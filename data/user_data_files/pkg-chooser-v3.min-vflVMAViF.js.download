define("metaserver/static/js/core/sdk_helpers",["require","exports","dropbox-internal-sdk","js/browser/cookies"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCookieAuthSDKAuth=t.getOAuthSDKAuth=void 0;const r=/^www\.dropbox\.com$/,o=/^meta-.*-dbx\.dev\.corp\.dropbox\.com$/;t.getOAuthSDKAuth=(e,t,i)=>{const r=o.test(window.location.hostname);return new s.DropboxAuth({clientId:e,clientSecret:t,refreshToken:i,domain:r?window.location.hostname:void 0})};t.getCookieAuthSDKAuth=e=>{const t=window.location.hostname;if(!r.test(t)&&!o.test(t))throw new Error("Cannot initialize the SDK on an unsupported domain.");return new s.DropboxAuth({domain:t,domainDelimiter:"",fetch:(t,s)=>{const n=new Headers((null==s?void 0:s.headers)||[]),a=window.location.hostname;(r.test(a)||o.test(a))&&n.append("X-CSRF-Token",i.Cookies.read("__Host-js_csrf")||"");const l=e();l&&n.append("X-Dropbox-Uid",l);const c=Object.assign(Object.assign({},s||{}),{headers:n});return fetch(t,c)}})}})),define("metaserver/static/js/dropins_v3/file_browser/fullscreen_preview",["require","exports","tslib","lodash","react","ts-key-enum","metaserver/static/js/dropins_v3/shared/async_filename_text","metaserver/static/js/dropins_v3/shared/async_icons","metaserver/static/js/dropins_v3/file_browser/file_thumbnail","metaserver/static/js/clean/raf_throttle","metaserver/static/js/components/ui/css"],(function(e,t,s,i,r,o,n,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullScreenPreview=void 0,i=s.__importStar(i),r=s.__importDefault(r);class h extends r.default.Component{constructor(e){super(e),this.state={key:0,windowHeight:0,windowWidth:window.screen.width},this.onWindowResize=new c.RafThrottle(()=>{this.props.webTimer&&null===this.props.webTimer.timeToInteractive()||this.setState(e=>e.windowHeight>500&&window.innerHeight<=500||e.windowHeight<=500&&window.innerHeight>500?{key:e.key+1,windowHeight:window.innerHeight,windowWidth:window.innerWidth}:Object.assign(Object.assign({},e),{windowHeight:window.innerHeight,windowWidth:window.innerWidth}))}).request,this.onCheckboxClick=e=>{var t;null===(t=this.props.telemetryClient)||void 0===t||t.logEvent({name:"chooser_fullscreen_preview_checkbox_click"})},this.handleKeyDown=e=>{this.selectableIndices(this.props.files).length>1&&(e.key===o.Key.ArrowLeft?this.cycleLeft():e.key===o.Key.ArrowRight&&this.cycleRight())},this.onTileClicked=e=>t=>{var s;e!==this.props.index&&this.props.onChangedIndex(e),null===(s=this.props.telemetryClient)||void 0===s||s.logEvent({name:"chooser_fullscreen_preview_carousel_item_click"})},this.leftArrowClicked=e=>{var t;this.cycleLeft(),null===(t=this.props.telemetryClient)||void 0===t||t.logEvent({name:"chooser_fullscreen_preview_carousel_cta_click"})},this.rightArrowClicked=e=>{var t;this.cycleRight(),null===(t=this.props.telemetryClient)||void 0===t||t.logEvent({name:"chooser_fullscreen_preview_carousel_cta_click"})},this.selectableIndices=i.memoize(e=>{const t=[];return e.forEach((e,s)=>{this.props.isItemSelectable(e)&&t.push(s)}),t}),this.onCheckboxClick=this.onCheckboxClick.bind(this)}componentDidMount(){var e;window.addEventListener("resize",this.onWindowResize),this.onWindowResize(),null===(e=this.props.telemetryClient)||void 0===e||e.logEvent({name:"chooser_fullscreen_preview"})}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}cycleLeft(){const{files:e,index:t}=this.props,s=this.selectableIndices(e),r=i.sortedIndex(s,t);this.props.onChangedIndex(s[h.cycleIndex(s,r-1)])}cycleRight(){const{files:e,index:t}=this.props,s=this.selectableIndices(e),r=i.sortedIndex(s,t);this.props.onChangedIndex(s[h.cycleIndex(s,r+1)])}static cycleIndex(e,t){return t>e.length-1?0:t<0?e.length-1:t}addCarouselIndices(e,t,s,i){let r=h.cycleIndex(t,s+1),o=h.cycleIndex(t,s-1);for(let s=0;s<i;s++)if(s%2==1){if(e.includes(t[o]))return;e.unshift(t[o]),o=h.cycleIndex(t,o-1)}else{if(e.includes(t[r]))return;e.push(t[r]),r=h.cycleIndex(t,r+1)}}renderBackButton(){return r.default.createElement("button",{className:"dropins-fullscreen-preview-back-button-container",onClick:this.props.onExit},r.default.createElement(a.AsyncIconArrow,{className:"dropins-fullscreen-preview-reverse-right-arrow dropins-fullscreen-preview-arrow",name:"right"}))}renderHeader(){const e=this.props.files[this.props.index];return r.default.createElement("div",{className:"dropins-fullscreen-preview-header-container"},this.renderBackButton(),r.default.createElement("div",{className:"dropins-fullscreen-preview-title-container"},r.default.createElement(n.AsyncFileNameText,{className:"dropins-fullscreen-preview-title",color:"inherit",path:e.fq_path,highlights:e.filename_highlights||void 0})))}renderLeftArrow(){return this.selectableIndices(this.props.files).length>1?r.default.createElement("button",{className:"dropins-fullscreen-preview-left-arrow-container",onClick:this.leftArrowClicked},r.default.createElement(a.AsyncIconArrow,{className:"dropins-fullscreen-preview-reverse-right-arrow dropins-fullscreen-preview-arrow",name:"right"})):null}renderRightArrow(){return this.selectableIndices(this.props.files).length>1?r.default.createElement("button",{className:"dropins-fullscreen-preview-right-arrow-container",onClick:this.rightArrowClicked},r.default.createElement(a.AsyncIconArrow,{className:"dropins-fullscreen-preview-arrow",name:"right"})):null}renderTile(e,t){const{disabledForFile:s,files:i,selectedForFile:o,thumbStore:n}=this.props,a=this.props.isItemSelectable(i[e])?"show":"hide",c=s?s(i[e]):void 0,d=o?o(i[e]):void 0,h=e!==this.props.index?.4:void 0;let p=void 0;return e===this.props.index&&(p=this.state.key),r.default.createElement(l.FileThumbnail,{checkboxMode:a,disabled:c,file:i[e],key:p,onCheckboxChange:this.props.onCheckboxChange(e),onCheckboxClick:this.onCheckboxClick,onClick:this.onTileClicked(e),opacity:h,selected:d,thumbStore:n,width:t})}renderPreviewAndCarousel(){return r.default.createElement("div",{className:"dropins-fullscreen-preview-tile-and-carousel-container"},r.default.createElement("div",{className:"dropins-fullscreen-preview-tile-container"},this.renderTile(this.props.index),this.renderLeftArrow(),this.renderRightArrow()),this.renderCarousel())}renderCarouselTiles(e){return e.map(e=>this.renderTile(e,150))}renderCarousel(){if(this.state.windowHeight>500){const e=this.selectableIndices(this.props.files),t=[],s=i.sortedIndex(e,this.props.index),o=Math.max(Math.floor(this.state.windowWidth/150)-1,0);if(0===e.length)throw new Error("Fullscreen Previewer must have at least one selectable file");return t.push(e[s]),this.addCarouselIndices(t,e,s,o),r.default.createElement("div",{className:"dropins-fullscreen-preview-carousel-container"},this.renderCarouselTiles(t))}return null}render(){const{files:e}=this.props;return e.length>0?r.default.createElement("div",{className:"dropins-chooser-content dropins-fullscreen-preview",onKeyDown:this.handleKeyDown,tabIndex:0},r.default.createElement("div",{className:"dropins-fullscreen-preview-header-and-tile"},this.renderHeader(),this.renderPreviewAndCarousel())):null}}h.displayName="FullScreenPreviewComponent",t.FullScreenPreview=(0,d.requireCssWithComponent)(h,["/static/metaserver/static/css/dropins_v3/file_browser/index-vflRZPVU4.css","/static/metaserver/static/css/dropins_v3/chooser/index-vflr_sBmR.css"])})),define("metaserver/static/js/dropins_v3/shared/file_state",["require","exports","tslib","immutable","metaserver/static/js/pnm/utils"],(function(e,t,s,i,r){"use strict";function o(e,t){return(e.filesAndFolders.get(t)||i.List()).filter(e=>!(0,r.isSupportedLinkNodeClickAction)(e.per_node_metadata))}Object.defineProperty(t,"__esModule",{value:!0}),t.setFilesAndFolders=t.appendToFilesAndFolders=t.filesAndFoldersForUser=void 0,i=s.__importStar(i),t.filesAndFoldersForUser=o,t.appendToFilesAndFolders=function(e,t,s){const i=o(e,t).push(s);return{filesAndFolders:e.filesAndFolders.set(t,i)}},t.setFilesAndFolders=function(e,t,s){return{filesAndFolders:e.filesAndFolders.set(t,i.List(s))}}})),define("metaserver/static/js/dropins_v3/chooser/api_client",["require","exports","tslib","js/browser/cookies","metaserver/static/js/core/uri","metaserver/static/js/dropins_v3/shared/ajax_error","metaserver/static/js/dropins_v3/shared/prefetch"],(function(e,t,s,i,r,o,n){"use strict";function a(e){return e&&e.__REGISTER_DROPINS_CHOOSER_BROWSE_PRELOAD_HANDLER}function l(e){return e&&e.__REGISTER_DROPINS_CHOOSER_RECENT_PRELOAD_HANDLER}function c(e){return e&&e.__REGISTER_DROPINS_CHOOSER_SUGGESTIONS_PRELOAD_HANDLER}Object.defineProperty(t,"__esModule",{value:!0}),t.ChooserApiClient=void 0;class d{constructor(e="3",t,s,i){this.version=e,this.linkType=t,this.appKey=s,this.correlationId=i}browseIfAvailable(){if(a(window)&&!d.hasUsedBrowsePrefetch){const e=window.__REGISTER_DROPINS_CHOOSER_BROWSE_PRELOAD_HANDLER.getDataIfAvailable();if((0,n.hasPayload)(e))return d.hasUsedBrowsePrefetch=!0,JSON.parse(e.payload)}return null}recentIfAvailable(){if(l(window)&&!d.hasUsedRecentPrefetch){const e=window.__REGISTER_DROPINS_CHOOSER_RECENT_PRELOAD_HANDLER.getDataIfAvailable();if((0,n.hasPayload)(e))return d.hasUsedRecentPrefetch=!0,JSON.parse(e.payload)}return null}suggestionsIfAvailable(){if(c(window)&&!d.hasUsedSuggestionsPrefetch){const e=window.__REGISTER_DROPINS_CHOOSER_SUGGESTIONS_PRELOAD_HANDLER.getDataIfAvailable();if((0,n.hasPayload)(e))return d.hasUsedSuggestionsPrefetch=!0,JSON.parse(e.payload)}return null}browse(t,i){return s.__awaiter(this,void 0,void 0,(function*(){if(a(window)&&!d.hasUsedBrowsePrefetch)return d.hasUsedBrowsePrefetch=!0,new Promise(window.__REGISTER_DROPINS_CHOOSER_BROWSE_PRELOAD_HANDLER).then(JSON.parse,()=>this.browse(t,i));return(yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],t,s)}).then(s.__importStar)).WebRequest({url:"/dropins/browse",data:{correlation_id:this.correlationId,fq_path:i},subject_user:t}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))}recent(t){return s.__awaiter(this,void 0,void 0,(function*(){if(l(window)&&!d.hasUsedRecentPrefetch)return d.hasUsedRecentPrefetch=!0,new Promise(window.__REGISTER_DROPINS_CHOOSER_RECENT_PRELOAD_HANDLER).then(JSON.parse,()=>this.recent(t));return(yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],t,s)}).then(s.__importStar)).WebRequest({url:"/dropins/recent",data:{correlation_id:this.correlationId,include_files:!0},subject_user:t}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))}suggestions(t,i){return s.__awaiter(this,void 0,void 0,(function*(){if(c(window)&&!d.hasUsedSuggestionsPrefetch)return d.hasUsedSuggestionsPrefetch=!0,new Promise(window.__REGISTER_DROPINS_CHOOSER_SUGGESTIONS_PRELOAD_HANDLER).then(JSON.parse,()=>this.suggestions(t,i));return(yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],t,s)}).then(s.__importStar)).WebRequest({url:"/dropins/suggestions",data:{correlation_id:this.correlationId,include_files:!0,experiment_group:i},subject_user:t}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))}search(t,i){return s.__awaiter(this,void 0,void 0,(function*(){const r=yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_jquery"],t,s)}).then(s.__importStar);return new Promise((e,s)=>{this.currentSearchXhr&&this.currentSearchXhr.abort(),this.currentSearchXhr=r.WebRequest({url:"/dropins/search",data:{correlation_id:this.correlationId,query:i},subject_user:t,success:e,error:(e,t,i)=>{s(i)},complete:e=>{e===this.currentSearchXhr&&delete this.currentSearchXhr}})}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))}share(t,i,r,n){return s.__awaiter(this,void 0,void 0,(function*(){const a=i.map(e=>[t,e]);return(yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],t,s)}).then(s.__importStar)).WebRequest({url:"/dropins/share",data:Object.assign({correlation_id:this.correlationId,version:this.version,uid_and_fq_paths:JSON.stringify(a),link_type:this.linkType,app_key:this.appKey,source:r},n?{fields:JSON.stringify(n)}:{})}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))}upload(e,t,o,n){return s.__awaiter(this,void 0,void 0,(function*(){if(!t.size)return Promise.reject({error:"unknown"});if(t.size>314572800)return Promise.reject({error:"too_large"});const s=new r.URI({authority:"dl-web.dropbox.com",path:"/upload_cross_domain",query:{filename:t.name,dest:o,t:i.Cookies.read("__Host-js_csrf"),overwrite:"0",_subject_uid:e.toString()}});return new Promise((e,i)=>{const r=new XMLHttpRequest;r.open("POST",s.toString(),!0),r.setRequestHeader("Content-Type",t.type||"application/octet-stream"),r.withCredentials=!0,r.upload.addEventListener("progress",n,!1),r.addEventListener("load",this.uploadResolveWrapper(r,e),!1),r.addEventListener("error",i,!1),r.send(t)})}))}uploadResolveWrapper(e,t){return s=>{let i;e.responseText&&(i=JSON.parse(e.responseText)),i&&(i.path||i.error)||(i={error:"unknown"}),t(i)}}checkFSW(t,i,r){return s.__awaiter(this,void 0,void 0,(function*(){return(yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],t,s)}).then(s.__importStar)).SilentBackgroundRequest({url:"/cmd/upload_precheck",data:{correlation_id:this.correlationId,path:i,to_path:r,fsw_request:"check",subject_user:t,is_admin_console:!1}}).then(JSON.parse)}))}}t.ChooserApiClient=d,d.hasUsedBrowsePrefetch=!1,d.hasUsedRecentPrefetch=!1,d.hasUsedSuggestionsPrefetch=!1})),define("metaserver/static/js/dropins_v3/chooser/chooser",["require","exports","tslib","classnames","react-intl","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/filetypes","metaserver/static/js/core/html","immutable","metaserver/static/js/core/exception","metaserver/static/js/core/notify","react","metaserver/static/js/components/ui/css","metaserver/static/js/core/i18n","metaserver/static/js/dropins_v3/shared/ajax_error","metaserver/static/js/dropins_v3/shared/file_state","metaserver/static/js/dropins_v3/shared/breadcrumbs","dig-components/buttons","dig-components/controls","metaserver/static/js/dropins_v3/shared/navigation_stack","metaserver/static/js/dropins_v3/chooser/routes","metaserver/static/js/dropins_v3/chooser/file_state","metaserver/static/js/dropins_v3/shared/culled_list","dig-components/typography","metaserver/static/js/dropins_v3/file_browser/empty","metaserver/static/js/dropins_v3/file_browser/fullscreen_preview","metaserver/static/js/dropins_v3/file_browser/file_thumbnail","metaserver/static/js/dropins_v3/shared/dropins_header","metaserver/static/js/dropins_v3/file_browser/grid_manager","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/dropins_v3/file_browser/view_toggle_button","metaserver/static/js/dropins_v3/shared/time_utils","metaserver/static/js/dropins_v3/shared/header","metaserver/static/js/dropins_v3/shared/item_row","metaserver/static/js/dropins_v3/file_browser/loading","metaserver/static/js/dropins_v3/chooser/upload_files_button","metaserver/static/js/dropins_v3/shared/request_queue","metaserver/static/js/dropins_v3/shared/search_input","metaserver/static/js/dropins_v3/chooser/selected_files_popover","metaserver/static/js/dropins_v3/shared/sidebar","dig-components/snackbar","dig-components/icons","dig-components/icons/src","dig-components/progress_indicators","dig-components/layer","dig-components/tabs","metaserver/static/js/dropins_v3/shared/user_friendly_error","metaserver/static/js/dropins_v3/chooser/file_uploader","metaserver/static/js/cloud_docs/constants","metaserver/static/js/dropins_v3/shared/chooser_saver_utils","lodash","js/browser/cookies","metaserver/static/js/dropins_v3/chooser/utils","metaserver/static/js/clean/ts_utils"],(function(e,t,s,i,r,o,n,a,l,c,d,h,p,u,m,g,f,_,v,w,S,b,C,E,y,I,F,x,R,k,T,j,A,M,N,P,O,U,q,L,D,B,W,H,G,z,V,K,Q,J,Y,X,Z,$){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chooser=t.LEGACY_GMAIL_EXT_APPKEY=void 0,i=s.__importDefault(i),o=s.__importStar(o),l=s.__importStar(l),c=s.__importStar(c),h=s.__importDefault(h);function ee(e){return e.permissions&&e.extensions&&e.fileselect&&e.sizeFits}function te(e){return ee(e)&&e.folderselect&&e.notVaultFolder}t.LEGACY_GMAIL_EXT_APPKEY="82bgsya5b7h847j";class se extends h.default.Component{constructor(e){let t;super(e),this.viewTypes=["list","tiles"],this.state={isLoading:!0,isSharing:!1,canUpload:!1,isTsd:!1,navigationStack:[{path:"recent"}],filesAndFolders:l.Map(),gridScrollPosition:0,listScrollPosition:0,selectedFiles:l.Map(),viewType:this.props.initialViewType||"list",latestBrowseQuery:"",renderFullScreenPreview:!1,indexForPreview:0,inSharedFolder:!1,chooserExtras:{},fileIdToPredictId:{}},this.ttiState="BEGIN",this.mountedTimestampMsec=0,this.handleNavigationError=e=>{e instanceof m.AjaxError&&"abort"!==e.errorThrown?(this.setState({isLoading:!1}),d.Notify.error(u.intl.formatMessage({id:"D8D6Vb",defaultMessage:"Failed to load request."}))):e instanceof V.UserFriendlyError?d.Notify.error(e.userFriendlyMessage):d.Notify.error(u.intl.formatMessage({id:"vMxvH1",defaultMessage:"An error occurred."})),c.reportException({err:e,tags:["dropins"],severity:c.SEVERITY.NONCRITICAL})},this.updateWithRecentResponse=(e,t,s)=>this.updateNavigationState(e,t,s.file_info),this.updateWithSuggestionsResponse=(e,t,s)=>{var i,r,o;const n=this.updateNavigationState(e,t,s.file_info),a={},l=null===(i=s.suggestions_metadata)||void 0===i?void 0:i.used_variant;return l&&(a.used_variant=l),Object.assign(Object.assign({},n),{chooserExtras:Object.assign(Object.assign({},n.chooserExtras),{suggestions:a,suggestionsShown:Object.assign({},a)}),fileIdToPredictId:null!==(o=null===(r=null==s?void 0:s.suggestions_metadata)||void 0===r?void 0:r.file_id_to_predict_id)&&void 0!==o?o:{}})},this.updateWithBrowseResponse=(e,t,s)=>{const i=this.updateNavigationState(e,t,s.file_info),r=-1!==s.containing_ns_permissions.indexOf("edit_contents");return Object.assign(Object.assign({},i),{canUpload:r,isTsd:s.is_tsd,inSharedFolder:s.in_shared_folder})},this.cacheBrowseResponse=e=>{const t=(0,w.getMostRecentRoute)(this.state.navigationStack).query;Object.keys(this.browseResponseCache).forEach(e=>{-1!==e.indexOf(t)&&delete this.browseResponseCache[e]}),this.browseResponseCache[t]=e,(0,Y.debounce)(this.invalidateBrowseCache,6e4)()},this.invalidateBrowseCache=()=>{this.browseResponseCache={}},this.handleBrowseSuccess=(e,t=!1)=>s=>{this.logEvent({name:"chooser_browse_success",extras:{in_shared_folder:s.in_shared_folder,cached_response:t}}),t||this.cacheBrowseResponse(s),this.setState(this.updateWithBrowseResponse(e,this.state,s)),this.handleCursorChange(s.navigation_cursor)},this.handleRecentSuccess=e=>t=>{this.logEvent({name:"chooser_recent_success"}),this.setState(this.updateWithRecentResponse(e,this.state,t)),this.handleCursorChange(t.navigation_cursor)},this.handleSuggestionsSuccess=e=>t=>{this.setState(this.updateWithSuggestionsResponse(e,this.state,t),()=>{var e;const t=this.getSuggestionExperimentGroup(),s=this.currentFilesAndFolders().toArray().map(e=>this.getPredictId(null==e?void 0:e.file_id)).filter($.notEmpty).map(e=>({prediction_id:e,experiment_group:t}));this.logEvent({name:"chooser_suggestions_success",predict_logger:{viewed:s},extras:{suggestions_used_variant:null===(e=this.state.chooserExtras.suggestions)||void 0===e?void 0:e.used_variant}})}),this.handleCursorChange(t.navigation_cursor)},this.handleSearchSuccess=e=>t=>{this.logEvent({name:"chooser_search_success"}),this.setState(this.updateNavigationState(e,this.state,t.file_info))},this.handleUploadClick=(e,t,s)=>(this.logEvent({name:"chooser_upload_attempt"}),this.props.checkFSWsForUpload?this.props.checkFSWsForUpload(e,t,s):Promise.resolve(!0)),this.handleUploadSuccess=(e,t,s)=>{this.logEvent({name:"chooser_upload_success"}),this.setState(e=>Object.assign(Object.assign({},e),{uploadStatus:{fileName:o.filename(t.fq_path),progressPercentage:1,uploaded:!0}})),e===this.getUserId()&&(this.hasRouteChanged(e,s)||this.setState(s=>Object.assign(Object.assign({},s),(0,g.appendToFilesAndFolders)(s,e,t))),te(this.selectionChecks(t))&&(this.props.multiselect?this.setState(s=>Object.assign(Object.assign({},s),(0,b.multiSelectFiles)(s,e,[t]))):this.setState(s=>Object.assign(Object.assign({},s),(0,b.singleSelectFile)(s,e,t))))),this.invalidateBrowseCache()},this.handleUploadProgress=(e,t,s)=>{const i={fileName:e,progressPercentage:s,uploaded:!1};0===s?this.setState({uploadStatus:i,hideStatus:!1}):this.setState({uploadStatus:i})},this.handleUploadCancel=()=>{this.setState({uploadStatus:void 0})},this.handleUploadError=e=>{let t;switch(e){case"UPLOAD_QUOTA":const e="personal"===this.props.userRole?"/upgrade":"/business/try";t=new a.HTML(u.intl.formatMessage({id:"gTTtEu",defaultMessage:"You can’t upload any files because your Dropbox is full. <link>Get more space</link>"},{link:t=>h.default.createElement(E.Link,{target:"_blank",href:e,rel:"noopener noreferrer"},t)}));break;case"UPLOAD_IGNORED":t=u.intl.formatMessage({id:"obSlFz",defaultMessage:"Sorry! This file name isn’t allowed."});break;case"UPLOAD_TOOLARGE":t=new a.HTML(u.intl.formatMessage({id:"klM4mG",defaultMessage:"The upload limit online is 300MB. You can upload larger files with the <link>Dropbox desktop application</link>."},{link:e=>h.default.createElement(E.Link,{href:"/install",target:"_blank",rel:"noopener noreferrer"},e)}));break;default:t=u.intl.formatMessage({id:"kBJj0f",defaultMessage:"There was an error while uploading your file."})}this.setState({uploadStatus:void 0}),d.Notify.error(t)},this.handleSearchQueryChange=e=>{this.setState(t=>{let s=t.navigationStack;const i=(0,w.getMostRecentRoute)(s),r="browse"===i.path?i.query:t.latestBrowseQuery;return(0,w.canPopRoute)(s)&&(s=(0,w.popRoute)(s)),e&&(s=(0,w.pushRoute)(s,{path:"search",query:e})),{navigationStack:s,latestBrowseQuery:r}})},this.handleNavigationChange=e=>{const t=(0,w.getMostRecentRoute)(this.state.navigationStack),s="browse"===t.path?t.query:this.state.latestBrowseQuery;switch(e){case"recent":return this.invalidateBrowseCache(),this.logEvent({name:"chooser_recent_attempt"}),void this.setState({navigationStack:[{path:"recent"}],latestBrowseQuery:s});case"suggestions":return this.invalidateBrowseCache(),this.logEvent({name:"chooser_suggested_attempt"}),void this.setState({navigationStack:[{path:"suggestions"}],latestBrowseQuery:s});case"browse":this.logEvent({name:"chooser_browse_attempt"}),this.setState({navigationStack:[{path:"browse",query:this.state.latestBrowseQuery}]});break;default:throw new Error("Unrecognized chooser tab")}},this.selectFiles=(e,...t)=>Object.assign(Object.assign({},e),(0,b.multiSelectFiles)(e,this.getUserId(),t)),this.deselectFiles=(e,...t)=>Object.assign(Object.assign({},e),(0,b.deselectFiles)(e,this.getUserId(),t)),this.updateSelection=(e,t,s,i,r)=>{const o=t[s];if(!te(this.selectionChecks(o)))return e;if(!this.props.multiselect)return"select"===i?Object.assign(Object.assign(Object.assign({},e),(0,b.singleSelectFile)(e,this.getUserId(),o)),{lastSelectedIndex:s}):Object.assign(Object.assign(Object.assign({},e),(0,b.deselectAllFiles)(e,this.getUserId())),{lastSelectedIndex:s});const n=[];if(r&&void 0!==e.lastSelectedIndex)for(let i=Math.min(e.lastSelectedIndex,s);i<=Math.max(e.lastSelectedIndex,s);i++){const e=t[i];e&&te(this.selectionChecks(e))&&n.push(e)}else n.push(o);return"select"===i?Object.assign(Object.assign({},this.selectFiles(e,...n)),{lastSelectedIndex:s}):Object.assign(Object.assign({},this.deselectFiles(e,...n)),{lastSelectedIndex:s})},this.handleRemoveSelectedFile=e=>{this.setState(t=>this.deselectFiles(t,e))},this.handleRemoveAllSelectedFiles=()=>{this.setState(Object.assign(Object.assign({},(0,b.deselectAllFiles)(this.state,this.getUserId())),{lastSelectedIndex:void 0}))},this.handleRowCheckboxChangeOverrideIndex=(e,t)=>s=>this.handleRowCheckboxChange(e,s||t),this.handleRowCheckboxChange=(e,t)=>s=>{var i;const r=null===(i=s.target)||void 0===i?void 0:i.checked,o=s.nativeEvent;this.setState(s=>this.updateSelection(s,e,t,r?"select":"deselect",!!(null==o?void 0:o.shiftKey)))},this.handleFullScreenExit=e=>{this.setState({renderFullScreenPreview:!1})},this.handleFullScreenNewIndex=e=>{this.setState({indexForPreview:e})},this.handleCancelClicked=()=>{var e;this.logEventBeforeCallback({name:"chooser_cancel",extras:{suggestions_used_variant:null===(e=this.state.chooserExtras.suggestions)||void 0===e?void 0:e.used_variant}},()=>{void 0!==this.props.onCancel&&this.props.onCancel()})},this.handleChooseClicked=()=>{this.logEventBeforeCallback({name:"chooser_choose_attempt"},()=>{this.setState({isSharing:!0});const e=this.getUserId(),t=(0,w.getMostRecentRoute)(this.state.navigationStack),s=this.currentSelectedFiles(),i=s.map(e=>e.fq_path).toArray(),r=this.canChooseCurrentFolder()&&0===s.count()&&"browse"===t.path?[t.query]:i,o=[];if("suggestions"===t.path)for(const e of s.toArray()){const t=this.state.fileIdToPredictId[e.file_id];t&&o.push(t)}this.confirmWithParentComponent(e,r).then(t=>t?this.createAndReturnLinks(e,r,o):Promise.resolve()).catch(e=>{if(e instanceof m.AjaxError&&"abort"!==e.errorThrown){this.setState({isLoading:!1});try{const t=JSON.parse(e.jqXHR.responseText);"CANNOT_CREATE_LINK"===t.error&&1===r.length?d.Notify.error(u.intl.formatMessage({id:"52zjhS",defaultMessage:"{folder} cannot be chosen."},{folder:r[0].substring(1)})):"ASSERTION_ERROR_ROOT_DIRECTORY"===t.error&&1===r.length?d.Notify.error(u.intl.formatMessage({id:"WmvY3S",defaultMessage:"User root folder cannot be chosen."})):d.Notify.error(u.intl.formatMessage({id:"D8D6Vb",defaultMessage:"Failed to load request."}))}catch(e){d.Notify.error(u.intl.formatMessage({id:"D8D6Vb",defaultMessage:"Failed to load request."}))}}else d.Notify.error(u.intl.formatMessage({id:"D8D6Vb",defaultMessage:"Failed to load request."}));c.reportException({err:e,tags:["dropins"],severity:c.SEVERITY.NONCRITICAL})}).then(()=>this.setState({isSharing:!1}))})},this.handleBreadcrumbClicked=e=>{this.logEvent({name:"chooser_navigate_attempt",extras:{source:"breadcrumb"}}),this.setState({navigationStack:[{path:"browse",query:e}]})},this.handleStatusBarCloseClicked=()=>{this.setState({hideStatus:!0})},this.updateListScrollPosition=e=>{this.setState({listScrollPosition:e})},this.updateGridScrollPosition=e=>{this.setState({gridScrollPosition:e})},this.changeViewType=e=>{if(this.props.vortexLogger)switch(e){case"tiles":this.props.vortexLogger.logRate("view_toggled_grid",1);break;case"list":this.props.vortexLogger.logRate("view_toggled_list",1)}this.setState({viewType:e})},this.handleChangeSelectAllCheckbox=e=>{var t;(null===(t=e.target)||void 0===t?void 0:t.checked)?this.setState(e=>this.selectFiles(e,...this.getSelectableItems())):this.setState(e=>this.deselectFiles(e,...this.getSelectableItems()))},this.renderFileListItem=(e,t)=>{const s=(0,w.getMostRecentRoute)(this.state.navigationStack),i=e[t],r=this.selectionChecks(i);return h.default.createElement("li",{key:i.fq_path,className:"dropins-chooser-files-list-item"},h.default.createElement(M.ItemRow,{item:i,disabled:!ee(r),checkboxMode:te(r)?"show":"hide",showPath:"browse"!==s.path,selected:this.currentSelectedFiles().has(i.fq_path),onCheckboxChange:this.handleRowCheckboxChange(e,t),onClick:this.handleRowClicked(e,t),webTimer:this.props.webTimer}))},this.triggerRenderFullScreenPreview=(e,t)=>{this.canBeSelected(e[t])&&this.setState({renderFullScreenPreview:!0,indexForPreview:t})},this.disabledForFile=e=>!ee(this.selectionChecks(e)),this.selectedForFile=e=>this.currentSelectedFiles().has(e.fq_path),this.canBeSelected=e=>te(this.selectionChecks(e)),this.renderFileListItemForCulledList=e=>(t,s)=>this.renderFileListItem(e,s),this.renderFileThumbnail=(e,t,s,i)=>{const r=e[t],o=this.selectionChecks(r);return h.default.createElement(F.FileThumbnail,{checkboxMode:te(o)?"show":"hide",disabled:!ee(o),file:r,labelHeight:i,width:s,onClick:this.handleRowClicked(e,t),onCheckboxChange:this.handleRowCheckboxChange(e,t),selected:this.currentSelectedFiles().has(r.fq_path),thumbStore:this.state.thumbStore})},this.renderDropinsHeader=(e,t)=>h.default.createElement(x.DropinsHeader,{text:e,height:t}),e.suggestionsIsDefault&&(this.state.navigationStack=[{path:"suggestions"}]),this.queue=new O.RequestQueue(e=>(0,S.areChooserRoutesEqual)((0,w.getMostRecentRoute)(this.state.navigationStack),e.route)&&this.getUserId()===e.userId),e.extensions&&e.extensions.length>0&&(this.state.extensionSet=l.Set(e.extensions)),"recent"===this.getInitialMode()&&(this.state.navigationStack=[{path:"recent"}],t=this.props.apiClient.recentIfAvailable(),t&&(this.state=this.updateWithRecentResponse(this.getUserId(),this.state,t))),"suggestions"===this.getInitialMode()?(this.state.navigationStack=[{path:"suggestions"}],t=this.props.apiClient.suggestionsIfAvailable(),t&&(this.state=this.updateWithSuggestionsResponse(this.getUserId(),this.state,t))):"browse"===this.getInitialMode()&&(this.state.navigationStack=[{path:"browse",query:this.props.initialPath||""}],t=this.props.apiClient.browseIfAvailable(),t&&(this.state=this.updateWithBrowseResponse(this.getUserId(),this.state,t))),t&&(this.state.isLoading=!1,this.ttiState="FETCHED_INITIAL_DATA",this.props.webTimer&&this.props.webTimer.fetchedDataRequiredForTTI()),this.state.latestBrowseQuery=this.props.initialPath||"";const s=(0,w.getMostRecentRoute)(this.state.navigationStack),i={userId:this.getUserId(),dest:"browse"===s.path?s.query:"",apiClient:this.props.apiClient,checkUploadFSW:this.state.isTsd,onUploadClick:this.handleUploadClick,onUploadSuccess:this.handleUploadSuccess,onUploadError:this.handleUploadError,onUploadProgress:this.handleUploadProgress,onUploadCancel:this.handleUploadCancel};this.fileUploader=new K.FileUploader(i),this.browseResponseCache={}}getInitialMode(){return this.props.initialMode?this.props.initialMode:this.props.suggestionsIsDefault?"suggestions":"recent"}componentDidMount(){this.mountedTimestampMsec=(0,Z.getTimestampMsec)(),"FETCHED_INITIAL_DATA"===this.ttiState?(this.ttiState="INTERACTIVE",this.props.webTimer&&this.props.webTimer.markTimeToInteractive()):this.refresh(!1);const e=()=>{this.props.vortexLogger&&(this.props.vortexLogger.logRate("page_start",1),this.logEvent({name:"chooser_start",extras:{initial_tab:this.getInitialMode(),suggestions_is_default:this.props.suggestionsIsDefault,suggestions_is_enabled:this.props.suggestionsIsEnabled,suggestions_variant:this.props.suggestionsVariant}})),this.invalidateBrowseCache(),this.refresh(!1)};this.props.webTimer?this.props.webTimer.waitForTTI().then(e):this.props.timeout(500).then(e),this.loadThumbStore()}UNSAFE_componentWillReceiveProps(e){this.props.viewer===e.viewer&&this.props.userRole===e.userRole||(this.invalidateBrowseCache(),this.setState(e=>"browse"===(0,w.getMostRecentRoute)(e.navigationStack).path?Object.assign(Object.assign({},e),{navigationStack:[{path:"browse",query:""}]}):Object.assign({},e))),this.props.extensions!==e.extensions&&(e.extensions&&e.extensions.length>0?this.setState({extensionSet:l.Set(e.extensions)}):this.setState({extensionSet:void 0}))}componentDidUpdate(e,t){"FETCHED_INITIAL_DATA"===this.ttiState&&(this.ttiState="INTERACTIVE",this.props.webTimer&&this.props.webTimer.markTimeToInteractive());const s=(0,w.getMostRecentRoute)(t.navigationStack),i=(0,w.getMostRecentRoute)(this.state.navigationStack);(0,S.areChooserRoutesEqual)(s,i)&&e.viewer===this.props.viewer&&e.userRole===this.props.userRole||this.refresh(!0),this.fileUploader.setUserId(this.getUserId()),this.fileUploader.setDest("browse"===i.path?i.query:""),this.fileUploader.setCheckUploadFSW(this.state.isTsd),t.chooserExtras!==this.state.chooserExtras&&this.props.onChooserExtrasChanged&&this.props.onChooserExtrasChanged(this.state.chooserExtras)}logEvent(e){if(void 0!==this.props.telemetryClient){const t=this.props.telemetryClient;this.props.webTimer?this.props.webTimer.waitForTTI().then(()=>t.logEvent(e)):t.logEvent(e)}}logEventBeforeCallback(e,t){if(void 0!==this.props.telemetryClient){const s=this.props.timeout(500);this.props.telemetryClient.logEventBeforeCallback(e,t,s)}else t()}loadThumbStore(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.props.webTimer){yield this.props.webTimer.waitForTTI();const{BufferedThumbStore:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/photos/thumb_loading/buffered_thumb_store"],t,s)}).then(s.__importStar);this.setState({thumbStore:new t})}}))}getUserId(){const e=this.props.viewer.get_uid_by_role(this.props.userRole);if(!e)throw new Error(`Viewer must be signed in to role ${this.props.userRole}`);return e}currentSelectedFiles(){return(0,b.selectedFilesForUser)(this.state,this.getUserId())}currentFilesAndFolders(){return(0,g.filesAndFoldersForUser)(this.state,this.getUserId())}hasRouteChanged(e,t){const s=(0,w.getMostRecentRoute)(this.state.navigationStack);return"search"===s.path||"recent"===s.path||e!==this.getUserId()||("browse"===s.path?s.query:"")!==t}updateNavigationState(e,t,s){return"FETCHING_INITIAL_DATA"===this.ttiState&&(this.ttiState="FETCHED_INITIAL_DATA",this.props.webTimer&&this.props.webTimer.fetchedDataRequiredForTTI()),Object.assign(Object.assign(Object.assign({},t),(0,g.setFilesAndFolders)(t,e,s)),{isLoading:!1,inSharedFolder:!1,chooserExtras:Object.assign(Object.assign({},t.chooserExtras),{suggestions:null}),fileIdToPredictId:{}})}handleCursorChange(e){!this.props.parentComponent.onCursorChange||this.props.webTimer&&null===this.props.webTimer.timeToInteractive||this.props.parentComponent.onCursorChange(e),X.Cookies.create("dropins_chooser_navigation_cursor",e,365,void 0,"/chooser")}getPredictId(e){var t;return e&&null!==(t=this.state.fileIdToPredictId[e])&&void 0!==t?t:null}refresh(e){"BEGIN"===this.ttiState&&(this.ttiState="FETCHING_INITIAL_DATA");const t=this.getUserId();e&&this.setState(e=>Object.assign(Object.assign({},(0,g.setFilesAndFolders)(e,this.getUserId(),[])),{isLoading:!0,lastSelectedIndex:void 0}));const s=(0,w.getMostRecentRoute)(this.state.navigationStack);switch(s.path){case"recent":this.queue.enqueueRequest(this.props.apiClient.recent(t),{userId:t,route:s},this.handleRecentSuccess(t),this.handleNavigationError);break;case"suggestions":this.queue.enqueueRequest(this.props.apiClient.suggestions(t,this.props.suggestionsExperimentGroup),{userId:t,route:s},this.handleSuggestionsSuccess(t),this.handleNavigationError);break;case"browse":const e=this.browseResponseCache&&this.browseResponseCache[s.query];e?this.handleBrowseSuccess(t,!0)(e):this.queue.enqueueRequest(this.props.apiClient.browse(t,s.query),{userId:t,route:s},this.handleBrowseSuccess(t,!1),this.handleNavigationError);break;case"search":this.queue.enqueueRequest(this.props.apiClient.search(t,s.query),{userId:t,route:s},this.handleSearchSuccess(t),this.handleNavigationError);break;default:throw new Error("Unrecognized chooser route")}}handleRowClicked(e,t){return s=>{const i=e[t];!(function(e){return!!e.is_dir})(i)?this.props.enableFullScreenPreview?this.triggerRenderFullScreenPreview(e,t):this.setState(r=>this.updateSelection(r,e,t,this.currentSelectedFiles().has(i.fq_path)?"deselect":"select",s.shiftKey)):(this.logEvent({name:"chooser_navigate_attempt",extras:{source:"row_item"}}),this.setState({navigationStack:[{path:"browse",query:i.fq_path}]}))}}getChooseMode(){switch((0,w.getMostRecentRoute)(this.state.navigationStack).path){case"recent":return"recent";case"suggestions":return"suggestions";case"browse":return this.props.viewer.is_paired?"personal"===this.props.userRole?"dropbox-personal":"dropbox-work":"dropbox";case"search":return"search";default:throw new Error("Unrecognized chooser route")}}confirmWithParentComponent(e,t){return this.props.parentComponent.onChooseClicked?this.props.parentComponent.onChooseClicked(e,t):Promise.resolve(!0)}getActiveTab(){return(0,w.getMostRecentRoute)(this.state.navigationStack).path}getSuggestionExperimentGroup(){return this.props.suggestionsExperimentGroup?this.props.suggestionsExperimentGroup:this.props.productKey?`dropins_suggestions__${this.props.productKey}`.replace(/[^a-zA-Z0-9]/g,"_"):"dropins_suggestions"}createAndReturnLinks(e,t,s){const i=e=>{(0,k.logRateBeforeCallback)(this.props.vortexLogger,this.props.timeout,"choose_success",()=>{var t,i;const r=this.getSuggestionExperimentGroup(),o=s.map(e=>({prediction_id:e,action:"choose",experiment_group:r}));this.logEventBeforeCallback({name:"chooser_choose_success",extras:{active_tab:this.getActiveTab(),initial_tab:this.getInitialMode(),msec_to_choose:(0,Z.getTimestampMsec)()-this.mountedTimestampMsec,suggestions_is_default:this.props.suggestionsIsDefault,suggestions_is_enabled:this.props.suggestionsIsEnabled,suggestions_variant:this.props.suggestionsVariant,suggestions_used_variant:null===(t=this.state.chooserExtras.suggestions)||void 0===t?void 0:t.used_variant,suggestions_used_variant_shown:null===(i=this.state.chooserExtras.suggestionsShown)||void 0===i?void 0:i.used_variant},predict_logger:{actioned:o}},()=>{this.props.parentComponent.onChooseSuccess(e)})})};return this.props.apiClient.share(e,t,this.getChooseMode(),this.props.fields).then(e=>i(e))}renderActionsPanel(e){switch(e.path){case"search":{const t=(0,r.defineMessage)({id:"jrp8mr",defaultMessage:"<text>Viewing results for </text><flex><bold>{query}</bold></flex>"});return h.default.createElement("div",{className:"dropins-chooser-actions-menu-search-text"},u.intl.formatMessage(t,{text:e=>h.default.createElement(E.Text,{size:"small",color:"faint",key:"results",className:"dropins-text-ellipsis"},e),flex:e=>h.default.createElement("div",{className:"dropins-chooser-actions-menu-query-text-container"},e),bold:e=>h.default.createElement(E.Text,{size:"small",isBold:!0,color:"faint",key:"query",className:"dropins-text-ellipsis"},e),query:e.query}))}case"browse":return this.props.appKey===t.LEGACY_GMAIL_EXT_APPKEY&&""===e.query?this.renderTabs("browse"):this.renderBreadcrumbs(e);case"recent":return"wide"===this.props.displayMode?h.default.createElement(E.Text,{size:"small",color:"faint",className:"dropins-text-ellipsis"},u.intl.formatMessage({id:"lG1K3n",defaultMessage:"Showing your recently accessed items"})):this.renderTabs("recent");case"suggestions":return"wide"===this.props.displayMode?h.default.createElement(E.Text,{size:"small",color:"faint",className:"dropins-text-ellipsis"},u.intl.formatMessage({id:"53qu9V",defaultMessage:"Showing your suggested items"})):this.renderTabs("suggestions")}}renderSelectAllCheckbox(){const{checked:e,isIndeterminate:t}=this.getSelectAllCheckboxState();return h.default.createElement("div",{className:"dropins-chooser-select-all-checkbox"},h.default.createElement(v.Checkbox,{"aria-label":"Select-All-Checkbox",className:"dropins-item-row-checkbox",checked:e,onChange:this.handleChangeSelectAllCheckbox,isIndeterminate:t}))}renderActionsMenu(e){const t="browse"===e.path,s=this.state.isTsd,r=!this.state.canUpload||!this.props.checkFSWsForUpload&&s,o=this.props.telemetryClient;return h.default.createElement("div",{className:"dropins-chooser-actions-menu"},"browse"===e.path&&this.props.multiselect&&this.getSelectableItems().length>0?this.renderSelectAllCheckbox():null,h.default.createElement("div",{className:"dropins-chooser-actions-menu-panel"},this.renderActionsPanel(e)),h.default.createElement("div",{className:(0,i.default)("dropins-chooser-upload-button-container",{"dropins-chooser-upload-button-container-hidden":"search"===e.path})},t?h.default.createElement(P.UploadFilesButton,{disabled:r,uploader:this.fileUploader,telemetryClient:o}):null),h.default.createElement("div",{className:"dropins-chooser-view-types-popover-container"},h.default.createElement(T.ViewToggleButton,{viewType:this.state.viewType,viewTypes:this.viewTypes,onSwitchViewType:this.changeViewType})))}getSelectableItems(){return this.currentFilesAndFolders().toArray().filter(e=>te(this.selectionChecks(e)))}getSelectedCountInCurrentView(){let e=0;const t=this.currentSelectedFiles();for(const s of this.currentFilesAndFolders().toArray())t.has(s.fq_path)&&e++;return e}getSelectAllCheckboxState(){const e=this.getSelectedCountInCurrentView();return 0===e?{checked:!1,isIndeterminate:!1}:e===this.getSelectableItems().length?{checked:!0,isIndeterminate:!1}:{checked:!1,isIndeterminate:!0}}renderBreadcrumbs(e){let t=2;window.matchMedia("screen and (max-width: 500px)").matches?t=1:window.matchMedia("screen and (min-width: 1024px)").matches&&(t=3);const s=(0,J.buildCrumbList)(this.props.viewer.get_root_name_by_role(this.props.userRole),e);return h.default.createElement(f.Breadcrumbs,{userRole:this.props.userRole,breadcrumbs:s,onBreadcrumbClick:this.handleBreadcrumbClicked,tailLen:t})}renderTabs(e){return h.default.createElement(z.Tabs,{selectedTab:e,onSelection:e=>this.handleNavigationChange(e)},h.default.createElement(z.Tabs.Group,null,this.props.suggestionsIsEnabled&&h.default.createElement(z.Tabs.Tab,{id:"suggestions"},u.intl.formatMessage({id:"hh7boA",defaultMessage:"Suggestions"})),h.default.createElement(z.Tabs.Tab,{id:"browse"},u.intl.formatMessage({id:"cdAaQR",defaultMessage:"My files"})),h.default.createElement(z.Tabs.Tab,{id:"recent"},u.intl.formatMessage({id:"hDgBBt",defaultMessage:"Recents"}))))}canSelectWithExtension(e){return!(this.state.extensionSet&&!this.state.extensionSet.has(e))&&("righteous-preview"===this.props.apiClient.linkType||!(0,Q.isCloudBasedFileByExtension)(e))}checkFilePermissions(e){return!e.mount_access_perms||(this.props.requiredPerms&&0!==this.props.requiredPerms.length?this.props.requiredPerms.every(t=>e.mount_access_perms&&e.mount_access_perms.includes(t)):0!==e.mount_access_perms.length)}selectionChecks(e){const t=this.checkFilePermissions(e),s="."+o.file_extension(o.filename(e.fq_path)),i=e.is_dir||this.canSelectWithExtension(s),r=e.is_dir||this.props.fileselect,a=!e.is_dir||this.props.folderselect,l=void 0===this.props.sizeLimit?1/0:this.props.sizeLimit;return{permissions:!!t,extensions:!!i,fileselect:!!r,folderselect:!!a,sizeFits:!!(e.bytes<l),notVaultFolder:e.type!==n.FileTypes.VAULT_FOLDER}}getDropinsItems(){const e=[];return this.currentFilesAndFolders().toArray().forEach(t=>{e.push({type:"file",file:t})}),e}getRecentDropinsItems(){const e=(0,j.groupFilesByTime)(this.currentFilesAndFolders().toArray()),t=[];return e.forEach(({groupId:s,files:i})=>{e.length>1&&t.push({type:"header",text:j.groupName[s]}),i.forEach(e=>{t.push({type:"file",file:e})})}),t}getRecentFilesListItems(){const e=(0,j.groupFilesByTime)(this.currentFilesAndFolders().toArray()),t=[];e.forEach(({groupId:s,files:i})=>{e.length>1&&t.push({type:"group",groupId:s}),i.forEach(e=>{t.push({type:"file",file:e})})});const s=t.reduce((e,t)=>"file"===t.type?e.concat([t.file]):e,[]);let i=0;return t.map(e=>"group"===e.type?h.default.createElement("li",{className:"dropins-chooser-files-list-group-title",key:e.groupId},h.default.createElement(E.Text,{size:"small",color:"faint",variant:"label"},j.groupName[e.groupId])):this.renderFileListItem(s,i++))}renderGridView(e){let t;return t="recent"===e.path?this.getRecentDropinsItems():this.getDropinsItems(),h.default.createElement(R.GridManager,{initialScrollPosition:this.state.gridScrollPosition,items:t,onScroll:this.updateGridScrollPosition,renderGridCell:this.renderFileThumbnail,renderGridHeader:this.renderDropinsHeader,webTimer:this.props.webTimer})}renderListView(e){if("recent"===e.path)return h.default.createElement("div",{className:"dropins-chooser-content"},h.default.createElement("ul",{className:"dropins-chooser-files-list"},this.getRecentFilesListItems()));{const e=this.currentFilesAndFolders().toArray();if(this.props.renderAllItems)return h.default.createElement("div",{className:"dropins-chooser-content"},h.default.createElement("ul",{className:"dropins-chooser-files-list"},e.map((t,s)=>this.renderFileListItem(e,s))));const t=e.map(e=>M.ITEM_ROW_HEIGHT);return h.default.createElement(C.CulledList,{containerClassName:"dropins-chooser-content",className:"dropins-chooser-files-list",initialScrollPosition:this.state.listScrollPosition,items:e,listItemHeights:t,onScroll:this.updateListScrollPosition,renderRow:this.renderFileListItemForCulledList(e),webTimer:this.props.webTimer})}}renderContent(e){return this.state.isLoading?h.default.createElement("div",{className:"dropins-chooser-content"},h.default.createElement("div",{className:"dropins-chooser-loading-container"},h.default.createElement(N.Loading,null))):0===this.currentFilesAndFolders().size?h.default.createElement("div",{className:"dropins-chooser-content"},h.default.createElement("div",{className:"dropins-chooser-empty-container"},h.default.createElement(y.Empty,{route:e}))):"tiles"===this.state.viewType?this.renderGridView(e):this.renderListView(e)}renderSelectedFilesComponent(){if(0===this.currentSelectedFiles().size)return h.default.createElement("div",{className:"dropins-chooser-selected-files-container"});let e=u.intl.formatMessage({id:"hczh4U",defaultMessage:"Deselect all"});return 1===this.currentSelectedFiles().size&&(e=u.intl.formatMessage({id:"BNlIo5",defaultMessage:"Deselect"})),h.default.createElement("div",{className:"dropins-chooser-selected-files-container"},h.default.createElement(q.SelectedFilesPopover,{selectedFiles:this.currentSelectedFiles().toArray(),onRemoveSelectedFile:this.handleRemoveSelectedFile,multiselect:!0,telemetryClient:this.props.telemetryClient}),h.default.createElement("div",{className:"dropins-chooser-deselect-all-container"},h.default.createElement(_.Button,{variant:"transparent",size:"small",onClick:this.handleRemoveAllSelectedFiles,hasNoUnderline:!0},e)))}renderSharedLinkMessage(){if(this.props.hideSharedLinkNotification||!this.canChoose())return null;const e=(0,r.defineMessage)({id:"UA1n47",defaultMessage:"{message} <link>How to set shared link permissions</link>"}),t=this.props.multiselect?u.intl.formatMessage({id:"p2o5/+",defaultMessage:"A shared link with your current sharing settings will be created for each item."}):u.intl.formatMessage({id:"eAGPII",defaultMessage:"A shared link with your current sharing settings will be created for this item."});return h.default.createElement("div",{className:"dropins-chooser-shared-link-notification"},u.intl.formatMessage(e,{message:t,link:e=>h.default.createElement(E.Link,{href:"https://help.dropbox.com/files-folders/share/set-link-permissions",target:"_blank",rel:"noreferrer"},e)}))}renderStatusBar(){if(this.state.hideStatus||void 0===this.state.uploadStatus)return null;let e,t="",s=!1,i=!1;if(this.state.uploadStatus){const{fileName:r,uploaded:o}=this.state.uploadStatus;e=this.state.uploadStatus.progressPercentage,o?(t=u.intl.formatMessage({id:"QmiUAu",defaultMessage:"Upload complete"}),s=!0):(t=u.intl.formatMessage({id:"6i37Wu",defaultMessage:"Uploading {file_name}"},{file_name:r}),i=!0)}return h.default.createElement(G.Layer,{className:"dropins-chooser-snackbar-container"},h.default.createElement(D.Snackbar,{open:!0,timeout:0},s&&h.default.createElement(B.UIIcon,{src:W.CheckmarkCircleLine}),h.default.createElement(D.Snackbar.Message,null,t,i&&h.default.createElement(H.ProgressBar,{inverse:!0,in:void 0!==e&&e>0,value:e})),s&&h.default.createElement(D.Snackbar.Actions,null,h.default.createElement(_.Button,{variant:"transparent",inverse:!0,onClick:this.handleStatusBarCloseClicked},u.intl.formatMessage({id:"EGrZ5w",defaultMessage:"Dismiss"})))))}renderSidebar(){const e=this.state.navigationStack[0],t=[{id:"browse",name:u.intl.formatMessage({id:"cdAaQR",defaultMessage:"My files"})},{id:"recent",name:u.intl.formatMessage({id:"hDgBBt",defaultMessage:"Recents"})}];return this.props.suggestionsIsEnabled&&t.unshift({id:"suggestions",name:u.intl.formatMessage({id:"hh7boA",defaultMessage:"Suggestions"})}),h.default.createElement("div",{className:"dropins-chooser-sidebar"},h.default.createElement(L.Sidebar,{navigationItems:t,activeItemId:e.path,userRole:this.props.userRole,viewer:this.props.viewer,onUserRoleChange:this.props.parentComponent.onUserRoleChange,onNavigationSelection:this.handleNavigationChange,showBranding:!!this.props.showBranding,showSignOut:!!this.props.showSignOut}))}canChooseCurrentFolder(){return"browse"===(0,w.getMostRecentRoute)(this.state.navigationStack).path&&!this.state.isTsd&&!1===this.props.fileselect&&!0===this.props.folderselect}canChoose(){return!this.state.isSharing&&(0!==this.currentSelectedFiles().size||this.canChooseCurrentFolder())}renderFooter(){return h.default.createElement("div",{className:"dropins-chooser-footer"},this.renderSelectedFilesComponent(),this.props.onCancel?h.default.createElement("div",{className:"dropins-chooser-cancel-button"},h.default.createElement(_.Button,{variant:"opacity",onClick:this.handleCancelClicked},u.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))):null,h.default.createElement(_.Button,{variant:"primary",onClick:this.handleChooseClicked,disabled:!this.canChoose()},this.props.isZoomChooser?u.intl.formatMessage({id:"xbgRlN",defaultMessage:"Share screen"}):u.intl.formatMessage({id:"eLfJ9t",defaultMessage:"Choose"})))}renderFullScreenPreview(){const e=this.currentFilesAndFolders().toArray();return h.default.createElement("div",{className:"dropins-chooser-main"},h.default.createElement(I.FullScreenPreview,{disabledForFile:this.disabledForFile,files:e,index:this.state.indexForPreview,isItemSelectable:this.canBeSelected,onExit:this.handleFullScreenExit,onChangedIndex:this.handleFullScreenNewIndex,onCheckboxChange:this.handleRowCheckboxChangeOverrideIndex(e,this.state.indexForPreview),selectedForFile:this.selectedForFile,thumbStore:this.state.thumbStore,webTimer:this.props.webTimer,telemetryClient:this.props.telemetryClient}),this.renderFooter())}renderMainChooser(e){return h.default.createElement("div",{className:"dropins-chooser-main"},"narrow"===this.props.displayMode?h.default.createElement(A.Header,{userRole:this.props.userRole,viewer:this.props.viewer,onUserRoleChange:this.props.parentComponent.onUserRoleChange,showBranding:!!this.props.showBranding,showSignOut:!!this.props.showSignOut}):null,h.default.createElement("div",{className:"dropins-chooser-search-header"},h.default.createElement("div",{className:"dropins-chooser-search-input-container"},h.default.createElement(U.SearchInput,{onQueryChange:this.handleSearchQueryChange}))),this.renderActionsMenu(e),this.renderContent(e),this.renderStatusBar(),this.renderSharedLinkMessage(),this.renderFooter())}render(){const e=(0,w.getMostRecentRoute)(this.state.navigationStack);return h.default.createElement("div",{className:"dropins-chooser"},"wide"===this.props.displayMode?this.renderSidebar():null,"wide"===this.props.displayMode?h.default.createElement("div",{className:"dropins-chooser-separator"}):null,this.state.renderFullScreenPreview?this.renderFullScreenPreview():this.renderMainChooser(e))}}se.displayName="Chooser",se.defaultProps={multiselect:!0,fileselect:!0,folderselect:!0,sizeLimit:1/0,displayMode:"narrow",enableFullScreenPreview:!1,suggestionsVariant:"OFF",suggestionsIsEnabled:!1,suggestionsIsDefault:!1},t.Chooser=(0,p.requireCssWithComponent)(se,["/static/metaserver/static/css/dropins_v3/chooser/index-vflr_sBmR.css","/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css","/static/metaserver/static/css/foundation-vflZkvt4R.css","/static/metaserver/static/css/notify-vflZVEumu.css"])})),define("metaserver/static/js/dropins_v3/chooser/chooser_page",["require","exports","tslib","metaserver/static/js/core/browser","react","metaserver/static/js/components/ui/css","metaserver/static/js/core/uri","metaserver/static/js/clean/viewer","metaserver/static/js/core/i18n","metaserver/static/js/dropins_v3/shared/check_fsw","metaserver/static/js/dropins_v3/chooser/chooser","metaserver/static/js/dropins_v3/shared/telemetry_client","metaserver/static/js/dropins_v3/shared/window_utils","metaserver/static/js/dropins_v3/chooser/api_client","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/dropins_v3/chooser/host_site","metaserver/static/js/dropins_v3/shared/logout","metaserver/static/js/dropins_v3/shared/window_utils","metaserver/static/js/dropins_v3/shared/login_modal","metaserver/static/js/clean/raf_throttle","metaserver/static/js/dropins_v3/shared/timeout","metaserver/static/js/core/exception"],(function(e,t,s,i,r,o,n,a,l,c,d,h,p,u,m,g,f,_,v,w,S,b,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChooserPage=void 0,i=s.__importStar(i),r=s.__importDefault(r),C=s.__importStar(C);const E={width:735};class y extends r.default.Component{constructor(e){super(e),this.onWindowResize=new S.RafThrottle(()=>{null!==this.webTimer.timeToInteractive()&&this.setState({isWide:window.innerWidth>=E.width})}).request,this.onChooseSuccess=e=>{this.hostSite.filesSelected(e)},this.onChooserExtrasChanged=e=>{this.hostSite.chooserExtrasChanged(e)},this.onUserRoleChange=e=>{if(e)a.Viewer.get_viewer().is_role_signed_in(e)?this.setState({userRole:e}):(this.hostSite.loginRequested(e),this.setState({loginModalUserRole:e}));else{const e=new n.URI({path:"/logout",query:{cont:i.get_href()}}).toString();(0,v.isIFrame)()||this.props.forceIFrameUI?(0,_.logoutViaPopup)(i.get_href()):i.redirect(e)}},this.onCursorChange=e=>{this.hostSite.cursorChanged(e)},this.onKeyUp=e=>{27===e.keyCode&&this.hostSite.escapeKeyUp()},this.handleLoginModalClose=e=>{if(e){const t=a.Viewer.get_viewer();t.sign_in_user_by_id(e);const s=t.get_user_by_id(e);this.setState({userRole:s.role,loginModalUserRole:null})}else this.setState({loginModalUserRole:null})},this.onCancel=()=>{this.hostSite.closeDialog()},this.chooserPresentFSWModal=e=>(0,c.presentFSWModal)(l.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"}),e),this.chooserCheckFSW=(e,t,i)=>s.__awaiter(this,void 0,void 0,(function*(){try{return yield(0,c.checkFSWs)(c.checkFSW,this.chooserPresentFSWModal,e,t,i)}catch(e){return C.reportException({err:e,severity:C.SEVERITY.NONCRITICAL,tags:["chooser_v3: check_fsw","dropins"]}),!1}})),this.apiClient=new u.ChooserApiClient(e.version,e.linkType,e.appKey,e.correlationId),this.hostSite=new f.HostSite(e.origin),this.webTimer=(0,g.get_timer)(),this.vortexLogger=new m.VortexLogger(e.appKey,e.statPrefix),this.telemetryClient=new h.AjaxTelemetryClient(e.appKey,e.correlationId,e.productKey,e.suggestionsExperimentGroup),this.state={userRole:this.props.initialRole,loginModalUserRole:null,isWide:!1},this.webTimer.applicationStart(),this.hostSite.listen({onClose:()=>window.close(),onState:()=>{}}),this.hostSite.ready()}componentDidMount(){window.addEventListener("resize",this.onWindowResize),this.webTimer.waitForTTI().then(()=>{this.onWindowResize()}),(0,p.attemptResizeWindow)(E)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){const e=a.Viewer.get_viewer();if(!a.Viewer.get_is_signed_in(e))throw new Error("Chooser page should not render if viewer is not signed in");return r.default.createElement("div",{className:"dropins-chooser-parent",tabIndex:0,onKeyUp:this.onKeyUp},r.default.createElement(d.Chooser,{appKey:this.props.appKey,apiClient:this.apiClient,checkFSWsForUpload:this.chooserCheckFSW,parentComponent:this,userRole:this.state.userRole,viewer:e,multiselect:this.props.multiselect,fileselect:this.props.fileselect,folderselect:this.props.folderselect,extensions:this.props.extensions,sizeLimit:this.props.sizeLimit,initialMode:this.props.initialMode,initialPath:this.props.initialPath,initialViewType:this.props.initialViewType,fields:this.props.fields,displayMode:this.state.isWide?"wide":"narrow",showBranding:!0,showSignOut:this.props.showSignOut,timeout:b.timeout,webTimer:this.webTimer,vortexLogger:this.vortexLogger,telemetryClient:this.telemetryClient,onCancel:this.onCancel,onChooserExtrasChanged:this.onChooserExtrasChanged,enableFullScreenPreview:this.props.enableFullScreenPreview,isZoomChooser:this.props.isZoomChooser,requiredPerms:this.props.requiredPerms,hideSharedLinkNotification:this.props.hideSharedLinkNotification,suggestionsVariant:this.props.suggestionsVariant,suggestionsIsEnabled:this.props.suggestionsIsEnabled,suggestionsIsDefault:this.props.suggestionsIsDefault,suggestionsExperimentGroup:this.props.suggestionsExperimentGroup,productKey:this.props.productKey}),this.state.loginModalUserRole?r.default.createElement(w.LoginModal,{viewer:e,forceIFrameUI:this.props.forceIFrameUI,userRole:this.state.loginModalUserRole,onClose:this.handleLoginModalClose}):null)}}y.displayName="ChooserPageComponent",t.ChooserPage=(0,o.requireCssWithComponent)(y,["/static/metaserver/static/css/dropins_v3/chooser/chooser_page-vflqqcLVr.css"])})),define("metaserver/static/js/dropins_v3/chooser/file_state",["require","exports","tslib","immutable"],(function(e,t,s,i){"use strict";function r(){return i.OrderedMap()}function o(e,t){return e.selectedFiles.get(t)||r()}function n(e,t,s){const i=o(e,t).withMutations(e=>s.forEach(t=>e.remove(t.fq_path)));return{selectedFiles:e.selectedFiles.set(t,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.deselectFiles=t.multiSelectFiles=t.deselectFile=t.deselectAllFiles=t.singleSelectFile=t.selectedFilesForUser=void 0,i=s.__importStar(i),t.selectedFilesForUser=o,t.singleSelectFile=function(e,t,s){const i=r().set(s.fq_path,s);return{selectedFiles:e.selectedFiles.set(t,i)}},t.deselectAllFiles=function(e,t){return{selectedFiles:e.selectedFiles.set(t,r())}},t.deselectFile=function(e,t,s){return n(e,t,[s])},t.multiSelectFiles=function(e,t,s){const i=o(e,t).withMutations(e=>s.forEach(t=>e.set(t.fq_path,t)));return{selectedFiles:e.selectedFiles.set(t,i)}},t.deselectFiles=n})),define("metaserver/static/js/dropins_v3/chooser/file_uploader",["require","exports","tslib"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileUploader=void 0;const i={quota:"UPLOAD_QUOTA",ignored:"UPLOAD_IGNORED",too_large:"UPLOAD_TOOLARGE",unknown:"UPLOAD_UNKNOWN"};t.FileUploader=class{constructor(e){this.setUserId=e=>{this.state.userId=e},this.setDest=e=>{this.state.dest=e},this.setCheckUploadFSW=e=>{this.state.checkUploadFSW=e},this.queue=[],this.enqueueNewFiles=(e,t)=>{if(!e[0]||!e[0].name)throw new Error("fileInput.files[0].name is not supported");for(let t=0;t<e.length;t++)this.queue.push({userId:this.state.userId,file:e[t],dest:this.state.dest,checkFSW:0===t&&this.state.checkUploadFSW});t&&t(),this.processQueue()},this.processQueue=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.currentFileUpload)return;const e=this.queue.shift();if(void 0===e)return;const{userId:t,file:s,dest:i,checkFSW:r}=e;this.currentFileUpload={userId:t,file:s,dest:i,checkFSW:r,progressPercentage:0},this.props.onUploadProgress(s.name,i,0),r&&this.props.onUploadClick&&!(yield this.props.onUploadClick(i,s.name,t))?(this.queue=this.queue.filter(e=>e.dest!==i),this.currentFileUpload=void 0,this.props.onUploadCancel(),this.processQueue()):this.props.apiClient.upload(t,s,i,this.handleProgress).then(this.handleSuccess,this.handleError)})),this.handleProgress=e=>{const t=Math.round(e.loaded/e.total*100),{file:s,dest:i}=this.getCurrentFileUpload();this.props.onUploadProgress(s.name,i,t)},this.handleSuccess=e=>{if(e.error||void 0===e.path)return void this.handleError(e.error);const{userId:t,dest:s}=this.getCurrentFileUpload();this.props.apiClient.browse(t,e.path).then(this.onBrowseSuccessWrapper(t,s),this.handleError)},this.handleError=e=>{var t;this.props.onUploadError((t=e)&&t in i?i[t]:"UPLOAD_UNKNOWN"),this.currentFileUpload=void 0,this.processQueue()},this.props=e,this.state={userId:e.userId,dest:e.dest,checkUploadFSW:e.checkUploadFSW}}getCurrentFileUpload(){if(!this.currentFileUpload)throw new Error("No file is currently uploading");return this.currentFileUpload}onBrowseSuccessWrapper(e,t){return s=>{s.file_info.length>0?(this.props.onUploadSuccess(e,s.file_info[0],t),this.currentFileUpload=void 0,this.processQueue()):this.handleError()}}}})),define("metaserver/static/js/dropins_v3/chooser/host_site",["require","exports","metaserver/static/js/dropins_v3/shared/host_site","metaserver/static/js/core/notify"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostSite=void 0;class r extends s.BaseHostSite{constructor(e){super(e,i.Notify)}filesSelected(e){this.sendMessage("files_selected",e)}loginRequested(e){this.sendMessage("login_requested",{type:e})}escapeKeyUp(){this.sendMessage("close_dialog")}chooserExtrasChanged(e){this.sendMessage("chooser_extras_changed",{chooserExtras:e})}}t.HostSite=r})),define("metaserver/static/js/dropins_v3/chooser/routes",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areChooserRoutesEqual=void 0,t.areChooserRoutesEqual=function(e,t){return e.path===t.path&&(!("query"in e&&"query"in t)||e.query===t.query)}})),define("metaserver/static/js/dropins_v3/chooser/selected_files_popover",["require","exports","tslib","metaserver/static/js/filepath/filepath","react","metaserver/static/js/components/ui/css","metaserver/static/js/core/i18n","dig-components/typography","metaserver/static/js/dropins_v3/shared/async_file_folder_icon","metaserver/static/js/dropins_v3/shared/filename_text","dig-components/buttons","dig-components/icons/src","dig-components/menu","dig-components/icons"],(function(e,t,s,i,r,o,n,a,l,c,d,h,p,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedFilesPopover=void 0,i=s.__importStar(i),r=s.__importDefault(r);class m extends r.default.Component{constructor(e){super(e),this.getRemoveSelectedFileHandler=e=>()=>{var t;this.props.onRemoveSelectedFile(e),null===(t=this.props.telemetryClient)||void 0===t||t.logEvent({name:"chooser_selected_files_popover_remove"})},this.logTriggerClick=this.logTriggerClick.bind(this)}logTriggerClick(){var e;null===(e=this.props.telemetryClient)||void 0===e||e.logEvent({name:"chooser_selected_files_popover_cta_click"})}renderTriggerText(){return this.props.multiselect?r.default.createElement(a.Text,{size:"small",isBold:!0,variant:"label",className:"dropins-text-ellipsis"},n.intl.formatMessage({id:"hIWeAV",defaultMessage:"{count, plural, one{{count} selected} other{{count} selected}}"},{count:this.props.selectedFiles.length})):n.intl.formatMessage({id:"L+wWOg",defaultMessage:"<text1>“</text1><text2>{filename}</text2><text3>” selected</text3>"},{text1:e=>r.default.createElement(a.Text,{size:"small",color:"faint",variant:"label",key:"prefix"},e),text2:e=>r.default.createElement(a.Text,{size:"small",color:"faint",variant:"label",className:"dropins-text-ellipsis",key:"filename"},e),text3:e=>r.default.createElement(a.Text,{size:"small",color:"faint",variant:"label",key:"suffix"},e),filename:i.filename(this.props.selectedFiles[0].fq_path)})}render(){return r.default.createElement(p.Menu.Wrapper,{closeOnSelection:!1,hasMaxHeight:300},({getContentProps:e,getTriggerProps:t})=>r.default.createElement(r.default.Fragment,null,r.default.createElement(d.Button,Object.assign({variant:"transparent",size:"small",disabled:!this.props.multiselect},t({onClick:this.logTriggerClick})),r.default.createElement(u.UIIcon,{src:h.CheckmarkLine,size:"small"}),this.renderTriggerText()),r.default.createElement(p.Menu.Content,Object.assign({},e()),r.default.createElement(p.Menu.Segment,null,this.props.selectedFiles.map(e=>r.default.createElement(p.Menu.ActionItem,{key:e.fq_path,value:e.fq_path,className:"dropins-selected-files-popover-item",withLeftAccessory:r.default.createElement(l.AsyncFileOrFolderIcon,{file:e}),withRightAccessory:r.default.createElement(d.Button,{variant:"transparent",size:"small",onClick:this.getRemoveSelectedFileHandler(e),hasNoUnderline:!0},n.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}))},r.default.createElement(c.FileNameText,{path:e.fq_path})))))))}}m.displayName="SelectedFilesPopover",t.SelectedFilesPopover=(0,o.requireCssWithComponent)(m,["/static/metaserver/static/css/dropins_v3/chooser/index-vflr_sBmR.css","/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css"])})),define("metaserver/static/js/dropins_v3/chooser/upload_files_button",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/core/i18n","dig-components/buttons"],(function(e,t,s,i,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadFilesButton=void 0,i=s.__importDefault(i);class a extends i.default.Component{constructor(){super(...arguments),this.state={clearFileInput:!1},this.setFileInput=e=>{this.fileInput=e},this.handleUploadClicked=()=>{var e;if(!this.fileInput)throw new Error("fileInput is not supported");this.fileInput.click(),null===(e=this.props.telemetryClient)||void 0===e||e.logEvent({name:"chooser_upload_files_cta_click"})},this.onQueued=()=>{this.setState({clearFileInput:!0})},this.handleFileInputChange=()=>{if(!this.fileInput.files||0===this.fileInput.files.length)throw new Error("fileInput.files is not supported");const e=this.fileInput.files;this.props.uploader.enqueueNewFiles(e,this.onQueued)}}render(){const e=this.state.clearFileInput?null:i.default.createElement("input",{type:"file",onChange:this.handleFileInputChange,multiple:!0,tabIndex:-1,className:"dropins-upload-files-button-input",ref:this.setFileInput});return i.default.createElement("div",{className:"dropins-upload-files-button"},i.default.createElement(n.Button,{variant:"transparent",size:"small",onClick:this.handleUploadClicked,disabled:this.props.disabled||this.state.clearFileInput},o.intl.formatMessage({id:"Qayhb5",defaultMessage:"Upload files"})),e)}componentDidUpdate(){this.state.clearFileInput&&this.setState({clearFileInput:!1})}}a.displayName="UploadFilesButton",t.UploadFilesButton=(0,r.requireCssWithComponent)(a,["/static/metaserver/static/css/dropins_v3/chooser/index-vflr_sBmR.css","/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css"])})),define("metaserver/static/js/dropins_v3/chooser/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTimestampMsec=void 0,t.getTimestampMsec=Date.now}));
//# sourceMappingURL=pkg-chooser-v3.min.js-vflYe6erj.map