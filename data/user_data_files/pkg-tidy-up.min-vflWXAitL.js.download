define("metaserver/static/js/browse/actions",["require","exports","tslib","immutable","metaserver/static/js/file_actions/create-folder","metaserver/static/js/file_operations/notifications","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/history","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/api","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/action_creators/file_actions","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","metaserver/static/js/files_view/types","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/sharing/browse_exports","metaserver/static/js/core/i18n","metaserver/static/js/browse/fss_experiment_carousel_util","metaserver/static/js/browse/model_types","metaserver/static/js/sync_everything/constants","metaserver/static/js/flows/utils/async_modal_launchers","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E,v,y,T,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseActions=void 0,r=s.__importStar(r),o=s.__importStar(o),i=s.__importStar(i),n=s.__importDefault(n),l=s.__importStar(l),d=s.__importStar(d),u=s.__importStar(u),_=s.__importStar(_),m=s.__importStar(m);t.browseActions=new class{constructor(){this.totalNumFiles=-1,this.initializeEverything=({path:t,files:a,paginatedTotalNumFiles:o,context:n,mountPoints:l,fqPathsToSelect:d,loadingState:c,teamFolders:_,currentFolderInfo:m})=>s.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(u.setPath({path:t})),this.reduxStore.dispatch(u.appendFiles({path:t,files:[...a,..._],currentFolderInfo:m})),I.WEBXP_PERF&&this.totalNumFiles==o||(this.totalNumFiles=o,this.reduxStore.dispatch(u.setPaginatedTotalNumFiles({paginatedTotalNumFiles:o}))),this.reduxStore.dispatch(u.setMountPoints({mountPoints:l})),this.reduxStore.dispatch(u.setLoadingState({loadingState:c,path:t})),c===f.LoadingState.LOADED?this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:d})):this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:r.Set(d)})),this.reduxStore.dispatch(u.setContext({context:n})),this.reduxStore.dispatch(u.setCurrentFolderInfo({currentFolderInfo:m}));const p={path:t,hasPermissionToUploadToFolder:n.isCurrentPathWriteable(),isMovingIntoVault:n.isInsideVaultFolder};new Promise((t,s)=>{e(["metaserver/static/js/file_uploader/clean/data/slice"],t,s)}).then(s.__importStar).then(({uploadActionCreators:e})=>{this.reduxStore.dispatch(e.setPath(p))});const{ActionsAdapter:h}=yield new Promise((t,s)=>{e(["metaserver/static/js/file_uploader/actions_adapter"],t,s)}).then(s.__importStar);h.on("uploadComplete",({filesAdded:e})=>{if(!e||0===e.length)return;const t=e.map(e=>i.normalize(e.path)+i.normalize(e.name));this.selectFilesAfterUpload({fqPathsToSelect:t})})})),this.addFilesAndSetLoadingState=({path:e,loadingState:t,files:s,paginatedTotalNumFiles:r})=>{this.reduxStore.dispatch(u.appendFiles({path:e,files:s})),I.WEBXP_PERF&&this.totalNumFiles==r||(this.totalNumFiles=r,this.reduxStore.dispatch(u.setPaginatedTotalNumFiles({paginatedTotalNumFiles:r}))),this.reduxStore.dispatch(u.setLoadingState({loadingState:t,path:e}))},this.setUrl=({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:r})=>{this.reduxStore.dispatch(u.setUrl({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:r}))},this.nameNewFolder=()=>{this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.PENDING_INPUT}))},this.createFolderPending=()=>{(0,a.logCreateFolderPending)(),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.SAVING_INPUT}))},this.cancelCreateFolder=e=>{(0,a.logCreateFolderCancel)(e),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE}))},this.createFolderComplete=()=>{(0,a.logCreateFolderSuccess)(),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),h.Snackbar.complete(S.intl.formatMessage({id:"a26imc",defaultMessage:"Folder created."}),"browse-action")},this.createFolder=e=>{this.reduxStore.dispatch(u.createFolder(e))},this.createFolderInNewFolderModal=({folderName:e,isConfidential:s,user:r,context:a,redirectOnSuccess:o,redirectOnCancel:i,fqPath:n,selectCreatedFolder:l,origin:d,shouldSuppressRedirectToBrowse:c,handleSuccessSharing:u,handleCancelSharing:_,shouldLaunchAutomationModal:m,defaultRecipientAccessLevel:p})=>{const f=a?a.currentFQPath:n,h=a?a.rootNSID:r.root_ns_id;if(s&&a&&!a.isInsideTeamFolderTree)(0,g.asyncShowNewFolderShareModal)({defaultBasePath:f,initialContentName:e,onCancel:_,onSuccessSharing:u,setUrl:this.setUrl,shouldSuppressRedirectToBrowse:c,user:r,automationOptionChecked:m,defaultRecipientAccessLevel:p});else{const n=(r.is_cdm_member||s)&&!!a&&a.isInsideTeamFolderTree;t.browseActions.createFolder({pathName:f,folderName:e,nsId:h,checkFSWs:!1,showShareModalOnSuccess:n?this.handleShowShareModal:null,redirectOnSuccess:o,redirectOnCancel:i,selectCreatedFolder:l,origin:d,user:r})}},this.handleNewFolderRedirectOnSuccess=e=>{this.setUrl({path:e})},this.handleNewFolderAutomationRedirect=(e,t,s,r)=>{this.setUrl({path:e}),(0,T.asyncLaunchAddOrEditAutoFolderModal)({fqPath:e,nsId:s,user:t,entryPoint:r,source:"add_from_folder_creation"})},this.doDeleteFilesWithModal=({files:e})=>{const t=m.user(this.reduxStore.getState()),r=m.context(this.reduxStore.getState());l.showDelete(t,e,r,i.filename(r.currentFQPath),()=>s.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(_.deleteFiles({files:[...e],checkFSWs:!0}))})))},this.openBackupDeleteDeviceFolderModal=e=>{const t=m.currentFolderBackupInfo(this.reduxStore.getState());l.showBackupDeleteDeviceFolderModal(t,e)},this.purgeSuccessCallback=e=>{t.browseActions.reloadCurrentPath()},this.onPurgeBatch=(t,r)=>{new Promise((t,s)=>{e(["metaserver/static/js/trash/actions"],t,s)}).then(s.__importStar).then(({purgeByPathBatch:e})=>{var s;const a=(0,y.isBackupBrowse)()?null===(s=m.context(this.reduxStore.getState()))||void 0===s?void 0:s.rootNSID:void 0;e(t,r,this.purgeSuccessCallback,void 0,null!=a?a:void 0)})},this.doPermanentDeleteWithModal=e=>{const t=m.user(this.reduxStore.getState()),s=m.context(this.reduxStore.getState());l.showPurgeModal({userId:t.id,context:s,files:e,onPurge:this.onPurgeBatch})},this.onRestore=(e,t,s,r)=>{d.restoreFiles({files:t,userId:e,onSuccess:()=>{o.notifyRestoreSuccess(t)},isSearchMode:s,rootNsId:r})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=m.user(this.reduxStore.getState()),s=m.context(this.reduxStore.getState());l.showUnifiedTrashModal({userId:t.id,context:s,files:e,onRestore:(e,t)=>{var r;this.onRestore(e,t,!1,null!==(r=s.rootNSID)&&void 0!==r?r:void 0)}})},this.handleShowRewindPanel=()=>{n.default.update_query_param(c.BrowseQueryArg.rewind,"true"),this.reduxStore.dispatch(u.showRewind())},this.fetchFolderSizes=({file:e})=>s.__awaiter(this,void 0,void 0,(function*(){const t=m.user(this.reduxStore.getState());let s=c.MAX_FOLDER_SIZE_ITERATIONS;try{this.reduxStore.dispatch(u.requestFolderSizes({fqPath:e.fq_path}));const r=yield d.fetchSharedFolderSizes(t.id,{fq_path:e.fq_path});this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:r}));let a=[],o=yield this.fetchAndSetSameNamespaceFolderSize(t.id,e.file_id,{fq_path:e.fq_path,folder_limit:c.MAX_FOLDERS_PER_CALL});for(o.queue&&(a=[...a,...o.queue]);a.length>0&&s>0;){s--;const r=Math.min(c.MAX_FOLDER_SIZE_QUEUE_SIZE,a.length),i=a.splice(0,r);o=yield this.fetchAndSetSameNamespaceFolderSize(t.id,e.file_id,{fq_path:e.fq_path,folder_limit:c.MAX_FOLDERS_PER_CALL,queue:i}),o.queue&&a&&(a=[...a,...o.queue])}const i=0!==s&&o.queue&&0===o.queue.length?v.FetchFolderSizeState.COMPLETE:v.FetchFolderSizeState.ERROR;this.reduxStore.dispatch(u.completeFolderSizes({fetchFolderSizeState:i}))}catch(t){this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:{sizes_dict:[{fq_path:e.fq_path,size:0}],queue:[]}})),this.reduxStore.dispatch(u.completeFolderSizes({fetchFolderSizeState:v.FetchFolderSizeState.ERROR}))}})),this.fetchMultipleFolderSizes=({files:e})=>s.__awaiter(this,void 0,void 0,(function*(){for(const t of e.toArray())yield this.fetchFolderSizes({file:t})})),this.handleShowShareModal=(e,t)=>{const s=m.user(this.reduxStore.getState()),r=m.context(this.reduxStore.getState());(0,g.asyncShowShareModal)(s,e,{browseContext:r,origin:t,onCancel:()=>{(0,E.asyncShowFssExpr)(s,e.ns_id,e.ns_path,e.is_dir)},onSuccessSharing:()=>{(0,E.asyncShowFssExpr)(s,e.ns_id,e.ns_path,e.is_dir)}},this.setUrl)},this.reduxStore=(0,p.getStoreForBrowse)()}reloadCurrentPath(){this.setUrl({path:m.path(this.reduxStore.getState()),qargs:{reload:!0}})}selectRowsFromBoltClient(e=[]){this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:r.Set(e.map(e=>e.fq_path))}))}selectFilesAfterUpload({fqPathsToSelect:e}){const t=m.unsortedFilesWithFolderSizes(this.reduxStore.getState());e.every(e=>t.has(e))?this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:e})):this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:r.Set(e)}))}selectFilesByFqPath({fqPathsToSelect:e}){this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:e}))}setShouldShowDeletedFiles({shouldShowDeletedFiles:e}){e?n.default.update_query_param(c.BrowseQueryArg.d,"1"):n.default.remove_query_param(c.BrowseQueryArg.d)}fetchAndSetSameNamespaceFolderSize(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){const s=m.user(this.reduxStore.getState()),{rootNSID:a}=m.context(this.reduxStore.getState()),o=!!a&&(0,y.isUnmountedBackupBrowse)(s,a)?yield d.fetchUnmountedBackupFolderSizes(e,t,r):yield d.fetchSameNamespaceFolderSizes(e,r);return this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:o})),o}))}}})),define("metaserver/static/js/browse/data/action_creators/file_actions",["require","exports","tslib","metaserver/static/js/file_actions/metrics","metaserver/static/js/file_actions/strings","metaserver/static/js/filepath/filepath","metaserver/static/js/metrics/index","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/file_actions/rollback","metaserver/static/js/files_view/file_actions/snackbars","metaserver/static/js/files_view/types","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/undo","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/sync_everything/hive_logger","metaserver/static/js/sync_everything/types","metaserver/static/js/campaigns/types","metaserver/static/js/campaigns/emitter"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E,v,y,T,I,F,A,M,w,b,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameFile=t.renameUndo=t.deleteFiles=void 0,o=s.__importStar(o),n=s.__importStar(n),u=s.__importStar(u),_=s.__importStar(_),p=s.__importStar(p),f=s.__importStar(f),h=s.__importStar(h),E=s.__importStar(E),M=s.__importStar(M);const O=({state:e,eventName:t,num_files_selected:s,num_folders_selected:r,batch_success_count:a,batch_fail_count:o,lookup_error_type:i,error_summary:n})=>{(0,l.logBrowseAction)({uid:u.user(e).id,action:t,num_files_selected:s,num_folders_selected:r,view_type:f.selectViewType(e,{instanceId:d.BROWSE_FILES_VIEW_ID}),batch_success_count:a,batch_fail_count:o,lookup_error_type:i,error_summary:n})};t.deleteFiles=({files:e,checkFSWs:l})=>(d,p)=>s.__awaiter(void 0,void 0,void 0,(function*(){const f=u.user(p()),g=u.path(p()),v=u.shouldShowDeletedFiles(p()),y=(0,i.getMetricsReporter)(),C=0!==e.length?u.backupInfoByFile(p())(e[0]):void 0,N="cb"===(null==C?void 0:C.type)&&C.usesAnchors,L={surface:"browse",batchSizeBucket:(0,r.bucketForBatchSize)(e.length),contentType:(0,r.batchContentType)(e)},P=y.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_total_ms"},L),D=Date.now(),k=y.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_average_ms"},L),U=y.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/completed"},L);T.Snackbar.sync(A.intl.formatMessage(a.deleteSnackbarProgressMessage,{count:e.length}),!0,"browse-action"),1!==e.length||v||d((0,c.pushBoltIgnore)({removed:new Set([e[0].fq_path])})),O({state:p(),eventName:F.WebUserActionLogEvent.DELETE_REQUEST_ATTEMPT,num_files_selected:e.length,num_folders_selected:0}),N&&M.logEvent({action_surface:"browse_delete_modal",event:"click_delete",page_source:"browse",extra:{id:C.id,backup_type:w.BackupType.COMPUTER}});const x=yield h.deleteFiles(e,f.id,l);if(x.isError&&"path"===x.error[".tag"]&&"file_system_warnings"===x.error.path[".tag"])return void d((({files:e,details:r})=>(o,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:r,onFinalAccept:()=>{o((0,t.deleteFiles)({files:e,checkFSWs:!1}))},confirmText:A.intl.formatMessage(a.deleteFswConfirmText)})})))({files:e,details:x.error.path.details}));if(P.record(),k.record((Date.now()-D)/e.length),x.isError)return d((({files:e,result:t})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.shouldShowDeletedFiles(a());1!==e.length||s||r((0,c.popBoltIgnore)({removed:new Set([e[0].fq_path])})),T.Snackbar.fail(E.deleteError(e.length,t.error),"browse-action");const o=u.selectedFiles(a()),{num_files_selected:i,num_folders_selected:n}=_.countFilesAndFolders(o);O({state:a(),eventName:F.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:i,num_folders_selected:n,batch_success_count:0,batch_fail_count:e.length,error_summary:t.error_summary})})))({files:e,result:x})),void U.record(0);const j=x.result.entries.filter(e=>"success"===e[".tag"]);d((({pathAtRequestTime:e,successEntries:t})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.shouldShowDeletedFiles(a());if(!o.paths_are_equal(u.path(a()),e))return;const i=t.map(e=>e.metadata.path_display),n=u.unsortedFiles(a()),l=i.reduce((e,t)=>{if(void 0===t)return e;const r=n.get(t);return s&&void 0!==r?e.set(t,new m.File(Object.assign(Object.assign({},r),{isDeleted:!0}))):e.delete(t)},n);r((0,c.setUnsortedFiles)({unsortedFiles:l}))})))({pathAtRequestTime:g,successEntries:j}));const B=((e,t)=>()=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),O({state:e,eventName:F.WebUserActionLogEvent.DELETE_UNDO,num_files_selected:t.result.changeset_data.length,num_folders_selected:0}),(0,S.rollback)({changeset_data:t.result.changeset_data,userId:u.user(e).id,onSuccess:()=>{T.Snackbar.complete(A.intl.formatMessage(a.deleteUndoSnackbarMessage),"browse-action"),O({state:e,eventName:F.WebUserActionLogEvent.DELETE_UNDO_REQUEST_SUCCESS,num_files_selected:t.result.changeset_data.length,num_folders_selected:0})}})})))(p(),x);(0,I.setHandleUndo)(B);const Y=x.result.entries.filter(h.isFailure),V=Y[0];let q,W;if(void 0!==V){const e=V.failure;q=e[".tag"],h.isPathLookupFailure(e)&&(W=e.path_lookup[".tag"])}const H=x.result.entries.filter(e=>h.isFailure(e)&&!h.isPathLookupFailure(e.failure)).length;U.record(H>0?0:1),(0,r.recordPathLookupErrors)(Y,"delete",L),Y.length===x.result.entries.length?(T.Snackbar.fail(E.deleteCompleteError(Y),"browse-action"),O({state:p(),eventName:F.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:x.result.changeset_data.length,num_folders_selected:0,batch_success_count:x.result.entries.length-Y.length,batch_fail_count:Y.length,error_summary:q,lookup_error_type:W}),N&&M.logEvent({action_surface:"browse_delete_modal",event:"delete_failure",page_source:"browse",extra:{id:C.id,backup_type:w.BackupType.COMPUTER}})):((0,R.publishEvent)(b.CampaignEvents.DELETE_SUCCESS),T.Snackbar.completeWithUndo(E.deleteCompleteSuccess(e.length,j.length),B,"browse-action"),O({state:p(),eventName:F.WebUserActionLogEvent.DELETE_REQUEST_SUCCESS,num_files_selected:x.result.changeset_data.length,num_folders_selected:0,batch_success_count:x.result.entries.length,batch_fail_count:0,error_summary:q,lookup_error_type:W}),N&&M.logEvent({action_surface:"browse_delete_modal",event:"delete_success",page_source:"browse",extra:{id:C.id,backup_type:w.BackupType.COMPUTER}}))}));const C=(e,t,s,r)=>{const a=u.selectedFiles(e),{num_files_selected:o,num_folders_selected:i}=_.countFilesAndFolders(a);(0,l.logBrowseAction)({uid:u.user(e).id,action:t,num_files_selected:o,num_folders_selected:i,view_type:f.selectViewType(e,{instanceId:d.BROWSE_FILES_VIEW_ID}),result:s,error_summary:r})};t.renameUndo=({file:e,pathAtRequestTime:t,resultEntry:n,changeset:l})=>(d,_)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.user(_()),m=(0,g.fileFromMetadata)(e,n.success),p=(0,i.getMetricsReporter)(),f={surface:"browse",contentType:e.is_dir?"folders":"files",batchSizeBucket:"single"},S={latency:p.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/latency_ms"},f),completed:p.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/completed"},f)};T.Snackbar.sync(A.intl.formatMessage(a.renameUndoSnackbarProgressMessage),!1,"browse-action"),d((0,c.pushBoltIgnore)({added:new Set([e.fq_path]),removed:new Set([m.fq_path])})),C(_(),F.WebUserActionLogEvent.RENAME_UNDO,e);const E=yield h.undo(l,s);E.isError?(T.Snackbar.fail(A.intl.formatMessage(a.renameUndoSnackbarErrorMessage),"browse-action"),d((0,c.popBoltIgnore)({added:new Set([e.fq_path]),removed:new Set([m.fq_path])})),C(_(),F.WebUserActionLogEvent.RENAME_UNDO_REQUEST_FAIL,e,E.error_summary),S.completed.record(0)):(T.Snackbar.complete(A.intl.formatMessage(a.renameUndoSnackbarSuccessMessage),"browse-action"),o.paths_are_equal(u.path(_()),t)&&(d((0,c.setUnsortedFiles)({unsortedFiles:u.unsortedFiles(_()).remove(m.fq_path).set(e.fq_path,e)})),d((0,c.refreshPinnedItems)())),d((0,c.selectFilesByFqPath)({fqPathsToSelect:[e.fq_path]})),C(_(),F.WebUserActionLogEvent.RENAME_UNDO_REQUEST_SUCCESS,e),S.completed.record(1)),S.latency.record()}));t.renameFile=({file:e,name:l,checkFSWs:d,onSuccessSnackbarClose:_})=>(m,f)=>s.__awaiter(void 0,void 0,void 0,(function*(){const S=u.user(f()),M=u.path(f()),w=(0,i.getMetricsReporter)(),b={surface:"browse",contentType:e.is_dir?"folders":"files"},R={latency:w.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/latency_ms"},b),completed:w.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/completed"},b)};if(-1!==l.indexOf("/"))return T.Snackbar.fail(A.intl.formatMessage(a.renameErrorInvalidName),"browse-action"),void m(p.setFileRename({file:e,renameState:null}));m(p.setFileRename({file:e,renameState:v.RenameState.SAVING_INPUT})),T.Snackbar.sync(A.intl.formatMessage(a.renameSnackbarProgressMessage),!1,"browse-action");const O=yield h.renameFile(e.fq_path,l,S.id,{checkFSWs:d});if(O.isError&&"to"===O.error[".tag"]&&"file_system_warnings"===O.error.to[".tag"])return void m((({file:e,name:r,details:o})=>(i,l)=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:o,onFinalAccept:()=>{i((0,t.renameFile)({file:e,name:r,checkFSWs:!1}))},onAbortAction:()=>{i(p.setFileRename({file:e,renameState:null})),i((0,c.pushBoltIgnore)({moved:new Set([e.fq_path])}))},confirmText:A.intl.formatMessage(a.renameFswConfirmText)})})))({file:e,name:l,details:O.error.to.details}));if(R.latency.record(),O.isError||"success"!==O.result.entries[0][".tag"]){const t=O.isError?O:h.createUndefinedRpcResult();return m((({file:e,result:t})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){r((0,c.pushBoltIgnore)({moved:new Set([e.fq_path])})),r(p.setFileRename({file:e,renameState:null})),T.Snackbar.fail(E.renameError(t.error,e.fq_path),"browse-action"),C(a(),F.WebUserActionLogEvent.RENAME_REQUEST_FAIL,e,t.error_summary)})))({file:e,result:t})),R.completed.record(0),void w.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/error"},Object.assign(Object.assign({},b),{error:t.error[".tag"]})).record(1)}const N=O.result.entries[0],L=(0,g.fileFromMetadata)(e,N.success);o.paths_are_equal(u.path(f()),M)&&(m((0,c.setUnsortedFiles)({unsortedFiles:u.unsortedFiles(f()).remove(e.fq_path).set(L.fq_path,L)})),m((0,y.fileRename)({file:e,newFile:L})),m((0,c.refreshPinnedItems)())),m((0,c.selectFilesByFqPath)({fqPathsToSelect:[L.fq_path]})),m(p.setFileRename({file:e,renameState:null})),R.completed.record(1);const P=()=>{m((0,t.renameUndo)({file:e,resultEntry:N,pathAtRequestTime:M,changeset:O.result.changeset_data}))};(0,I.setHandleUndo)(P),T.Snackbar.completeWithUndo(A.intl.formatMessage(a.renameSnackbarSuccessMessage),P,"browse-action",{onClosed:()=>{null==_||_(L)}}),C(f(),F.WebUserActionLogEvent.RENAME_REQUEST_SUCCESS,L)}))})),define("metaserver/static/js/browse/data/action_creators/index",["require","exports","tslib","lodash","immutable","typescript/dropbox/proto/hql_events/browse/web_browse_pb","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/file_actions/create-folder","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/filetypes","metaserver/static/js/flux/dispatcher","metaserver/static/js/clean/history","metaserver/static/js/tagging/experiments","metaserver/static/js/hql/index","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/api","metaserver/static/js/extensions/data/store","metaserver/static/js/browse/constants","metaserver/static/js/browse/crypto_subtle_digest","metaserver/static/js/browse/data/folder_overview_selectors","metaserver/static/js/browse/data/helpers","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/types","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/browse/uri_helper","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/types","metaserver/static/js/files_view/sort_types","metaserver/static/js/folder_overview/data/action_creators","metaserver/static/js/clean/ui/selection","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/redux/tests/store","metaserver/static/js/tagging/experiments","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/core/exception","metaserver/static/js/core/i18n","metaserver/static/js/core/uri","metaserver/static/js/browse/right_rail_preferences","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/sync_everything/constants","metaserver/static/js/browse/api"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E,v,y,T,I,F,A,M,w,b,R,O,C,N,L,P,D,k,U,x,j,B,Y,V,q,W,H){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchLastBackupTime=t.setCreateMenuOpenRequest=t.setBackups=t.setOverflowMenuCloseRequest=t.setInlineOverflowMenuOpenRequest=t.setOverflowMenuCoordinates=t.setOverflowMenuOpenRequest=t.expandBlade=t.setFileHasAutomatedRuleMap=t.setRightRailIsCollapsed=t.setHideFilesAndSidebar=t.setViewType=t.setArePostTTIModulesLoaded=t.setIsFileViewerShown=t.appendFiles=t.applyBoltUpdates=t.completeFolderSizes=t.setFolderSizesPending=t.requestFolderSizes=t.setUnsortedFiles=t.setAndStoreSortOrder=t.setShouldShowDeletedFiles=t.clearSelection=t.setSelection=t.setPathData=t.setPath=t.setUrl=t.setPaginatedTotalNumFiles=t.setNewFolderCreationState=t.setMountPoints=t.setLoadingState=t.setFolderSizes=t.createFolder=t.refreshPinnedItems=t.toggleSpacesEntryPoint=t.hideFolderHistoryPanel=t.showFolderHistoryPanel=t.hideRewind=t.showRewind=t.setFolderMemberCounts=t.setIsRewindButtonEnabled=t.setFilePathsToSelectOnNextUpdate=t.resetFileJumpFilter=t.addFileJumpKeyCode=t.setBrowsePostTTIData=t.setBrowsePostTTIExperiments=t.setCurrentFolderInfo=t.setContext=t.pasteFilesFromClipboard=t.setFilesToClipboard=t.setCanDisplayFolderSizes=t.selectFilesByFqPath=t.popBoltIgnore=t.pushBoltIgnore=t.handleAppCleanup=t.appInit=void 0,r=s.__importStar(r),a=s.__importStar(a),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),u=s.__importDefault(u),f=s.__importStar(f),E=s.__importStar(E),y=s.__importStar(y),I=s.__importStar(I),M=s.__importStar(M),w=s.__importStar(w),V=s.__importStar(V);t.appInit=({props:e,user:t,viewer:s})=>r=>{r({type:T.ActionTypes.APP_INIT,payload:{props:e,user:t,viewer:s}}),r(M.loadScopedSortOrders({user:t,defaultSort:{sortField:O.SortField.FILENAME,sortDirection:O.SortDirection.ASCENDING}}))};t.handleAppCleanup=()=>({type:T.ActionTypes.HANDLE_APP_CLEANUP});t.pushBoltIgnore=e=>({type:T.ActionTypes.PUSH_BOLT_IGNORE,payload:e});t.popBoltIgnore=e=>({type:T.ActionTypes.POP_BOLT_IGNORE,payload:e});t.selectFilesByFqPath=({fqPathsToSelect:e})=>({type:T.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}});t.setCanDisplayFolderSizes=({canDisplayFolderSizes:e})=>({type:T.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:e}});const G=({clipboard:e})=>({type:T.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboard:e}});t.setFilesToClipboard=({clipboard:e})=>t=>{const{files:s}=e;s.length&&(s.some(e=>e.isDeleted||e.is_unmounted)?L.Snackbar.fail(B.intl.formatMessage({id:"jdnaZR",defaultMessage:"Deleted files cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(F.File.isTeamSharedFolder)||s.some(F.File.isTeamMemberFolder)?L.Snackbar.fail(B.intl.formatMessage({id:"0Nkg/N",defaultMessage:"Team Folders cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(F.File.isFamilySharedFolder)?L.Snackbar.fail(B.intl.formatMessage({id:"KMcV0/",defaultMessage:"Family shared folders cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(e=>e.type===d.FileTypes.VAULT_FOLDER)?L.Snackbar.fail(B.intl.formatMessage({id:"La991r",defaultMessage:"{TRADEMARK_VAULT} cannot be added to the clipboard"},{TRADEMARK_VAULT:U.TRADEMARK_VAULT}),"browse-clipboard-copy"):(L.Snackbar.complete(B.intl.formatMessage({id:"BvUPS9",defaultMessage:"{count, plural, one{Added {count} item to clipboard.} other{Added {count} items to clipboard.}}"},{count:s.length}),"browse-clipboard-copy"),t(G({clipboard:e}))))};t.pasteFilesFromClipboard=({copyFiles:e,moveFiles:t})=>(s,r)=>{const a=r(),o=y.user(a),{files:i,action:n}=y.clipboard(r()),d=y.path(r());i.length<=0||("cut"===n?(l.paths_are_equal(l.parent_dir(i[0].fq_path),d)||t({user:o,files:i,newPath:"/"===d?"":d,checkFSWs:!0}),s(G({clipboard:{files:[]}}))):e({user:o,files:i,newPath:d,checkFSWs:!0,isPasteAction:!0,onSuccess:e=>{}}))};t.setContext=({context:e})=>({type:T.ActionTypes.SET_CONTEXT,payload:{context:e}});t.setCurrentFolderInfo=({currentFolderInfo:e})=>({type:T.ActionTypes.SET_CURRENT_FOLDER_INFO,payload:{currentFolderInfo:e}});t.setBrowsePostTTIExperiments=({browsePostTTIExperiments:e})=>({type:T.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:e}});t.setBrowsePostTTIData=({browsePostTTIData:e})=>{const t=Object.assign({},e);return Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),{type:T.ActionTypes.SET_BROWSE_POST_TTI_DATA,payload:{browsePostTTIData:t}}};const K=({fileJumpFilter:e})=>({type:T.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:e}});t.addFileJumpKeyCode=({keyChar:e})=>(s,r)=>{const a=y.fileJumpFilter(r())+e.toLowerCase();s(K({fileJumpFilter:a}));let o=null;const i=y.fileJumpIndex(r());for(const{fqPath:e,filename:t}of i)if(t>=a){o=e;break}null!=o&&s((0,t.selectFilesByFqPath)({fqPathsToSelect:[o]}))};t.resetFileJumpFilter=()=>(e,t)=>{(0,p.logKeyboardShortcutUsage)({user_id:y.user(t()).id,keyboard_shortcut_type:"jump",view_type:w.selectViewType(t(),{instanceId:g.BROWSE_FILES_VIEW_ID})}),e(K({fileJumpFilter:""}))};t.setFilePathsToSelectOnNextUpdate=({filePathsToSelectOnNextUpdate:e})=>({type:T.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}});t.setIsRewindButtonEnabled=e=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{path:s,userId:r,userSkuHasRewind:a}=e;if(!a)return void t({type:T.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!0}});const o=yield f.isRewindButtonEnabled(s,r);t({type:T.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!!o.can_rewind}})}));t.setFolderMemberCounts=e=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{contentId:s,userId:a}=e;let o;o=y.isInsideBackupFolder(r())?1:yield f.getFolderMemberCounts(s,a),t({type:T.ActionTypes.SET_FOLDER_MEMBER_COUNTS,payload:{value:o}})}));t.showRewind=()=>({type:T.ActionTypes.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}});t.hideRewind=()=>({type:T.ActionTypes.HIDE_TIMELINE,payload:{}});t.showFolderHistoryPanel=()=>({type:T.ActionTypes.SHOW_FOLDER_HISTORY_PANEL,payload:{timestamp:(new Date).getTime()}});t.hideFolderHistoryPanel=()=>({type:T.ActionTypes.HIDE_FOLDER_HISTORY_PANEL,payload:{}});t.toggleSpacesEntryPoint=({value:e})=>({type:T.ActionTypes.TOGGLE_SPACES_ENTRY_POINT,payload:{value:e}});t.refreshPinnedItems=()=>(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=E.folderOverviewFolderFileId(t());e((0,C.reloadContentReferences)({folderFileId:s,componentNamespace:g.BrowseFolderOverviewComponentNamespace}))}));t.createFolder=({pathName:e,folderName:r,user:a,checkFSWs:o,showShareModalOnSuccess:l,redirectOnSuccess:d,redirectOnCancel:c,selectCreatedFolder:u=!0,origin:_})=>(m,p)=>s.__awaiter(void 0,void 0,void 0,(function*(){m((0,t.setNewFolderCreationState)({newFolderCreationState:R.NewFolderCreationState.SAVING_INPUT}));const s=yield n.createFolder({destination:e,name:r,user:a,checkFsw:o,origin:_,surface:"browse"});if(m((0,t.setNewFolderCreationState)({newFolderCreationState:R.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),"success"===s.type){const e=(0,b.folderFromFolderMetadata)(s.folder);u&&m((0,t.selectFilesByFqPath)({fqPathsToSelect:[e.fq_path]})),d&&d(e.fq_path),l&&l(e,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else c&&c()}));t.setFolderSizes=({folderSizes:e})=>({type:T.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:e}});t.setLoadingState=({loadingState:e,path:t})=>({type:T.ActionTypes.SET_LOADING_STATE,payload:{loadingState:e,path:t}});t.setMountPoints=({mountPoints:e})=>({type:T.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:e}});t.setNewFolderCreationState=({newFolderCreationState:e})=>({type:T.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}});t.setPaginatedTotalNumFiles=({paginatedTotalNumFiles:e})=>({type:T.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}});t.setUrl=({path:e="",qargs:s,expandedBlade:a="info",forceExpandRightRail:o=!1})=>(i,n)=>{u.default.push_state(y.urlPrefix(n())+Y.URI.encode_parts(e),r.omitBy(Object.assign(Object.assign({},r.pick((0,A.getQueryArgs)(),["d"])),s),r.isUndefined)),i((0,t.clearSelection)({skipLogging:!0})),i((0,t.expandBlade)(a)),o&&i((0,t.setRightRailIsCollapsed)(!1))};t.setPath=({path:e})=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){t({type:T.ActionTypes.SET_PATH,payload:{path:e}});const s=yield(0,S.hashString)(e);s||(0,j.reportException)({err:new Error("hashString returned null"),tags:["browse"],severity:j.SEVERITY.NONCRITICAL}),t({type:T.ActionTypes.SET_VIEW_SCOPE,payload:{viewScope:s}}),e&&(document.title=(0,W.isBackupBrowse)()?B.intl.formatMessage({id:"IePl0Y",defaultMessage:"{folder_name} - Dropbox Backup"},{folder_name:l.filename(e,B.intl.formatMessage({id:"UwzCW9",defaultMessage:"Backups"}))}):B.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:l.filename(e,B.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}))}))}));t.setPathData=({path:r,files:o,paginatedTotalNumFiles:i,context:n,currentFolderInfo:d})=>(u,_)=>{if(!l.paths_are_equal(r,y.path(_())))return;const m=a.Map(o.map(e=>[e.fq_path,e]));u((0,t.setContext)({context:n})),u((0,t.setCurrentFolderInfo)({currentFolderInfo:d})),(0,t.setUnsortedFiles)({unsortedFiles:m})(u,_,P.mockExtraArguments),u((0,t.setPaginatedTotalNumFiles)({paginatedTotalNumFiles:i})),u((0,t.clearSelection)({skipLogging:!0})),z({unsortedFiles:m})(u,_,P.mockExtraArguments),(0,D.isFetchTagsOnBrowseEnabled)(y.manualTaggingVariant(_()))&&u((0,q.fetchTagsForFiles)({user:y.user(_()),files:d?[...o,d]:[...o],override:!0})),setTimeout(()=>{c.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:r,files:o}});const t={path:r,hasPermissionToUploadToFolder:n.isCurrentPathWriteable(),isMovingIntoVault:n.isInsideVaultFolder};new Promise((t,s)=>{e(["metaserver/static/js/file_uploader/clean/data/slice"],t,s)}).then(s.__importStar).then(({uploadActionCreators:e})=>{u(e.setPath(t))})},1)};t.setSelection=({selection:e,actionSource:t,skipLogging:s})=>(r,a)=>{if(!s){const s=a(),{event:r,itemId:i}=I.makeSelectionEvent(y.selection(s),e),n=y.selectFileByFullPath(s,{path:i}),{browseWebHqlPilot:l}=y.experiments(s);if(n){const{num_files_selected:i,num_folders_selected:d}=I.countFilesAndFolders(y.selectFilesForSelection(s,{selection:e}));l&&r===k.WebUserActionLogEvent.SELECT_ROW&&(0,m.logEvent)(new o.WebBrowseSelectRow({actionSource:t})),(0,p.logBrowseAction)({uid:y.user(s).id,action:r,action_source:t,num_files_selected:i,num_folders_selected:d,view_type:w.selectViewType(a(),{instanceId:g.BROWSE_FILES_VIEW_ID}),result:n,extra:{entity_type:n.is_dir?"folder":"file"}})}}r({type:T.ActionTypes.SET_SELECTION,payload:{selection:e,actionSource:t}}),X(r,a,e)};t.clearSelection=({actionSource:e,skipLogging:s}={})=>(0,t.setSelection)({actionSource:e,skipLogging:s,selection:(0,N.createSelection)()});t.setShouldShowDeletedFiles=({shouldShowDeletedFiles:e})=>({type:T.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:e}});t.setAndStoreSortOrder=e=>(t,s)=>{const r=s(),a=y.user(r);(0,p.logSortRecords)({uid:a.id,sort_by:e.sortField,sort_direction:e.sortDirection,view_type:w.selectViewType(r,{instanceId:g.BROWSE_FILES_VIEW_ID})}),t(M.setSort({user:a,sort:e,viewScope:w.selectViewTypeScope(r,{instanceId:g.BROWSE_FILES_VIEW_ID}),updateGlobalScope:!0})),t((({sortOrder:e})=>({type:T.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:e}}))({sortOrder:e}))};t.setUnsortedFiles=({unsortedFiles:e})=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=y.user(r());t({type:T.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),(0,h.initializeStore)(s,e.toArray())}));t.requestFolderSizes=({fqPath:e})=>({type:T.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:e}});t.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:T.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}});t.completeFolderSizes=({fetchFolderSizeState:e})=>({type:T.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}});t.applyBoltUpdates=({path:e,updates:s})=>(r,a)=>{const{parent_changes:o}=s,i=y.user(a());if(l.paths_are_equal(e,y.path(a()))){if(o&&o.change_to_fq_path)return(0,v.showUserNotificationForPathChange)(i,o),void(0,t.setUrl)({path:o.change_to_fq_path})(r,a,P.mockExtraArguments);(function(e,s,r){const{mount_points:a}=r,o=y.path(s()),[i,n]=(0,v.getMountPointUpdateForCurrentPath)(a,o,y.mountPoints(s()));!i||n||(0,W.isBackupBrowse)()||L.Snackbar.complete(B.intl.formatMessage({id:"QB9ZqK",defaultMessage:"The folder was unshared."}),"browse-unshare");const l=(0,v.getPathForNewMountPoint)(i,n,o);if(l)return void e((0,t.setPath)({path:l}));e((0,t.setMountPoints)({mountPoints:a}))})(r,a,s),(function(e,s,r){const{added:a,moved:o,removed:i}=r,n=y.path(s());let d=y.unsortedFiles(s()),u=y.folderSizes(s()),_=d.size;const m={added:new Set([]),moved:new Set([]),removed:new Set([])};e((0,t.popBoltIgnore)(m)),d=d.withMutations(e=>{u=u.withMutations(t=>{const s=t=>{(e=>l.paths_are_equal(l.parent_dir(e.fq_path),n))(t)&&(e.set(t.fq_path,F.File.fromServerObject(t)),_+=1)},r=(r,a)=>{const o=e.get(r);if(o&&o.sjid>=a.sjid&&r===a.fq_path)return;e.remove(r),_-=1,s(a);const i=t.get(r);i&&(t.remove(r),t.set(a.fq_path,i))},d=s=>{e.remove(s),t.remove(s),_-=1};for(const t of a)e.has(t.fq_path)?r(t.fq_path,t):s(t);for(const[t,a]of o)e.has(t)?r(t,a):e.has(a.fq_path)?r(a.fq_path,a):s(a);for(const t of i){const s=e.find(e=>e.fq_path.toLowerCase()===t.toLowerCase());s&&d(s.fq_path)}})}),d.size!==_&&(0,j.reportException)({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:j.SEVERITY.NONCRITICAL,exc_extra:{expected_unsorted_files_size:_,actual_unsorted_files_size:d.size,is_deleted_files_on:y.shouldShowDeletedFiles(s()),filesAdded:a,filesRemoved:i,filesMove:o}});d!==y.unsortedFiles(s())&&((0,t.setUnsortedFiles)({unsortedFiles:d})(e,s,P.mockExtraArguments),c.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_UPDATED,data:{parentPath:n,files:d.toArray()}}));u!==y.folderSizes(s())&&e((0,t.setFolderSizes)({folderSizes:u}));z({unsortedFiles:d})(e,s,P.mockExtraArguments)})(r,a,s),(0,_.isTaggingEnabled)(y.manualTaggingVariant(a()))&&(function(e,t,s,r){if(0===s.moved.length)return;const a=[];for(const e of s.moved){const{fq_path:s}=e[1],r=y.selectFileByFullPath(t(),{path:s});void 0!==r&&a.push(r)}e((0,q.fetchTagsForFiles)({user:r,files:a}))})(r,a,s,i)}};const z=({unsortedFiles:e})=>(s,r)=>{const o=y.filePathsToSelectOnNextUpdate(r()).toArray().map(e=>e.toLowerCase()),i=e.toArray().filter(e=>o.includes(e.fq_path.toLowerCase())).map(e=>e.fq_path.toLowerCase()),n=o.filter(e=>!i.includes(e.toLowerCase()));0!==i.length&&(s((0,t.selectFilesByFqPath)({fqPathsToSelect:i})),s((0,t.setFilePathsToSelectOnNextUpdate)({filePathsToSelectOnNextUpdate:a.Set(n)})))};t.appendFiles=({path:e,files:s,currentFolderInfo:r})=>(o,i)=>{if(!l.paths_are_equal(e,y.path(i())))return;const n=y.unsortedFiles(i()),d=n.size;let u=d;s.forEach(e=>{n.has(e.fq_path)||u++});const _=n.merge(a.Map(s.map(e=>[e.fq_path,e])));(0,t.setUnsortedFiles)({unsortedFiles:_})(o,i,P.mockExtraArguments),z({unsortedFiles:_})(o,i,P.mockExtraArguments),(0,D.isFetchTagsOnBrowseEnabled)(y.manualTaggingVariant(i()))&&(r=null!=r?r:y.getCurrentFolderInfo(i()),o((0,q.fetchTagsForFiles)({user:y.user(i()),files:r?[...s,r]:[...s],override:0===d}))),x.BROWSE_SHARED_WITH_PERF?c.Dispatcher.dispatch({type:g.SharedWithActionType.LOAD_SHARED_FILE_DATA_FOR_PATH,data:{parentPath:e,files:s}}):c.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:e,files:s}}),_.size!==u&&(0,j.reportException)({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:j.SEVERITY.NONCRITICAL,exc_extra:{previous_unsorted_files_size:d,incoming_files_size:s.length,expected_files_size:u,updated_unsorted_files_size:_.size,is_deleted_files_on:y.shouldShowDeletedFiles(i())}})};t.setIsFileViewerShown=({isShown:e})=>({type:T.ActionTypes.SET_IS_FILE_VIEWER_SHOWN,payload:{isShown:e}});t.setArePostTTIModulesLoaded=({arePostTTIModulesLoaded:e})=>({type:T.ActionTypes.SET_ARE_POST_TTI_MODULES_LOADED,payload:{arePostTTIModulesLoaded:e}});const X=(e,t,s)=>{if(!s||0===s.selected.count())return;const r=y.unsortedFiles(t()),a=null==r?void 0:r.filter(e=>s.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl),o=[];if(null==a||a.forEach(e=>{o.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})}),o.length>0){const s=y.user(t()).id;e(M.loadPreviewThumbnails(o,s,g.BROWSE_FILES_VIEW_ID))}};t.setViewType=e=>(t,s)=>{const r=s();t(M.setViewType({user:y.user(r),viewType:e,viewTypeScope:y.selectViewTypeScope(r),updateGlobalScope:!0}))};t.setHideFilesAndSidebar=({shouldHideFilesAndSidebar:e})=>({type:T.ActionTypes.SET_HIDE_FILES_AND_SIDEBAR,payload:{shouldHideFilesAndSidebar:e}});t.setRightRailIsCollapsed=e=>(t,s)=>{const r=y.user(s());t({type:T.ActionTypes.SET_RIGHTRAIL_IS_COLLAPSED,payload:{collapsed:e}}),V.setIsCollapsed(r.id,e)};t.setFileHasAutomatedRuleMap=({fileHasAutomatedRuleMap:e})=>({type:T.ActionTypes.SET_FILE_HAS_AUTOMATED_RULE_MAP,payload:{fileHasAutomatedRuleMap:e}});t.expandBlade=e=>({type:T.ActionTypes.SET_EXPANDED_BLADE,payload:{expandedBlade:e}});t.setOverflowMenuOpenRequest=e=>({type:T.ActionTypes.SET_OVERFLOW_MENU_OPEN_REQUEST,payload:{overflowMenuOpenRequest:e}});t.setOverflowMenuCoordinates=e=>({type:T.ActionTypes.SET_OVERFLOW_MENU_COORDINATES,payload:{overflowMenuCoordinates:e}});t.setInlineOverflowMenuOpenRequest=e=>({type:T.ActionTypes.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST,payload:{inlineOverflowMenuOpenRequest:e}});t.setOverflowMenuCloseRequest=e=>({type:T.ActionTypes.SET_OVERFLOW_MENU_CLOSE_REQUEST,payload:{overflowMenuCloseRequest:e}});t.setBackups=t=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(null!==y.backups(a()))return;const{expEnableThirdPartyBackup:o}=y.browsePostTTIExperiments(a()),{fetchBackups:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/sync_everything/api"],t,s)}).then(s.__importStar),n=yield i(t,{includeThirdPartyBackups:o});r({type:T.ActionTypes.SET_BACKUPS,payload:{backups:n}})}));t.setCreateMenuOpenRequest=e=>({type:T.ActionTypes.SET_CREATE_MENU_OPEN_REQUEST,payload:{createMenuOpenRequest:e}});t.fetchLastBackupTime=(e,t)=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){var s,o;const i=y.lastBackupTimesSelector(a());if(e&&!i.has(e)){const i=y.user(a()),n=yield(0,H.fetchChronicleEventsApi)(i.id,e,0,{".tag":"past"},!1,[],t);(null===(o=null===(s=n.events)||void 0===s?void 0:s[0])||void 0===o?void 0:o.timestamp_us)&&r({type:T.ActionTypes.SET_LAST_BACKUP_TIMES,payload:{fqPath:e,lastBackupTime:n.events[0].timestamp_us}})}}))})),define("metaserver/static/js/browse/data/folder_overview_selectors",["require","exports","tslib","metaserver/static/js/browse/constants","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/browse/data/selectors","reselect","metaserver/static/js/files_view/types","metaserver/static/js/filepath/filepath"],(function(e,t,s,r,a,o,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowFamilyEmptyState=t.shouldShowVaultEmptyState=t.paginatedTotalNumFiles=t.folderOverviewPinnedItems=t.folderOverviewLoggingFileId=t.folderOverviewFolderFileId=t.hasFailedToLoad=t.haveAllComponentsLoaded=void 0,a=s.__importStar(a),l=s.__importStar(l);const d=a.makeHaveAllComponentsLoadedSelector(),c=a.makeHasFailedToLoadSelector(),u=a.makeFolderFileIdSelector(),_=a.makeLoggingFileIdSelector(),m=a.makePinnedItemsSelector();t.haveAllComponentsLoaded=e=>d(e,{componentNamespace:r.BrowseFolderOverviewComponentNamespace});t.hasFailedToLoad=e=>c(e,{componentNamespace:r.BrowseFolderOverviewComponentNamespace});t.folderOverviewFolderFileId=e=>u(e,{path:(0,o.path)(e)});t.folderOverviewLoggingFileId=e=>_(e,{path:(0,o.path)(e)});t.folderOverviewPinnedItems=e=>m(e,{path:(0,o.path)(e)});t.paginatedTotalNumFiles=e=>(0,o.browseLoadingState)(e)===n.LoadingState.LOADED?(0,o.sortedFiles)(e).count():(0,o.getBrowseState)(e).paginatedTotalNumFiles,t.shouldShowVaultEmptyState=(0,i.createSelector)(o.context,t.paginatedTotalNumFiles,(e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t),t.shouldShowFamilyEmptyState=(0,i.createSelector)(o.context,t.paginatedTotalNumFiles,o.experiments,(e,t,s)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t)}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,a)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};define("metaserver/static/js/browse/fss_experiment_carousel_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowFssExpr=void 0;t.asyncShowFssExpr=(t,s,r,a)=>{new Promise((t,s)=>{e(["metaserver/static/js/browse/fss_experiment_carousel"],t,s)}).then(__importStar).then(e=>{e.showFssExpr(t,s,r,a)})}})),define("metaserver/static/js/clean/ui/tree_view",["require","exports","tslib","classnames","immutable","react","react-dom","lodash","metaserver/static/js/icon/folder_icon","typescript/libraries/spectrum-content-icon-compatibility/src/index","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/clean/em_string","metaserver/static/js/filepath/filepath","ts-key-enum","metaserver/static/js/components/ui/css","metaserver/static/js/clean/ui/sprite","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/clean/ui/tree_item","metaserver/static/js/clean/ui/tree"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserFolderTreeView=t.browseGetFolder=t.AdminFolderTreeView=t.PinnedFolderTreeView=t.FolderTreeView=t.RootIcon=t.TreeView=t.TreeItemView=t.INDENT_SIZE_PX_WITH_DIG_EXPAND_BUTTON=t.INDENT_SIZE_PX=t.MAX_LABEL_LENGTH=void 0,r=s.__importDefault(r),a=s.__importStar(a),o=s.__importDefault(o),i=s.__importStar(i),n=s.__importStar(n),c=s.__importStar(c),t.MAX_LABEL_LENGTH=20,t.INDENT_SIZE_PX=15,t.INDENT_SIZE_PX_WITH_DIG_EXPAND_BUTTON=24;class v extends o.default.Component{render(){return o.default.createElement("ul",{className:"tree-view__group",role:"group"},this.props.children)}}v.displayName="TreeGroupView";class y extends o.default.Component{constructor(){super(...arguments),this.handleClick=e=>{if(e.preventDefault(),e.stopPropagation(),this.props.item.disabled)return;const t=i.findDOMNode(this.refs.expandButton);t&&t.contains(e.target)||this.props.onClick&&this.props.onClick(this.props.item)},this.handleExpandClick=e=>{e.preventDefault(),this.props.onExpandButtonClick&&this.props.onExpandButtonClick(this.props.item,!this.props.isExpanded)}}renderExpandButton(){return o.default.createElement("div",{className:(0,r.default)("tree-view__expand-button",{"is-disabled":this.props.disabled}),onClick:this.handleExpandClick,ref:"expandButton",role:"button"},this.props.useDIGExpandButton?o.default.createElement(o.default.Fragment,null,!this.props.isExpanded&&o.default.createElement("div",{className:(0,r.default)("tree-view__expand-button-vertical",{"is-disabled":this.props.disabled})}),o.default.createElement("div",{className:(0,r.default)("tree-view__expand-button-horizontal",{"is-disabled":this.props.disabled})})):o.default.createElement(f.Sprite,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:this.props.isExpanded?h.intl.formatMessage({id:"nPGI06",defaultMessage:"Collapse"}):h.intl.formatMessage({id:"mGnlBs",defaultMessage:"Expand"})}))}renderIcon(){const{item:e}=this.props,{icon:t,disabled:s}=e;return o.default.createElement("div",{className:"tree-view__icon-wrapper"},o.default.createElement(d.IconContent,{className:"tree-view__item-icon",name:(0,l.convertLegacyFolderIconToSpectrum)(t,"small"),disabled:s||this.props.disabled,height:19,width:19}))}render(){const e=!this.props.canExpand,s=(0,r.default)({"tree-view__item":!0,"tree-view__item--leaf":e}),a=this.props.canExpand&&!this.props.showAsHeader;return o.default.createElement("li",{key:this.props.item.key,id:this.props.id,className:s,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled||this.props.disabled,"aria-label":this.props.item.label,"aria-level":this.props.level+1,"aria-selected":!!this.props.isSelected||void 0,"aria-expanded":a?this.props.isExpanded:void 0},o.default.createElement("span",{className:(0,r.default)({"tree-view__item-row":!0,"tree-view__item-row--disabled":this.props.item.disabled||this.props.disabled}),style:{paddingLeft:this.props.showAsHeader||!this.props.level?0:this.props.level*(this.props.useDIGExpandButton?t.INDENT_SIZE_PX_WITH_DIG_EXPAND_BUTTON:t.INDENT_SIZE_PX)}},this.props.showAsHeader||e?void 0:this.renderExpandButton(),this.props.item.icon?this.renderIcon():void 0,this.props.item.label?o.default.createElement("span",{className:"tree-view__item-label"},u.Emstring.em_snippet(this.props.item.label,t.MAX_LABEL_LENGTH)):void 0),this.props.children)}}t.TreeItemView=y,y.defaultProps={isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:n.noop,onExpandButtonClick:n.noop,showAsHeader:!1,useDIGExpandButton:!1,disabled:!1},y.displayName="TreeItemView";class T extends o.default.Component{renderIcon(){return this.props.useDIGIcon?o.default.createElement("div",{className:"tree-view__icon-wrapper"},o.default.createElement(d.IconContent,{className:"tree-view__item-icon",name:(0,l.convertLegacyFolderIconToSpectrum)(this.props.item.icon,"small"),disabled:!0})):this.props.item.icon?o.default.createElement(f.Sprite,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null}render(){return o.default.createElement("div",{className:(0,r.default)("tree-view__item-row","tree-view__item-row--disabled")},this.renderIcon(),o.default.createElement("h3",{className:"tree-view__header",id:this.props.id},this.props.item.label))}}T.displayName="TreeHeaderView";class I extends o.default.Component{constructor(){super(...arguments),this.state={selectedItemKey:this.props.defaultSelectedPath?this.props.defaultSelectedPath:null,expandedItemKeys:a.Set([this.props.tree.rootItem.key]),showFocused:!1},this.selectItem=e=>{this.props.disabled||(this.setState({selectedItemKey:null!=e&&e.key?e.key:null}),this.props.onItemSelected(e))},this.handleExpandButtonClick=(e,t)=>{this.setState({expandedItemKeys:this.setItemExpanded(e.key,t)}),this.props.onItemExpanded(e,t)},this.handleKeyDown=e=>{switch(e.key){case m.Key.ArrowUp:this.advanceSelection(!0)&&e.preventDefault();break;case m.Key.ArrowDown:this.advanceSelection(!1)&&e.preventDefault();break;case m.Key.ArrowRight:if(null!=this.state.selectedItemKey){const t=this.props.tree.items.get(this.state.selectedItemKey);this.canItemExpand(t)&&(this.handleExpandButtonClick(t,!0),e.preventDefault())}break;case m.Key.ArrowLeft:if(this.state.selectedItemKey){const t=this.props.tree.items.get(this.state.selectedItemKey);this.canItemExpand(t)&&(this.handleExpandButtonClick(t,!1),e.preventDefault())}}},this.rootRef=o.default.createRef(),this.handleOnFocus=()=>this.setState({showFocused:!0}),this.handleOnBlur=()=>this.setState({showFocused:!1})}UNSAFE_componentWillReceiveProps(e){e.resetSelectedItem&&e.resetSelectedItem!==this.props.resetSelectedItem&&this.setState({selectedItemKey:null})}componentDidUpdate(e,t){if(this.state.selectedItemKey&&this.state.selectedItemKey!==t.selectedItemKey&&this.rootRef.current){const e=this.rootRef.current,t=e.querySelector('[aria-selected="true"]');t&&this.scrollElementIntoViewIfNeeded(t,e)}}scrollElementIntoViewIfNeeded(e,t){const s=t.getBoundingClientRect(),r=e.getBoundingClientRect();if(e.offsetTop-t.scrollTop<0)return void e.scrollIntoView(!0);const a=s.height,o=t.scrollTop+a,i=r.height;e.offsetTop+i>o&&i<a&&e.scrollIntoView(!1)}hasSelectableRootItem(){const{rootStyle:e}=this.props;return e===S.RootStyle.TreeItem||e===S.RootStyle.HeaderItem}getHTMLIdPrefix(){return this.HTMLIdPrefix||(this.HTMLIdPrefix=`tree-view-${Math.floor(16777215*Math.random()).toString(16)}`)}getLastLeafOf(e){const t=this.props.tree.getChildItems(e);return this.state.expandedItemKeys.contains(e.key)&&null!=t&&t.size>0?this.getLastLeafOf(t.last()):e}getPrevItem(e){if(!e)return null;const t=this.props.tree.getParentItem(e);if(!t)return null;const s=this.props.tree.getChildItems(t),r=s.indexOf(e);if(r>0)return this.getLastLeafOf(s.get(r-1));if(0===r){return t===this.props.tree.rootItem&&!this.hasSelectableRootItem()?null:t}return null}getNextItem(e,t=!0){if(!e)return null;const s=this.state.expandedItemKeys.contains(e.key)&&this.props.tree.isParent(e);if(t&&s)return this.props.tree.getChildItems(e).first();const r=this.props.tree.getParentItem(e);if(!r)return null;const a=this.props.tree.getChildItems(r),o=a.size-1,i=a.indexOf(e);return i===o?this.getNextItem(r,!1):0<=i&&i<o&&a.get(i+1)||null}advanceSelection(e=!1){if(!this.state.selectedItemKey){let e;if(this.hasSelectableRootItem())e=this.props.tree.rootItem;else{const t=this.props.tree.getChildItems(this.props.tree.rootItem);e=t?t.first():null}return this.selectItem(e),!0}const t=this.props.tree.items.get(this.state.selectedItemKey),s=e?this.getPrevItem(t):this.getNextItem(t);return!!s&&(this.selectItem(s),!0)}getValidHTMLIdForItem(e){return`${this.getHTMLIdPrefix()}${e.key}`.replace(/\s+/g,"_")}setItemExpanded(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)}canItemExpand(e){return e&&(e.canExpand||this.props.tree.isParent(e))}renderSingleItem(e,t,s,r={}){const a=Object.assign({id:this.getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,canExpand:this.canItemExpand(e)&&!e.forceExpanded,level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},r),i=this.props.treeItemView;return o.default.createElement(i,Object.assign({},a),s)}renderItemAndDescendants(e,t){let s;const r=this.state.expandedItemKeys.contains(e.key)||e.forceExpanded;return this.props.tree.isParent(e)&&r&&(s=this.renderChildrenOfItemAsGroup(e,t+1)),this.renderSingleItem(e,t,s,{useDIGExpandButton:this.props.useDIGExpandButton,disabled:this.props.disabled})}renderChildrenOfItemAsGroup(e,t){if(!e||!this.props.tree.isParent(e))return null;const s=this.props.tree.getChildItems(e).map(e=>this.renderItemAndDescendants(e,t));return o.default.createElement(v,null,s.toJS())}render(){let e,t,s;const{rootItem:a}=this.props.tree;if(this.props.rootStyle===S.RootStyle.TreeItem)t=o.default.createElement(v,null,this.renderItemAndDescendants(a,0));else if(this.props.rootStyle===S.RootStyle.HeaderItem)e=this.getValidHTMLIdForItem(a),t=o.default.createElement(v,null,this.renderSingleItem(a,0,null,{showAsHeader:!0,id:e,disabled:this.props.disabled}),this.renderChildrenOfItemAsGroup(a,0));else if(this.props.rootStyle===S.RootStyle.StaticHeader)e=this.getValidHTMLIdForItem(a),t=o.default.createElement(v,null,o.default.createElement(T,{item:a,id:e,useDIGIcon:this.props.useDIGExpandButton}),this.renderChildrenOfItemAsGroup(a,0));else{if(this.props.rootStyle!==S.RootStyle.None)throw new Error(`Unknown root style: ${this.props.rootStyle}`);t=this.renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}if(this.props.defaultSelectedPath?this.state.selectedItemKey&&this.state.selectedItemKey in this.props.tree.items:this.state.selectedItemKey){const e=this.props.tree.items.get(this.state.selectedItemKey);s=this.getValidHTMLIdForItem(e)}return o.default.createElement("div",{role:"tree",tabIndex:0,onFocus:this.handleOnFocus,onBlur:this.handleOnBlur,className:(0,r.default)("tree-view","ax-focusable",{"is-focused":this.state.showFocused&&!this.props.disabled,"is-disabled":this.props.disabled}),"aria-labelledby":e||void 0,"aria-activedescendant":s,onKeyDown:this.handleKeyDown,ref:this.rootRef},t,this.props.children)}}var F;I.defaultProps={rootStyle:S.RootStyle.None,onItemSelected:e=>{},onItemExpanded:(e,t)=>{},treeItemView:y,defaultSelectedPath:"",useDIGExpandButton:!1,disabled:!1},I.displayName="TreeViewWithoutCSS",t.TreeView=(0,p.requireCssWithComponent)(I,["/static/metaserver/static/css/react/tree_view-vfl59yfhc.css","/static/metaserver/static/css/accessibility-vfliGZNRm.css"]),(function(e){e.BRIEFCASE="s_briefcase",e.HOUSE="s_house",e.DROPBOX="dropbox",e.TEAM="folder_team"})(F=t.RootIcon||(t.RootIcon={}));const A=e=>new S.FolderTreeItem({key:e.path,label:(0,_.filename)(e.path),canExpand:e.has_subdirs,icon:e.icon,disabled:e.read_only},e.contained_ns);class M extends o.default.Component{constructor(){super(...arguments),this._pendingAjaxRequest=null,this._pendingAjaxRequestAbortController=null,this.state={showLoadingScreen:!1,tree:E.Tree.createWithRootItem(new S.TreeItem({key:"/",icon:this.props.rootIcon,label:this.props.treeRootName}))},this.asyncFetchSubFoldersForItem=e=>{var t;const s=e===this.state.tree.rootItem;s&&this.setState({showLoadingScreen:!0}),this._pendingAjaxRequest&&(null===(t=this._pendingAjaxRequestAbortController)||void 0===t||t.abort()),this._pendingAjaxRequestAbortController=new AbortController,this._pendingAjaxRequest=this.props.mkAjaxRequest(e.key,this._pendingAjaxRequestAbortController.signal),Promise.resolve(this._pendingAjaxRequest).then(t=>{const s=this.parseFolderList(t),r=this.state.tree.setChildItems(e,s);this.setState({tree:r})}).catch(this.props.handleError).then(()=>{if(null==this._pendingAjaxRequest)return;this._pendingAjaxRequest=null,s&&(this.props.isLoadingAdditionalData||this.setState({showLoadingScreen:!1}));const e=i.findDOMNode(this.refs.treeView);e&&e.focus()})},this.handleItemSelected=e=>{null!==e&&(e instanceof S.FolderTreeItem?this.props.onFolderSelected(e.key,e.folderNsId,e.icon):this.props.onFolderSelected(e.key,void 0,e.icon))},this.handleExpandButtonClick=(e,t)=>{t&&!this.state.tree.isParent(e)&&this.asyncFetchSubFoldersForItem(e)},this.renderLoadingMessage=()=>o.default.createElement("span",{className:"tree-view__loading-label"},h.intl.formatMessage({id:"9fef95",defaultMessage:"Loading your folders…"}))}componentDidMount(){this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)}UNSAFE_componentWillReceiveProps(e){e.isLoadingAdditionalData||e.isLoadingAdditionalData===this.props.isLoadingAdditionalData||this.setState({showLoadingScreen:!1})}componentWillUnmount(){var e;this._pendingAjaxRequest&&(null===(e=this._pendingAjaxRequestAbortController)||void 0===e||e.abort(),this._pendingAjaxRequest=null)}parseFolderList(e){return e.map(A)}render(){const e=this.props.isRootSelectable?S.RootStyle.HeaderItem:S.RootStyle.StaticHeader;return o.default.createElement(t.TreeView,{ref:"treeView",tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick,resetSelectedItem:this.props.resetSelectedItem,defaultSelectedPath:this.props.defaultSelectedPath,useDIGExpandButton:this.props.useDIGExpandButton,disabled:this.props.disabled},this.state.showLoadingScreen?this.renderLoadingMessage():void 0)}}M.defaultProps={onFolderSelected:(e,t,s)=>{},handleError(e){g.Notify.error(h.intl.formatMessage({id:"dFFA0Z",defaultMessage:"An error occurred while trying to load your folder."}))}},M.displayName="AbstractFolderTreeView";class w extends M{}t.FolderTreeView=w;class b extends M{parseFolderList(e){let t=e;this.props.folderToHide&&(t=e.filter(e=>e.path!==this.props.folderToHide));let s=-1;const r=t.map((e,t)=>{const r=e.path;return this.props.pinnedFolder&&r===this.props.pinnedFolder&&(s=t),A(e)});if(-1!==s){const e=r[s];r.splice(s,1),r.unshift(e)}return r}}function R(e,t,s){const r={folder:t};return c.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:r,dataType:"json",signal:s})}t.PinnedFolderTreeView=b,t.AdminFolderTreeView=function(e){const t=e.mkAjaxRequest||((t,s)=>(function(e,t,s,r){const a={ns_id:s,ns_path:t,hide_tmfs:!0};return c.WebRequestOref({url:"/browse_util/tree_view_team_folder_contents",type:"POST",subject_user:e,data:a,dataType:"json",signal:r})})(e.userId,t,e.rootNSID,s));return o.default.createElement(w,Object.assign({},e,{rootIcon:F.DROPBOX,mkAjaxRequest:t}))},t.browseGetFolder=R,t.UserFolderTreeView=function(e){const t=e.mkAjaxRequest||((t,s)=>R(e.user.id,t,s)),s=e.forceRootSelectable||"edit"===e.user.user_root_permissions,r=e.is_paired?e.user.is_team?F.BRIEFCASE:F.HOUSE:F.DROPBOX,a=Object.assign(Object.assign({},e),{mkAjaxRequest:t,isRootSelectable:s,rootIcon:r});if(e.user.is_cdm_member){const t=e.user.cdm_tmf_path;return o.default.createElement(b,Object.assign({},a,{pinnedFolder:t}))}return o.default.createElement(w,Object.assign({},a))}})),define("metaserver/static/js/growth/ui/rich_snackbar_actions/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGrowthOrigin=t.SnackbarOrigin=void 0,(function(e){e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar",e.from_reengagement_upload_snackbar="from_reengagement_upload_snackbar",e.from_discovery_upload_snackbar="from_discovery_upload_snackbar",e.from_reengagement_rename_snackbar="from_reengagement_rename_snackbar",e.from_discovery_rename_snackbar="from_discovery_rename_snackbar"})(t.SnackbarOrigin||(t.SnackbarOrigin={})),(function(e){e.reengagement="reengagement",e.discovery="discovery"})(t.FeatureGrowthOrigin||(t.FeatureGrowthOrigin={}))})),define("metaserver/static/js/tidy_up/api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/constants","metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types","metaserver/static/js/filepath/filepath"],(function(e,t,s,r,a,o,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowUploadSnackbar=t.shouldShowMoveSnackbar=t.dismissSnackbar=t.shouldShowSnackbar=t.getNumAddedFilesAndFolders=t.applySmartPreview=t.createRequestPreviewDataFn=t.getStoredFilters=t.submitFeedback=t.undo=t.getKeyphrases=t.preview=t.applyPreview=t.tidy=void 0,t.tidy=function(e,t,a,o){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;return c(()=>s.ns("tidy_up").rpc("tidy",{request:o,source_path:t,ns_id:a,source:"web_modal"},{subjectUserId:e}),e,s)}))},t.applyPreview=function(e,t,a,o){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;return c(()=>s.ns("tidy_up").rpc("apply_preview",{rule:a,source_path:t,entries_to_tidy:o,source:"web_modal"},{subjectUserId:e}),e,s)}))},t.preview=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{return{result:yield s.ns("tidy_up").rpc("preview",{rule:a,source_path:(0,n.normalize)(t)},{subjectUserId:e})}}catch(e){return{isError:!0,error:e.error,error_summary:e.summary}}}))};const l=(e,t,s)=>s.ns("tidy_up").rpc("tidy/check",{async_job_id:e},{subjectUserId:t});function d(e){return Object.assign(Object.assign({},e),{ns_id_str:e.ns_id.toString()})}t.getKeyphrases=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{return(yield s.ns("tidy_up").rpc("get_keyphrases",{path:t},{subjectUserId:e})).entries}catch(e){return[]}}))},t.undo=function(e,t,a,o,i){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{const r=yield s.ns("tidy_up_api_proxy").rpc("undo",{source_path:e,moved_files_changesets:a.map(d),created_directories_changesets:o.map(d),renamed_directories_changesets:i.map(d)},{subjectUserId:t}),n=void 0!==r.files_result&&"success"===r.files_result[".tag"],l=!r.folders_result||"success"===r.folders_result[".tag"],c=!r.renamed_folders_result||"success"===r.renamed_folders_result[".tag"];return n&&l&&c}catch(e){return!1}}))},t.submitFeedback=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{yield s.ns("tidy_up_api_proxy").rpc("submit_feedback",{feedback:t},{subjectUserId:e})}catch(e){}}))},t.getStoredFilters=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{const r=yield s.ns("tidy_up_api_proxy").rpc("get_stored_custom_filters",{folder_path:t},{subjectUserId:e});let a=[];return void 0!==r.filters&&void 0!==r.filters.filters&&(a=r.filters.filters),a}catch(e){return[]}}))};const c=(e,t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){var s;try{const s=yield e();if("complete"===s[".tag"])return{isError:!1,result:s};if("other"===s[".tag"])return{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"};let a=void 0;do{yield new Promise(e=>setTimeout(e,o.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS)),a=yield l(s.async_job_id,t,r)}while(a&&"in_progress"===a[".tag"]);return"complete"===a[".tag"]?{isError:!1,result:a}:{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"}}catch(e){return(null===(s=null==e?void 0:e.error)||void 0===s?void 0:s[".tag"])?{isError:!0,error:e.error,error_summary:e.summary}:{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"}}}));t.createRequestPreviewDataFn=(e,t)=>{const o=t.replace(/\/$/,"");return n=>s.__awaiter(void 0,void 0,void 0,(function*(){var s,l,d,c,u,_,m,p,f;const h=new r.UserApiV2Client,g=[];try{let t=yield h.ns("files").rpc("list_folder",{path:o},{subjectUserId:e});for(g.push(...t.entries);t.has_more;)t=yield h.ns("files").rpc("list_folder/continue",{cursor:t.cursor},{subjectUserId:e}),g.push(...t.entries)}catch(e){return{error_tag:"list_files"}}const S={},E=[];for(const e of g)"file"===e[".tag"]&&(S[e.id]=e,E.push((0,i.getEntryId)(e.id)));if(0===E.length)return{error_tag:"no_files"};let v;null===(s=n.onPreviewDatafetchListfolderDone)||void 0===s||s.call(n);try{v=yield h.ns("tidy_up").rpc("smart_preview",{request:{".tag":"smart_move_request",entry_ids:E}},{subjectUserId:e})}catch(e){const t=null===(l=null==e?void 0:e.error)||void 0===l?void 0:l[".tag"];if(!t)return{error_tag:"other"};switch(t){case"path":return{error_tag:"path_not_found"};case"multiple_containing_folders":case"no_files":case"no_containing_folder":case"no_destinations":case"cannot_move_entry":case"list_files":return{error_tag:t};default:return{error_tag:"other"}}}const y={};for(const e of null!==(d=v.destinations)&&void 0!==d?d:[])e.name&&(y[e.id]={id:(0,i.getDestinationId)(e.id),folderName:e.name,path:`${t}/${e.name}`});const T=[];for(const e of null!==(c=v.entries)&&void 0!==c?c:[])(null===(u=S[e.id])||void 0===u?void 0:u.name)&&e.destination_ids&&e.suggested_destination_id&&T.push({id:(0,i.getEntryId)(e.id),filename:S[e.id].name,allowedDestinationIds:e.destination_ids.map(i.getDestinationId),suggestedDestinationId:(0,i.getDestinationId)(e.suggested_destination_id),isMlSuggestion:null!==(_=e.is_ml_suggestion)&&void 0!==_?_:null,predictId:null!==(m=e.prediction_id)&&void 0!==m?m:null,score:null!==(p=e.score)&&void 0!==p?p:null,suggestionConfidence:a.TidyConversions.confidenceLevelFromApi(e.confidence_interval),path:null!==(f=S[e.id].path_lower)&&void 0!==f?f:null});return{entries:T,destinations:y}}))};t.applySmartPreview=function(e,t,a,o=setTimeout){return s.__awaiter(this,void 0,void 0,(function*(){const s={};for(const e of a)s[e.id]=e;const i=new r.UserApiV2Client,n=Object.keys(t).map(e=>t[e]).filter(e=>{var t;return(null==e?void 0:e.isSelected)&&!!(null==e?void 0:e.selectedDestinationId)&&!!(null===(t=s[null==e?void 0:e.id])||void 0===t?void 0:t.filename)}).map(e=>({from_path:e.id,to_path:`${e.selectedDestinationId}/${s[e.id].filename}`}));let l;try{l=yield i.ns("files").rpc("move_batch_v2",{entries:n,autorename:!0},{subjectUserId:e})}catch(e){return{errorTag:"move"}}let d=null;for(;"complete"!==l[".tag"]&&"complete"!==(null==d?void 0:d[".tag"]);){yield new Promise(e=>o(e,2e3));try{d=yield i.ns("files").rpc("move_batch/check_v2",{async_job_id:l.async_job_id},{subjectUserId:e})}catch(e){return{errorTag:"check"}}}return{successTag:"response"}}))},t.getNumAddedFilesAndFolders=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{return yield s.ns("tidy_up").rpc("get_num_added_files",{user_id:e,fq_path:t},{subjectUserId:e})}catch(e){return{num_added_files:-1,num_added_folders:-1}}}))},t.shouldShowSnackbar=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new r.UserApiV2Client;try{return(yield t.ns("tidy_up").rpc("feature_discovery/should_show_snackbar",void 0,{subjectUserId:e})).should_show}catch(e){return!1}}))},t.dismissSnackbar=function(e){(new r.UserApiV2Client).ns("tidy_up").rpc("feature_discovery/snackbar_dismissed",{reset_criteria:!1},{subjectUserId:e})},t.shouldShowMoveSnackbar=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{const r=yield s.ns("tidy_up").rpc("feature_discovery/should_show_move_snackbar",{fq_path:t,num_moved_files:a},{subjectUserId:e});return{should_show:r.should_show,snackbar_type:r.snackbar_type}}catch(e){return{should_show:!1,snackbar_type:void 0}}}))},t.shouldShowUploadSnackbar=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new r.UserApiV2Client;try{const r=yield s.ns("tidy_up").rpc("feature_discovery/should_show_upload_snackbar",{fq_path:t},{subjectUserId:e});return{should_show:r.should_show,snackbar_type:r.snackbar_type}}catch(e){return{should_show:!1,snackbar_type:void 0}}}))}})),define("metaserver/static/js/tidy_up/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FEATURE_GROWTH_SNACKBARS=t.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS=void 0,t.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS=1e3,(function(e){e.reengagement="reengagement",e.discovery="discovery"})(t.FEATURE_GROWTH_SNACKBARS||(t.FEATURE_GROWTH_SNACKBARS={}))})),define("metaserver/static/js/tidy_up/modal/options_view/tidy_radio_selection",["require","exports","tslib","react","dig-components/controls","dig-components/typography"],(function(e,t,s,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TidyUpSelection=void 0,r=s.__importDefault(r);t.TidyUpSelection=({isSelected:e,onSelect:t,value:s,label:i,subtext:n,children:l,name:d})=>r.default.createElement("div",{className:"tidy-up-view__radio-row",key:s},r.default.createElement(a.RadioButton,{id:s,value:s,checked:e,onChange:t,className:"tidy-up-view__radio-button",name:d}),r.default.createElement("span",{className:"tidy-up-view__radio-label-container"},r.default.createElement("span",{className:"tidy-up-view__radio-label"},r.default.createElement(o.Text,{tagName:"label",htmlFor:s},i)),r.default.createElement(o.Text,{size:"small",color:"faint"},n),e&&l)),t.TidyUpSelection.displayName="TidyUpSelection"})),define("metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfidenceLevel=t.getDestinationId=t.getEntryId=void 0,t.getEntryId=function(e){return e},t.getDestinationId=function(e){return e},(function(e){e[e.low=0]="low",e[e.medium=1]="medium",e[e.high=2]="high"})(t.ConfidenceLevel||(t.ConfidenceLevel={}))})),define("metaserver/static/js/tidy_up/modal/tidy_strings",["require","exports","react-intl"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TIDY_FEATURE_GROWTH_STRINGS=t.TIDY_OPTION_STRINGS=t.TIDY_INACTIVE_OPTION=t.TIDY_MODAL_SUBTITLE=t.TIDY_MODAL_HEADER=t.TIDY_UNDO=t.TIDY_CONFIRMATION=t.TIDY_FEEDBACK=t.TidyTimeFrameFolderNamingDayLabels=t.TidyTimeFrameFolderNamingYearLabels=t.TidyTimeFrameFolderNamingMonthLabels=t.TidyTimeFrameFolderStructureLabels=t.TidyTimeFrameFolderDateRuleLabels=t.TIDY_TIME_FRAME_FILTER=t.TIDY_CUSTOM_FILTERS=t.TIDY_FOLDER_SELECTION=t.TIDY_KEYPHRASE=t.TIDY_SMART_PREVIEW=t.TIDY_PREVIEW=t.TIDY_ERROR=t.TIDY_SUCCESS=t.TIDY_PENDING=t.TIDY_OPTIONS=t.TIDY_UP_MODAL_PREVIEW_LABEL=t.TIDY_UP_SNACKBAR_DISMISS_LABEL=t.TIDY_UP_MODAL_BACK_LABEL=t.TIDY_UP_MODAL_APPLY_LABEL=t.TIDY_UP_MODAL_CANCEL_LABEL=t.TIDY_UP_MODAL_CLOSE_LABEL=t.TIDY_UP_MODAL_HEADER_LABEL=void 0,t.TIDY_UP_MODAL_HEADER_LABEL=(0,s.defineMessage)({id:"OC4T38",defaultMessage:"Tidy up"}),t.TIDY_UP_MODAL_CLOSE_LABEL=(0,s.defineMessage)({id:"FEI6xF",defaultMessage:"Close"}),t.TIDY_UP_MODAL_CANCEL_LABEL=(0,s.defineMessage)({id:"StgmB7",defaultMessage:"Cancel"}),t.TIDY_UP_MODAL_APPLY_LABEL=(0,s.defineMessage)({id:"03FNiv",defaultMessage:"Apply"}),t.TIDY_UP_MODAL_BACK_LABEL=(0,s.defineMessage)({id:"ndSchX",defaultMessage:"Back"}),t.TIDY_UP_SNACKBAR_DISMISS_LABEL=(0,s.defineMessage)({id:"PLME/5",defaultMessage:"Dismiss"}),t.TIDY_UP_MODAL_PREVIEW_LABEL=(0,s.defineMessage)({id:"7aGUDe",defaultMessage:"Preview"}),t.TIDY_OPTIONS=(0,s.defineMessages)({HEADER_LABEL:{id:"/IXzI6",defaultMessage:"Choose a rule"},BODY_TEXT:{id:"R7e8cr",defaultMessage:"Organize this content into folders grouped by:"},NEXT_LABEL:{id:"Z2Ie27",defaultMessage:"Next"},PREVIEW_LABEL:{id:"7aGUDe",defaultMessage:"Preview"},KEYPHRASE_LABEL:{id:"rHnW1g",defaultMessage:"Choose keyword"},FEEDBACK_LABEL:{id:"Z7UZ30",defaultMessage:"Give feedback"}}),t.TIDY_PENDING=(0,s.defineMessages)({PENDING_TEXT_1:{id:"3Cumks",defaultMessage:"Creating folders..."},PENDING_TEXT_2:{id:"rOHuZh",defaultMessage:"This may take a moment."},PENDING_AUTOMATION_REMOVAL:{id:"mK/eth",defaultMessage:"Removing automation..."},PENDING_AUTOMATION_APPLY:{id:"yvx6Ny",defaultMessage:"Applying automation..."},STILL_WORKING_TEXT_1:{id:"xDVihY",defaultMessage:"Moving files..."},STILL_WORKING_TEXT_2:{id:"Fw7phK",defaultMessage:"You can safely go about your work while we finish."}}),t.TIDY_SUCCESS=(0,s.defineMessages)({SUCCESS_TEXT:{id:"iszJTE",defaultMessage:"Successfully organized {numFilesTidied, plural, one{# file} other{# files}}."},AUTOMATION_REMOVAL_SUCCESS_TEXT:{id:"4DeEN2",defaultMessage:"Successfully removed automation."},AUTOMATION_APPLY_SUCCESS_TEXT:{id:"NfBNbr",defaultMessage:"Successfully applied automation."}}),t.TIDY_ERROR=(0,s.defineMessages)({ERROR_TEXT:{id:"9ma/3b",defaultMessage:"We weren’t able to organize your folder. Try again."},MIXED_SUCCESS_AUTOMATION_SUCCESS:{id:"n50m8S",defaultMessage:"Couldn't apply the rule. Successfully made changes to the automation."},MIXED_SUCCESS_AUTOMATION_FAILURE:{id:"WHUu5h",defaultMessage:"Couldn't make changes to the automation. Successfully applied rule."},AUTOMATION_REMOVAL_FAILURE:{id:"Uh39z5",defaultMessage:"Couldn't remove the automation."},AUTOMATION_APPLICATION_FAILURE:{id:"YoRCK6",defaultMessage:"Couldn't apply the automation."},PARTIAL_SUCCESS_TEXT_1:{id:"6V5H17",defaultMessage:"Organized {numSucceeded, plural, one{# file} other{# files}}."},PARTIAL_SUCCESS_TEXT_2:{id:"YKjtS3",defaultMessage:"{numFailed, plural, one{# file} other{# files}} couldn’t be organized – give it another try."},ALL_CONTENT_ACTIVE_TEXT:{id:"/9yhnT",defaultMessage:"All of your content has been active recently."},ALL_CREATED_CURRENT_MONTH:{id:"yj7SqD",defaultMessage:"All of your content was added to Dropbox this month."},ALL_CREATED_CURRENT_YEAR:{id:"N73kL9",defaultMessage:"All of your content was added to Dropbox this year."},NO_MATCHING_KEYWORD:{id:"P/rv1f",defaultMessage:"We couldn’t find any files containing this keyword."},EMPTY_KEYPHRASE_PREVIEW_BACK:{id:"UzL6C5",defaultMessage:"Try another keyword"},EMPTY_PREVIEW_BACK:{id:"FDsh/B",defaultMessage:"Try another rule"},EMPTY_CUSTOM_FITLER_PREVIEW_BACK:{id:"Yy0gyY",defaultMessage:"Modify filter rules"},NO_MATCHING_FILES_GENERIC:{id:"4zKt1i",defaultMessage:"We couldn’t find any files to organize in this folder."},SNACKBAR_TEXT:{id:"cGFOIN",defaultMessage:"We couldn’t find any files to organize in this folder. Try choosing a different rule."}}),t.TIDY_PREVIEW=(0,s.defineMessages)({MODAL_TITLE_LABEL:{id:"2/YiSD",defaultMessage:"Preview this rule"},MODAL_TITLE_ERROR_LABEL:{id:"mAFYum",defaultMessage:"Couldn’t apply this rule"},DESCRIPTION_TEXT:{id:"dpAMYR",defaultMessage:"You’re about to make the following changes. Uncheck any items you want to exclude from this operation."},AUTOMATION_TOGGLE_LABEL:{id:"eY1+iP",defaultMessage:"Apply rule to every file added to this folder"},AUTOMATION_ON_LABEL:{id:"AXasyS",defaultMessage:"On"},AUTOMATION_OFF_LABEL:{id:"urtNrM",defaultMessage:"Off"}}),t.TIDY_SMART_PREVIEW=(0,s.defineMessages)({MODAL_TITLE_LABEL:{id:"NqyXrB",defaultMessage:"Smart move"},PREVIEW_PENDING_TEXT_1:{id:"kUAGn3",defaultMessage:"Analyzing folder for Smart Move..."},PREVIEW_PENDING_TEXT_2:{id:"ywWex0",defaultMessage:"This may take a moment."},APPLY_PENDING_TEXT:{id:"hSVEfh",defaultMessage:"Identifying folders..."},CONTENT_TITLE:{id:"+AvtU7",defaultMessage:"Content"},MOVE_TO_TITLE:{id:"LAd/7v",defaultMessage:"Move to:"},ADD_FEEDBACK:{id:"V0ezVH",defaultMessage:"Add feedback"},SHARE_FEEDBACK_PLACEHOLDER:{id:"y0XkHO",defaultMessage:"Share feedback with the team"},ERROR_PATH_NOT_FOUND:{id:"6JUT/e",defaultMessage:"Could not locate a file for organizing"},ERROR_MULTIPLE_CONTAINING_FOLDERS:{id:"gKBmyF",defaultMessage:"Cannot organize more than one folder at a time"},ERROR_NO_CONTAINING_FOLDER:{id:"AGMIp0",defaultMessage:"Cannot organize files without a containing folder"},ERROR_NO_DESTINATIONS_1:{id:"+7w7cI",defaultMessage:"Smart move needs at least one subfolder to suggest moving files into."},ERROR_NO_DESTINATIONS_2:{id:"yXlKn4",defaultMessage:"Create a subfolder or try another multi-file organize rule."},ERROR_CANNOT_MOVE_ENTRY:{id:"bNlw4b",defaultMessage:"Some files are read-only and cannot be moved"},ERROR_LIST_FILES:{id:"cLoDbN",defaultMessage:"There was a problem identifying files to organize"},ERROR_OTHER:{id:"CWZOOV",defaultMessage:"We weren’t able to organize your folder. Try again."},WARNING_TEXT:{id:"kDUNC8",defaultMessage:"This feature is for internal testing only. Be aware that moving files to a different folder may result in different access permissions."},HIGH_CONFIDENCE_SECTION_HEADER:{id:"MEt1EZ",defaultMessage:"Our suggested matches:"},POSSIBLE_MATCHES_SECTION_HEADER:{id:"ZUHtxO",defaultMessage:"Some possible matches:"},LOW_CONFIDENCE_ONLY_SECTION_HEADER:{id:"hl1h7f",defaultMessage:"Choose where you think these files should live:"},BODY_DESCRIPTION:{id:"X7XEUt",defaultMessage:"Here are the suggested locations for your files. Select the ones you want to move."},BODY_DESCRIPTION_NO_SUGGESTIONS:{id:"TJG7hj",defaultMessage:"We couldn’t come up with any suggested matches, but you can choose the correct destination from the dropdowns."},CONTENT_COLUMN_HEADER:{id:"fZA951",defaultMessage:"Current content"},DESTINATIONS_COLUMN_HEADER:{id:"JGXTov",defaultMessage:"Move to"},DESTINATION_PLACEHOLDER:{id:"t0ARxk",defaultMessage:"Choose folder"},ERROR_BANNER:{id:"Ttmxyl",defaultMessage:"Selected files must have a folder destination."},PRIMARY_BUTTON_LABEL:{id:"TW19Cd",defaultMessage:"Move"}}),t.TIDY_KEYPHRASE=(0,s.defineMessages)({HEADER_LABEL:{id:"YBZvnw",defaultMessage:"Group by keyword"},PREVIEW_LABEL:{id:"7aGUDe",defaultMessage:"Preview"},INPUT_LABEL:{id:"p4yoHO",defaultMessage:"Keyword:"},INPUT_PLACEHOLDER:{id:"nW3umL",defaultMessage:"Type your keyword"},FOLDER_SELECTION_LABEL:{id:"6Zd09J",defaultMessage:"Destination:"}}),t.TIDY_FOLDER_SELECTION=(0,s.defineMessages)({DROPDOWN_PLACEHOLDER:{id:"IJxA/7",defaultMessage:"Choose a subfolder…"},NO_SUBFOLDERS:{id:"jOCQJ1",defaultMessage:"It seems like you don’t have any existing subfolders. Try this again once you have at least one subfolder to choose from."},FOLDER_SELECTION_BUTTON_LABEL:{id:"mz8m9a",defaultMessage:"Choose folder"},TITLE:{id:"ZXnd4e",defaultMessage:"Move items to…"},DEFAULT_FOLDER_SELECTION_BUTTON_LABEL:{id:"7SCfI3",defaultMessage:"Folder name"}}),t.TIDY_CUSTOM_FILTERS=(0,s.defineMessages)({HEADER_LABEL:{id:"zyqr9m",defaultMessage:"Custom filters"},BODY_LABEL:{id:"TaNu8P",defaultMessage:"Create filters and configure rules to organize content. Filters will be applied to matching content in the order listed."},KEYWORD_EMPTY_INPUT_ERROR_LABEL:{id:"tQYcdG",defaultMessage:"Please enter a keyword."},KEYWORD_INVALID_CHARACTERS_ERROR_LABEL:{id:"0TvUJE",defaultMessage:"Please use letters (a-z), numbers (0-9), and underscores (_)."},KEYWORD_TOO_LONG_ERROR_LABEL:{id:"rlauM0",defaultMessage:"Maximum length for a keyword is 15 characters."},KEYWORD_ALREADY_EXISTS_ERROR_LABEL:{id:"K2iRBi",defaultMessage:"This keyword has already been added to the rule."},SIZE_INVALID_CHARACTERS_ERROR_LABEL:{id:"vjH8Ek",defaultMessage:"Please use numbers (0-9) only."},SIZE_TOO_LARGE_ERROR_LABEL:{id:"EdF6PB",defaultMessage:"Maximum value for a file size filter is 100 GB."},SIZE_INVALID_RANGE_ERROR_LABEL:{id:"wxq54e",defaultMessage:"Minimum value cannot exceed maximum."},FILES_GREATER_THAN_LABEL:{id:"nFLqkw",defaultMessage:"Files greater than"},FILES_SMALLER_THAN_LABEL:{id:"XbA6pf",defaultMessage:"Files smaller than"},ADD_RULE_LABEL:{id:"yjoU9B",defaultMessage:"Add rule"},CREATE_FILTER_LABEL:{id:"XXL0GB",defaultMessage:"Create new filter"},FOLDER_SELECTION_LABEL:{id:"lWzfli",defaultMessage:"Move files to:"},DELETE_FILTER_LABEL:{id:"qA0lf+",defaultMessage:"Delete filter"}}),t.TIDY_TIME_FRAME_FILTER=(0,s.defineMessages)({header_label:{id:"fSFcZF",defaultMessage:"Organize by time"},body_label:{id:"hcBEFs",defaultMessage:"Group files into subfolders based on the following folder structure."},time_frame_rule_selection_label:{id:"nvWpEL",defaultMessage:"Group by"},time_frame_date_rule_selection_label:{id:"YtpkZb",defaultMessage:"Using"},time_frame_date_date_rule_prompt_label:{id:"YUWPut",defaultMessage:"Date created is not always available for each file."},folder_naming_selection_label:{id:"v1bOOP",defaultMessage:"Folder naming"},year_folders_selection_label:{id:"nrRYNb",defaultMessage:"Year folders"},month_folders_selection_label:{id:"VNIPPz",defaultMessage:"Month folders"},day_folders_selection_label:{id:"PrfGFA",defaultMessage:"Day folders"},preview_label:{id:"7aGUDe",defaultMessage:"Preview"}}),t.TidyTimeFrameFolderDateRuleLabels=(0,s.defineMessages)({date_created:{id:"/z5QOK",defaultMessage:"Date created"},date_uploaded:{id:"hISSJo",defaultMessage:"Date uploaded"}}),t.TidyTimeFrameFolderStructureLabels=(0,s.defineMessages)({month:{id:"rMb/VK",defaultMessage:"Month"},year:{id:"LcewkZ",defaultMessage:"Year"},day:{id:"sHbORR",defaultMessage:"Day"}}),t.TidyTimeFrameFolderNamingMonthLabels=(0,s.defineMessages)({mm:{id:"GdmYyK",defaultMessage:"MM"},mm_yyyy:{id:"MkGMnE",defaultMessage:"MM-YYYY"},yyyy_mm:{id:"NPIdJZ",defaultMessage:"YYYY-MM"},month:{id:"rMb/VK",defaultMessage:"Month"},month_yyyy:{id:"xo2MT1",defaultMessage:"Month YYYY"}}),t.TidyTimeFrameFolderNamingYearLabels=(0,s.defineMessages)({yyyy:{id:"IqGaq/",defaultMessage:"YYYY"},yy:{id:"02jpeP",defaultMessage:"YY"}}),t.TidyTimeFrameFolderNamingDayLabels=(0,s.defineMessages)({dd:{id:"8URMRS",defaultMessage:"DD"},dd_day:{id:"Kr9xjy",defaultMessage:"DD Monday"},day:{id:"8Xmwl1",defaultMessage:"Monday"}}),t.TIDY_FEEDBACK=(0,s.defineMessages)({HEADER_LABEL:{id:"wihZud",defaultMessage:"Let us know what you think"},INPUT_PLACEHOLDER:{id:"u7sQJP",defaultMessage:"Anything goes here!"},MODAL_TEXT:{id:"4IQhQm",defaultMessage:"What can we do to make organizing your files easier?"},SUBMIT_LABEL:{id:"C/HKsS",defaultMessage:"Submit"}}),t.TIDY_CONFIRMATION=(0,s.defineMessages)({UPDATE_AUTOMATION_HEADER_LABEL:{id:"WvZUJv",defaultMessage:"Replace your existing automation?"},REMOVE_AUTOMATION_HEADER_LABEL:{id:"Mx+XRk",defaultMessage:"Remove your existing automation?"},UPDATE_CONFIRMATION_BODY_LABEL:{id:"R8WlLm",defaultMessage:"Automating this rule will replace this folder’s existing automation on an ongoing basis. Click <strong>{keepExistingButtonLabel}</strong> to apply this new rule only this one time."},REMOVE_CONFIRMATION_BODY_LABEL:{id:"kaTvx4",defaultMessage:"Updating this rule will remove this folder’s existing automation going forward. Click <strong>{keepExistingButtonLabel}</strong> to apply this rule without removing automation."},APPLY_WITHOUT_OVERRIDE_LABEL:{id:"raqLbh",defaultMessage:"Keep existing automation"},APPLY_AND_OVERRIDE_LABEL:{id:"sp7ooC",defaultMessage:"Replace"},APPLY_AND_REMOVE_LABEL:{id:"grjvza",defaultMessage:"Remove"}}),t.TIDY_UNDO=(0,s.defineMessages)({UNDO_PENDING:{id:"9yS73d",defaultMessage:"Undoing..."},UNDO_SUCCESS:{id:"vsXQtc",defaultMessage:"Undo successful — removed file grouping."},UNDO_ERROR:{id:"jwcStr",defaultMessage:"Couldn’t remove file grouping."},UNDO_PARTIAL_ERROR_AUTOMATION_SUCCESS:{id:"wc6Thl",defaultMessage:"Undo successfully applied to the automation, but couldn’t undo the file grouping."},UNDO_PARTIAL_ERROR_AUTOMATION_FAILURE:{id:"PQoKpp",defaultMessage:"Undo successfully applied to file grouping, but couldn’t undo the automation."}}),t.TIDY_MODAL_HEADER=(0,s.defineMessage)({id:"rlhg66",defaultMessage:"Multi-file organize"}),t.TIDY_MODAL_SUBTITLE=(0,s.defineMessage)({id:"tZjTI1",defaultMessage:"Organize this content into folders grouped by:"}),t.TIDY_INACTIVE_OPTION=(0,s.defineMessages)({TITLE:{id:"VN2FV7",defaultMessage:"Organize inactive content"},SUBTITLE:{id:"mkBKo9",defaultMessage:"Group together content you haven't engaged with recently"},OPTION_LABEL:{id:"cN4D1q",defaultMessage:"Inactive for"},TIDY_UP_INACTIVE_THIRTY_DAYS:{id:"+7XcHy",defaultMessage:"30 days"},TIDY_UP_INACTIVE_NINETY_DAYS:{id:"XditG3",defaultMessage:"90 days"}}),t.TIDY_OPTION_STRINGS=(0,s.defineMessages)({CUSTOM_FILTER_TITLE:{id:"OhBogU",defaultMessage:"Custom filters"},CUSTOM_FILTER_SUBTITLE:{id:"ERkF8C",defaultMessage:"Group based on keywords and file types"},TIME_FRAME_TITLE:{id:"Rc8edF",defaultMessage:"Timeframe"},TIME_FRAME_SUBTITLE:{id:"BJUzKE",defaultMessage:"Group based on a specific timeframe"},INACTIVITY_TITLE:{id:"rxaX/E",defaultMessage:"Inactivity"},INACTIVITY_SUBTITLE:{id:"qd8Pdr",defaultMessage:"Group together content you haven’t engaged with recently"},SMART_MOVE_TITLE:{id:"xB+pkI",defaultMessage:"Smart move"},SMART_MOVE_SUBTITLE:{id:"ThRSey",defaultMessage:"Group files into existing subfolders based on our recommendations"},KEYPHRASE_FILTER_TITLE:{id:"rHq4Oa",defaultMessage:"Keyword"},KEYPHRASE_FILTER_SUBTITLE:{id:"WDRppN",defaultMessage:"Group by specific keywords"}}),t.TIDY_FEATURE_GROWTH_STRINGS=(0,s.defineMessages)({DISCOVERY_TITLE:{id:"4MKaZt",defaultMessage:"It looks like you’ve organized multiple files in this folder recently – organize them with our new folder organization tools."},REENGAGEMENT_TITLE:{id:"x+KNtZ",defaultMessage:"We updated multi-file organize with new custom filters."}})})),define("metaserver/static/js/tidy_up/modal/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DayRelatedFolderStructure=t.YearRelatedFolderStructure=t.MonthRelatedFolderStructure=t.TidyModalWidth=t.TidySpecificActionSurfaceLogValue=t.defaultTidyParameters=t.TidyTimeFrameDateRule=t.TidyTimeFrameFolderNamingDay=t.TidyTimeFrameFolderNamingYear=t.TidyTimeFrameFolderNamingMonth=t.TidyTimeFrameFolderStructure=t.TidyCustomFiltersType=t.TidyErrorType=t.initialTidyState=t.TidyStateType=t.DateFormatSelection=t.InactiveSelection=t.TidyUpType=t.toFileID=void 0;var s,r,a,o,i,n,l,d,c;t.toFileID=e=>e,(function(e){e.none="none",e.inactive="inactive",e.by_month="by_month",e.by_year="by_year",e.smart_move="smart_move",e.keyphrase="keyphrase",e.custom_filters="custom_filters",e.time_frame_filter="time_frame_filter"})(s=t.TidyUpType||(t.TidyUpType={})),(function(e){e.thirty_days="thirty_days",e.ninety_days="ninety_days"})(r=t.InactiveSelection||(t.InactiveSelection={})),(function(e){e[e.YYYY_MM=0]="YYYY_MM",e[e.YYYY_MM_Month=1]="YYYY_MM_Month",e[e.Month_YYYY=2]="Month_YYYY"})(t.DateFormatSelection||(t.DateFormatSelection={})),(function(e){e[e.Idle=0]="Idle",e[e.Preview=1]="Preview",e[e.SmartPreview=2]="SmartPreview",e[e.Keyphrase=3]="Keyphrase",e[e.KeyphrasePreview=4]="KeyphrasePreview",e[e.CustomFilters=5]="CustomFilters",e[e.CustomFilterPreview=6]="CustomFilterPreview",e[e.ConfirmOverrideAutomation=7]="ConfirmOverrideAutomation",e[e.ConfirmRemoveAutomation=8]="ConfirmRemoveAutomation",e[e.Feedback=9]="Feedback",e[e.TimeFrameFilter=10]="TimeFrameFilter",e[e.TimeFrameFilterPreview=11]="TimeFrameFilterPreview",e[e.InactivityFilter=12]="InactivityFilter",e[e.InactivityFilterPreview=13]="InactivityFilterPreview",e[e.CustomFilterFolderSelection=14]="CustomFilterFolderSelection"})(a=t.TidyStateType||(t.TidyStateType={})),t.initialTidyState={type:a.Idle},(function(e){e[e.Generic=0]="Generic",e[e.PartialSuccess=1]="PartialSuccess",e[e.NoMatchingFiles=2]="NoMatchingFiles"})(t.TidyErrorType||(t.TidyErrorType={})),(function(e){e.None="None",e.Keyword="Keyword",e.FileExtension="FileExtension",e.Size="Size"})(o=t.TidyCustomFiltersType||(t.TidyCustomFiltersType={})),(function(e){e.year="year",e.year_month="year_month",e.year_month_day="year_month_day",e.month="month",e.month_day="month_day",e.day="day"})(i=t.TidyTimeFrameFolderStructure||(t.TidyTimeFrameFolderStructure={})),(function(e){e.mm="mm",e.mm_yyyy="mm_yyyy",e.yyyy_mm="yyyy_mm",e.month="month",e.month_yyyy="month_yyyy"})(n=t.TidyTimeFrameFolderNamingMonth||(t.TidyTimeFrameFolderNamingMonth={})),(function(e){e.yyyy="yyyy",e.yy="yy"})(l=t.TidyTimeFrameFolderNamingYear||(t.TidyTimeFrameFolderNamingYear={})),(function(e){e.dd="dd",e.dd_day="dd_day",e.day="day"})(d=t.TidyTimeFrameFolderNamingDay||(t.TidyTimeFrameFolderNamingDay={})),(function(e){e.date_uploaded="date_uploaded",e.date_created="date_created"})(c=t.TidyTimeFrameDateRule||(t.TidyTimeFrameDateRule={})),t.defaultTidyParameters={type:s.none,activityParams:{inactiveSelection:r.thirty_days},byMonthParams:{excludeCurrentMonth:!1,dateFormatSelection:void 0},byYearParams:{excludeCurrentYear:!1},byKeyphraseParams:{keyphrase:void 0,keyphraseDestination:void 0},customFilterParams:{filters:[{id:Date.now(),rules:[{type:o.None}],actions:{destination:void 0}}]},byTimeFrameParams:{folderStructure:i.month,formatNaming:{monthFormat:n.yyyy_mm,yearFormat:l.yyyy,dayFormat:d.dd},date_rule:c.date_uploaded},previewData:void 0},(function(e){e.GROWTH_SNACKBAR_CTA="snackbar",e.MOVE_SNACKBAR_CTA="move_snackbar",e.DESKTOP_ENTRYPOINT="desktop",e.ORGANIZED_HOME_DESKTOP_ENTRYPOINT="desktop_organized_home",e.SNACKBAR_RETRY="from_retry",e.BROWSE_ACTIONS="browse_actions",e.ORGANIZE_WEB_ENTRYPOINT="web_organized_menu",e.IN_FOLDER_ACTIVATION="in_folder_activation",e.DISCOVERY_UPLOAD_SNACKBAR="discovery_upload_snackbar",e.REENGAGEMENT_UPLOAD_SNACKBAR="reengagement_upload_snackbar",e.DISCOVERY_MOVE_SNACKBAR="discovery_move_snackbar",e.REENGAGEMENT_MOVE_SNACKBAR="reengagement_move_snackbar"})(t.TidySpecificActionSurfaceLogValue||(t.TidySpecificActionSurfaceLogValue={})),(function(e){e.SMALL="small",e.STANDARD="standard",e.LARGE="large"})(t.TidyModalWidth||(t.TidyModalWidth={})),t.MonthRelatedFolderStructure=[i.month,i.year_month,i.month_day,i.year_month_day],t.YearRelatedFolderStructure=[i.year,i.year_month,i.year_month_day],t.DayRelatedFolderStructure=[i.day,i.month_day,i.year_month_day]})),define("metaserver/static/js/tidy_up/utils",["require","exports","tslib","metaserver/static/js/tidy_up/modal/types","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/ts_utils","metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types","metaserver/static/js/pap/util","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar","metaserver/static/js/tidy_up/constants"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logTidyUpReengagementSnackbar=t.logTidyUpDiscoverySnackbar=t.TidyConversions=t.AutomationConversions=void 0,a=s.__importStar(a),t.AutomationConversions={automationRuleSetToRuleType(e){var t,s;if(!e.rules||0===e.rules.length||!(null===(s=null===(t=e.rules[0])||void 0===t?void 0:t.action)||void 0===s?void 0:s.action))return;const r=e.rules[0].action.action;return"other"!==r[".tag"]?r[".tag"]:void 0}},t.TidyConversions={tidyTypeToApiV2(e){const{type:s,activityParams:a,byMonthParams:o,byYearParams:i,byKeyphraseParams:n,customFilterParams:l,byTimeFrameParams:d}=e;switch(s){case r.TidyUpType.inactive:return{inactive_for:t.TidyConversions.inactiveTimespanToApiV2(a.inactiveSelection),".tag":"inactive_request"};case r.TidyUpType.by_month:return{exclude_current:o.excludeCurrentMonth,date_format:t.TidyConversions.dateFormatSelectionToApiV2(o.dateFormatSelection),".tag":"by_month_request"};case r.TidyUpType.by_year:return{exclude_current:i.excludeCurrentYear,".tag":"by_year_request"};case r.TidyUpType.keyphrase:return{phrase:n.keyphrase||"",destination:n.keyphraseDestination||"",".tag":"keyphrase_request"};case r.TidyUpType.smart_move:return{".tag":"smart_move_request"};case r.TidyUpType.custom_filters:return{".tag":"filter_request",filters:l.filters.map(t.TidyConversions.customFilterDefinitionToApiV2)};case r.TidyUpType.time_frame_filter:return{".tag":"by_time_frame_request",folder_structure:t.TidyConversions.byTimeFrameFilterParamsToApiV2(d),date_rule:{".tag":d.date_rule}};default:return{".tag":"other"}}},byTimeFrameFilterParamsToApiV2:e=>"month"===e.folderStructure?{".tag":"month",format:{".tag":e.formatNaming.monthFormat}}:"year"===e.folderStructure?{".tag":"year",format:{".tag":e.formatNaming.yearFormat}}:"day"===e.folderStructure?{".tag":"day",format:{".tag":e.formatNaming.dayFormat}}:"year_month"===e.folderStructure?{".tag":"year_month",month_format:{".tag":e.formatNaming.monthFormat},year_format:{".tag":e.formatNaming.yearFormat}}:"month_day"===e.folderStructure?{".tag":"month_day",month_format:{".tag":e.formatNaming.monthFormat},day_format:{".tag":e.formatNaming.dayFormat}}:{".tag":"year_month_day",month_format:{".tag":e.formatNaming.monthFormat},year_format:{".tag":e.formatNaming.yearFormat},day_format:{".tag":e.formatNaming.dayFormat}},customFilterRulesToApiV2:e=>({rules:e.map(e=>{var t,s,r;return"Keyword"===e.type?{rule:{".tag":"keyword_filter",keywords:null===(t=e.keywordRule)||void 0===t?void 0:t.keywords}}:"Size"===e.type?{rule:{".tag":"size_filter",sizes:null===(s=e.sizeRule)||void 0===s?void 0:s.sizes}}:{rule:{".tag":"file_type_filter",file_types:null===(r=e.fileExtensionRule)||void 0===r?void 0:r.fileExtensions}}})}),customFilterDefinitionToApiV2:e=>({filter_rules:t.TidyConversions.customFilterRulesToApiV2(e.rules),actions:{actions:[{action:{".tag":"move",destination:e.actions.destination,is_absolute_path:e.actions.is_absolute_path}}]}}),customFilterRulesFromApiV2(e){var t;return(null!==(t=e.rules)&&void 0!==t?t:[]).map(e=>{var t,s,a;return"keyword_filter"===(null===(t=e.rule)||void 0===t?void 0:t[".tag"])&&void 0!==e.rule.keywords?{type:r.TidyCustomFiltersType.Keyword,keywordRule:{keywords:e.rule.keywords}}:"file_type_filter"===(null===(s=e.rule)||void 0===s?void 0:s[".tag"])&&void 0!==e.rule.file_types?{type:r.TidyCustomFiltersType.FileExtension,fileExtensionRule:{fileExtensions:e.rule.file_types}}:"size_filter"===(null===(a=e.rule)||void 0===a?void 0:a[".tag"])&&void 0!==e.rule.sizes?{type:r.TidyCustomFiltersType.Size,sizeRule:{sizes:e.rule.sizes}}:{type:r.TidyCustomFiltersType.None}})},customFilterDefinitionFromApiV2(e){var s,r,a,o;const i=null!==(s=e.filter_rules)&&void 0!==s?s:{};let n="",l=!1;return"move"===(null===(o=null===(a=null===(r=e.actions)||void 0===r?void 0:r.actions)||void 0===a?void 0:a[0].action)||void 0===o?void 0:o[".tag"])&&void 0!==e.actions.actions[0].action.destination&&(n=e.actions.actions[0].action.destination,l=!!e.actions.actions[0].action.is_absolute_path),{id:Date.now(),rules:t.TidyConversions.customFilterRulesFromApiV2(i),actions:{destination:n,is_absolute_path:l}}},sourceToDestinationPathFromApplyResult(e){var t;const s=[],r={};for(const t of e.entries)r[t.id]=t;for(const[a,o]of Object.entries(e.tidyPlan))if(o.isSelected&&null!==o.selectedDestinationId&&void 0!==o.selectedDestinationId&&(null===(t=e.destinations[o.selectedDestinationId])||void 0===t?void 0:t.path)&&r[a].filename){const t=r[a].path,i=`${e.destinations[o.selectedDestinationId].path}/${r[a].filename}`;t&&s.push({source_path:t,dest_path:i})}return s},tidyTypeFromApiV2(e){const s=r.defaultTidyParameters;switch(e[".tag"]){case"by_month_request":return s.type=r.TidyUpType.by_month,s.byMonthParams.excludeCurrentMonth=e.exclude_current,s.byMonthParams.dateFormatSelection=t.TidyConversions.dateFormatSelectionFromApiV2(e.date_format),s;case"by_year_request":return s.type=r.TidyUpType.by_year,s.byYearParams.excludeCurrentYear=e.exclude_current,s;case"inactive_request":return s.type=r.TidyUpType.inactive,s.activityParams.inactiveSelection=t.TidyConversions.inactiveTimespanFromApiV2(e.inactive_for),s;case"keyphrase_request":return s.type=r.TidyUpType.keyphrase,s.byKeyphraseParams.keyphrase=e.phrase,s.byKeyphraseParams.keyphraseDestination=e.destination,s;case"smart_move_request":return s.type=r.TidyUpType.smart_move,s;case"filter_request":return s.type=r.TidyUpType.custom_filters,s;case"by_time_frame_request":return s.type=r.TidyUpType.time_frame_filter,s;default:return s}},tidyTypeToFlowsAPI(e){const s=t.TidyConversions.tidyTypeToApiV2(e);return{rules:[{enabled:!0,action:{action:{".tag":"tidy_up",args_json:JSON.stringify(s)}}}]}},tidyTypetoLoggingType(e){const{type:t,activityParams:s,byMonthParams:a,byYearParams:i}=e;let n="",l="";switch(t){case r.TidyUpType.inactive:l="inactive",n=s.inactiveSelection===r.InactiveSelection.thirty_days?"30d":"90d";break;case r.TidyUpType.by_month:l="month",a.excludeCurrentMonth&&(n="excl_current");break;case r.TidyUpType.by_year:l="year",i.excludeCurrentYear&&(n="excl_current");break;case r.TidyUpType.keyphrase:l="keyword";break;case r.TidyUpType.smart_move:l="smart_move";break;case r.TidyUpType.custom_filters:l="custom_filters";break;case r.TidyUpType.time_frame_filter:l="time_frame_filter";break;case r.TidyUpType.none:l="none";break;default:throw(0,o.enforceExhaustive)(t)}return{tidyUpRule:l,tidyUpSubRule:n}},inactiveTimespanToApiV2(e){switch(e){case r.InactiveSelection.thirty_days:return{".tag":"thirty_days"};case r.InactiveSelection.ninety_days:return{".tag":"ninety_days"};default:return{".tag":"other"}}},inactiveTimespanFromApiV2(e){switch(e[".tag"]){case"thirty_days":return r.InactiveSelection.thirty_days;case"ninety_days":return r.InactiveSelection.ninety_days;default:return r.InactiveSelection.thirty_days}},dateFormatSelectionToApiV2(e){switch(e){case r.DateFormatSelection.YYYY_MM:return{".tag":"yyyy_mm"};case r.DateFormatSelection.YYYY_MM_Month:return{".tag":"yyyy_mm_month"};case r.DateFormatSelection.Month_YYYY:return{".tag":"month_yyyy"};default:return}},dateFormatSelectionFromApiV2(e){if(void 0===e)return r.DateFormatSelection.YYYY_MM;switch(e[".tag"]){case"yyyy_mm":return r.DateFormatSelection.YYYY_MM;case"yyyy_mm_month":return r.DateFormatSelection.YYYY_MM_Month;case"month_yyyy":return r.DateFormatSelection.Month_YYYY;default:return r.DateFormatSelection.YYYY_MM}},previewSelectionToApiV2(e,t){const s=[];for(const r of e){if(r.isRenamed){if((t.get(r.id)||r.files.some(e=>!!t.get(e.id)))&&r.sourcePath&&r.destPath){const e={source_path:r.sourcePath,dest_path:r.destPath,is_folder:!0};s.push(e)}}for(const e of r.files)if(t.get(e.id)){const t={source_path:e.fqPathSrc,dest_path:e.fqPathDest};s.push(t)}}return s},apiV2ToPreviewSelection(e,t){const s={},o=[],i=[];function n(e,t){let s=[];for(let r=0;r<e.length;r++)if(e[r]!==t[r]){s=t.slice(r);break}return s.length>=1?s:t.slice(e.length)}for(const t of e){if(t.is_folder){i.push(t);continue}const e=a.parent_dir(t.dest_path),n=(0,r.toFileID)(t.dest_path),l={displayName:a.filename(t.dest_path),id:n,fqPathDest:t.dest_path,fqPathSrc:t.source_path};o.push(n),e in s?s[e].push(l):s[e]=[l]}const l=[];for(const[e,o]of Object.entries(s)){const s=a.parent_dir(o[0].fqPathSrc),i=a.parent_dir(o[0].fqPathDest),d=a.inSubDirectory(s,i)?n(s.split("/"),i.split("/")):i.split("/").filter(e=>0!==e.length);0===d.length&&d.push(t);const c={isDir:!0,displayName:d,fqPath:e,files:o,id:(0,r.toFileID)(e)};l.push(c)}for(const e of i){let t=!1;for(const s of l)if(s.fqPath===e.dest_path){s.isRenamed=!0,s.previousName=a.filename(e.source_path),s.newName=a.filename(e.dest_path),s.sourcePath=e.source_path,s.destPath=e.dest_path,t=!0;break}if(!t){const t=(0,r.toFileID)(e.dest_path),s={isDir:!0,displayName:[""],fqPath:e.dest_path,files:[],isRenamed:!0,previousName:a.filename(e.source_path),newName:a.filename(e.dest_path),sourcePath:e.source_path,destPath:e.dest_path,id:t};o.push(t),l.push(s)}}return{folderHierarchy:l,fileIds:o}},compareTidyRules:(e,t)=>"inactive_request"===e[".tag"]&&"inactive_request"===t[".tag"]?e.inactive_for===t.inactive_for:"by_month_request"===e[".tag"]&&"by_month_request"===t[".tag"]?e.exclude_current===t.exclude_current&&e.date_format===t.date_format:"by_year_request"===e[".tag"]&&"by_year_request"===t[".tag"]?e.exclude_current===t.exclude_current:"keyphrase_request"===e[".tag"]&&"keyphrase_request"===t[".tag"]&&(e.phrase===t.phrase&&e.destination===t.destination),doesCurrentSelectionMatchAutomation(e,s){if(!e)return!1;const r=t.TidyConversions.tidyTypeToApiV2(s);return"by_month_request"===r[".tag"]&&"by_month_request"===e[".tag"]||("filter_request"===r[".tag"]&&"filter_request"===e[".tag"]||("by_time_frame_request"===r[".tag"]&&"by_time_frame_request"===e[".tag"]||("keyphrase_request"===r[".tag"]&&"keyphrase_request"===e[".tag"]||t.TidyConversions.compareTidyRules(e,r))))},shouldSilentlyReplaceAutomation(e,s){if(!e)return!1;const r=t.TidyConversions.tidyTypeToApiV2(s);return!t.TidyConversions.compareTidyRules(e,r)&&("by_month_request"===r[".tag"]&&"by_month_request"===e[".tag"])},confidenceLevelFromApi(e){switch(null==e?void 0:e[".tag"]){case"high":return i.ConfidenceLevel.high;case"mid":return i.ConfidenceLevel.medium;default:return i.ConfidenceLevel.low}},confidenceLevelToApi(e){switch(e){case i.ConfidenceLevel.high:return{".tag":"high"};case i.ConfidenceLevel.medium:return{".tag":"mid"};case i.ConfidenceLevel.low:return{".tag":"low"};default:throw(0,o.enforceExhaustive)(e)}},tidyTypeToPapType(e,t){const{type:s,activityParams:a,byMonthParams:i,byYearParams:l}=e;let d=void 0,c="";switch(s){case r.TidyUpType.inactive:d=(0,n.getEnumValueForString)("INACTIVE_TIDYUP_RULE",t),c=a.inactiveSelection===r.InactiveSelection.thirty_days?"30d":"90d";break;case r.TidyUpType.by_month:d=(0,n.getEnumValueForString)("MONTH_TIDYUP_RULE",t),i.excludeCurrentMonth&&(c="excl_current");break;case r.TidyUpType.by_year:d=(0,n.getEnumValueForString)("YEAR_TIDYUP_RULE",t),l.excludeCurrentYear&&(c="excl_current");break;case r.TidyUpType.keyphrase:d=(0,n.getEnumValueForString)("KEYWORD_TIDYUP_RULE",t);break;case r.TidyUpType.smart_move:d=(0,n.getEnumValueForString)("SMART_MOVE_TIDYUP_RULE",t);break;case r.TidyUpType.custom_filters:d=(0,n.getEnumValueForString)("CUSTOM_FILTER_TIDYUP_RULE",t);break;case r.TidyUpType.time_frame_filter:d=(0,n.getEnumValueForString)("TIME_FRAME_FILTER_TIDYUP_RULE",t);break;case r.TidyUpType.none:break;default:throw(0,o.enforceExhaustive)(s)}return{tidyUpRule:d,tidyUpSubrule:c}},tidyInactiveRangeToPapType(e,t){let s=void 0;switch(e){case r.InactiveSelection.thirty_days:s=(0,n.getEnumValueForString)("THIRTY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE",t);break;case r.InactiveSelection.ninety_days:s=(0,n.getEnumValueForString)("NINETY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE",t);break;default:throw(0,o.enforceExhaustive)(e)}return s},tidyDateFormatToPapType(e,t){if(void 0===e)return(0,n.getEnumValueForString)("UNKNOWN_TIDYUP_DATE_FORMAT_SUBRULE",t);switch(e){case r.DateFormatSelection.YYYY_MM:return(0,n.getEnumValueForString)("YYYY_MM_TIDYUP_DATE_FORMAT_SUBRULE",t);case r.DateFormatSelection.YYYY_MM_Month:return(0,n.getEnumValueForString)("YYYY_MM_MONTH_TIDYUP_DATE_FORMAT_SUBRULE",t);case r.DateFormatSelection.Month_YYYY:return(0,n.getEnumValueForString)("MONTH_YYYY_TIDYUP_DATE_FORMAT_SUBRULE",t);default:throw(0,o.enforceExhaustive)(e)}},tidyAutomationToPapType:(e,t,s)=>t?(0,n.getEnumValueForString)("APPLY_TIDYUP_AUTOMATION_ACTION",s):e?(0,n.getEnumValueForString)("REMOVE_TIDYUP_AUTOMATION_ACTION",s):(0,n.getEnumValueForString)("NONE_TIDYUP_AUTOMATION_ACTION",s),tidySourceToPapType:(e,t)=>e===r.TidySpecificActionSurfaceLogValue.DESKTOP_ENTRYPOINT?(0,n.getEnumValueForString)("DESKTOP_MENU_TIDYUP_SOURCE",t):e===r.TidySpecificActionSurfaceLogValue.GROWTH_SNACKBAR_CTA||e==r.TidySpecificActionSurfaceLogValue.DISCOVERY_UPLOAD_SNACKBAR||e==r.TidySpecificActionSurfaceLogValue.REENGAGEMENT_UPLOAD_SNACKBAR?(0,n.getEnumValueForString)("UPLOAD_SNACKBAR_TIDYUP_SOURCE",t):e===r.TidySpecificActionSurfaceLogValue.MOVE_SNACKBAR_CTA||e==r.TidySpecificActionSurfaceLogValue.DISCOVERY_MOVE_SNACKBAR||e==r.TidySpecificActionSurfaceLogValue.REENGAGEMENT_MOVE_SNACKBAR?(0,n.getEnumValueForString)("MOVE_SNACKBAR_TIDYUP_SOURCE",t):e===r.TidySpecificActionSurfaceLogValue.SNACKBAR_RETRY?(0,n.getEnumValueForString)("RETRY_TIDYUP_SOURCE",t):e===r.TidySpecificActionSurfaceLogValue.ORGANIZED_HOME_DESKTOP_ENTRYPOINT?(0,n.getEnumValueForString)("DESKTOP_ORGANIZED_HOME_TIDYUP_SOURCE",t):(0,n.getEnumValueForString)("WEB_BROWSE_TIDYUP_SOURCE",t)};t.logTidyUpDiscoverySnackbar=(e,t,s)=>{d.WebUserActionLog.log(e,l.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:t,origin:_.FEATURE_GROWTH_SNACKBARS.discovery,trigger:s,feature:"tidy_up"}),(0,c.logEvent)(u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:l.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureDiscoveryTrigger:u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureDiscoveryTrigger.BULK_MOVE_TIDYUP_FEATURE_DISCOVERY_TRIGGER}))};t.logTidyUpReengagementSnackbar=(e,t,s)=>{d.WebUserActionLog.log(e,l.WebUserActionLogEvent.FEATURE_REENGAGEMENT_SNACKBAR_SHOW,{ns_id:t,origin:_.FEATURE_GROWTH_SNACKBARS.reengagement,trigger:s,feature:"tidy_up"}),(0,c.logEvent)(u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:l.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureReengagementTrigger:u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureReengagementTrigger.BULK_MOVE_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER}))}})),define("metaserver/static/js/tidy_up/feature_growth",["require","exports","tslib","metaserver/static/js/tidy_up/api_v2","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/core/i18n","react","metaserver/static/js/tidy_up/modal/types","metaserver/static/js/tidy_up/modal/tidy_strings","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/constants","metaserver/static/js/clean/viewer"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showTidyUpMoveSnackbar=t.openTidyUpModal=void 0,o=s.__importStar(o),l=s.__importStar(l),c=s.__importDefault(c);t.openTidyUpModal=(t,r,d,c)=>{n.Snackbar.close("tidyup-feature-growth");const u=(0,i.getStoreForBrowse)(),_=u.getState();o.path(_)!==t&&u.dispatch(l.setUrl({path:t}));const m=o.browsePostTTIExperiments(_);new Promise((t,s)=>{e(["metaserver/static/js/tidy_up/modal/tidy_up_modal"],t,s)}).then(s.__importStar).then(({showTidyUpModal:e})=>{const s=o.user(_);e({currentUserId:r,targetPath:t,namespaceId:d,actionSurface:c,features:m,subfolders:o.unsortedFiles(_).filter(e=>e.is_dir).toArray(),isInsideFlowsEligibleFolder:(0,a.isInsideFlowsEligibleFolder)(_),isPaidUser:!!s.paid||!!s.is_team,rootFolderDisplayName:f.Viewer.get_root_name(s)})})};const h=d.intl.formatMessage({id:"Kk24DX",defaultMessage:"Open multi-file organize"}),g=d.intl.formatMessage({id:"UArEyu",defaultMessage:"Close"});t.showTidyUpMoveSnackbar=(e,s,a,o)=>{if(void 0===e)return;let i;o&&o[".tag"]!==p.FEATURE_GROWTH_SNACKBARS.discovery?o[".tag"]===p.FEATURE_GROWTH_SNACKBARS.reengagement&&(i=d.intl.formatMessage(_.TIDY_FEATURE_GROWTH_STRINGS.REENGAGEMENT_TITLE),(0,m.logTidyUpReengagementSnackbar)(s,a,"bulk_move")):(i=d.intl.formatMessage(_.TIDY_FEATURE_GROWTH_STRINGS.DISCOVERY_TITLE),(0,m.logTidyUpDiscoverySnackbar)(s,a,"bulk_move"));const l=void 0!==o&&o[".tag"]===p.FEATURE_GROWTH_SNACKBARS.reengagement?u.TidySpecificActionSurfaceLogValue.REENGAGEMENT_MOVE_SNACKBAR:u.TidySpecificActionSurfaceLogValue.DISCOVERY_UPLOAD_SNACKBAR;n.Snackbar.show(c.default.createElement(n.Snackbar,{actionButtonText:h,onActionClick:()=>(0,t.openTidyUpModal)(e,s,a,l),closeButtonText:g,onCloseClick:()=>(0,r.dismissSnackbar)(s),timeoutDelayMs:1e4,title:i,variant:"generic",id:"tidyup-feature-growth"}))}})),define("typescript/dropbox/proto/hql_events/browse/web_browse_pb",["require","exports","@bufbuild/protobuf","../extensions_pb"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebBrowseSelectRow=void 0;class a extends s.Message{constructor(e){super(),this.actionSource="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(a,e,t)}}t.WebBrowseSelectRow=a,a.runtime=s.proto3,a.typeName="hql_events.WebBrowseSelectRow",a.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"action_source",kind:"scalar",T:9},{no:2,name:"hql_metadata",kind:"message",T:r.HQLMetadata}])})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(r=s.__importStar(r)).Reader,r.Writer,r.util;const a=r.roots.default||(r.roots.default={});var o,i;t.default=a,t.pap_events=a.pap_events=((o=a.pap_events||{}).tidyup=((i=o.tidyup||{}).Shown_TidyupGrowthSnackbar=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.tidyupFeatureDiscoveryTrigger=0,e.prototype.tidyupFeatureReengagementTrigger=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Shown_TidyupGrowthSnackbar"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupFeatureDiscoveryTrigger=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=0,t[e[1]="BULK_UPLOAD_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=1,t[e[2]="BULK_MOVE_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=2,t})(),e.TidyupFeatureReengagementTrigger=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=0,t[e[1]="BULK_MOVE_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=1,t[e[2]="BULK_UPLOAD_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=2,t})(),e})(i.Shown_TidyupGrowthSnackbar||{}),i),o)})),define("metaserver/static/js/clean/ui/fileops_actions",["require","exports","tslib","react","dig-components/typography","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/clean/em_string","metaserver/static/js/file_operations/notifications","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/api","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/store","metaserver/static/js/browse/models","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/file_actions/rollback","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/sharing/browse_exports","metaserver/static/js/clean/undo","metaserver/static/js/clean/viewer","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/core/browser","metaserver/static/js/browse/data/selectors","metaserver/static/js/tidy_up/api_v2","metaserver/static/js/tidy_up/feature_growth"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E,v,y,T,I,F,A,M,w,b,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMovePartialSuccessSnackbarText=t.getMoveSuccessSnackbarText=t.showBatchCompletedSnackbar=t.nestedNamespaceSnackbars=t.getBatchUndoHandler=t.moveFiles=t.moveFiles_LEGACY=t.copyFiles_v2=t.copyFiles=void 0,r=s.__importDefault(r),l=s.__importStar(l),d=s.__importStar(d),c=s.__importStar(c),_=s.__importStar(_),m=s.__importStar(m),h=s.__importStar(h),w=s.__importStar(w);const O="view_only_access_error",C="off_team_owner_error",N="owner_only_manage_membership_error",L="team_space_owner_only_manage_membership_error",P="team_space_only_on_team_sharing_error",D="ns_have_mounted_children_ns_error",k="action_nested_shared_folder_ownership_surrender",U="action_move_implicit_share";t.copyFiles=e=>e.useApiV2?Y(e):x(e);const x=e=>{const{files:s,newPath:r,checkFSWs:a,onSuccess:o,onRequestNotSent:i,onUndo:n,user:d,dataApi:u=_}=e;!u.copyFiles({files:s,newPath:r,checkFSWs:a,userId:d.id,onSuccess:({newFiles:a,changesets:i,failureDetails:u})=>{if(u){const s=()=>{(0,t.copyFiles)(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:u,onFinalAccept:s,confirmText:F.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"})})}else o&&o(a),l.notifyCopySuccess(s.length,d,i,r,()=>{n&&n()})}})&&i&&i()},j=(e,t)=>s=>r.default.createElement(a.Link,{hasNoUnderline:!0,inverse:!0,href:(0,i.browse_uri_for_fq_path)(e,t).toString()},r.default.createElement("strong",null,s));const B=({entries:e,loggingInfo:t,jobId:s,uid:r})=>{e.forEach(a=>{switch(a[".tag"]){case"failure":(0,u.logFileAction)({uid:r,action:t.failItemLogAction,num_files_selected:e.length,num_folders_selected:0,error_summary:a.failure[".tag"],error:a.failure[".tag"],jobId:s,extra:t.extra});break;case"other":(0,u.logFileAction)({uid:r,action:t.failItemLogAction,num_files_selected:e.length,num_folders_selected:0,error_summary:"other",error:"other",jobId:s,extra:t.extra});break;case"success":(0,u.logFileAction)({uid:r,action:t.successItemLogAction,num_files_selected:e.length,num_folders_selected:0,jobId:s,extra:t.extra})}})};function Y(e){return s.__awaiter(this,void 0,void 0,(function*(){const{files:s,newPath:r,onError:a,onUndo:o,onSuccess:i,user:n,isLockedVaultFolder:l,isPasteAction:c}=e;if(l)return void E.Snackbar.fail(V,"browse-action");const _=d.filename(r),m=j(n,r),p=c?{sync:e=>F.intl.formatMessage({id:"xegVmx",defaultMessage:"{count, plural, one{Pasting {count} item...} other{Pasting {count} items...}}"},{count:e}),undo:F.intl.formatMessage({id:"xkxhEq",defaultMessage:"Undoing paste..."}),undoFail:F.intl.formatMessage({id:"biijKe",defaultMessage:"Couldn’t undo paste."}),undoComplete:F.intl.formatMessage({id:"gevTNB",defaultMessage:"Paste undone."}),failure:e=>F.intl.formatMessage({id:"fJ21+e",defaultMessage:"{count, plural, one{Couldn’t paste {count} item.} other{Couldn’t paste {count} items.}}"},{count:e}),partialSuccess:(e,t)=>F.intl.formatMessage({id:"o9R5u2",defaultMessage:"{count, plural, one{Pasted {succesfully_copied_files} out of {count} item.} other{Pasted {succesfully_copied_files} out of {count} items.}}"},{count:t,succesfully_copied_files:e}),success:e=>F.intl.formatMessage({id:"TIeF91",defaultMessage:"{count, plural, one{Pasted {count} item.} other{Pasted {count} items.}}"},{count:e})}:(function(e,t){return{sync:e=>F.intl.formatMessage({id:"Xq8RFm",defaultMessage:"{count, plural, one{Copying {count} item...} other{Copying {count} items...}}"},{count:e}),undo:F.intl.formatMessage({id:"X8FnSw",defaultMessage:"Undoing copy..."}),undoFail:F.intl.formatMessage({id:"oYs0zq",defaultMessage:"Couldn’t undo copy."}),undoComplete:F.intl.formatMessage({id:"zgCNlD",defaultMessage:"Copy undone."}),failure:s=>F.intl.formatMessage({id:"0OnruC",defaultMessage:"{count, plural, one{Couldn’t copy {count} item to <link>{folderName}</link>.} other{Couldn’t copy {count} items to <link>{folderName}</link>.}}"},{count:s,folderName:e,link:t}),partialSuccess:(s,r)=>F.intl.formatMessage({id:"QA6Uk4",defaultMessage:"{count, plural, one{Copied {succesfully_copied_files} out of {count} item to <link>{folderName}</link>.} other{Copied {succesfully_copied_files} out of {count} items to <link>{folderName}</link>.}}"},{count:r,succesfully_copied_files:s,folderName:e,link:t}),success:s=>F.intl.formatMessage({id:"c5FpTz",defaultMessage:"{count, plural, one{Copied {count} item to <link>{folderName}</link>.} other{Copied {count} items to <link>{folderName}</link>.}}"},{count:s,folderName:e,link:t})}})(_,m);E.Snackbar.sync(p.sync(s.length),!0,"browse-action"),s.forEach(e=>{(0,u.logFileAction)({uid:n.id,action:I.WebUserActionLogEvent.COPY_ITEM_ATTEMPT,num_files_selected:s.length,num_folders_selected:0})});const f=yield h.copyFiles(s,r,n.id,{checkFSWs:!1}),g={attemptItemLogAction:I.WebUserActionLogEvent.COPY_ITEM_ATTEMPT,failItemLogAction:I.WebUserActionLogEvent.COPY_ITEM_FAIL,successItemLogAction:I.WebUserActionLogEvent.COPY_ITEM_SUCCESS,successLogAction:I.WebUserActionLogEvent.COPY_REQUEST_SUCCESS,failedLogAction:I.WebUserActionLogEvent.COPY_REQUEST_FAIL,undoingLogAction:I.WebUserActionLogEvent.COPY_UNDO,undoFailedLogAction:I.WebUserActionLogEvent.COPY_UNDO_REQUEST_FAIL,undoSuccessLogAction:I.WebUserActionLogEvent.COPY_UNDO_REQUEST_SUCCESS,undoingSnackbarText:p.undo,undoFailedSnackbarText:p.undoFail,undoSuccessSnackbarText:p.undoComplete,getFailureSnackbarText:p.failure,getPartialSuccessSnackbarText:p.partialSuccess,getSuccessSnackbarText:p.success};if(f.isError){E.Snackbar.close("browse-action"),a&&a();const e=()=>{E.Snackbar.fail(g.getFailureSnackbarText(s.length),"browse-action")};return H(n,f.error[".tag"],s,r,e),void(0,u.logFileAction)({uid:n.id,action:g.failedLogAction,num_files_selected:s.length,num_folders_selected:0,error_summary:f.error_summary,error:f.error[".tag"],jobId:f&&f.jobId,extra:g.extra})}const S=f.result.entries.filter(e=>"success"===e[".tag"]),v=S.length,y=s.length-v;B({entries:f.result.entries,loggingInfo:g,jobId:f.jobId,uid:n.id});const T=K(f,n,g,o);if((0,t.showBatchCompletedSnackbar)(s.length,v,y,g,T,{isNestedNamespaceError:f.result.entries.some(G)}),i){i([],W(S,s),v)}X(g.successLogAction,f.result,n.id,f.jobId,s.length,g.extra)}))}t.copyFiles_v2=Y;t.moveFiles_LEGACY=e=>{const{path:s,files:r,newPath:a,checkFSWs:o,onSuccess:i,onRequestNotSent:n,onUndo:d,user:u,dataApi:m=_}=e,p=({newFiles:s,changesets:o,failureDetails:n})=>{if(n){const s=()=>{(0,t.moveFiles_LEGACY)(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:n,onFinalAccept:s,confirmText:F.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}else l.notifyMoveSuccess(r.length,u,o,a,()=>{d&&d()}),i&&i(s)};!m.moveFiles({path:s,files:r,newPath:a,checkFSWs:o,userId:u.id,onSuccess:p,onError:e=>{"This will result in losing ownership of these folders."===e?(A.Notify.clear(),c.showConfirmOwnershipTransferModal(()=>{m.moveFiles({path:s,files:r,newPath:a,userId:u.id,onSuccess:p,allowOwnershipTransfer:!0})})):H(u,e,r,a)},allowOwnershipTransfer:!1})&&n&&n()};const V=F.intl.formatMessage({id:"zYM4td",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),q=F.intl.formatMessage({id:"p2aC9a",defaultMessage:"Those files already exist in that folder."});const W=(e,t)=>{const s=[];return e.forEach(e=>{if("file"===e.success[".tag"]||"folder"===e.success[".tag"]){const r=e.success,a=t.find(e=>"file_id"in e?e.file_id===r.id:"id"in e&&e.id===r.id);if(a){const e=(0,g.fileFromMetadata)(a,r);s.push(e)}}}),s};function H(e,t,s,a,i){const l=T.Viewer.get_viewer().team_name;let u=!1;"is_cdm_member"in e&&e.is_cdm_member&&d.inSubDirectory(e.cdm_tmf_path,a)&&(u=!0);const _=(function(e,t,s,a,i){const l=F.intl.formatMessage({id:"gVzSq7",defaultMessage:"You don’t have permission to move some of these items. Try moving items individually."});let d=null;const c=(e=>0===e.length?"":h.getFilenameFromActionInfo(e[0]))(a);t===C?d=1===a.length?null==s?F.intl.formatMessage({id:"eqzXgU",defaultMessage:"The owner of <strong>{file_name}</strong> is a member of another team."},{file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):F.intl.formatMessage({id:"F7A+9f",defaultMessage:"The owner of <strong>{file_name}</strong> isn’t a member of {team_name}."},{team_name:s,file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):null==s?F.intl.formatMessage({id:"1mkOQ2",defaultMessage:"The owner of some of these shared folders is a member of another team."}):F.intl.formatMessage({id:"kXptr+",defaultMessage:"The owner of some of these shared folders isn’t a member of {team_name}."},{team_name:s}):t===N?d=1===a.length?"is_cdm_member"in e&&e.is_cdm_member&&!i?F.intl.formatMessage({id:"rLKsQF",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to the {team_name} team space."},{team_name:s,file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):F.intl.formatMessage({id:"Xkb8gG",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to a team folder."},{file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):"is_cdm_member"in e&&e.is_cdm_member&&!i?F.intl.formatMessage({id:"Ic3QpQ",defaultMessage:"Only the owner can move some of these folders to the {team_name} team space."},{team_name:s}):F.intl.formatMessage({id:"AGXz3U",defaultMessage:"Only the owner can move some of these folders to a team folder."}):t===O?d=1===a.length?F.intl.formatMessage({id:"4nfaRz",defaultMessage:"You can only view <strong>{file_name}</strong>. Ask an owner or editor of the folder for access to edit it."},{file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):F.intl.formatMessage({id:"vSscn6",defaultMessage:"You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them."}):t===L||t===P?d=1===a.length?F.intl.formatMessage({id:"xYXgy4",defaultMessage:"If you need to move <strong>{file_name}</strong>, ask your admin to move it for you."},{file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):l:t===D&&(d=1===a.length?F.intl.formatMessage({id:"sFivS0",defaultMessage:"<strong>{file_name}</strong> has other shared folders inside it. Try moving each shared folder individually."},{file_name:n.Emstring.em_snippet(c,o.SNIPPET_SIZES.FILENAME),strong:e=>r.default.createElement("strong",{style:{fontWeight:500}},e)}):l);return d})(e,t,l,s,u);if(null==_)return void(i&&i());A.Notify.clear();const g=t===L||t===P||t===D,S=(function(e,t,s,r,a){if(t)return 1===r?F.intl.formatMessage({id:"MHxxzk",defaultMessage:"Can’t move out of the team space"}):F.intl.formatMessage({id:"XJI7dZ",defaultMessage:"Can’t move {num_of_files} items"},{num_of_files:r});return"is_cdm_member"in e&&e.is_cdm_member&&!a?F.intl.formatMessage({id:"S+fFwb",defaultMessage:"{count, plural, one{Can’t move shared folder to the {team_name} team space} other{Can’t move shared folders to the {team_name} team space}}"},{count:r,team_name:n.Emstring.em_snippet(s,o.SNIPPET_SIZES.DISPLAY_NAME)}):F.intl.formatMessage({id:"thmzHN",defaultMessage:"{count, plural, one{Can’t move shared folder to a team folder} other{Can’t move shared folders to a team folder}}"},{count:r})})(e,g,l,s.length,u);let E="";E=g?"/help/business/team-space-overview#moveout":"/help/business/team-space-overview#movein";const y=1===s.length,I=s[0]instanceof f.File&&y&&!g?F.intl.formatMessage({id:"tHNeW4",defaultMessage:"See owner"}):void 0;c.showMoveErrorModal({title:S,content:_,learnMoreLink:E,buttonString:I,onClick:()=>{s[0]instanceof f.File&&(0,v.asyncShowShareModal)(e.id,s[0],{origin:o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},({path:e,qargs:t})=>(0,p.getStoreForBrowse)().dispatch(m.setUrl({path:e,qargs:t})))}})}function G(e){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"cant_nest_shared_folder"===e.failure.relocation_error[".tag"]}function K(e,t,r,a){return!e.isError&&e.result.changeset_data&&e.result.changeset_data.length>0?()=>s.__awaiter(this,void 0,void 0,(function*(){E.Snackbar.close("browse-action"),(0,u.logFileAction)({uid:t.id,action:r.undoingLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0,extra:r.extra}),(0,S.rollback)({changeset_data:e.result.changeset_data,userId:t.id,onSuccess:()=>{E.Snackbar.complete(r.undoSuccessSnackbarText,"browse-action"),(0,u.logFileAction)({uid:t.id,action:r.undoSuccessLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0}),a&&a(!0)}})})):void 0}function z(){(0,M.open_tab)("https://help.dropbox.com/files-folders/share/shared-folder-differences#move_shared_folder")}t.moveFiles=function e(r){var a,o;return s.__awaiter(this,void 0,void 0,(function*(){const{path:s,files:i,newPath:n,onError:l,onUndo:_,onSuccess:m,user:f,dataApiV2:g=h,checkFSWs:S,isLockedVaultFolder:v,extra:y,fswIDs:T=[]}=r;if(v)return void E.Snackbar.fail(V,"browse-action");if(d.paths_are_equal(s,n))return void E.Snackbar.fail(q,"browse-action");const A=(function(e,t,s){return{sync:e=>F.intl.formatMessage({id:"IE0PNM",defaultMessage:"{count, plural, one{Moving {count} item...} other{Moving {count} items...}}"},{count:e}),undo:F.intl.formatMessage({id:"XkY9GW",defaultMessage:"Undoing move..."}),undoFail:F.intl.formatMessage({id:"htZAqt",defaultMessage:"Couldn’t undo move."}),undoComplete:F.intl.formatMessage({id:"rrCngs",defaultMessage:"Move undone."}),failure:(s,{isNestedNamespaceError:r}={})=>r?F.intl.formatMessage({id:"U2agKj",defaultMessage:"{count, plural, one{Couldn’t move {count} item to <link>{folderName}</link>.} other{Couldn’t move {count} items to <link>{folderName}</link>.}} Shared folders can’t be moved to other shared folders."},{count:s,folderName:e,link:t}):F.intl.formatMessage({id:"aWWTan",defaultMessage:"{count, plural, one{Couldn’t move {count} item to <link>{folderName}</link>.} other{Couldn’t move {count} items to <link>{folderName}</link>.}}"},{count:s,folderName:e,link:t}),success:r=>Z({folderLinkCta:t,folderName:e,fswIDs:s,successActions:r}),partialSuccess:(r,a,{isNestedNamespaceError:o}={})=>Q({folderLinkCta:t,folderName:e,fswIDs:s,isNestedNamespaceError:o,successActions:r,totalActions:a})}})(d.filename(n),j(f,n),T);E.Snackbar.sync(A.sync(i.length),!0,"browse-action"),i.forEach(e=>{(0,u.logFileAction)({uid:f.id,action:I.WebUserActionLogEvent.MOVE_ITEM_ATTEMPT,num_files_selected:i.length,num_folders_selected:0})});const M=yield g.moveFiles(i,n,f.id,{allowOwnershipTransfer:T.includes(k),checkFSWs:S}),O={attemptItemLogAction:I.WebUserActionLogEvent.MOVE_ITEM_ATTEMPT,failItemLogAction:I.WebUserActionLogEvent.MOVE_ITEM_FAIL,successItemLogAction:I.WebUserActionLogEvent.MOVE_ITEM_SUCCESS,successLogAction:I.WebUserActionLogEvent.MOVE_REQUEST_SUCCESS,failedLogAction:I.WebUserActionLogEvent.MOVE_REQUEST_FAIL,undoingLogAction:I.WebUserActionLogEvent.MOVE_UNDO,undoFailedLogAction:I.WebUserActionLogEvent.MOVE_UNDO_REQUEST_FAIL,undoSuccessLogAction:I.WebUserActionLogEvent.MOVE_UNDO_REQUEST_SUCCESS,undoingSnackbarText:A.undo,undoFailedSnackbarText:A.undoFail,getPartialSuccessSnackbarText:A.partialSuccess,getSuccessSnackbarText:A.success,undoSuccessSnackbarText:A.undoComplete,getFailureSnackbarText:A.failure,extra:y};if(M.isError){if(E.Snackbar.close("browse-action"),l&&l(M),"to"===M.error[".tag"]&&"file_system_warnings"===M.error.to[".tag"]){const t=(null===(o=null===(a=M.error.to)||void 0===a?void 0:a.details)||void 0===o?void 0:o.map(({id:e})=>e))||[],s=()=>e(Object.assign(Object.assign({},r),{checkFSWs:!1,fswIDs:t}));return void c.showFileSystemWarningsModal({fsws:M.error.to.details,onFinalAccept:s,confirmText:F.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}const t=()=>{E.Snackbar.fail(O.getFailureSnackbarText(i.length),"browse-action")};return H(f,M.error[".tag"],i,n,t),void(0,u.logFileAction)({uid:f.id,action:O.failedLogAction,num_files_selected:i.length,num_folders_selected:0,error_summary:M.error_summary,error:M.error[".tag"],jobId:M&&M.jobId,extra:O.extra})}B({entries:M.result.entries,loggingInfo:O,jobId:M.jobId,uid:f.id});const C=M.result.entries.filter(e=>"success"===e[".tag"]),N=C.length,L=i.length-N,P=K(M,f,O,_);if((0,t.showBatchCompletedSnackbar)(i.length,N,L,O,P,{isNestedNamespaceError:M.result.entries.some(G)}),m){m([],W(C,i),N)}if(X(O.successLogAction,M.result,f.id,M.jobId,i.length,y),0===L&&N>0){const e=(0,p.getStoreForBrowse)().getState(),t=w.postTTIExperiments(e);if(t.expTidyMoveFeatureGrowth){n.substring(0,n.lastIndexOf("/"))===r.path&&(0,b.shouldShowMoveSnackbar)(f.id,n,N).then(s=>{if(s.should_show){const a=t.expTidyUpReengagement?s.snackbar_type:void 0;setTimeout(()=>{(0,R.showTidyUpMoveSnackbar)(r.path,f.id,w.context(e).currentNSID,a)},5e3)}})}}}))},t.getBatchUndoHandler=K,t.nestedNamespaceSnackbars={showPartialSuccess:(e,t)=>t?((0,y.setHandleUndo)(t),E.Snackbar.show(r.default.createElement(E.Snackbar,{title:e,variant:"complete",actionButtonText:F.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:t,closeButtonText:F.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onCloseClick:z,timeoutDelayMs:5e3,id:"browse-action"}))):E.Snackbar.show(r.default.createElement(E.Snackbar,{closeButtonText:F.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:F.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:z,timeoutDelayMs:5e3,title:e,variant:"complete",id:"browse-action"})),showFailure:e=>E.Snackbar.show(r.default.createElement(E.Snackbar,{closeButtonText:F.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:F.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:z,timeoutDelayMs:5e3,title:e,variant:"fail",id:"browse-action"}))};function X(e,t,s,r,a,o){let i=a,n=0,l=void 0;const d=t.entries.filter(e=>"success"===e[".tag"]);d&&(i=d.filter(e=>"file"===e.success[".tag"]).length,n=d.filter(e=>"folder"===e.success[".tag"]).length);const c=t.entries.filter(e=>"failure"===e[".tag"]);c&&c.length>0&&(l=c[0].failure[".tag"]),(0,u.logFileAction)({uid:s,action:e,num_files_selected:i,num_folders_selected:n,jobId:r,error_summary:l,extra:o})}function Z({folderLinkCta:e,folderName:t,fswIDs:s,successActions:r}){return(null==s?void 0:s.includes(U))?F.intl.formatMessage({id:"P6vPej",defaultMessage:"{count, plural, one{{count} item moved and can now be accessed by everyone with access to “{folderName}.”} other{{count} items moved and can now be accessed by everyone with access to “{folderName}.”}}"},{count:r,folderName:t,link:e}):F.intl.formatMessage({id:"315R6Z",defaultMessage:"{count, plural, one{Moved {count} item to <link>{folderName}</link>.} other{Moved {count} items to <link>{folderName}</link>.}}"},{count:r,folderName:t,link:e})}function Q({folderLinkCta:e,folderName:t,fswIDs:s,isNestedNamespaceError:r,successActions:a,totalActions:o}){return(null==s?void 0:s.includes("action_move_implicit_share"))?F.intl.formatMessage({id:"FrPyCz",defaultMessage:"{successActions} of {totalActions} items moved and can now be accessed by everyone with access to “{folderName}.”"},{successActions:a,totalActions:o,folderName:t,link:e}):r?F.intl.formatMessage({id:"v6wzJx",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}} Shared folders can’t be moved to other shared folders."},{count:o,succesfully_moved_files:a,folderName:t,link:e}):F.intl.formatMessage({id:"VgRH6k",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}}"},{count:o,succesfully_moved_files:a,folderName:t,link:e})}t.showBatchCompletedSnackbar=(e,s,r,a,o,i={})=>{if(s>0&&r>0){const r=a.getPartialSuccessSnackbarText(s,e,i);i.isNestedNamespaceError?t.nestedNamespaceSnackbars.showPartialSuccess(r,o):o?((0,y.setHandleUndo)(o),E.Snackbar.completeWithUndo(r,o,"browse-action")):E.Snackbar.complete(r,"browse-action")}else if(s>0){const e=a.getSuccessSnackbarText(s);o?((0,y.setHandleUndo)(o),E.Snackbar.completeWithUndo(e,o,"browse-action")):E.Snackbar.complete(e,"browse-action")}else{const e=a.getFailureSnackbarText(r,i);i.isNestedNamespaceError?t.nestedNamespaceSnackbars.showFailure(e):E.Snackbar.fail(e,"browse-action")}},t.getMoveSuccessSnackbarText=Z,t.getMovePartialSuccessSnackbarText=Q})),define("metaserver/static/js/file_actions/create-folder",["require","exports","tslib","metaserver/static/js/file_actions/metrics","metaserver/static/js/file_actions/strings","metaserver/static/js/metrics/index","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/user_survey/user_survey"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logCreateFolderSuccess=t.logCreateFolderPending=t.logCreateFolderCancel=t.logCreateFolderError=t.logCreateFolder=t.createFolder=void 0,i=s.__importStar(i),l=s.__importStar(l);function m(e,t,s){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_ERROR,extra:{error_summary:e||null,error:t||null,origin:s||null}})}function p(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_CANCEL,extra:{origin:e||null}})}function f(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_PENDING,extra:{origin:e||null}})}function h(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_SUCCESS,extra:{origin:e||null}}),_.UserSurvey.trackEvent("create_item","browse")}t.createFolder=({user:e,name:n,destination:c,checkFsw:_,origin:g,surface:S})=>s.__awaiter(void 0,void 0,void 0,(function*(){const E=(0,o.getMetricsReporter)(),v={surface:S},y={latency:E.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/latency_ms"},v),completed:E.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/completed"},v)};f(g),d.Snackbar.sync(u.intl.formatMessage(a.createFolderSnackbarProgress),!1,"browse-action");const T=yield l.createFolder(c,n,e,_);if(T.isError&&"path"===T.error[".tag"]&&"file_system_warnings"===T.error.path[".tag"]){return d.Snackbar.close("browse-action"),(yield(function(e){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise(t=>{i.showFileSystemWarningsModal({fsws:e,onFinalAccept:()=>{t(!0)},onAbortAction:()=>{t(!1)},confirmText:u.intl.formatMessage(a.createFolderFswConfirmText)})})}))})(T.error.path.details))?yield(0,t.createFolder)({user:e,name:n,destination:c,checkFsw:!1,origin:g,surface:S}):(p(g),{type:"cancel"})}return y.latency.record(),T.isError?("path"===T.error[".tag"]&&"malformed_path"===T.error.path[".tag"]?(d.Snackbar.fail(u.intl.formatMessage(a.createFolderErrorMalformedPath),"browse-action"),y.completed.record(1)):(d.Snackbar.fail(u.intl.formatMessage(a.createFolderErrorGeneric),"browse-action"),y.completed.record(0)),m(T.error_summary,T.error[".tag"],g),{type:"error",summary:T.error_summary,error:T.error[".tag"]}):(d.Snackbar.complete(u.intl.formatMessage(a.createFolderSnackbarSuccess),"browse-action",void 0),h(g),y.completed.record(1),{type:"success",folder:T.result.metadata})})),t.logCreateFolder=function({uid:e,view_type:t,origin:s,source:r}){(0,n.logWebUserAction)({user_id:e,event_name:c.WebUserActionLogEvent.CREATE_FOLDER,view_type:t||null,extra:Object.assign({origin:s},r&&{source:r})})},t.logCreateFolderError=m,t.logCreateFolderCancel=p,t.logCreateFolderPending=f,t.logCreateFolderSuccess=h})),define("metaserver/static/js/flows/utils/async_modal_launchers",["require","exports","tslib","react","react-intl","react-redux","metaserver/static/js/core/i18n","metaserver/static/js/components/ui/modal","metaserver/static/js/browse/data/store"],(function(e,t,s,r,a,o,i,n,l){"use strict";function d(e,t){n.Modal.showInstance(r.default.createElement(o.Provider,{store:(0,l.getStoreForBrowse)()},r.default.createElement(a.RawIntlProvider,{value:i.intl},r.default.createElement(e,Object.assign({},t)))))}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncLaunchWorkflowBuilder=t.asyncLaunchAddOrEditAutoFolderModal=t.asyncLaunchUnifiedAutomationEditModal=t.asyncLaunchUnifiedAutomationAddModal=t.asyncLaunchUnifiedAutomationCreateModal=t.showModalInstance=void 0,r=s.__importDefault(r),t.showModalInstance=d,t.asyncLaunchUnifiedAutomationCreateModal=function(t,r){new Promise((t,s)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,s)}).then(s.__importStar).then(({BrowseCreateAutoFolderModal:e})=>{const s={parentFqPath:t,surface:"browse",user:r};d(e,Object.assign(Object.assign({},s),{onRetry:function(){d(e,Object.assign(Object.assign({},s),{entryPoint:"error_snackbar"}))}}))})},t.asyncLaunchUnifiedAutomationAddModal=function(t,r,a,o,i,n,l,c,u){new Promise((t,s)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,s)}).then(s.__importStar).then(({BrowseAddAutoFolderModal:e})=>{const s={automation:i,actionData:n,currentFqPath:t,entryPoint:c,folderFqPath:r,initialScreen:l,nsId:o,user:a,source:u};d(e,Object.assign(Object.assign({},s),{onRetry:function(){d(e,Object.assign(Object.assign({},s),{entryPoint:"error_snackbar"}))}}))})},t.asyncLaunchUnifiedAutomationEditModal=function(t,r,a,o){return s.__awaiter(this,void 0,void 0,(function*(){const{getFolderRuleForFqPath:i,BrowseEditAutoFolderModal:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,s)}).then(s.__importStar),l=yield i(t);if(null!=(null==l?void 0:l.folderRule)&&null!=(null==l?void 0:l.actionTag)){const e={folderRule:l.folderRule,fqPath:t,user:r,nsId:a,entryPoint:o};d(n,Object.assign(Object.assign({},e),{onRetry:function(){d(n,Object.assign(Object.assign({},e),{entryPoint:"error_snackbar"}))}}))}}))},t.asyncLaunchAddOrEditAutoFolderModal=function({fqPath:t,nsId:r,user:a,entryPoint:o,source:i}){return s.__awaiter(this,void 0,void 0,(function*(){const{getFolderRuleForFqPath:n,BrowseAddAutoFolderModal:l,BrowseEditAutoFolderModal:c}=yield new Promise((t,s)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,s)}).then(s.__importStar),u=yield n(t);if(null!=(null==u?void 0:u.folderRule)&&null!=(null==u?void 0:u.actionTag)){const{folderRule:e,actionTag:s}=u,i={automation:s,entryPoint:o,folderRule:e,fqPath:t,nsId:r,user:a};function _(){d(c,Object.assign(Object.assign({},i),{entryPoint:"error_snackbar"}))}d(c,Object.assign(Object.assign({},i),{onRetry:_}))}else{const e={currentFqPath:t,entryPoint:o,folderFqPath:t,nsId:r,user:a,source:i};function _(){d(l,Object.assign(Object.assign({},e),{entryPoint:"error_snackbar"}))}d(l,Object.assign(Object.assign({},e),{onRetry:_}))}}))},t.asyncLaunchWorkflowBuilder=function({operation:t,folderFqPath:r,parentFqPath:a,surface:o,entryPoint:i}){return s.__awaiter(this,void 0,void 0,(function*(){const{WorkflowBuilderComponent:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/flows/workflow_builder/workflow_builder"],t,s)}).then(s.__importStar);d(n,{operation:t,folderFqPath:r,parentFqPath:a,surface:o,entryPoint:i})}))}})),define("metaserver/static/js/folder_dialog/move_dialog",["require","exports","tslib","lodash","react","dig-components/buttons","dig-components/modal","dig-components/typography","spectrum/button/index","spectrum/dimensions/index","metaserver/static/js/filepath/filepath","metaserver/static/js/logging/hive/schemas/web-modal-activity","metaserver/static/js/browse/actions","metaserver/static/js/browse/constants","metaserver/static/js/components/ui/css","metaserver/static/js/folder_dialog/constants","metaserver/static/js/folder_dialog/folder_picker_dig","metaserver/static/js/folder_dialog/utils","metaserver/static/js/sharing/browse_exports","metaserver/static/js/clean/viewer","metaserver/static/js/core/i18n","metaserver/static/js/dropins_v3/shared/search_input","metaserver/static/js/dropins_v3/shared/culled_list","metaserver/static/js/dropins_v3/shared/item_row","metaserver/static/js/dropins_v3/file_browser/loading"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E,v,y,T,I,F){"use strict";var A;Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDialog=t.MoveDialogComponent=t.MoverUiState=void 0,r=s.__importStar(r),a=s.__importDefault(a),(function(e){e[e.Browse=1]="Browse",e[e.Search=2]="Search",e[e.SearchLoading=3]="SearchLoading"})(A=t.MoverUiState||(t.MoverUiState={}));class M extends a.default.Component{constructor(e){super(e),this.handleSuccess=()=>{const e=this.state.selectedPath,t=this.state.containedNsID,s=this.state.selectedPredictionId;if(this.isPrimaryButtonDisabled())return;const{onSuccess:r,apiClient:a,onError:o,onPrimaryButtonClick:i}=this.props;i(e,s),a.moveToFolder(e,t,this.state.isLockedVaultFolder).then(r,o)},this.handleCancelClick=()=>{const{onCancel:e,onSecondaryButtonClick:t}=this.props;t(),e()},this.handleFolderSelected=(e,t,s,r,a)=>{const{onFolderSelected:o}=this.props;o&&o(e,!!a),this.setState({selectedPath:e,containedNsID:t,selectedPredictionId:s,isLockedVaultFolder:r})},this.shouldShowFolderSuggestion=()=>{const{apiClient:e,entries:t,operation:s,showFolderSuggestion:r}=this.props;return!!r&&!!e.getFolderSuggestion&&(s===f.Operation.COPY||s===f.Operation.MOVE)&&!!t&&t.length>0},this.fetchFolderSuggestion=e=>s.__awaiter(this,void 0,void 0,(function*(){const{apiClient:t,entries:s,operation:r}=this.props,a=s.map(e=>e.fq_path),o=r===f.Operation.MOVE?"MOVE":"COPY";return yield t.getFolderSuggestion(e,a,o)})),this.handleCreateNewFolderClick=()=>{const{selectedPath:e}=this.state;if(void 0===e)return;this.handleCancelClick();const t=this.props.user,s=e=>{this.showMoveDialog(e)},r=()=>{this.showMoveDialog(e)};(0,S.asyncShowCdmNewFolderModal)({handleCreateFolder:({folderName:a})=>{_.browseActions.createFolderInNewFolderModal({folderName:a,isConfidential:!1,user:t,context:null,redirectOnSuccess:s,redirectOnCancel:r,fqPath:e,selectCreatedFolder:!1,origin:m.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_MOVE_DIALOG})},user:t,context:null,shouldSyncDefault:!1,shouldDisplaySyncSettings:!1,shouldDisplayAudienceInput:!1,redirectOnCancel:r})},this.showMoveDialog=e=>{const{operation:t,user:s,apiClient:r,entries:a,initialFolderSelection:o,onSuccess:i,onCancel:n,showFolderSuggestion:l,createNewFolderInMoveDialog:d,showMoveDialogOnRedirect:c}=this.props;c&&c({operation:t,modalName:t===f.Operation.MOVE?u.ModalName.MOVE:u.ModalName.COPY,user:s,apiClient:r,entries:a,initialFolderSelection:o,onSuccess:i,onCancel:n,showFolderSuggestion:l,createNewFolderInMoveDialog:d,initialFolderSelectionOnRedirect:e})},this.isPrimaryButtonDisabled=()=>{if(void 0===this.state.selectedPath)return!0;if(this.props.operation!==f.Operation.MOVE)return!1;return!!r.filter(this.props.entries,e=>"fq_path"in e&&(!(!e.is_dir||this.props.operation!==f.Operation.MOVE||!(0,c.paths_are_equal)(e.fq_path,this.state.selectedPath))||(0,c.paths_are_equal)((0,c.parent_dir)(e.fq_path),this.state.selectedPath))).length},this.handleSearchQueryChange=r.debounce(e=>{""===e?this.setState({moverUiState:A.Browse,searchText:e,selectedSearchResult:""}):(this.setState({moverUiState:A.SearchLoading,searchText:e}),this.props.apiClient.search(this.props.user.id,e).then(e=>{this.setState({moverUiState:A.Search,searchResults:e.file_info})}))},1e3),this.renderSearchResultItem=e=>{const t=this.state.selectedSearchResult===e.fq_path,s=!!e.mount_access_perms&&0===e.mount_access_perms.length;return a.default.createElement("li",{key:e.fq_path,className:"dropins-mover-files-list-item"},a.default.createElement(I.ItemRow,{item:e,selected:t,disabled:s,showPath:!0,onClick:this.handleSearchResultSelected(e)}))},this.state={moverUiState:A.Browse,searchText:"",searchResults:[],selectedSearchResult:""}}handleSearchResultSelected(e){return()=>{this.setState({moverUiState:A.Browse,selectedSearchResult:e.fq_path})}}renderContent(){const{user:e,initialFolderSelection:t,webTimer:s,apiClient:r,onError:o,onDataLoaded:i,onBreadcrumbClicked:n,onRowClicked:l,onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u}=this.props,{moverUiState:_}=this.state,m=Object.assign(Object.assign({},r),{fetchFolderSuggestion:this.shouldShowFolderSuggestion()?this.fetchFolderSuggestion:void 0});return _===A.SearchLoading?a.default.createElement("div",{className:"dropins-mover-content"},a.default.createElement("div",{className:"dropins-mover-loading-container"},a.default.createElement(F.Loading,null))):_===A.Search?a.default.createElement(T.CulledList,{containerClassName:"dropins-mover-content",className:"dropins-mover-files-list",items:this.state.searchResults,listItemHeights:this.state.searchResults.map(()=>60),renderRow:this.renderSearchResultItem,webTimer:s}):a.default.createElement(h.FolderPicker,{user:e,apiClient:m,webTimer:s,initialPath:this.state.selectedSearchResult||t,rootName:E.Viewer.get_role_title(e)||v.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),canSelectReadonly:!1,onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:o,showFolderSuggestion:this.shouldShowFolderSuggestion(),onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u,onDataLoaded:i,onBreadcrumbClicked:n,onRowClicked:l})}render(){const{apiClient:e,entries:t,operation:s,modalTitle:r,createNewFolderInMoveDialog:c,showFoldersOnly:u,useDigModal:_,showSearchBar:m,primaryButtonText:p}=this.props,{selectedPath:h}=this.state;if(_)return a.default.createElement(a.default.Fragment,null,!u&&a.default.createElement(i.Modal.Header,{hasBottomSpacing:"title-small"},a.default.createElement(n.Title,{size:"small"},(0,g.createFolderPickerDialogTitle)(t,s,r))),a.default.createElement(i.Modal.Body,{className:"folder-picker-container__fixed-height uxa-modal",id:this.props.modalId},this.renderContent()),!u&&a.default.createElement(i.Modal.Footer,null,c&&void 0!==h?a.default.createElement(o.Button,{onClick:this.handleCreateNewFolderClick,variant:"transparent",size:"small",id:"create-new-folder"},v.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})):null,a.default.createElement(o.Button,{variant:"opacity",onClick:this.handleCancelClick},v.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),a.default.createElement(o.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},(0,g.createFolderPickerDialogButtonLabel)(s,p))));const S=a.default.createElement("div",{id:"move_dialog-header",key:"header",className:"move_dialog-header mc-util-modal-header"},(0,g.createFolderPickerDialogTitle)(t,s,r)),E=a.default.createElement("div",{key:"footer",className:"move_dialog-actions mc-util-modal-actions"},c&&void 0!==h?a.default.createElement("div",null,a.default.createElement("a",{role:"button",href:"#",onClick:this.handleCreateNewFolderClick,id:"create-new-folder"},v.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"}))):a.default.createElement("div",null),a.default.createElement("div",{className:"mc-util-modal-actions-buttons"},a.default.createElement(l.Button,{variant:"secondary",onClick:this.handleCancelClick},v.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),a.default.createElement(l.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},(0,g.createFolderPickerDialogButtonLabel)(s,p))));return a.default.createElement(d.Dimensions,{className:"move_dialog mc-util-modal"},({height:t})=>[u?null:S,m&&e.search?a.default.createElement("div",{key:"search-input",className:"dropins-mover-search-input-container"},a.default.createElement(y.SearchInput,{onQueryChange:this.handleSearchQueryChange})):null,t&&a.default.createElement("div",{key:"body",className:"move_dialog-body mc-util-modal-body",style:{height:t-(f.DIALOG_HEAD_HEIGHT+f.DIALOG_ACTIONS_HEIGHT+f.DIALOG_BODY_PADDING)}},this.renderContent()),u?null:E])}}t.MoveDialogComponent=M,M.defaultProps={onPrimaryButtonClick:r.noop,onSecondaryButtonClick:r.noop,onError:r.noop,showFoldersOnly:!1,showSearchBar:!1},M.displayName="MoveDialogComponent",t.MoveDialog=(0,p.requireCssWithComponent)(M,["/static/metaserver/static/css/react/move_dialog-vflt84lSc.css"])})),define("metaserver/static/js/folder_dialog/utils",["require","exports","metaserver/static/js/core/i18n","metaserver/static/js/folder_dialog/constants","metaserver/static/js/filepath/filepath"],(function(e,t,s,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialFolderSelection=t.getModalId=t.createFolderPickerDialogButtonLabel=t.createFolderPickerDialogTitle=void 0,t.createFolderPickerDialogTitle=function(e,t,a){if(void 0!==a)return a;if(!e||0===e.length){if(t===r.Operation.MOVE)return s.intl.formatMessage({id:"wKPvYZ",defaultMessage:"Move to…"});if(t===r.Operation.COPY)return s.intl.formatMessage({id:"TCTlqi",defaultMessage:"Copy to…"});if(t===r.Operation.UPLOAD)return s.intl.formatMessage({id:"dMKLu2",defaultMessage:"Upload to…"});if(t===r.Operation.EXPORT_LEGAL_HOLD)return s.intl.formatMessage({id:"ra1icr",defaultMessage:"Export to…"})}let o="";const i=e?e.length:0;return t===r.Operation.MOVE?o=s.intl.formatMessage({id:"qeRA7T",defaultMessage:"{count, plural, one{Move {count} item to…} other{Move {count} items to…}}"},{count:i}):t===r.Operation.COPY?o=s.intl.formatMessage({id:"N4rDe0",defaultMessage:"{count, plural, one{Copy {count} item to…} other{Copy {count} items to…}}"},{count:i}):t===r.Operation.UPLOAD&&(o=s.intl.formatMessage({id:"bWKJBF",defaultMessage:"{count, plural, one{Upload {count} item to…} other{Upload {count} items to…}}"},{count:i})),o},t.createFolderPickerDialogButtonLabel=function(e,t){return void 0!==t?t:e===r.Operation.COPY?s.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"}):e===r.Operation.EXPORT_LEGAL_HOLD?s.intl.formatMessage({id:"8+T625",defaultMessage:"Export"}):s.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})},t.getModalId=function(e){switch(e){case r.Operation.MOVE:return"move-fileops-modal";case r.Operation.COPY:return"copy-fileops-modal";case r.Operation.UPLOAD:return"upload-fileops-modal";default:return""}},t.getInitialFolderSelection=function(e,t,s){if(void 0!==s)return s;if(e&&0!==e.length){const s=(0,a.parent_dir)(e[0].fq_path),r=e.length;for(let o=1;o<r;o++)if(s!==(0,a.parent_dir)(e[o].fq_path))return t;return s}return t}})),define("metaserver/static/js/folder_overview/api",["require","exports","metaserver/static/js/api_v2/types","metaserver/static/js/api_v2/user_client"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAccount=t.isFormatVersionError=t.isConflictError=t.getLoggingFileId=t.getSharedFolderPath=t.getFolderAccess=t.addContentReferencesToPath=t.addContentReferences=t.removeContentReferences=t.getContentReferences=t.setDescription=t.getDescription=void 0;const a=new r.UserApiV2Client;class o extends r.UserApiV2Client{constructor(e,t){super(t),this.user=e}_headers(e){return this.user.is_cdm_member&&this.user.is_team_admin&&this.user.team_member_id?Object.assign({[s.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.user.team_member_id},super._headers(e)):super._headers(e)}}t.getDescription=(e,t)=>a.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then(e=>{if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]});t.setDescription=(e,t,s,r,a)=>new o(e).ns("files").rpc("set_description",{file_id:t,current_revision_id:s,text:r,format_version:a},{subjectUserId:e.id});t.getContentReferences=(e,t)=>a.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e});t.removeContentReferences=(e,t,s)=>a.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e});t.addContentReferences=(e,t,s)=>a.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e});t.addContentReferencesToPath=(e,t,s)=>a.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e});t.getFolderAccess=({userId:e,sharedFolderId:t,accountId:s,accountEmail:r})=>a.ns("files").rpc("has_folder_access",{shared_folder_id:t,account_id:s,account_email:r},{subjectUserId:e});t.getSharedFolderPath=({userId:e,sharedFolderId:t})=>a.ns("files").rpc("get_metadata",{path:`ns:${t}`},{subjectUserId:e}).then(e=>e.is_shareable?e.path_display:void 0);t.getLoggingFileId=({userId:e,path:t})=>a.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e}).then(e=>e.id);t.isConflictError=e=>e.error&&e.error.status&&"conflict"===e.error.status[".tag"];t.isFormatVersionError=e=>e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"];t.getUserAccount=({userId:e,accountId:t})=>a.ns("users").rpc("get_account",{account_id:t},{subjectUserId:e})})),define("metaserver/static/js/folder_overview/constants",["require","exports","metaserver/static/js/core/i18n","react-intl"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFLICT_POPUP_BUTTON=t.CONFLICT_POPUP_CONTENT_YOU=t.CONFLICT_POPUP_CONTENT=t.CONFLICT_POPUP_TITLE_YOU=t.CONFLICT_POPUP_TITLE=t.DESCRIPTION_LAST_EDIT=t.DESCRIPTION_LAST_EDIT_YOU=t.DESCRIPTION_LAST_EDIT_EMPTY=t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=t.PIN_TO_READ_ONLY_FOLDER=t.PIN_TO_FAILURE_PERMISSION_DENIED=t.PIN_TO_MODAL_TITLE_MULTIPLE=t.PIN_TO_MODAL_TITLE_SINGLE=t.DESCRIPTION_VERSION=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=t.SHARING_MODAL_MESSAGE_SAME_FOLDER=t.FOLDER_OVERVIEW_EDITOR_EDITING=t.CMD_KEY=t.CTRL_KEY=t.ALT_KEY=t.OPT_KEY=t.DESCRIPTION_SAVE_ERROR_DELAY_MS=t.DESCRIPTION_SAVE_DELAY_MS=t.SNACKBAR_SHOW_BUTTON_TEXT=t.SNACKBAR_CLOSE_BUTTON_TEXT=t.UNPIN_FROM_SNACKBAR_MESSAGE=t.PIN_TO_SNACKBAR_MESSAGE=t.ERROR_SHARE_NO_PERMISSION=t.ERROR_SHARE_MEMBER_FOLDER=t.ERROR_SHARE_PERSONAL_FOLDER=t.ERROR_DESCRIPTION_SAVE=t.ERROR_DESCRIPTION_FORMAT_VERSION=t.ERROR_DESCRIPTION_CONFLICT=t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=t.DATA_CACHE_TTL_MS=void 0,t.DATA_CACHE_TTL_MS=3e4,t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=s.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."}),t.ERROR_DESCRIPTION_CONFLICT=s.intl.formatMessage({id:"ssdefa",defaultMessage:"Can’t save changes. Paste text elsewhere to save, then click Refresh."}),t.ERROR_DESCRIPTION_FORMAT_VERSION=s.intl.formatMessage({id:"5dt0hu",defaultMessage:"Can’t save changes. Reload the page and try again."}),t.ERROR_DESCRIPTION_SAVE=s.intl.formatMessage({id:"PM6K+P",defaultMessage:"Can’t save changes."}),t.ERROR_SHARE_PERSONAL_FOLDER=s.intl.formatMessage({id:"9C/lc5",defaultMessage:"Can’t @mention someone in your Personal Dropbox."}),t.ERROR_SHARE_MEMBER_FOLDER=s.intl.formatMessage({id:"+dhj1b",defaultMessage:"Can’t @mention someone in your member folder."}),t.ERROR_SHARE_NO_PERMISSION=s.intl.formatMessage({id:"b7//2e",defaultMessage:"You don’t have permission to share this folder."}),t.PIN_TO_SNACKBAR_MESSAGE=(0,r.defineMessage)({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),t.UNPIN_FROM_SNACKBAR_MESSAGE=(0,r.defineMessage)({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"}),t.SNACKBAR_CLOSE_BUTTON_TEXT=(0,r.defineMessage)({id:"Ww9LPX",defaultMessage:"Close"}),t.SNACKBAR_SHOW_BUTTON_TEXT=(0,r.defineMessage)({id:"8msMyU",defaultMessage:"Show"}),t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.DESCRIPTION_SAVE_ERROR_DELAY_MS=10*t.DESCRIPTION_SAVE_DELAY_MS,t.OPT_KEY=s.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),t.ALT_KEY=s.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),t.CTRL_KEY=s.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),t.CMD_KEY=s.intl.formatMessage({id:"NWv/3R",defaultMessage:"⌘"}),t.FOLDER_OVERVIEW_EDITOR_EDITING=s.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER=(0,r.defineMessage)({id:"xkXFjI",defaultMessage:"Hi {user_name}, I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=(0,r.defineMessage)({id:"YzaJIx",defaultMessage:"Hi {user_name}, I @mentioned you in the {folder_name} folder. Take a look."}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=s.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=(0,r.defineMessage)({id:"erm7J0",defaultMessage:"I @mentioned you in the {folder_name} folder. Take a look."}),t.DESCRIPTION_VERSION=[1,0,1],t.PIN_TO_MODAL_TITLE_SINGLE=(0,r.defineMessage)({id:"kh62rs",defaultMessage:"Pin “{name}” to..."}),t.PIN_TO_MODAL_TITLE_MULTIPLE=(0,r.defineMessage)({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),t.PIN_TO_FAILURE_PERMISSION_DENIED=(0,r.defineMessage)({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),t.PIN_TO_READ_ONLY_FOLDER=(0,r.defineMessage)({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"}),t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=(0,r.defineMessage)({id:"PX5Hq1",defaultMessage:"Deleted {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT_EMPTY=(0,r.defineMessage)({id:"7V5b6j",defaultMessage:"Deleted {time_ago} by {name}"}),t.DESCRIPTION_LAST_EDIT_YOU=(0,r.defineMessage)({id:"oA46AW",defaultMessage:"Updated {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT=(0,r.defineMessage)({id:"MP7zas",defaultMessage:"Updated {time_ago} by {name}"}),t.CONFLICT_POPUP_TITLE=(0,r.defineMessage)({id:"PHRYz8",defaultMessage:"Your changes weren’t saved because you and {user} are editing at the same time."}),t.CONFLICT_POPUP_TITLE_YOU=s.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes weren’t saved because you are editing this description elsewhere."}),t.CONFLICT_POPUP_CONTENT=s.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until they’re done before making changes."}),t.CONFLICT_POPUP_CONTENT_YOU=s.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),t.CONFLICT_POPUP_BUTTON=s.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"})})),define("metaserver/static/js/folder_overview/data/action_creators",["require","exports","tslib","react","metaserver/static/js/filepath/filepath","metaserver/static/js/browse/data/selectors","metaserver/static/js/folder_overview/api","metaserver/static/js/folder_overview/constants","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/folder_overview/data/types","metaserver/static/js/folder_overview/errors","metaserver/static/js/folder_overview/live_update","metaserver/static/js/folder_overview/logging","metaserver/static/js/folder_overview/utils","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/persistence/storage","metaserver/static/js/clean/viewer","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/exception","metaserver/static/js/core/i18n"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m,p,f,h,g,S,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToBolt=t.fetchLoggingFileId=t.fetchAccountForUserId=t.fetchSharedFolderName=t.setDescriptionHasFocus=t.setRequiredComponents=t.updateFolderDataCache=t.removeContentReferences=t.addContentReferencesForPath=t.addContentReferences=t.reloadContentReferences=t.setContentReferencesData=t.saveDescriptionDraft=t.reloadDescription=t.setDescriptionData=t.setFailedToLoad=t.removeLoadedComponent=t.addLoadedComponent=t.saveFolderPreferences=t.loadFolderPreferences=t.handlePrefetch=t.fetchDataForFolder=void 0,r=s.__importStar(r),a=s.__importStar(a),o=s.__importStar(o),i=s.__importStar(i),l=s.__importStar(l),m=s.__importStar(m),S=s.__importStar(S);t.fetchDataForFolder=({path:e,nsId:r,componentNamespace:a,fetchContentReferences:o})=>(c,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){let s,_=!1;const p=m.normalizePath(e),f=Date.now(),h=l.componentDataCache(u())[a];if(!h||0===h.requiredComponents.length){const e=o?["content_references","description","draftjs"]:["description","draftjs"];c((0,t.setRequiredComponents)({componentNamespace:a,requiredComponents:e}))}const g=[];try{const h=l.user(u()).id;s=l.fileIdCache(u())[p];const S=s||l.nsIdCache(u())[p]||r;if(!S)throw new Error("Unable to get file ID or NS ID for current folder");c((0,t.setFailedToLoad)({componentNamespace:a,hasFailedToLoad:!1}));let E=s?l.folderDataCache(u())[s]:void 0;E&&E.descriptionLastUpdated&&f-E.descriptionLastUpdated<n.DATA_CACHE_TTL_MS?(_=!!E.descriptionBaseRevision,c((0,t.addLoadedComponent)({componentNamespace:a,component:"description"})),g.push(Promise.resolve(null))):(c((0,t.removeLoadedComponent)({componentNamespace:a,component:"description"})),g.push(i.getDescription(h,S))),E&&E.contentReferencesLastUpdated&&f-E.contentReferencesLastUpdated<n.DATA_CACHE_TTL_MS?(c((0,t.addLoadedComponent)({componentNamespace:a,component:"content_references"})),g.push(Promise.resolve(null))):o&&(c((0,t.removeLoadedComponent)({componentNamespace:a,component:"content_references"})),g.push(i.getContentReferences(h,S)));const[v,y]=yield Promise.all(g);if(v&&(s=v.file_obj_id),!s)throw new Error("Did not get a file ID from the Sprinkle description payload");c({type:d.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[m.normalizePath(e)]:s}}}),_=!!v&&M(c,s,v,a,f),y&&w(c,s,y,_,a,f),E=l.folderDataCache(u())[s],E&&E.sharedFolderPath||c((0,t.fetchSharedFolderName)({path:e})),E&&E.loggingFileId||c((0,t.fetchLoggingFileId)({path:e})),c((0,t.loadFolderPreferences)({folderFileId:s}))}catch(s){S.reportException({err:s,severity:"non-critical",exc_extra:{path:e}}),c((0,t.setFailedToLoad)({componentNamespace:a,hasFailedToLoad:!0}))}}));t.handlePrefetch=({path:e,content_references:r,description:a,componentNamespace:o,ts:i=Date.now()})=>n=>s.__awaiter(void 0,void 0,void 0,(function*(){try{const t=a||{},s=r||{},l=t.file_obj_id;if(!l)throw new Error("Did not get a file ID from the Odyssey prefetch payload");n({type:d.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[m.normalizePath(e)]:l}}});const c=t&&M(n,l,t,o,i);s&&w(n,l,s,c,o,i)}catch(s){S.reportException({err:s,severity:"non-critical",exc_extra:{path:e}}),n((0,t.setFailedToLoad)({componentNamespace:o,hasFailedToLoad:!0}))}}));t.loadFolderPreferences=({folderFileId:e})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(a()).id;f.UserLocalStorage.clearOtherUsers([s]);const o=f.UserLocalStorage.get(s,`folder-overview-${e}`);o&&r((0,t.updateFolderDataCache)({fileId:e,folderData:o}))}));t.saveFolderPreferences=({folderFileId:e})=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=l.user(r()).id;f.UserLocalStorage.clearOtherUsers([t]);const s=l.folderDataCache(r())[e];s&&f.UserLocalStorage.set(t,`folder-overview-${e}`,{isCollapsed:s.isCollapsed})}));t.addLoadedComponent=({componentNamespace:e,component:t})=>({type:d.ActionTypes.ADD_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}});t.removeLoadedComponent=({componentNamespace:e,component:t})=>({type:d.ActionTypes.REMOVE_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}});t.setFailedToLoad=({componentNamespace:e,hasFailedToLoad:t})=>({type:d.ActionTypes.SET_FAILED_TO_LOAD,payload:{componentNamespace:e,hasFailedToLoad:t}});t.setDescriptionData=(e,s,r)=>{const{text:a,latest_revision_id:o,file_obj_id:i,bolt_channel_state:n,format_version:l,last_modified_time:c,last_modified_user:u}=e;if(!i)throw new Error("Unexpected response from Sprinkle");const _=o||"";s((0,t.updateFolderDataCache)({fileId:i,folderData:{description:a,descriptionBaseRevision:_,descriptionDraft:void 0,descriptionSaveState:d.DescriptionSaveState.IDLE,descriptionFormatVersion:l,descriptionBoltChannelState:n,descriptionLastUpdated:Date.now()}})),s((0,t.addLoadedComponent)({componentNamespace:r,component:"description"})),s(F({folderFileId:i,modifiedInfo:{timestamp:c,userId:u},field:"description"})),(0,t.subscribeToBolt)("description",n)};t.reloadDescription=({folderFileId:e,componentNamespace:r})=>(a,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(o());try{const o=yield i.getDescription(s.id,e);a((0,t.updateFolderDataCache)({fileId:e,folderData:{descriptionBaseRevision:""}})),(0,t.setDescriptionData)(o,a,r)}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));t.saveDescriptionDraft=({folderFileId:e,componentNamespace:r})=>(a,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(o());try{const t=l.folderDataCache(o())[e];if(!t||!I(t))return;u({descriptionSaveState:d.DescriptionSaveState.SAVING});const a=yield i.setDescription(s,e,t.descriptionLatestRevision,t.descriptionDraft,n.DESCRIPTION_VERSION.join(".")),c=l.componentDataCache(o())[r];(null==c?void 0:c.descriptionHasFocus)||void 0===t.descriptionOpenedAtRevision||T(t);const{text:m,latest_revision_id:p,last_modified_time:f,last_modified_user:h}=a;u({description:m,descriptionSaveState:d.DescriptionSaveState.IDLE,descriptionLastModified:{timestamp:f,userId:h},descriptionBaseRevision:p,descriptionLatestRevision:p});const S="BROWSE"===r?g.ActionSurfaceLogValue.CENTER_PANE:g.ActionSurfaceLogValue.RIGHT_SIDEBAR,E="search-sidebar"===r?g.RetrievalSourceValue.SEARCH:g.RetrievalSourceValue.BROWSE;(0,_.logOverviewEdited)({folderFileId:e,action_surface:S,retrievalSource:E,loggingFileId:t.loggingFileId})}catch(t){i.isConflictError(t)?(u({descriptionSaveState:d.DescriptionSaveState.CONFLICT,descriptionLastModified:{userId:void 0}}),a(A({folderFileId:e}))):i.isFormatVersionError(t)?((0,c.showDescriptionFormatError)(),u({descriptionSaveState:d.DescriptionSaveState.ERROR})):((0,c.showDescriptionSaveError)(),u({descriptionSaveState:d.DescriptionSaveState.ERROR}))}function u(s){a((0,t.updateFolderDataCache)({fileId:e,folderData:s}))}}));t.setContentReferencesData=(e,s,r,a)=>{const o=s.content_references||[],i=s.latest_revision_id,n=s.last_modified_time,l=s.last_modified_user;r((0,t.updateFolderDataCache)({fileId:e,folderData:{contentReferences:o,contentReferencesRevision:i,contentReferencesBoltChannelState:s.bolt_channel_state,contentReferencesLastUpdated:Date.now()}})),r(F({folderFileId:e,modifiedInfo:{timestamp:n,userId:l},field:"contentReferences"})),r((0,t.addLoadedComponent)({componentNamespace:a,component:"content_references"})),(0,t.subscribeToBolt)("content_references",s.bolt_channel_state)};function v(e){p.Snackbar.complete(E.intl.formatMessage({id:"sz+AhS",defaultMessage:"{count, plural, one{Pinned {count} item.} other{Pinned {count} items.}}"},{count:e}),"folder-overview-pin-current-folder")}t.reloadContentReferences=({folderFileId:e,componentNamespace:r})=>(a,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(o());try{const o=yield i.getContentReferences(s.id,e);(0,t.setContentReferencesData)(e,o,a,r)}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));const y=({folderName:e,onShow:t})=>{p.Snackbar.show(r.createElement(p.Snackbar,{title:E.intl.formatMessage(n.PIN_TO_SNACKBAR_MESSAGE,{folderName:e}),timeoutDelayMs:5e3,actionButtonText:t?E.intl.formatMessage(n.SNACKBAR_SHOW_BUTTON_TEXT):void 0,closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:t?()=>{p.Snackbar.close("folder-overview-pin"),t()}:void 0,id:"folder-overview-pin"}))};t.addContentReferences=({folderFileId:e,fileIds:r,componentNamespace:a,snackbarConfig:o})=>(n,d)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(null===r||0===r.length)return;const s=l.user(d()).id;try{yield i.addContentReferences(s,e,r),o?y(o):v(r.length),n((0,t.reloadContentReferences)({folderFileId:e,componentNamespace:a}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.addContentReferencesForPath=({path:e,files:r,currentPath:o,snackbarConfig:d})=>(c,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(u());try{yield i.addContentReferencesToPath(s.id,e,r.map(m.fileToContentReferenceId)),d?y(d):o!==e?p.Snackbar.complete(E.intl.formatMessage({id:"Mflc9Z",defaultMessage:"{count, plural, one{Pinned {count} item to {folder}.} other{Pinned {count} items to {folder}.}}"},{count:r.length,folder:a.filename(e,h.Viewer.get_root_name(s))}),"folder-overview-pin"):v(r.length);const n=l.fileIdCache(u())[m.normalizePath(e)];n&&c((0,t.reloadContentReferences)({folderFileId:n,componentNamespace:"BROWSE"}))}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]});try{if("permission_denied"===t.error.status[".tag"]){const t=d?E.intl.formatMessage(n.PIN_TO_READ_ONLY_FOLDER):E.intl.formatMessage(n.PIN_TO_FAILURE_PERMISSION_DENIED,{path:a.filename(e,h.Viewer.get_root_name(s))});return void p.Snackbar.fail(t,"folder-overview-pin")}}catch(e){}p.Snackbar.fail(E.intl.formatMessage({id:"LYVKP8",defaultMessage:"{count, plural, one{Failed to pin {count} item to {folder}.} other{Failed to pin {count} items to {folder}.}}"},{count:r.length,folder:a.filename(e,h.Viewer.get_root_name(s))}),"folder-overview-pin")}}));t.removeContentReferences=({folderFileId:e,fileIds:a,componentNamespace:o,snackbarConfig:d})=>(c,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(u()).id;try{yield i.removeContentReferences(s,e,a),d?p.Snackbar.show(r.createElement(p.Snackbar,{title:E.intl.formatMessage(n.UNPIN_FROM_SNACKBAR_MESSAGE,{folderName:d.folderName}),variant:"complete",actionButtonText:E.intl.formatMessage({id:"GUtve/",defaultMessage:"Undo"}),closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:()=>{p.Snackbar.close("folder-overview-unpin"),c((0,t.addContentReferences)({folderFileId:e,fileIds:a,componentNamespace:o,snackbarConfig:d}))},timeoutDelayMs:5e3,id:"folder-overview-unpin"})):p.Snackbar.generic(E.intl.formatMessage({id:"0bkx9E",defaultMessage:"{count, plural, one{Unpinned {count} item.} other{Unpinned {count} items.}}"},{count:a.length}),"folder-overview-unpin"),c((0,t.reloadContentReferences)({folderFileId:e,componentNamespace:o}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.updateFolderDataCache=({fileId:e,folderData:t})=>({type:d.ActionTypes.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:e,folderData:t}});function T(e){const t=e.description?E.intl.formatMessage({id:"BV1uZg",defaultMessage:"Folder overview changed."}):E.intl.formatMessage({id:"MLktc7",defaultMessage:"Folder overview added."});p.Snackbar.generic(t,"folder-overview-change")}t.setRequiredComponents=({componentNamespace:e,requiredComponents:t})=>({type:d.ActionTypes.SET_REQUIRED_COMPONENTS,payload:{componentNamespace:e,requiredComponents:t}});t.setDescriptionHasFocus=({componentNamespace:e,descriptionHasFocus:s,folderFileId:r})=>(a,o)=>{const i=l.componentDataCache(o())[e];if(s&&i&&!i.descriptionHasFocus){const e=l.folderDataCache(o())[r].descriptionBaseRevision;a((0,t.updateFolderDataCache)({fileId:r,folderData:{descriptionLatestRevision:e,descriptionOpenedAtRevision:e}}))}else if(!s&&(null==i?void 0:i.descriptionHasFocus)){const e=l.folderDataCache(o())[r];e&&(null==e?void 0:e.descriptionOpenedAtRevision)!==(null==e?void 0:e.descriptionLatestRevision)&&(T(e),a((0,t.updateFolderDataCache)({fileId:r,folderData:{descriptionOpenedAtRevision:void 0}})))}a({type:d.ActionTypes.SET_DESCRIPTION_HAS_FOCUS,payload:{componentNamespace:e,descriptionHasFocus:s}})};const I=e=>!!e&&(e.descriptionSaveState!==d.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==d.DescriptionSaveState.SAVING&&m.hasUnsavedDescriptionDraft(e)));t.fetchSharedFolderName=({path:e})=>(r,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(a.paths_are_equal(e,"/"))return;const s=m.normalizePath(e),n=l.nsIdCache(o())[s];if(!n)return;const d=l.fileIdCache(o())[s],c=l.user(o()).id,u=m.extractSharedFolderId(n);if(u)try{const e=yield i.getSharedFolderPath({userId:c,sharedFolderId:u});r((0,t.updateFolderDataCache)({fileId:d,folderData:{sharedFolderPath:e}}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.fetchAccountForUserId=({accountId:e})=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(r());if(!e)return;if(e in l.accountCache(r()))return;if(e===s.account_id)return;const a=yield i.getUserAccount({userId:s.id,accountId:e});t({type:d.ActionTypes.UPDATE_ACCOUNT_CACHE,payload:{accountCache:{[e]:a}}})}));t.fetchLoggingFileId=({path:e})=>(r,n)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(a.paths_are_equal(e,"/"))return;if(a.paths_are_equal(o.context(n()).currentFQPath,e)&&!o.context(n()).currentNSPath)return;const s=m.normalizePath(e),d=l.fileIdCache(n())[s],c=l.user(n()).id;try{const e=yield i.getLoggingFileId({userId:c,path:s});r((0,t.updateFolderDataCache)({fileId:d,folderData:{loggingFileId:e}}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));const F=({folderFileId:e,modifiedInfo:s,field:r})=>(a,o)=>{if(!s.timestamp||!s.userId)return;const i=l.folderDataCache(o())[e];if(!i)return;const n="contentReferences"===r?"contentReferencesLastModified":"descriptionLastModified",d=i[n];(null==d?void 0:d.timestamp)&&s.timestamp<d.timestamp||(a((0,t.updateFolderDataCache)({fileId:e,folderData:{[n]:s}})),a((0,t.fetchAccountForUserId)({accountId:s.userId})))};t.subscribeToBolt=(e,t)=>{if(void 0!==t)try{const{channel_id:s,revision:r,token:a}=t;if(void 0===s||void 0===r||void 0===a)return;const{unique_id:o,app_id:i}=s;if(void 0===o||void 0===i)return;u.folderOverviewLiveUpdateManager.setUpdateChannelForType(e,{uniqueId:o,appId:i,token:a,revision:`${r}`})}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}};const A=({folderFileId:e})=>(t,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(r()),{last_modified_time:a,last_modified_user:o}=yield i.getDescription(s.id,e);t(F({folderFileId:e,modifiedInfo:{timestamp:a,userId:o},field:"description"}))})),M=(e,s,r,a,o)=>r.latest_revision_id?((0,t.setDescriptionData)(r,e,a),!0):(e((0,t.addLoadedComponent)({componentNamespace:a,component:"description"})),e((0,t.updateFolderDataCache)({fileId:s,folderData:{descriptionBoltChannelState:r.bolt_channel_state,descriptionLastUpdated:o}})),(0,t.subscribeToBolt)("description",r.bolt_channel_state),!1),w=(e,s,r,a,o,i)=>r.latest_revision_id?((0,t.setContentReferencesData)(s,r,e,o),!0):(e((0,t.updateFolderDataCache)({fileId:s,folderData:{contentReferences:[],contentReferencesBoltChannelState:r.bolt_channel_state,contentReferencesLastUpdated:i}})),e((0,t.addLoadedComponent)({componentNamespace:o,component:"content_references"})),!1)})),define("metaserver/static/js/folder_overview/data/selectors",["require","exports","tslib","reselect","metaserver/static/js/filepath/filepath","metaserver/static/js/folder_overview/constants","metaserver/static/js/folder_overview/data/reducer","metaserver/static/js/folder_overview/utils","typescript/libraries/comments2/src/components/folder_overview_utils/index","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/clean/user"],(function(e,t,s,r,a,o,i,n,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDoesFolderOverviewExistSelector=t.makeIsFolderOverviewEmptySelector=t.makePinnedItemsSelector=t.makeDescriptionContentSelector=t.makeLoggingFileIdSelector=t.makeSharedFolderNameSelector=t.makeSharedFolderPathSelector=t.makeHasUnsavedDescriptionDraftSelector=t.makeDescriptionFormatValidSelector=t.makeDescriptionSaveStateSelector=t.makeLastModifiedUserSelector=t.makeLastModifiedUserIdSelector=t.makeLastModifiedTimeSelector=t.makeDescriptionBaseRevisionSelector=t.makeIsCollapsedSelector=t.descriptionAuthorSelector=t.makeSharedFolderIdSelector=t.makeFolderNsIdSelector=t.makeFolderFileIdSelector=t.makeDescriptionHasFocusSelector=t.makeHasFailedToLoadSelector=t.makeHaveAllComponentsLoadedSelector=t.makeLoadedComponentsSelector=t.user=t.componentDataCache=t.accountCache=t.nsIdCache=t.fileIdCache=t.folderDataCache=void 0,a=s.__importStar(a),n=s.__importStar(n);const _=[],m=e=>(0,c.getStateAtNamespace)(e,d.FOLDER_OVERVIEW_NAMESPACE_KEY)||i.defaultFolderOverviewState;t.folderDataCache=e=>m(e).folderDataCache;t.fileIdCache=e=>m(e).fileIdCache;const p=(e,s)=>(0,t.fileIdCache)(e)[n.normalizePath(s.path)];t.nsIdCache=e=>m(e).nsIdCache;const f=(e,s)=>(0,t.nsIdCache)(e)[n.normalizePath(s.path)];t.accountCache=e=>m(e).accountCache;t.componentDataCache=e=>m(e).componentDataCache;t.user=e=>e.BROWSE&&e.BROWSE.user||(0,u.mkUser)(e.SEARCH.user);const h=(e,s)=>(0,t.componentDataCache)(e)[s.componentNamespace],g=(e,s)=>{const r=p(e,s);return(0,t.folderDataCache)(e)[r]},S=(e,t)=>{const s=g(e,t);return s?s.sharedFolderPath||t.path:void 0},E=(e,t)=>{var s;const r=v(e,t);return null!==(s=null==r?void 0:r.userId)&&void 0!==s?s:void 0},v=(e,t)=>{const{descriptionLastModified:s}=g(e,t)||{};return s},y=(0,r.createSelector)(g,e=>e?e.descriptionFormatVersion:void 0),T=(0,r.createSelector)(g,e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}}),I=(0,r.createSelector)(g,e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?_:n.convertContentReferencesToSortedFiles(e.contentReferences)}),F=(0,r.createSelector)(T,l.isEmptyDescription);t.makeLoadedComponentsSelector=()=>(0,r.createSelector)(h,e=>e?e.loadedComponents:void 0);t.makeHaveAllComponentsLoadedSelector=()=>(0,r.createSelector)(h,e=>{if(!e||0===e.requiredComponents.length)return!1;return 0===e.requiredComponents.filter(t=>!e.loadedComponents.includes(t)).length});t.makeHasFailedToLoadSelector=()=>(0,r.createSelector)(h,e=>!!e&&e.hasFailedToLoad);t.makeDescriptionHasFocusSelector=()=>(0,r.createSelector)(h,e=>!!e&&e.descriptionHasFocus);t.makeFolderFileIdSelector=()=>(0,r.createSelector)(p,e=>e);t.makeFolderNsIdSelector=()=>(0,r.createSelector)(f,e=>e);t.makeSharedFolderIdSelector=()=>(0,r.createSelector)(f,e=>{if(e)return n.extractSharedFolderId(e)}),t.descriptionAuthorSelector=(0,r.createSelector)(t.user,n.convertDbxUserToIUser);t.makeIsCollapsedSelector=()=>(0,r.createSelector)(g,e=>!!e&&!!e.isCollapsed);t.makeDescriptionBaseRevisionSelector=()=>(0,r.createSelector)(g,e=>e?e.descriptionBaseRevision:void 0);t.makeLastModifiedTimeSelector=()=>(0,r.createSelector)(v,e=>{var t;return null!==(t=null==e?void 0:e.timestamp)&&void 0!==t?t:void 0});t.makeLastModifiedUserIdSelector=()=>(0,r.createSelector)(E,e=>e);t.makeLastModifiedUserSelector=()=>(0,r.createSelector)(E,t.accountCache,(e,t)=>e?t[e]:void 0);t.makeDescriptionSaveStateSelector=()=>(0,r.createSelector)(g,e=>e?e.descriptionSaveState:void 0);t.makeDescriptionFormatValidSelector=()=>(0,r.createSelector)(y,e=>{if(!e)return!0;const t=e.split(".").map(e=>parseInt(e,10));return!(t[0]>o.DESCRIPTION_VERSION[0])&&!(t[0]===o.DESCRIPTION_VERSION[0]&&t[1]>o.DESCRIPTION_VERSION[1])});t.makeHasUnsavedDescriptionDraftSelector=()=>(0,r.createSelector)(g,n.hasUnsavedDescriptionDraft);t.makeSharedFolderPathSelector=()=>(0,r.createSelector)(S,e=>e);t.makeSharedFolderNameSelector=()=>(0,r.createSelector)(S,e=>e?a.filename(e):void 0);t.makeLoggingFileIdSelector=()=>(0,r.createSelector)(g,e=>e?e.loggingFileId:void 0);t.makeDescriptionContentSelector=()=>(0,r.createSelector)(T,e=>e);t.makePinnedItemsSelector=()=>(0,r.createSelector)(I,e=>e);t.makeIsFolderOverviewEmptySelector=()=>(0,r.createSelector)(F,I,(e,t)=>e&&!(t&&t.length));t.makeDoesFolderOverviewExistSelector=()=>(0,r.createSelector)(g,e=>!!e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision))})),define("metaserver/static/js/folder_overview/errors",["require","exports","metaserver/static/js/folder_overview/constants","metaserver/static/js/clean/ui/snackbar"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showDescriptionSaveError=t.showDescriptionFormatError=void 0;t.showDescriptionFormatError=()=>{r.Snackbar.fail(s.ERROR_DESCRIPTION_FORMAT_VERSION,"folder-overview")};t.showDescriptionSaveError=()=>{r.Snackbar.fail(s.ERROR_DESCRIPTION_SAVE,"folder-overview")}})),define("metaserver/static/js/folder_overview/live_update",["require","exports","tslib","lodash","eventemitter3","metaserver/static/js/bolt/bolt_nodeps"],(function(e,t,s,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderOverviewLiveUpdateManager=t.FolderOverviewLiveUpdateManager=void 0,r=s.__importStar(r),a=s.__importDefault(a);class i extends a.default{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new o.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(r.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach(e=>{const s=r.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});s&&!t.includes(s)&&(this.emit("update",{type:s}),t.push(s))})},this.handleRefresh=()=>{this.boltClient.update_states(r.values(this.signedChannelStates))},this.boltClient=new o.BoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}t.FolderOverviewLiveUpdateManager=i,t.folderOverviewLiveUpdateManager=new i})),define("metaserver/static/js/folder_overview/logging",["require","exports","tslib","sjcl","immutable","metaserver/static/js/filepath/filepath","metaserver/static/js/logging/hive/schemas/web-user-action","metaserver/static/js/logging/telemetry","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/folder_overview/data/store","metaserver/static/js/folder_overview/utils","metaserver/static/js/clean/web_user_action_events"],(function(e,t,s,r,a,o,i,n,l,d,c,u){"use strict";function _(e){return e.blocks.map(e=>e.text.length).reduce((e,t)=>e+t,0)}function m(e){let t=(0,a.OrderedSet)();return t=t.merge(e.blocks.map(e=>e.type).filter(e=>"unstyled"!==e)),e.blocks.forEach(e=>e.inlineStyleRanges.forEach(e=>{t=t.add(e.style)})),e.blocks.forEach(s=>s.entityRanges.forEach(s=>{t=t.add(e.entityMap[s.key].type)})),t.toArray().sort()}Object.defineProperty(t,"__esModule",{value:!0}),t.logFolderOverviewAction=t.logOverviewEdited=t.makeOverviewResourceExtras=t.makeEditedData=t.extractNsIdAndPath=t.hashPath=t.hiveLogger=void 0,r=s.__importStar(r),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),t.hiveLogger=new n.HiveLogger;const p=(e,t)=>{const s=l.folderDataCache(t)[e];return s&&s.contentReferences||[]},f=e=>{if(!e)return"";const t=r.hash.sha256.hash(e.toLowerCase());return r.codec.hex.fromBits(t)};t.hashPath=e=>(e||"/").split("/").map(f).join("/");const h=e=>{const t=o.normalize(e).split("/");return f(t.pop())};t.extractNsIdAndPath=e=>e?{nsId:(0,c.extractSharedFolderId)(e),nsPath:(0,c.extractSharedFolderPath)(e)}:{};t.makeEditedData=({folderFileId:e,loggingFileId:s,action_surface:r,retrievalSource:a})=>{const o=(0,d.getStoreForFolderOverview)().getState(),i=(function(e){const t=(function(e){const t={all:0,checked:0};if(!e)return t;return e.blocks.forEach(e=>{"task-block"===e.type&&(t.all+=1,e.data&&e.data.checked&&(t.checked+=1))}),t})(e);return{length:e?_(e):0,features:e?m(e):[],tasks:t.all,checkedTasks:t.checked}})(((e,t)=>{const s=l.folderDataCache(t)[e];if(s&&s.descriptionDraft)try{return JSON.parse(s.descriptionDraft)}catch(e){return}})(e,o)),n=(0,t.makeOverviewResourceExtras)({folderFileId:e,loggingFileId:s,action_surface:r,retrievalSource:a});if(n)return Object.assign(Object.assign({},n),{length:i.length.toString(),formatting:JSON.stringify(i.features),tasks:i.tasks.toString(),checkedTasks:i.checkedTasks.toString(),pins:JSON.stringify(p(e,o).map(e=>({file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:h(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:`${e.ns_id}`,resource_path:(0,t.hashPath)(e.fq_path),resource_namespace_path:(0,t.hashPath)(e.ns_path)}})))})};t.makeOverviewResourceExtras=({folderFileId:e,loggingFileId:s,action_surface:r,retrievalSource:a})=>{const o=(0,d.getStoreForFolderOverview)().getState(),i=((e,t)=>{const s=l.fileIdCache(t);for(const t in s)if(s[t]===e)return t})(e,o);if(void 0===i)return;const{nsId:n,nsPath:c}=(0,t.extractNsIdAndPath)(l.nsIdCache(o)[i]);return n?{resource_type:"SFJ_FOLDER",resource_title:h(i),ns_id:n,resource_path:(0,t.hashPath)(i),resource_namespace_path:(0,t.hashPath)(c),file_id:(c?s:n)||null,file_obj_id:e,is_offline:"false",action_surface:r,retrieval_source:a}:void 0};t.logOverviewEdited=({folderFileId:e,loggingFileId:s,action_surface:r,retrievalSource:a})=>{const o=(0,d.getStoreForFolderOverview)().getState();(0,t.logFolderOverviewAction)(u.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,l.user(o).id,null,(0,t.makeEditedData)({folderFileId:e,loggingFileId:s,action_surface:r,retrievalSource:a}))};t.logFolderOverviewAction=(e,s,r,a={})=>{let n={user_id:s,event_name:e};r&&(n=Object.assign(Object.assign({},n),{file_nsid:r.ns_id,file_sjid:r.sjid,file_id:r.file_id,file_name:o.filename(r.fq_path),file_path:r.fq_path,file_extension:r.ext})),t.hiveLogger.log(new i.WebUserActionRow(Object.assign(Object.assign({},n),{extra:Object.assign({},a)})))}})),define("metaserver/static/js/dropins_v3/mover/api_client",["require","exports","tslib","metaserver/static/js/dropins_v3/shared/user_friendly_error","metaserver/static/js/clean/ui/fileops_actions","metaserver/static/js/cloud_docs/utils","metaserver/static/js/dropins_v3/shared/ajax_error"],(function(e,t,s,r,a,o,i){"use strict";function n(e){return void 0!==e.cloud_doc_id}function l(e){return void 0!==e.id}function d(t,r,a){return s.__awaiter(this,void 0,void 0,(function*(){const i=(0,o.replaceInvalidFilenameChars)(r.name);return(yield(function(){return s.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/api_v2/user_client"],t,s)}).then(s.__importStar);return(new t).ns("cloud_docs")}))})()).rpc("alpha/dropin_move",{cloud_doc_id:r.cloud_doc_id,to_path:`${a}/${i}`},{subjectUserId:t.id})}))}function c(t,r){return s.__awaiter(this,void 0,void 0,(function*(){const a={"Dropbox-API-Path-Root":`{".tag": "root", "root": "${t.root_ns_id}"}`};return(yield(function(){return s.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/api_v2/user_client"],t,s)}).then(s.__importStar);return(new t).ns("files")}))})()).rpc("get_metadata_batch",{paths:r.map(e=>e.id)},{subjectUserId:t.id,headers:a})}))}function u(e,t,s){return Promise.all(t.map(t=>d(e,t,s)))}function _(e,t,o){return s.__awaiter(this,void 0,void 0,(function*(){if(0===t.length)return Promise.resolve([]);const s=c(e,t),i=yield s.then(e=>e.entries.map((e,s)=>{if(void 0!==e.path_lower)return{fq_path:e.path_lower,is_dir:t[s].is_dir};throw new r.UserFriendlyError("path_lower is undefined","Oops! Seems like the file does not exist!")})),n={user:e,path:"",files:i,newPath:o,checkFSWs:!0};return new Promise((e,t)=>{a.moveFiles_LEGACY(Object.assign(Object.assign({},n),{onSuccess:e,onRequestNotSent:t}))})}))}Object.defineProperty(t,"__esModule",{value:!0}),t.search=t.moveEntriesToFolder=t.entryIsFile=t.entryIsCloudDoc=void 0,a=s.__importStar(a),t.entryIsCloudDoc=n,t.entryIsFile=l,t.moveEntriesToFolder=function(e,t,s){const r=t.filter(e=>n(e)),a=t.filter(e=>l(e));return Promise.all([u(e,r,s),_(e,a,s)]).then(()=>{})},t.search=function(t,r){return(function(t,r){return s.__awaiter(this,void 0,void 0,(function*(){const a=yield new Promise((t,s)=>{e(["metaserver/static/js/deprecated_ajax/ajax_jquery"],t,s)}).then(s.__importStar);return new Promise((e,s)=>{a.WebRequest({url:"/dropins/search",data:{query:r,include_files:!1},subject_user:t,success:e,error:(e,t,r)=>{s(r)}})}).then(JSON.parse,e=>Promise.reject(new i.AjaxError(e)))}))})(t,r)}})),define("metaserver/static/js/dropins_v3/mover/host_site",["require","exports","metaserver/static/js/dropins_v3/shared/host_site"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostSite=void 0;class r extends s.BaseHostSite{onSuccess(){this.sendMessage("success"),this.closeDialog()}onCancel(){this.sendMessage("cancel"),this.closeDialog()}onError(e){this.sendMessage("error",e.message),this.closeDialog()}onFolderSelected(e){this.sendMessage("folder_selected",{path:e})}}t.HostSite=r})),define("metaserver/static/js/dropins_v3/mover/mover_page",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/folder_dialog/api","metaserver/static/js/dropins_v3/mover/api_client","metaserver/static/js/dropins_v3/mover/host_site","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/core/notify","metaserver/static/js/dropins_v3/mover/mover_parent","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/dropins_v3/shared/timeout","metaserver/static/js/clean/viewer"],(function(e,t,s,r,a,o,i,n,l,d,c,u,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverPage=void 0,r=s.__importDefault(r);class p extends r.default.Component{constructor(e){super(e),this.state={accountId:e.accountId,initialFolderSelection:e.initialFolderSelection,entries:null,showFoldersOnly:!!e.showFoldersOnly,showSearchBar:!!e.showSearchBar},this.vortexLogger=new u.VortexLogger(e.appKey,e.statPrefix),this.hostSite=new n.HostSite(e.origin,d.Notify),this.hostSite.listen({onState:e=>this.setState(e),onClose:()=>window.close()}),this.hostSite.ready()}render(){const e={moveEntriesToFolder:i.moveEntriesToFolder,getFolderContents:o.getFolderContents,search:i.search};return r.default.createElement("div",{className:"dropins-mover-page"},r.default.createElement(c.MoverParent,{viewer:m.Viewer.get_viewer(),hostSite:this.hostSite,apiClient:e,webTimer:(0,l.get_timer)(),vortexLogger:this.vortexLogger,timeout:_.timeout,accountId:this.state.accountId,entries:this.state.entries,initialFolderSelection:this.state.initialFolderSelection,showFoldersOnly:this.state.showFoldersOnly,showSearchBar:this.state.showSearchBar}))}}p.displayName="MoverPage",t.MoverPage=(0,a.requireCssWithComponent)(p,["/static/metaserver/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/metaserver/static/css/foundation-vflZkvt4R.css","/static/metaserver/static/css/notify-vflZVEumu.css"])})),define("metaserver/static/js/dropins_v3/mover/mover_parent",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/folder_dialog/move_dialog","metaserver/static/js/folder_dialog/constants","metaserver/static/js/dropins_v3/mover/api_client"],(function(e,t,s,r,a,o,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverParent=void 0,r=s.__importDefault(r);class d extends r.default.Component{constructor(){super(...arguments),this.handleSuccess=()=>{const{hostSite:e,timeout:t,vortexLogger:s}=this.props;(0,o.logRateBeforeCallback)(s,t,"move_success",()=>{e.onSuccess()})},this.handleCancel=()=>{const{hostSite:e,timeout:t,vortexLogger:s}=this.props;(0,o.logRateBeforeCallback)(s,t,"move_cancel",()=>{e.onCancel()})},this.handleError=e=>{const{hostSite:t,timeout:s,vortexLogger:r}=this.props;(0,o.logRateBeforeCallback)(r,s,"move_error",()=>{t.onError(e)})},this.handleFolderSelected=(e,t)=>{const{hostSite:s,timeout:r,vortexLogger:a}=this.props;t||(0,o.logRateBeforeCallback)(a,r,"move_folder_selection",()=>{s.onFolderSelected(e)})}}componentDidMount(){this.props.webTimer.waitForTTI().then(()=>{this.props.vortexLogger&&this.props.vortexLogger.logRate("page_start",1)})}getDialogProps(e){const{apiClient:t,entries:s,showFoldersOnly:r,initialFolderSelection:a,webTimer:o,showSearchBar:i}=this.props,d=s&&s.map(e=>(0,l.entryIsCloudDoc)(e)?{is_dir:!1}:{is_dir:e.is_dir}),c={getFolderContents:t.getFolderContents,moveToFolder:()=>Promise.resolve(),search:t.search};if(s&&s.length>0){const r=s;c.moveToFolder=s=>t.moveEntriesToFolder(e,r,s)}return{apiClient:c,user:e,initialFolderSelection:a,operation:n.Operation.MOVE,entries:d,webTimer:o,onSuccess:this.handleSuccess,onCancel:this.handleCancel,onError:this.handleError,onFolderSelected:this.handleFolderSelected,showFoldersOnly:r,showSearchBar:i}}render(){const{accountId:e,hostSite:t,viewer:s}=this.props,a=(function(e){if("string"!=typeof e.accountId)return new Error("accountId must be provided, and it must be a string");if(null!==e.entries){if(!(e.entries instanceof Array))return new Error("entries must be provided, and they must be an array");for(const t of e.entries)if((0,l.entryIsCloudDoc)(t)){if("string"!=typeof t.cloud_doc_id)return new Error("cloud doc must have a cloud_doc_id of type string");if("string"!=typeof t.name)return new Error("cloud doc must have a name of type string")}else{if(!(0,l.entryIsFile)(t))return new Error("entry must be a file with field id or cloud doc with field cloud_doc_id");if("string"!=typeof t.id)return new Error("entry must have an id of type string");if("boolean"!=typeof t.is_dir)return new Error("file must have field is_dir of type boolean")}}if("string"!=typeof e.initialFolderSelection)return new Error("initialFolderSelection must be provided, and it must be a string");return null})(this.props);if(a)return this.props.hostSite.onError(a),null;const o=(function(e,t){const s=t.get_users(!1);for(const t of s)if(e===t.account_id)return t;return null})(e,s);return o?r.default.createElement("div",{className:"dropins-mover-parent"},r.default.createElement(i.MoveDialog,Object.assign({},this.getDialogProps(o)))):(t.onError(new Error("user with given accountId is not logged in")),null)}}d.displayName="Mover",t.MoverParent=(0,a.requireCssWithComponent)(d,["/static/metaserver/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/metaserver/static/css/foundation-vflZkvt4R.css","/static/metaserver/static/css/notify-vflZVEumu.css"])})),define("metaserver/static/js/redux/tests/store",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockExtraArguments=void 0;t.mockExtraArguments=()=>({})}));
//# sourceMappingURL=pkg-tidy-up.min.js-vfll9ePxb.map