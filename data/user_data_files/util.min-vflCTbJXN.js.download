define(["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/clean/analytics","metaserver/static/js/core/exception","metaserver/static/js/sharing/api/client","typescript/component_libraries/spectrum-sharing/src/utils/logging","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/sharing/views/share_modal_evolution/utils/logging"],(function(e,t,r,i,a,s,n,c,o,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportRichSnackbarException=t.getOrCreateLink=t.getFileId=void 0;t.getFileId=e=>r.__awaiter(void 0,void 0,void 0,(function*(){const{userId:r,filePath:a}=e,n=new i.UserApiV2Client;try{return(yield n.ns("files").rpc("get_metadata",{path:a},{subjectUserId:r})).id}catch(e){return(0,t.reportRichSnackbarException)("Failed to get file id",e,s.SEVERITY.CRITICAL),Promise.reject(e)}}));t.getOrCreateLink=(e,i="max")=>r.__awaiter(void 0,void 0,void 0,(function*(){const{userId:r,filePath:s,ns_id:_}=e,l=new n.FileShareApiClient({userId:r});try{const e=yield l.sharedLinkInfo({fileIdOrPath:s});if(e.length)return e[0];a.ShareTibEventLogger.log(r,c.TiburonEventName.AttemptCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{access:i,is_folder:!1,ns_id:_,fq_path:s});try{const e=yield l.createSharedLink({fileIdOrPath:s,settings:{access:i}});return a.ShareTibEventLogger.log(r,c.TiburonEventName.SucceedCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign({is_folder:!1,ns_id:_,fq_path:s,access:i,http_status_code:200,response_status:"success"},(0,d.buildExtraFromLinkMetadata)(e))),e}catch(e){return a.ShareTibEventLogger.log(r,c.TiburonEventName.FailCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:_,fq_path:s,access:i,http_status_code:e.raw&&e.raw.status,error_tag:e.error&&e.error[".tag"]||"undefined_error",error_summary:e&&e.summary}),(0,t.reportRichSnackbarException)("Failed to create link",e),Promise.reject(e)}}catch(e){return(0,t.reportRichSnackbarException)("Failed to get shared link info",e),Promise.reject(e)}}));t.reportRichSnackbarException=(e,t,r=s.SEVERITY.NONCRITICAL)=>{(0,s.reportException)({err:new Error(e),severity:r,exc_extra:{err:t},tags:["rich_snackbar","product-growth"]})}}));
//# sourceMappingURL=util.min.js-vflL01vv0.map