define(["require","exports","tslib","metaserver/static/js/clean/analytics","metaserver/static/js/clean/clipboard_v3","metaserver/static/js/filepath/filepath","metaserver/static/js/core/browser","metaserver/static/js/clean/ui/async_fileops_modals","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/actions","metaserver/static/js/browse/data/store","metaserver/static/js/browse/file_actions/actions/share_copy_link","metaserver/static/js/core/exception","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/sharing/async_share_modal_util","metaserver/static/js/sharing/ui_notifications_util","metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal_util","metaserver/static/js/sharing/views/share_modal_evolution/utils/logging","typescript/component_libraries/spectrum-sharing/src/utils/logging","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/growth/ui/rich_snackbar_actions/types","metaserver/static/js/growth/ui/rich_snackbar_actions/util","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/naming_conventions/types","metaserver/static/js/campaigns/campaign_events_api","metaserver/static/js/onboarding/logging/events","metaserver/static/js/growth/ui/personalization/full_funnel_activation/logger"],(function(e,r,n,a,i,o,t,s,c,_,l,p,g,d,m,k,b,u,v,h,C,S,y,E,f,O,L,N){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.handleUseDropboxReplayWithUpload=r.handleTryDocsendClick=r.handleNamingConventionsClick=r.handleCopyLinkClick=r.handleShareClick=r.UPLOAD_SNACKBAR_ID=void 0,s=n.__importStar(s),c=n.__importStar(c),g=n.__importStar(g);r.UPLOAD_SNACKBAR_ID="inline-upload-snackbar";r.handleShareClick=function(e){a.ProEventsLogger.log("rich_snackbar_click",{action:"share"});const{userId:r,filePath:n,campaignImpressionContext:i}=e;return i&&(0,O.logCampaignClick)(i,"share"),I(),(0,m.asyncShowShareModal)(r,{fqPath:n,isFolder:!1},{origin:h.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD})},r.handleCopyLinkClick=function(e){return n.__awaiter(this,void 0,void 0,(function*(){a.ProEventsLogger.log("rich_snackbar_click",{action:"copy_link"});const{filePath:r,ns_id:n,userId:o,campaignImpressionContext:t}=e;t&&(0,O.logCampaignClick)(t,"copy_link"),I(),(0,k.showCopyLinkProgressSupportedBrowserSnackbar)();try{const t=yield(0,S.getOrCreateLink)(e),s=t.url;a.ShareTibEventLogger.log(o,v.TiburonEventName.CopySharedLink,h.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign(Object.assign({},(0,u.buildExtraFromLinkMetadata)(t)),{is_folder:!1,ns_id:n,fq_path:r})),(0,p.isBrowserCopyEnabled)()?(0,i.copyToClipboard)(s,()=>T(t),()=>P(s,e)):(0,k.showCopyLinkCTASnackbar)(s,()=>w(e,t),"sharing-notification")}catch(e){e.error[".tag"]===b.CopyLinkException.ACCESS_DENIED?(0,k.showCopyLinkNoPermissionSnackbar)():e.error[".tag"]===b.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===b.CopyLinkException.NOT_AUTHORIZED?(0,k.showCopyLinkNoPermissionSnackbar)():e.error[".tag"]===b.CopyLinkException.PATH&&e.error.path[".tag"]===b.CopyLinkException.NOT_FOUND?(0,k.showCopyLinkNotFoundSnackbar)():e.error[".tag"]===b.CopyLinkException.EMAIL_NOT_VERIFIED?(0,k.showCopyLinkEmailNotVerifiedSnackbar)():(0,k.showCopyLinkCatchallSnackbar)(),a.ShareTibEventLogger.log(o,v.TiburonEventName.CopySharedLinkFailure,h.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:n,fq_path:r,error_message:e.error[".tag"]}),(0,S.reportRichSnackbarException)("Failed to copy link",e)}}))},r.handleNamingConventionsClick=function(e){const{userId:r,filePath:n,ns_id:i,snackbar_origin:t}=e,{expNamingConventionsPositioning:p}=c.browsePostTTIExperiments((0,l.getStoreForBrowse)().getState());a.ProEventsLogger.log("rich_snackbar_click",{action:"naming_conventions"}),y.WebUserActionLog.log(r,E.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:i,origin:t,positioning:p?1:0}),I(),A();const g=(0,o.parent_dir)(n);c.path((0,l.getStoreForBrowse)().getState())!==g&&_.browseActions.setUrl({path:g});const d={currentUserId:r,targetPath:g,namespaceId:i,origin:{[C.SnackbarOrigin.from_upload_snackbar]:f.NamingConventionOrigin.from_upload_snackbar,[C.SnackbarOrigin.from_rename_snackbar]:f.NamingConventionOrigin.from_rename_snackbar,[C.SnackbarOrigin.from_reengagement_upload_snackbar]:f.NamingConventionOrigin.from_reengagement_upload_snackbar,[C.SnackbarOrigin.from_discovery_upload_snackbar]:f.NamingConventionOrigin.from_discovery_upload_snackbar,[C.SnackbarOrigin.from_reengagement_rename_snackbar]:f.NamingConventionOrigin.from_reengagement_rename_snackbar,[C.SnackbarOrigin.from_discovery_rename_snackbar]:f.NamingConventionOrigin.from_discovery_rename_snackbar}[t]};s.showNamingConventionsModal(d)},r.handleTryDocsendClick=function(e){a.ProEventsLogger.log("docsend_upsell_post_file_upload-continue"),window.open("https://docsend.com/signup/dropbox?utm_source=Dropbox%20Referral&utm_medium=Referral&utm_campaign=post-upload-v1&signup_source=post-upload-v1","_blank","noreferrer"),I()};const I=()=>{d.Snackbar.close(r.UPLOAD_SNACKBAR_ID)},A=()=>{d.Snackbar.close("on-rename-rich-snackbar")},w=(e,r)=>{d.Snackbar.close("sharing-notification"),(0,i.copyToClipboard)(r.url,()=>T(r),()=>P(r.url,e))},T=e=>{const r=e?e.link_permissions.link_access_level:void 0;let n="viewer";r&&(n=r.hasOwnProperty(".tag")?r[".tag"]:r),(0,k.showCopyLinkSuccessSnackbar)(e.url,n)},P=(e,r)=>{const{userId:n,ns_id:i,filePath:o}=r;(0,S.reportRichSnackbarException)("Failed to copy link to clipboard"),(0,k.showCopyLinkErrorSnackbar)(e),a.ShareTibEventLogger.log(n,v.TiburonEventName.CopySharedLinkFailure,h.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:i,fq_path:o,error:"failed_copy_to_clipboard"})};r.handleUseDropboxReplayWithUpload=e=>n.__awaiter(void 0,void 0,void 0,(function*(){(e=>{var r,n;return"V1"===(null===(n=null===(r=e.usersJtbdInterestInfo)||void 0===r?void 0:r.experiments)||void 0===n?void 0:n.full_funnel_activation_m3_variant)})(e)&&(0,N.logFullFunnelM3Event)(L.FullFunnelM3Events.REPLAY_ACTION_CLICK);try{const r=yield(0,S.getFileId)(e);(0,t.redirect)(`https://replay.dropbox.com/project/creating/${r}?creationSource=dropbox_web_snackbar`)}catch(e){g.reportException({err:e,severity:g.SEVERITY.CRITICAL,tags:["activation-targeted"]}),(0,t.redirect)("https://replay.dropbox.com/?login=true")}}))}));
//# sourceMappingURL=action_handlers.min.js-vfl321bNv.map