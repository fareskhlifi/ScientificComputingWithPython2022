define("metaserver/static/js/starred/browse_exports",["require","exports","metaserver/static/js/home/resource_id_types","metaserver/static/js/starred/actions","metaserver/static/js/starred/browse_update","metaserver/static/js/starred/constants","metaserver/static/js/starred/id_type_pair","metaserver/static/js/starred/star","metaserver/static/js/starred/store","metaserver/static/js/starred/redux/store","metaserver/static/js/starred/redux/slice","metaserver/static/js/starred/redux/selectors"],(function(e,t,s,r,a,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStarredBoolObject=t.getIsStarred=t.getStarredFileIds=t.getStarredState=t.updateStarredStatus=t.fetchMissingStarredStatuses=t.getStoreForStarred=t.StarredStore=t.Star=t.itemNameFromStarrableItem=t.idTypePairFromStarrableItem=t.StarredSource=t.checkForMissingStarredData=t.StarredActions=t.HOME_RESOURCE_ID_TYPE=void 0,Object.defineProperty(t,"HOME_RESOURCE_ID_TYPE",{enumerable:!0,get:function(){return s.HOME_RESOURCE_ID_TYPE}}),Object.defineProperty(t,"StarredActions",{enumerable:!0,get:function(){return r.StarredActions}}),Object.defineProperty(t,"checkForMissingStarredData",{enumerable:!0,get:function(){return a.checkForMissingStarredData}}),Object.defineProperty(t,"StarredSource",{enumerable:!0,get:function(){return i.StarredSource}}),Object.defineProperty(t,"idTypePairFromStarrableItem",{enumerable:!0,get:function(){return n.idTypePairFromStarrableItem}}),Object.defineProperty(t,"itemNameFromStarrableItem",{enumerable:!0,get:function(){return n.itemNameFromStarrableItem}}),Object.defineProperty(t,"Star",{enumerable:!0,get:function(){return o.Star}}),Object.defineProperty(t,"StarredStore",{enumerable:!0,get:function(){return l.StarredStore}}),Object.defineProperty(t,"getStoreForStarred",{enumerable:!0,get:function(){return c.getStoreForStarred}}),Object.defineProperty(t,"fetchMissingStarredStatuses",{enumerable:!0,get:function(){return d.fetchMissingStarredStatuses}}),Object.defineProperty(t,"updateStarredStatus",{enumerable:!0,get:function(){return d.updateStarredStatus}}),Object.defineProperty(t,"getStarredState",{enumerable:!0,get:function(){return u.getStarredState}}),Object.defineProperty(t,"getStarredFileIds",{enumerable:!0,get:function(){return u.getStarredFileIds}}),Object.defineProperty(t,"getIsStarred",{enumerable:!0,get:function(){return u.getIsStarred}}),Object.defineProperty(t,"getStarredBoolObject",{enumerable:!0,get:function(){return u.getStarredBoolObject}})})),define("metaserver/static/js/clean/mobile_tracker",["require","exports","tslib","metaserver/static/js/core/browser","metaserver/static/js/core/uri"],(function(e,t,s,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMobileTrackerCampaignParams=void 0,r=s.__importStar(r);const i=["src","campaign","adgroup","creative"];t.getMobileTrackerCampaignParams=function(){const e=a.URI.parse(r.get_href()).getQuery(),t={};for(const s in e)i.includes(s)&&(t[s]=e[s]);return t}})),define("metaserver/static/js/browse/file_actions/action_handlers",["require","exports","tslib","metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/browse/file_actions/actions/download","metaserver/static/js/clean/browse_interface","metaserver/static/js/filepath/filepath","metaserver/static/js/action_bar/file_actions/portable/go_to_folder","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/actions","metaserver/static/js/browse/actions_navigate","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/folder_overview_selectors","metaserver/static/js/browse/data/store","metaserver/static/js/browse/data/types","metaserver/static/js/browse/file_actions/file_action_helpers","metaserver/static/js/browse/models","metaserver/static/js/file_lock/api","metaserver/static/js/file_transfers/async/browse_entry_point_onboarding_modal_async","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/store","metaserver/static/js/files_view/types","metaserver/static/js/folder_overview/async_components","metaserver/static/js/folder_overview/data/action_creators","metaserver/static/js/folder_overview/data/store","metaserver/static/js/folder_overview/utils","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/starred/browse_exports","metaserver/static/js/search/single_page/data/action_creators/file_actions","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/data/types","metaserver/static/js/sharing/browse_exports","metaserver/static/js/unity/features","metaserver/static/js/clean/viewer","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/file_viewer/constants","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/user_survey/user_survey","metaserver/static/js/browse/data/selectors","metaserver/static/js/file_store/utils","metaserver/static/js/file_transfers/lib/urls","metaserver/static/js/sync_everything/constants","metaserver/static/js/starred/redux/slice","metaserver/static/js/dropbox/proto/pap_events/organize/finish_browse_time_to_success","metaserver/static/js/browse_tts/browse_tts"],(function(e,t,s,r,a,i,n,o,l,c,d,u,p,m,h,f,_,g,b,y,v,E,S,w,M,k,N,A,I,C,R,T,F,x,L,O,P,j,D,U,B,q,W,V,K,H,G,z,Q,X){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleSendForSignature=t.handleShowInFolder=t.handleShareCopyLink=t.handleOpenInDesktop=t.handleOpenInDesktopWithoutStandardHandlers=t.handlePreview=t.handleOpenInNewTab=t.handleReplay=t.handleAddToTransfer=t.handleReAdd=t.handleRewind=t.handleExtensionClick=t.handleExtensionDropdownOpen=t.handleUnstar=t.handleStar=t.handlePermanentDelete=t.handleRestore=t.handleBackupDeleteDeviceFolder=t.handleDelete=t.handleUnpin=t.handleBrowsePinTo=t.handleBrowsePin=t.handleManageAsAdmin=t.handleCalculateFolderSize=t.handleEvents=t.handleVersions=t.handleFileRequestUnlock=t.handleFileUnlock=t.handleFileLock=t.handleArchive=t.handleRenameTeamFolder=t.handleComment=t.handleDownload=t.handleRename=t.handleRequestFiles=void 0,o=s.__importStar(o),c=s.__importStar(c),d=s.__importStar(d),h=s.__importStar(h),y=s.__importStar(y),E=s.__importStar(E),k=s.__importStar(k),R=s.__importStar(R),T=s.__importStar(T),U=s.__importStar(U),z=s.__importStar(z);var Y=Q.pap_events.organize.Finish_BrowseTimeToSuccess.BrowseTtsEventName;function $(e,t){const s=e.files.first();(0,C.getStoreForStarred)().dispatch(z.updateStarredStatus({id:s.file_id,newStatus:t,itemName:(0,C.itemNameFromStarrableItem)(s),showSnackbar:!0}))}function J(e,t,s,r=!0){var a,i;(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.OPEN_DESKTOP});const n=e.files.first(),o=n?n.ns_id:null===(a=e.context)||void 0===a?void 0:a.currentNSID,l=n?n.ns_path:null===(i=e.context)||void 0===i?void 0:i.currentNSPath;O.UnityFeatures.open_file(o||null,l||"/",e.user.id,t,s,r)}t.handleRequestFiles=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.REQUEST_FILES_CLICK});const{ns_id:t,ns_path:s}=e.files.first();U.redirect(`/requests?ns_id=${t}&path=${s}&referrer=web_browse_file_action`)},t.handleRename=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.RENAME}),(0,S.getStoreForFilesView)().dispatch(E.setFileRename({file:e.files.first(),renameState:w.RenameState.PENDING_INPUT}))},t.handleDownload=function(e,t){(0,X.logBrowseTTS)(Y.DOWNLOAD_FILE_BROWSE_TTS_EVENT_NAME),(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.DOWNLOAD});const{user:s,files:r}=e;(0,i.downloadFiles)({files:r,context:t,user:s,source:e.isSearchMode?"search":"browse",root_ns_id:(0,G.isBackupBrowse)()&&t.rootNSID?t.rootNSID:void 0}),W.UserSurvey.trackEvent("download_item","browse")},t.handleComment=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.ADD_COMMENT});const t=e.files.first();t instanceof b.FileSharedWithMe?U.redirect(t.href):e.isSearchMode?(0,F.getStoreForSearch)().dispatch(T.setPreviewFile({previewFileId:t.file_id})):p.browseNavigateActions.navigateToFileOrFolder({file:t,shouldFocusComment:!0})},t.handleRenameTeamFolder=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.RENAME_TEAM_FOLDER}),c.showContentManagerBridge(e.files.toArray(),"rename",P.Viewer.get_viewer().team_is_limited)},t.handleArchive=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.ARCHIVE}),c.showContentManagerBridge(e.files.toArray(),"archive",P.Viewer.get_viewer().team_is_limited)},t.handleFileLock=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.LOCK_FILE}),y.showFileLockConfirmModal(e.user.id,e.files.first())},t.handleFileUnlock=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.UNLOCK_FILE}),y.asyncUnlockFile(e.user.id,[e.files.first()])},t.handleFileRequestUnlock=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.REQUEST_UNLOCK_FILE}),y.showRequestUnlockConfirmModal(e.user.id,e.files.first())},t.handleVersions=function(e){var t,s;(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.VERSIONS});const r=(0,G.isBackupBrowse)()&&(null===(t=e.context)||void 0===t?void 0:t.rootNSID)?{inside_backup:"true",ns_id:`${null===(s=e.context)||void 0===s?void 0:s.rootNSID}`,return_url:U.get_href()}:{},a=(0,n.getFileHistoryUrl)({fqPath:e.files.first().fq_path,userId:e.user.id},r);U.redirect(a)},t.handleEvents=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.EVENTS}),U.redirect(`/events?ns=${e.files.first().target_ns}`)},t.handleCalculateFolderSize=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.CALCULATE_SIZE});const{files:t}=e;u.browseActions.fetchMultipleFolderSizes({files:t})},t.handleManageAsAdmin=function(t){new Promise((t,s)=>{e(["metaserver/static/js/sharing/content_manager"],t,s)}).then(s.__importStar).then(({goToContentManagerForPath:e})=>{const s=t.files.first();e({containingFolder:s.is_dir?s.fq_path:o.parent_dir(s.fq_path)})})},t.handleBrowsePin=function(e,{snackbarWithShowButton:t}){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN});const s=(0,N.getStoreForFolderOverview)(),r=(0,V.path)(s.getState());s.dispatch(k.addContentReferences({folderFileId:h.folderOverviewFolderFileId(s.getState()),fileIds:e.files.toArray().map(A.fileToContentReferenceId),componentNamespace:m.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{u.browseActions.setUrl({path:r,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(r,P.Viewer.get_root_name(e.user))}:void 0}))},t.handleBrowsePinTo=function(e,t,{snackbarWithShowButton:s}){const{files:r,user:a}=e;(0,M.asyncShowPinToModal)({user:a,path:t.currentFQPath,files:r.toArray(),onFolderSelected:i=>{(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN}),(0,N.getStoreForFolderOverview)().dispatch(k.addContentReferencesForPath({files:r.toArray(),path:i,currentPath:t.currentFQPath,snackbarConfig:s?{onShow:()=>{u.browseActions.setUrl({path:i,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(i,P.Viewer.get_root_name(a))}:void 0}))},isCurrentPathReadOnly:!t.isCurrentPathWriteable()})},t.handleUnpin=function(e,t){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN});const s=(0,N.getStoreForFolderOverview)(),r=(0,V.path)(s.getState());s.dispatch(k.removeContentReferences({folderFileId:h.folderOverviewFolderFileId(s.getState()),fileIds:e.files.toArray().map(A.fileToContentReferenceId),componentNamespace:m.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{u.browseActions.setUrl({path:r,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:o.filename(r,P.Viewer.get_root_name(e.user))}:void 0}))},t.handleDelete=function(e,t){(0,X.logBrowseTTS)(Y.DELETE_FILE_BROWSE_TTS_EVENT_NAME),(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.DELETE}),W.UserSurvey.trackEvent("delete_item","browse");const s=e.files.toArray(),r=s.some(b.File.isTeamSharedFolder),a=s.some(e=>e.read_only),i=s.every(e=>e.isDeleted);if(!t.isCurrentPathWriteable()||r||a)r?q.Notify.error(B.intl.formatMessage({id:"AjarNz",defaultMessage:"Team folders can’t be deleted."})):q.Notify.warning(B.intl.formatMessage({id:"q5LxGC",defaultMessage:"You don’t have permission to delete files in this folder."}));else if(e.isSearchMode){const r=(0,F.getStoreForSearch)();i?r.dispatch(T.purgeFiles({files:s,user:e.user,context:t})):r.dispatch(R.deleteFiles({files:s}))}else i?u.browseActions.doPermanentDeleteWithModal(s):u.browseActions.doDeleteFilesWithModal({files:s})},t.handleBackupDeleteDeviceFolder=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.DELETE_DEVICE_FOLDER});const t=e.files.map(e=>e.fq_path).toArray();u.browseActions.openBackupDeleteDeviceFolderModal(t)},t.handleRestore=function(e,t){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.RESTORE});const s=e.files.toArray();if(e.isSearchMode){(0,F.getStoreForSearch)().dispatch(T.restoreFiles({files:s,user:e.user,context:t}))}else u.browseActions.doRestoreFilesWithUnifiedTrashModal({files:s})},t.handlePermanentDelete=function(e,t){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.PERMANENT_DELETE});const s=e.files.toArray();if(e.isSearchMode){(0,F.getStoreForSearch)().dispatch(T.purgeFiles({files:s,user:e.user,context:t}))}else u.browseActions.doPermanentDeleteWithModal(s)},t.handleStar=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.STAR}),$(e,!0)},t.handleUnstar=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.REMOVE_STAR}),$(e,!1)},t.handleExtensionDropdownOpen=function(e,t){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.OPEN_EXTENSIONS,action_surface:t})},t.handleExtensionClick=function(e,t,s){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.EXTENSIONS_SELECTED,action_surface:t,extra:{extensions_option:s||"unknown"}})},t.handleRewind=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.REWIND_CLICK});const t=(0,n.browse_uri_for_fq_path)(e.user,e.files.first().fq_path);t.setQuery({rewind:"true"}),U.replace_location(t.toString())},t.handleReAdd=function(e,t){const s=e.files.first().target_ns;s?((0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK}),(0,L.asyncMountSharedFolder)({shared_folder_id:s,origin:a.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,should_redirect:!1,target_file:null,user:e.user})):(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK,extra:{error:"No nsId found, no-op"}})},t.handleAddToTransfer=function(e){(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.ADD_TO_TRANSFER}),(0,v.asyncShowBrowseEntryPointOnboardingModal)({primaryActionOnClick:()=>{const t=e.files.toArray(),s=(0,H.prepareFileIdsParam)(t);I.Snackbar.sync(B.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer");let r="browse";e.actionSurface&&(r=`browse_${e.actionSurface}`,e.actionSurface===j.ActionSurfaceLogValue.RIGHT_SIDEBAR&&1===t.length?r=`browse_${e.actionSurface}_single_file`:e.actionSurface===j.ActionSurfaceLogValue.RIGHT_SIDEBAR&&t.length>1&&(r=`browse_${e.actionSurface}_multi_file`)),U.redirect((0,H.createTransferUrlWithParams)({referrer:r,fileids:s}))},userId:e.user.id})},t.handleReplay=function(e){const{files:t}=e,s=t.first(),{file_id:r}=s;U.unsafeRedirect(`https://replay.dropbox.com/project/creating/${r}?creationSource=dropbox_web`)},t.handleOpenInNewTab=function(e){(0,X.logBrowseTTS)(Y.OPEN_IN_NEW_TAB_BROWSE_TTS_EVENT_NAME);const{files:t,user:s}=e,r=t.first();let a;a=r.is_dir?(0,n.browse_uri_for_fq_path)(s,r.fq_path):(0,n.preview_uri_for_fq_path)(s,r.fq_path),window.open(a.toString(),"_blank")},t.handlePreview=function(e,t){(0,X.logBrowseTTS)(Y.PREVIEW_DROPBOX_BROWSE_TTS_EVENT_NAME);const{files:s,user:r,rightRailState:a}=e,i=s.first();if(e.isSearchMode){(0,F.getStoreForSearch)().dispatch(T.handleNavigateToFileOrFolder(i,{actionSource:t}))}else{const{ns_id:s,sjid:n,file_id:l,fq_path:c,bytes:u,ext:m,request_id:h}=i;d.logOpenRow({uid:r.id,entity_type:i.is_dir?"folder":"file",source:"list_browse",view_type:e.viewType,file_nsid:s,file_sjid:n,file_id:l,file_name:o.filename(i.fq_path),file_path:c,file_size:u,file_type:i.type,file_extension:m,request_id:h,action_source:t,rightRailState:a}),t===j.ActionSourceValue.DETAILS_PANE_PREVIEW&&d.logBrowseAction({uid:r.id,num_files_selected:1,num_folders_selected:0,action:j.WebUserActionLogEvent.THUMBNAIL_OPEN_PREVIEW,action_surface:j.ActionSurfaceLogValue.RIGHT_SIDEBAR,right_sidebar_state:"opened"}),p.browseNavigateActions.openPreviewForBrowseFile({file:i,shouldFocusComment:!1,user:r,fileViewOrigin:D.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{}})}},t.handleOpenInDesktopWithoutStandardHandlers=J,t.handleOpenInDesktop=function(e,t,s,r){(0,X.logBrowseTTS)(Y.OPEN_IN_FINDER_BROWSE_TTS_EVENT_NAME),J(e,e=>(t&&t(e),O.UnityFeatures.standard_open_file_handler(e)),e=>{s&&s(e),O.UnityFeatures.standard_open_file_handler(!1)},r)},t.handleShareCopyLink=function(e,t,s,a,i){(0,X.logBrowseTTS)(Y.COPY_LINK_BROWSE_TTS_EVENT_NAME),(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.SHARE_COPY_LINK});const n=e.isSearchMode?(0,F.getStoreForSearch)():(0,f.getStoreForBrowse)(),{expCopyLinkInRightRail:o}=(0,V.browsePostTTIExperiments)(n.getState());r.CopyLinkMiniModal.show({user:e.user,file:e.files.first()||e.currentFolderInfo,setIsCreatingSharedLink:(t,s)=>{n.dispatch({type:e.isSearchMode?x.ActionTypes.SET_IS_CREATING_SHARED_LINK:_.ActionTypes.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:s,isCreatingSharedLink:t}})},userActionSource:e.actionSource,anchorRef:t,onHoverLocked:s,onActionFlowComplete:a,userActionSurfaceLogValue:e.actionSurface,rightRailCollapsed:"collapsed"===e.rightRailState,isInCopyLinkRightRailExpt:"ON"===o,isInUserLevelSharingSettings:"ON"===i})},t.handleShowInFolder=function(e){const{user:t,files:s}=e,r=s.map(e=>e.fq_path).toArray();(0,g.logUserEventOnFile)({args:e,action_type:j.WebUserActionLogEvent.SHOW_IN_FOLDER}),(0,l.handleShowInFolder)({fqPaths:r,user:t})},t.handleSendForSignature=function(t,r){const{files:a,user:i}=t,n=a.first();return n&&(0,K.isBrowseFile)(n)&&i?new Promise((t,s)=>{e(["metaserver/static/js/integrations/hellosign_deep_integration/launcher"],t,s)}).then(s.__importStar).then(({getLauncher:e})=>{const s=e();return s.init({entryPoint:r?"file_hover_overflow_menu_self_sign":"file_hover_overflow_menu",file:n,user:i,source:r?"dropbox-file-hover-overflow-menu-send-for-self-sign":"dropbox-file-hover-overflow-menu-send-for-esign",selfSign:r}),(0,g.logUserEventOnFile)({args:t,action_type:r?j.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT:j.WebUserActionLogEvent.SEND_FOR_SIGNATURE}),s}).then(e=>(e.launch(),e)):Promise.resolve()}})),define("metaserver/static/js/browse/file_actions/actions/download",["require","exports","tslib","metaserver/static/js/clean/downloads","metaserver/static/js/browse/models","metaserver/static/js/action_bar/file_actions/portable/download","metaserver/static/js/sync_everything/constants"],(function(e,t,s,r,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadFiles=void 0,r=s.__importStar(r),t.downloadFiles=function({files:e,context:t,user:o,source:l,root_ns_id:c}){return s.__awaiter(this,void 0,void 0,(function*(){if(1===e.count()&&!e.first().is_dir&&!(0,n.isUnmountedBackupBrowse)(o,c)){const t=e.first();return void(0,i.downloadSingleFile)({href:t.href,source:l,isFswm:t instanceof a.FileSharedWithMe})}if(!t.blockHash)return;const s=t.currentFQPath,d=e.toArray().map(e=>e.fq_path);r.get_zip({fq_paths:d,subject_uid:o.id,block_hash:t.blockHash,parent_path:s,source:`${l}_zip`,root_ns_id:c})}))}})),define("metaserver/static/js/browse/file_actions/file_action_helpers",["require","exports","tslib","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/logger_util","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/browse/models"],(function(e,t,s,r,a,i,n,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserEventOnFile=void 0,r=s.__importStar(r),a=s.__importStar(a),i=s.__importStar(i),t.logUserEventOnFile=function({args:e,action_type:t,action_source:s,action_surface:d,extra:u}){var p;const{user:m,files:h,isSearchMode:f,source:_,viewType:g,isSidebar:b}=e,{num_files_selected:y,num_folders_selected:v}=a.countFilesAndFolders(h),E=e.actionSurface?e.actionSurface:d||(b?l.ActionSurfaceLogValue.RIGHT_SIDEBAR:l.ActionSurfaceLogValue.OVERFLOW_MENU),S=e.actionSource?e.actionSource:s,w=h.first();f?(0,o.logResultAction)(t,i.resultsList((0,n.getStoreForSearch)().getState()),w,E,S,Object.assign(Object.assign({},u),{num_files_selected:y.toString(),num_folders_selected:v.toString(),right_sidebar_state:null!==(p=e.rightRailState)&&void 0!==p?p:null})):w instanceof c.FileSharedWithMe||r.logBrowseAction({uid:m.id,source:_,action:t,num_files_selected:y,num_folders_selected:v,view_type:g,result:w,action_surface:E,action_source:S,right_sidebar_state:e.rightRailState,extra:u})}})),define("metaserver/static/js/action_bar/file_actions/portable/download",["require","exports","tslib","metaserver/static/js/clean/downloads","metaserver/static/js/share_download/ui/api","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/filepath/filepath"],(function(e,t,s,r,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.downloadSingleFileAsZip=t.downloadSingleFile=void 0,r=s.__importStar(r),n=s.__importStar(n);t.downloadSingleFile=({href:e,source:t,isFswm:n=!1},{onAttempt:o,onSuccess:l,onError:c}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){null==o||o();const s=n?yield(0,a.fetchDownloadUrl)(e,void 0,i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE):e;r.get({url:s,source:`${t}_direct`,error:c}),null==l||l()}));t.downloadSingleFileAsZip=({fqPath:e,rootNsId:t,source:a,blockHash:i,user:o},{onAttempt:l,onSuccess:c}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){null==l||l(),r.get_zip({fq_paths:[e],subject_uid:o.id,block_hash:i,parent_path:n.parent_dir(e),source:a,root_ns_id:t}),null==c||c()}))})),define("metaserver/static/js/action_bar/file_actions/portable/go_to_folder",["require","exports","tslib","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/browse_interface"],(function(e,t,s,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areConsistentParents=t.handleShowInFolder=void 0,r=s.__importStar(r);t.handleShowInFolder=({fqPaths:e,user:t})=>{if(0===e.length)return;const s=e.map(e=>r.filename(e)),i=r.parent_dir(e[0]),n=(0,a.browse_uri_for_fq_path)(t,i);s.length>1?n.updateQuery({select_multi:JSON.stringify(s)}):n.updateQuery({select:s[0]}),window.open(n.toString(),"_blank")};t.areConsistentParents=e=>{if(0===e.length)return!1;const t=r.parent_dir(e[0]);for(let s=1;s<e.length;s++)if(r.parent_dir(e[s])!==t)return!1;return!0}})),define("metaserver/static/js/file_lock/api",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/browse/models","metaserver/static/js/core/i18n","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/components/modals/show_modal","metaserver/static/js/locked_files/view/modals/lock_confirm_modal","metaserver/static/js/locked_files/view/modals/request_unlock_confirm_modal","metaserver/static/js/filepath/filepath","js/browser/cookies"],(function(e,t,s,r,a,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showRequestUnlockConfirmModal=t.showFileLockConfirmModal=t.asyncRequestUnlockFile=t.asyncUnlockFile=t.asyncLockFile=t.showFeedbackForFileLockAction=t.unlockFailureString=t.unlockSuccessString=void 0,d=s.__importStar(d);function p(){return i.intl.formatMessage({id:"uGHYAs",defaultMessage:"Unlocked editing. Any one else with access can edit again."})}function m(){return i.intl.formatMessage({id:"v/COiN",defaultMessage:"Unlocking editing failed."})}function h(e){return{entries:e.map(e=>({path:e.fq_path}))}}function f(e){return e.result.then(t=>t.entries&&t.entries.length>0&&t.entries.every(e=>"success"===e[".tag"])?(n.Snackbar.complete(e.onSuccessMsg(t),"file-lock-status"),Promise.resolve()):Promise.reject()).catch(()=>(n.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject()))}function _(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(new r.UserApiV2Client).ns("files").rpc("lock_file_batch",h(t),{subjectUserId:e});yield f({result:s,onSuccessMsg:e=>i.intl.formatMessage({id:"nv3jy/",defaultMessage:"Editing locked. Now only you can make changes."}),onFailMsg:i.intl.formatMessage({id:"MmwXT2",defaultMessage:"Locking editing failed."})})}))}function g(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=a.File.getFilename(t[0]),n=t[0].lockholder_name,o=(new r.UserApiV2Client).ns("files").rpc("request_unlock_file_batch",h(t),{subjectUserId:e});yield f({result:o,onSuccessMsg:e=>{const t=e.entries[0];return t.lock&&t.lock.content&&"unlocked"===t.lock.content[".tag"]?p():i.intl.formatMessage({id:"im3MR+",defaultMessage:"Asked {name} to unlock {filename}"},{filename:s,name:n})},onFailMsg:i.intl.formatMessage({id:"i/KiYl",defaultMessage:"Error asking {name} to unlock {filename}"},{filename:s,name:n})})}))}t.unlockSuccessString=p,t.unlockFailureString=m,t.showFeedbackForFileLockAction=f,t.asyncLockFile=_,t.asyncUnlockFile=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(new r.UserApiV2Client).ns("files").rpc("unlock_file_batch",h(t),{subjectUserId:e});yield f({result:s,onSuccessMsg:e=>p(),onFailMsg:m()})}))},t.asyncRequestUnlockFile=g,t.showFileLockConfirmModal=function(e,t){const s=()=>{_(e,[t])},r=()=>{u.Cookies.create("do_not_show_lock_confirmation_dialog","true",365)};"true"===u.Cookies.read("do_not_show_lock_confirmation_dialog")?s():(0,o.showModal)((0,l.FileLockConfirmModal)({filename:d.filename(t.fq_path),onLock:s,onNeverShowAgain:r}))},t.showRequestUnlockConfirmModal=function(e,t){void 0!==t.ts_locked&&void 0!==t.lockholder_name?(0,o.showModal)((0,c.RequestUnlockConfirmModal)({lockCreatedTime:t.ts_locked,lockholderName:t.lockholder_name,onRequestUnlock:()=>{g(e,[t])}})):n.Snackbar.fail(i.intl.formatMessage({id:"LDj5Eu",defaultMessage:"Could not ask to unlock. Please try again later."}),"file-lock-status")}})),define("metaserver/static/js/locked_files/view/modals/lock_confirm_modal",["require","exports","tslib","react","react-intl","spectrum/modal/index","metaserver/static/js/core/i18n","metaserver/static/js/ux_analytics/utils","metaserver/static/js/clean/ux_analytics_modal_tracking","metaserver/static/js/core/browser","spectrum/checkbox/index","metaserver/static/js/components/ui/css"],(function(e,t,s,r,a,i,n,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileLockConfirmModal=t.FileLockConfirmModalWithCSS=void 0,r=s.__importDefault(r),c=s.__importStar(c);class p extends r.default.Component{constructor(e){super(e),this.onClickCheckbox=()=>{this.setState({checkboxMarked:!this.state.checkboxMarked})},this.onRequestClose=()=>{this.setState({isModalOpen:!1}),(0,o.dispatchModalClosed)()},this.onRequestLock=()=>{this.props.onLock(),this.state.checkboxMarked&&this.props.onNeverShowAgain()},this.state={checkboxMarked:!1,isModalOpen:!0}}render(){const e=n.intl.formatMessage({id:"cRptek",defaultMessage:"Lock editing for this file?"}),t=(0,a.defineMessage)({id:"dBZbCY",defaultMessage:"Only you can make changes to <st>{path}</st> while editing is locked. Anyone else with access to the file can still view it."}),s=n.intl.formatMessage({id:"iR68zV",defaultMessage:"Lock"}),u=n.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),p=n.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),m=n.intl.formatMessage({id:"s0mqEc",defaultMessage:"Don’t ask me this again"});return r.default.createElement(i.UtilityModal,{title:e,primaryAction:s,onReady:o.dispatchModalOpened,onPrimaryAction:this.onRequestLock,secondaryAction:u,onRequestClose:this.onRequestClose,ariaLabel:e,open:this.state.isModalOpen,shouldFocusAfterRender:!0,link:p,onLink:()=>{c.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},r.default.createElement(l.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),n.intl.formatMessage(t,{st:e=>r.default.createElement("strong",null,e),path:this.props.filename}),r.default.createElement("div",{className:"checkbox-with-label"},r.default.createElement(d.Checkbox,{checked:this.state.checkboxMarked?"checked":"unchecked",onChange:this.onClickCheckbox,id:"accept-checkbox"}),r.default.createElement("label",{className:"checkbox-with-label-label",htmlFor:"accept-checkbox"},r.default.createElement("div",null,m))))}}p.displayName="FileLockConfirmModalBase",t.FileLockConfirmModalWithCSS=(0,u.requireCssWithComponent)(p,["/static/metaserver/static/css/file_locking/file_locking_modal-vflDp2_5Q.css"]);t.FileLockConfirmModal=({filename:e,onLock:s,onNeverShowAgain:a})=>r.default.createElement(t.FileLockConfirmModalWithCSS,{onLock:s,onNeverShowAgain:a,filename:e})})),define("metaserver/static/js/locked_files/view/modals/request_unlock_confirm_modal",["require","exports","tslib","react","react-intl","spectrum/modal/index","metaserver/static/js/core/i18n","metaserver/static/js/datetime/datetime","metaserver/static/js/ux_analytics/utils","metaserver/static/js/clean/ux_analytics_modal_tracking","metaserver/static/js/core/browser"],(function(e,t,s,r,a,i,n,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestUnlockConfirmModal=void 0,r=s.__importDefault(r),d=s.__importStar(d);const u=e=>()=>{e(),(0,l.dispatchModalClosed)()};t.RequestUnlockConfirmModal=({lockCreatedTime:e,lockholderName:t,onRequestUnlock:s})=>{const p=n.intl.formatMessage({id:"yd0RsA",defaultMessage:"Editing is locked for this file"}),m=(0,a.defineMessage)({id:"iRKebb",defaultMessage:"{lockholder_name} temporarily locked editing for this file {ago}. You can view it while it’s locked, or ask them to unlock it."}),h=n.intl.formatMessage({id:"PMI4xl",defaultMessage:"Ask to unlock"}),f=n.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),_=n.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),g=1e3*Number(e),b=(0,o.agoFromDate)(new Date(g),new Date);return r.default.createElement(i.UtilityModal,{title:p,primaryAction:h,onReady:l.dispatchModalOpened,onPrimaryAction:u(s),secondaryAction:f,onRequestClose:l.dispatchModalClosed,ariaLabel:p,open:!0,shouldFocusAfterRender:!0,link:_,onLink:()=>{d.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},r.default.createElement(c.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),n.intl.formatMessage(m,{lockholder_name:t,ago:b}))}})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/flow_steps",["require","exports","tslib","jquery","react","dig-components/buttons","dig-components/text_fields","dig-components/controls","metaserver/static/js/account_page/widgets/two_step_verification/modals/phone_input","metaserver/static/js/account_page/widgets/two_step_verification/modals/twofactor_api","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/api_v2/user_client","metaserver/static/js/auth/authenticator","metaserver/static/js/clean/ui/image","metaserver/static/js/clean/ui/input_dig","metaserver/static/js/components/ui/modal_controller","metaserver/static/js/clean/ui/modal_dig","metaserver/static/js/clean/static_urls","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","jquery.qrcode"],(function(e,t,s,r,a,i,n,o,l,c,d,u,p,m,h,f,_,g,b,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevokeAllTrustedDevicesModal=t.SecurityKeyRegisterModal=t.SecurityKeyIntroModal=t.FinishTwofactorDisableModal=t.FinishTwofactorEnableModal=t.EditRecoveryCodesModal=t.ViewRecoveryCodesModal=t.BackupPhoneModal=t.ConfirmDeliveryModal=t.SetupOfflineModal=t.EnterPhoneModal=t.fetchPhoneNumberConstants=t.ChooseDeliveryModal=t.ConfirmPasswordModal=t.StartModal=void 0,r=s.__importDefault(r),a=s.__importDefault(a),c=s.__importStar(c),p=s.__importStar(p),h=s.__importStar(h),f=s.__importStar(f);const v=h.password,E=b.intl.formatMessage({id:"fvZIUX",defaultMessage:"Sorry, an error occurred. Please try again later."});class S extends a.default.Component{render(){const e=this.props.acceptButtonText||b.intl.formatMessage({id:"vJgZg+",defaultMessage:"Next"});let t,s=void 0;return this.props.dismissOptions&&(t=this.props.dismissOptions.text,s=e=>{-1!==e.currentTarget.className.indexOf("dbmodal-button")&&(e.preventDefault(),this.props.dismissOptions.onDismiss())}),a.default.createElement(_.Modal,{acceptButtonText:null===this.props.onAccept?null:e,autoClose:!1,onAccept:this.props.onAccept,onDismiss:s,title:this.props.title,submitting:this.props.submitting,id:this.props.id,className:this.props.className,dismissButtonText:t,helpLink:this.props.helpLink,onShow:this.props.onShow},a.default.createElement("div",{className:"twofactor-account-form"},this.props.children,this.props.errorText&&a.default.createElement("div",{className:"error-message"},this.props.errorText)))}}S.displayName="ModalStepModal";class w extends a.default.Component{render(){return a.default.createElement(S,{id:"twofactor-start",onAccept:this.props.onConfirm,title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"kOQNUE",defaultMessage:"Get started"}),helpLink:a.default.createElement("a",{className:"learn-more",href:"https://www.dropbox.com/help/363",target:"_blank",rel:"noreferrer"},b.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}))},a.default.createElement("p",null,b.intl.formatMessage({id:"EIHDne",defaultMessage:"Two-step verification adds an extra layer of protection to your account. Whenever you sign in to the Dropbox website or link a new device, you’ll need to enter both your password and also a security code sent to your mobile phone."})))}}t.StartModal=w,w.displayName="StartModal";class M extends a.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.confirmPassword(this.props.user.id,this.state.password,this.props.context);if(this.setState({submitting:!1}),"success"===e.type)this.props.onSuccessfulPassword(e.checkpointToken);else if("error"===e.type)switch(e.error){case"INVALID":this.setState({error:b.intl.formatMessage({id:"l/9ohN",defaultMessage:"Invalid password"})})}else this.setState({unexpectedError:E})})),this.setPassword=e=>this.setState({password:e.currentTarget.value}),this.state={password:"",submitting:!1}}render(){return a.default.createElement(S,{id:"twofactor-enter-password",onAccept:this.onAccept,title:this.props.title,submitting:this.state.submitting,errorText:this.state.unexpectedError},a.default.createElement("p",null,b.intl.formatMessage({id:"+HVGgM",defaultMessage:"For security, please enter your password for {email}."},{email:this.props.user.email})),a.default.createElement(v,{id:"password",value:this.state.password,variant:"small",onChange:this.setPassword,error:void 0===this.state.error?void 0:{message_text:this.state.error},placeholder:b.intl.formatMessage({id:"i+PJQ7",defaultMessage:"Password"})}))}}t.ConfirmPasswordModal=M,M.displayName="ConfirmPasswordModal";class k extends a.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.state.usePhoneDelivery)this.props.onSelectionConfirmed({type:"phone"});else{this.setState({submitting:!0});const e=yield c.fetchOfflineKey(this.props.user.id,this.props.checkpointToken);this.setState({submitting:!1}),"success"===e.type?this.props.onSelectionConfirmed({type:"offline",offlineKey:e.b32EncodedKey}):"error"===e.type?this.props.onPasswordExpired():this.setState({unexpectedError:E})}})),this.state={usePhoneDelivery:!0,submitting:!1}}render(){const e=e=>()=>{this.setState({usePhoneDelivery:e})};return a.default.createElement(S,{title:this.props.title,submitting:this.state.submitting,onAccept:this.onAccept,id:"twofactor-delivery-choice",errorText:this.state.unexpectedError},a.default.createElement("p",null,a.default.createElement("b",null,b.intl.formatMessage({id:"6Ooe3V",defaultMessage:"How would you like to receive your security codes?"}))),a.default.createElement("div",{className:`delivery-choice ${this.state.usePhoneDelivery?"selected":""}`,id:"sms-choice"},a.default.createElement(o.RadioButton,{id:"use-sms",name:"delivery","aria-label":"Use SMS",checked:this.state.usePhoneDelivery,"aria-checked":this.state.usePhoneDelivery,onChange:e(!0),tabIndex:0}),a.default.createElement("label",{htmlFor:"use-sms"},a.default.createElement("strong",null,b.intl.formatMessage({id:"ribcyl",defaultMessage:"Use text messages"})),a.default.createElement("br",null),b.intl.formatMessage({id:"rkKFQh",defaultMessage:"Security codes will be sent to your mobile phone"}))),a.default.createElement("div",{className:`delivery-choice ${this.state.usePhoneDelivery?"":"selected"}`,id:"app-choice"},a.default.createElement(o.RadioButton,{id:"use-app",name:"delivery",type:"radio",checked:!this.state.usePhoneDelivery,"aria-checked":!this.state.usePhoneDelivery,onChange:e(!1),tabIndex:0}),a.default.createElement("label",{htmlFor:"use-app"},a.default.createElement("strong",null,b.intl.formatMessage({id:"gbLFmN",defaultMessage:"Use a mobile app"})),a.default.createElement("br",null),b.intl.formatMessage({id:"9W0BXd",defaultMessage:"Security codes will be generated by an authenticator app"}))))}}t.ChooseDeliveryModal=k,k.displayName="ChooseDeliveryModal";let N=[];function A(){return s.__awaiter(this,void 0,void 0,(function*(){try{return yield(0,d.WebRequest)({url:"/account/get_phone_input_data",dataType:"json"})}catch(e){return null}}))}t.fetchPhoneNumberConstants=A;const I=e=>{let t=[];if(e){const{country_list:s,phone_code_map:r}=e;t=s.map(e=>({countryCode:e[0],countryName:e[1],phoneCode:r[e[0]]}))}return t};class C extends a.default.Component{constructor(e){super(e),this.BAD_CARRIER=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.INVALID_NUMBER=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.NOTAMOBILE=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.UNREACHABLE=b.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isn’t supported at this time."}),this.RATE_LIMIT=b.intl.formatMessage({id:"O7BCIr",defaultMessage:"You’ve asked for too many SMS messages. Please try again in a few minutes."}),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.state.phoneNumber&&"success"===this.state.phoneNumber.type){this.setState({submitting:!0});const e=yield c.submitPhoneNumber(this.props.user.id,this.props.checkpointToken,this.state.phoneNumber.phoneNumber);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept({phoneNumber:this.state.phoneNumber.phoneNumber,phoneSig:e.phoneSig});else if("error"===e.type){const t=e=>{this.setState({unexpectedError:e})};switch(e.error){case"EXPIRED":this.props.onPasswordExpired();break;case"UNREACHABLE":t(this.UNREACHABLE);break;case"BADCARRIER":t(this.BAD_CARRIER);break;case"INVALIDNUMBER":t(this.INVALID_NUMBER);break;case"NOTAMOBILE":t(this.NOTAMOBILE);break;case"RATELIMIT":y.Notify.error(this.RATE_LIMIT)}}else this.setState({unexpectedError:E})}})),this.setPhoneNumber=e=>this.setState({phoneNumber:e}),this.state={submitting:!1,loadedUserConstants:N}}UNSAFE_componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===N.length){const e=yield A();if(e&&0===this.state.loadedUserConstants.length){const t=I(e);N=t,this.setState({loadedUserConstants:t})}}}))}render(){return a.default.createElement(S,{id:"twofactor-enter-phone",className:"twofactor-overflow",title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},a.default.createElement("p",{className:"subtitle"},b.intl.formatMessage({id:"HKKwpB",defaultMessage:"Enter your mobile phone number"})),a.default.createElement("p",null,b.intl.formatMessage({id:"NvAM7e",defaultMessage:"We’ll send a security code to this phone number whenever you sign in to the Dropbox website or link a new Device."})),a.default.createElement(l.PhoneInput,{onPhoneNumberInput:this.setPhoneNumber,isLoading:0===this.state.loadedUserConstants.length,countryList:this.state.loadedUserConstants}))}}t.EnterPhoneModal=C,C.displayName="EnterPhoneModal";class R extends a.default.Component{constructor(e){super(e),this.qrCodeContainer=a.default.createRef(),this.state={showBarcode:!0}}componentDidMount(){this.setupQrCode()}componentDidUpdate(){this.setupQrCode()}componentWillUpdate(e,t){this.clearQrCode()}setupQrCode(){const e=(0,r.default)(this.qrCodeContainer.current);e.empty();const t=this.parseB32Key(this.props.totpB32Secret,!1),s={text:`otpauth://totp/Dropbox:${this.props.user.email}?secret=${t}&issuer=Dropbox`,height:200,width:200},a=document.createElement("canvas"),i=!(!a.getContext||!a.getContext("2d"));i||(s.render="table"),e.qrcode(s).show(),i||e.children("table").css("margin","0 auto")}clearQrCode(){(0,r.default)(this.qrCodeContainer.current).empty()}parseB32Key(e,t){const s=e.replace(new RegExp("=+$"),"");return t?s.toLowerCase().replace(/(.{4})/g,"$1 "):s}render(){const e=e=>()=>{this.setState({showBarcode:e})};return a.default.createElement(S,{title:this.props.title,onAccept:this.props.onAccept,id:"twofactor-offline-setup",dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss},onShow:()=>this.setupQrCode()},a.default.createElement("p",null,b.intl.formatMessage({id:"u09i+4",defaultMessage:"An authenticator app lets you generate security codes on your phone without needing to receive text messages. If you don’t already have one, we support any of <a>these apps</a>."},{a:e=>a.default.createElement("a",{href:"https://www.dropbox.com/help/363#2fa-apps",rel:"noopener noreferrer",target:"_blank"},e)})),a.default.createElement("p",null,b.intl.formatMessage({id:"b+PDmn",defaultMessage:"To configure your authenticator app:"})),a.default.createElement("ul",{className:"blue-bullets"},a.default.createElement("li",null,b.intl.formatMessage({id:"bKmf0p",defaultMessage:"Add a new time-based token."})),this.state.showBarcode?a.default.createElement("li",null,b.intl.formatMessage({id:"+kJxW6",defaultMessage:"Use your app to scan the barcode below, or <button>enter your secret key manually</button>."},{button:t=>a.default.createElement(i.Button,{variant:"transparent",onClick:e(!1)},t)})):a.default.createElement("li",null,b.intl.formatMessage({id:"LzEh8h",defaultMessage:"Enter the secret key below, or <button>scan a barcode instead</button>."},{button:t=>a.default.createElement(i.Button,{variant:"transparent",onClick:e(!0)},t)}))),this.state.showBarcode?a.default.createElement("div",{id:"qr-div",ref:this.qrCodeContainer}):a.default.createElement("div",{id:"secret-div"},this.parseB32Key(this.props.totpB32Secret,!0)))}}t.SetupOfflineModal=R,R.displayName="SetupOfflineModal";class T extends a.default.Component{constructor(e){super(e),this.INVALID_CODE_GENERAL=b.intl.formatMessage({id:"LGWy5v",defaultMessage:"Invalid code."}),this.INVALID_CODE_TOTP=b.intl.formatMessage({id:"PEgSVc",defaultMessage:"Invalid code. Check the clock on your phone: it must be accurate to the minute."}),this.bindToInput=e=>t=>{this.setState(Object.assign(Object.assign({},this.state),{[e]:t.currentTarget.value}))},this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e="phone"===this.props.deliveryDetails.type?this.props.deliveryDetails.phoneData.phoneSig:void 0,t=yield c.confirmCode(this.props.user.id,this.props.checkpointToken,this.state.code,e);if(this.setState({submitting:!1}),"success"===t.type)this.props.onSuccessfulConfirm(t.backupCodes);else if("error"===t.type)switch(t.error){case"EXPIRED":this.props.onPasswordExpired();break;case"INVALID":const e=this.state.invalidCodeAttempts+1;0===this.state.invalidCodeAttempts||"phone"===this.props.deliveryDetails.type?this.setState({unexpectedError:this.INVALID_CODE_GENERAL,invalidCodeAttempts:e}):this.setState({unexpectedError:this.INVALID_CODE_TOTP,invalidCodeAttempts:e});break;case"RATELIMIT":y.Notify.error(b.intl.formatMessage({id:"kU4PMt",defaultMessage:"Too many invalid codes. Try again in a few minutes."}))}else this.setState({unexpectedError:E})})),this.state={submitting:!1,invalidCodeAttempts:0,code:""}}render(){return"phone"===this.props.deliveryDetails.type?(e=>a.default.createElement(S,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enable-confirm",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},a.default.createElement("p",null,b.intl.formatMessage({id:"HONi9s",defaultMessage:"We sent a security code to {phone_number}. Enter it below to verify your phone number"},{phone_number:e})),a.default.createElement("div",{className:"twofactor-input-wrapper"},a.default.createElement(n.TextInput,{id:"phone-code",value:this.state.code,onChange:this.bindToInput("code"),placeholder:b.intl.formatMessage({id:"DFLqLE",defaultMessage:"6-digit code"})}))))(this.props.deliveryDetails.phoneData.phoneNumber):(()=>a.default.createElement(S,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enable-confirm",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},a.default.createElement("p",null,b.intl.formatMessage({id:"lG9gS/",defaultMessage:"Enter the security code generated by your mobile authenticator app to make sure it’s configured correctly."})),a.default.createElement("div",{className:"twofactor-input-wrapper"},a.default.createElement(n.TextInput,{id:"phone-code",value:this.state.code,onChange:this.bindToInput("code"),placeholder:b.intl.formatMessage({id:"DFLqLE",defaultMessage:"6-digit code"})}))))()}}t.ConfirmDeliveryModal=T,T.displayName="ConfirmDeliveryModal";class F extends a.default.Component{constructor(e){super(e),this.SAME_AS_PRIMARY_ERROR=b.intl.formatMessage({id:"yJcqG4",defaultMessage:"You can’t use your primary phone as your backup"}),this.numberIsSameAsPrimary=()=>{const e=this.state.backupPhoneNumber,t=e&&"success"===e.type?e.phoneNumber:void 0;return t&&this.props.primaryPhone&&t===this.props.primaryPhone},this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.numberIsSameAsPrimary())return;const e=this.state.backupPhoneNumber,t=e&&"success"===e.type?e.phoneNumber:void 0;if("edit_backup_phone"===this.props.flow){this.setState({submitting:!0});const e=yield c.addBackupPhone(this.props.user.id,this.props.checkpointToken,t);this.setState({submitting:!1}),"success"===e.type?this.props.onAccept(t):"error"===e.type?this.props.onPasswordExpired():this.setState({unexpectedError:E})}else if("edit_twofactor"===this.props.flow){this.setState({submitting:!0});const e=yield c.enableTwofactorFinish(this.props.user.id,this.props.checkpointToken,t||null);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept(t);else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:E})}else this.props.onAccept(t)})),this.setBackupPhoneNumber=e=>this.setState({backupPhoneNumber:e}),this.state={submitting:!1,isSameAsPrimary:!1,loadedUserConstants:N}}UNSAFE_componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===N.length){const e=yield A();if(e&&0===this.state.loadedUserConstants.length){const t=I(e);N=t,this.setState({loadedUserConstants:t})}}}))}render(){const e=this.numberIsSameAsPrimary()&&this.SAME_AS_PRIMARY_ERROR;return a.default.createElement(S,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-enter-backup-phone",className:"twofactor-overflow",errorText:e||this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},a.default.createElement("p",{className:"subtitle"},b.intl.formatMessage({id:"PVsh9/",defaultMessage:"<strong>Backup phone number</strong> (optional)"},{strong:e=>a.default.createElement("strong",null,e)})),a.default.createElement("p",null,b.intl.formatMessage({id:"MLWfyM",defaultMessage:"If you lose access to your primary security code source, we can send them to your backup mobile number instead."})),a.default.createElement(l.PhoneInput,{onPhoneNumberInput:this.setBackupPhoneNumber,isLoading:0===this.state.loadedUserConstants.length,countryList:this.state.loadedUserConstants}),a.default.createElement("p",{id:"backup-phone-number-description"},b.intl.formatMessage({id:"djBo1i",defaultMessage:"While this step is optional, we encourage you to set up a backup phone number in case you lose your mobile phone or are otherwise unable to receive your security code."})))}}function x(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")}t.BackupPhoneModal=F,F.displayName="BackupPhoneModal";class L extends a.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.enableTwofactorFinish(this.props.user.id,this.props.checkpointToken,this.props.backupPhone||null);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:E})})),this.state={submitting:!1}}render(){const e=void 0!==this.props.primaryPhone?b.intl.formatMessage({id:"HyWjj5",defaultMessage:"Your security codes will be sent by text message"}):b.intl.formatMessage({id:"bQoyjz",defaultMessage:"Your security codes will be generated by your authenticator app"});return a.default.createElement(S,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-recovery",errorText:this.state.unexpectedError,dismissOptions:{text:b.intl.formatMessage({id:"tSs2ty",defaultMessage:"Back"}),onDismiss:this.props.onDismiss}},a.default.createElement("div",{className:"deliveryLabel"},e),a.default.createElement("div",{className:"confirm-phones-outer"},this.props.primaryPhone&&a.default.createElement("div",{id:"confirm-phone-primary",className:"confirm-phones-inner"},a.default.createElement("span",{className:"confirm-phone-label"},b.intl.formatMessage({id:"9m9zTf",defaultMessage:"Primary phone number"})),a.default.createElement("span",{id:"confirm-phone-primary-number",className:"confirm-phone-number"},this.props.primaryPhone)),this.props.backupPhone&&a.default.createElement("div",{id:"confirm-phone-backup",className:"confirm-phones-inner"},a.default.createElement("span",{className:"confirm-phone-label"},b.intl.formatMessage({id:"4KZf0Q",defaultMessage:"Backup phone number"})),a.default.createElement("span",{id:"confirm-phone-backup-number",className:"confirm-phone-number"},this.props.backupPhone))),a.default.createElement("div",{className:"codesbox"},a.default.createElement("p",{className:"desc"},b.intl.formatMessage({id:"zSj4X8",defaultMessage:"You can use these one-time backup codes to access your account."})),a.default.createElement("div",{id:"backup-code-list-container"},a.default.createElement("ol",{className:"twofactor-backup-list"},this.props.recoveryCodes.map(e=>a.default.createElement("li",{className:"twofactor-backup-list__item"},a.default.createElement("span",{className:"twofactor-backup-list__code"},x(e)))))),a.default.createElement("p",{className:"sub-desc"},b.intl.formatMessage({id:"Lb5frQ",defaultMessage:"Write these down and keep them safe."}))))}}t.ViewRecoveryCodesModal=L,L.displayName="ViewRecoveryCodesModal";class O extends a.default.Component{constructor(e){super(e),this.loadRecoveryCodes=e=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const t=yield c.getRecoveryCodes(this.props.user.id,this.props.checkpointToken,e);if(this.setState({submitting:!1}),"success"===t.type)this.setState({backupCodes:t.backupCodes});else if("error"===t.type)switch(t.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:E})})),this.state={submitting:!1}}componentWillMount(){return s.__awaiter(this,void 0,void 0,(function*(){this.loadRecoveryCodes(!1)}))}render(){const{backupCodes:e}=this.state;return a.default.createElement(S,{title:this.props.title,onAccept:this.props.onClose,acceptButtonText:b.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),dismissOptions:{text:b.intl.formatMessage({id:"rnNUn1",defaultMessage:"Generate new codes"}),onDismiss:()=>this.loadRecoveryCodes(!0)},id:"twofactor-recovery-edit",submitting:this.state.submitting,errorText:this.state.unexpectedError},(e=>e?a.default.createElement("div",{className:"codesbox"},a.default.createElement("p",{className:"desc"},b.intl.formatMessage({id:"zSj4X8",defaultMessage:"You can use these one-time backup codes to access your account."})),a.default.createElement("div",{id:"backup-code-list-container"},a.default.createElement("ol",{className:"twofactor-backup-list"},e.map(e=>a.default.createElement("li",{className:"twofactor-backup-list__item"},a.default.createElement("span",{className:"twofactor-backup-list__code"},x(e)))))),a.default.createElement("p",{className:"sub-desc"},b.intl.formatMessage({id:"Lb5frQ",defaultMessage:"Write these down and keep them safe."}))):a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"),alt:b.intl.formatMessage({id:"jybGUg",defaultMessage:"Loading"})}))(e))}}t.EditRecoveryCodesModal=O,O.displayName="EditRecoveryCodesModal";class P extends a.default.Component{render(){return a.default.createElement(S,{title:this.props.title,onAccept:this.props.onAccept,id:"twofactor-done"},a.default.createElement("p",null,b.intl.formatMessage({id:"4cZi/F",defaultMessage:"From now on, when you sign in to the Dropbox website or link a new device, you’ll need to enter a security code from your phone."})))}}t.FinishTwofactorEnableModal=P,P.displayName="FinishTwofactorEnableModal";class j extends a.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.disableTwofactor(this.props.user.id,this.props.checkpointToken);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:E})})),this.state={submitting:!1}}render(){return a.default.createElement(S,{title:this.props.title,onAccept:this.onAccept,submitting:this.state.submitting,id:"twofactor-disable",errorText:this.state.unexpectedError},a.default.createElement("p",null,b.intl.formatMessage({id:"wAS6mz",defaultMessage:"If you disable two-step verification, you’ll only need your email and password when you sign in to the Dropbox website or link a new device."})))}}t.FinishTwofactorDisableModal=j,j.displayName="FinishTwofactorDisableModal";class D extends a.default.Component{constructor(e){super(e),this.UNSUPPORTED_U2F_ERROR_STRING=b.intl.formatMessage({id:"nr9Ux4",defaultMessage:"Currently, security keys are only supported with Google Chrome, version 38 or higher."}),this.UNSUPPORTED_ERROR_STRING=b.intl.formatMessage({id:"oHNNG5",defaultMessage:"Currently, security keys are only supported with Google Chrome, version 38 or higher, and Firefox, version 60 or higher."}),this.onAccept=()=>{this.state.unsupportedBrowser?f.unmountModal():this.props.onAccept()},this.state={submitting:!0,unsupportedBrowser:!1,unsupportedErrorText:this.UNSUPPORTED_U2F_ERROR_STRING}}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){let e;try{if(e=yield c.startSecurityKeyRegistration(this.props.user.id),"unknown_error"===e.type)throw e}catch(e){return this.setState({submitting:!1,unsupportedBrowser:!0,unsupportedErrorText:this.UNSUPPORTED_U2F_ERROR_STRING}),void this.props.onGetRequest()}const t=!p.canRegisterAuthenticator(e.request);let s=this.UNSUPPORTED_U2F_ERROR_STRING;p.isWebAuthnEnabled(e.request)&&(s=this.UNSUPPORTED_ERROR_STRING),this.setState({submitting:!1,unsupportedBrowser:t,unsupportedErrorText:s}),this.props.onGetRequest(e)}))}render(){const e=this.state.unsupportedBrowser?this.state.unsupportedErrorText:"";return a.default.createElement(S,{title:this.props.title,id:"twofactor-security-key-unsupported-browser",onAccept:this.onAccept,errorText:e,acceptButtonText:this.state.unsupportedBrowser?b.intl.formatMessage({id:"6bRQ0U",defaultMessage:"Done"}):b.intl.formatMessage({id:"6fTvLO",defaultMessage:"Begin setup"}),submitting:this.state.submitting},a.default.createElement("div",{className:"modal-img"},a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/security_keys/insert-vflkCfC4_.png"),srcHiRes:(0,g.static_url)("/static/metaserver/static/images/security_keys/insert@2x-vflTxG2RJ.png")})),a.default.createElement("div",{className:"instructions"},a.default.createElement("p",null,b.intl.formatMessage({id:"mgikY5",defaultMessage:"A security key allows you to complete two-step verification securely and conveniently, when logging into Dropbox. <a>Learn more</a>"},{a:e=>a.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)}))))}}t.SecurityKeyIntroModal=D,D.displayName="SecurityKeyIntroModal";class U extends a.default.Component{constructor(e){super(e),this.onPrepareAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({registrationStatus:"pending_registration"})})),this.onAuthenticatorCallback=e=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const t=yield c.finishSecurityKeyRegistration(this.props.user.id,this.props.checkpointToken,e);this.setState({submitting:!1}),"success"===t.type?(this.props.onKeyAdded(),this.setState({registrationStatus:"success",deviceGid:t.data.device_gid})):"error"===t.type?this.setState({registrationStatus:"error",unexpectedError:t.localizedError}):this.setState({registrationStatus:"error"})})),this.renderPrepare=()=>a.default.createElement(S,{title:this.props.title,onAccept:this.onPrepareAccept,acceptButtonText:b.intl.formatMessage({id:"cTRGoc",defaultMessage:"Key inserted"}),submitting:this.state.submitting,errorText:this.state.unexpectedError},a.default.createElement("div",{className:"modal-img"},a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/security_keys/insert-vflkCfC4_.png"),srcHiRes:(0,g.static_url)("/static/metaserver/static/images/security_keys/insert@2x-vflTxG2RJ.png")})),a.default.createElement("div",{className:"instructions"},a.default.createElement("p",null,b.intl.formatMessage({id:"3Ol37w",defaultMessage:"Start by inserting your security key into a USB port. <a>Learn more</a>"},{a:e=>a.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)})))),this.renderPending=()=>a.default.createElement(S,{title:this.props.title,errorText:this.state.unexpectedError},a.default.createElement("div",{className:"modal-img"},a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/security_keys/detect-vflwOn2Nf.png"),srcHiRes:(0,g.static_url)("/static/metaserver/static/images/security_keys/detect@2x-vflx2BPRH.png")})),a.default.createElement("div",{className:"instructions"},a.default.createElement("p",null,a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),className:"scanning-wheel"}),b.intl.formatMessage({id:"tq1aa1",defaultMessage:"Scanning for security key"})),a.default.createElement("p",null,b.intl.formatMessage({id:"e8eCgM",defaultMessage:"If your key has a button or a gold disk, tap it now. <a>Learn more</a>"},{a:e=>a.default.createElement("a",{href:"/help/363#2fa-security-keys",rel:"noopener noreferrer",target:"_blank"},e)})))),this.retryRegister=()=>{this.setState({registrationStatus:"pending_registration"})},this.renderError=()=>a.default.createElement(S,{title:this.props.title,onAccept:this.retryRegister,acceptButtonText:b.intl.formatMessage({id:"n1zYou",defaultMessage:"Retry"}),errorText:this.state.unexpectedError},a.default.createElement("div",{className:"modal-img"},a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/security_keys/detect-vflwOn2Nf.png"),srcHiRes:(0,g.static_url)("/static/metaserver/static/images/security_keys/detect@2x-vflx2BPRH.png")})),a.default.createElement("div",{className:"instructions"},a.default.createElement("p",null,b.intl.formatMessage({id:"50+STL",defaultMessage:"Re-insert your key and click ‘Retry’"})))),this.setNickname=e=>this.setState({nickname:e.currentTarget.value}),this.renameAndFinish=()=>{if(this.state.nickname){this.setState({renameSubmitting:!0}),(new u.UserApiV2Client).ns("security_settings").rpc("rename_auth_device_v2",{device_gid:this.state.deviceGid,nickname:this.state.nickname},{subjectUserId:this.props.user.id}).then(e=>{this.setState({renameSubmitting:!1}),this.props.onKeyAdded(),this.props.onFinish()},e=>{this.setState({renameSubmitting:!1}),this.props.onFinish()})}else this.props.onFinish()},this.state={submitting:!1,renameSubmitting:!1,registrationStatus:"prepare",deviceGid:"",nickname:""},this.currentRequest=this.props.request}componentDidUpdate(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(t.registrationStatus!==this.state.registrationStatus&&"pending_registration"===this.state.registrationStatus)if(void 0===this.currentRequest&&(this.setState({submitting:!0}),this.currentRequest=yield c.startSecurityKeyRegistration(this.props.user.id,this.props.checkpointToken),this.setState({submitting:!1})),"success"===this.currentRequest.type){const e=yield p.register(this.currentRequest.request);this.currentRequest=void 0,this.onAuthenticatorCallback(e)}else this.setState({registrationStatus:"error",unexpectedError:E})}))}renderSuccess(){return a.default.createElement(S,{title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"t0ve6c",defaultMessage:"Finish"}),onAccept:this.renameAndFinish,submitting:this.state.renameSubmitting},a.default.createElement("div",{className:"modal-img"},a.default.createElement(m.Image,{src:(0,g.static_url)("/static/metaserver/static/images/security_keys/success-vfldNQ5IO.png"),srcHiRes:(0,g.static_url)("/static/metaserver/static/images/security_keys/success@2x-vflv-3UZY.png")})),a.default.createElement("div",{className:"instructions"},a.default.createElement("p",null,b.intl.formatMessage({id:"qAhMHO",defaultMessage:"Key added!"})),a.default.createElement("p",null,b.intl.formatMessage({id:"FvQTeI",defaultMessage:"You can now use your security key to complete two-step verification when you sign into Dropbox."})),a.default.createElement("p",null,b.intl.formatMessage({id:"/8wKhI",defaultMessage:"If you’d like, you can also set a nickname for this security key, so that it’s easier to tell apart from any other key you have."}))),a.default.createElement(n.TextInput,{id:"nickname",value:this.state.nickname,onChange:this.setNickname,"disable-errors":!0,placeholder:b.intl.formatMessage({id:"J/uM6N",defaultMessage:"for example, ‘yellow USB key’"}),maxLength:100}))}render(){switch(this.state.registrationStatus){case"prepare":return this.renderPrepare();case"pending_registration":return this.renderPending();case"error":return this.renderError();case"success":return this.renderSuccess()}}}t.SecurityKeyRegisterModal=U,U.displayName="SecurityKeyRegisterModal";class B extends a.default.Component{constructor(e){super(e),this.onAccept=()=>s.__awaiter(this,void 0,void 0,(function*(){this.setState({submitting:!0});const e=yield c.revokeAllTrustedDevices(this.props.user.id,this.props.checkpointToken);if(this.setState({submitting:!1}),"success"===e.type)this.props.onAccept();else if("error"===e.type)switch(e.error){case"EXPIRED":this.props.onPasswordExpired()}else this.setState({unexpectedError:E})})),this.state={submitting:!1}}render(){return a.default.createElement(S,{title:this.props.title,acceptButtonText:b.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),onAccept:this.onAccept,dismissOptions:{text:b.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onDismiss:this.props.onDismiss},id:"twofactor-revoke-all-trusted-devices",submitting:this.state.submitting,errorText:this.state.unexpectedError},a.default.createElement("p",null,b.intl.formatMessage({id:"B7S5UI",defaultMessage:"To sign in again you’ll need your phone or a backup option for the second step."})))}}t.RevokeAllTrustedDevicesModal=B,B.displayName="RevokeAllTrustedDevicesModal"})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/phone_input",["require","exports","tslib","react","styled-components","metaserver/static/js/modules/constants/viewer","metaserver/static/js/core/i18n","metaserver/static/js/clean/static_urls","metaserver/static/js/clean/ui/select","metaserver/static/js/clean/ui/input_dig","phone_helpers"],(function(e,t,s,r,a,i,n,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneInput=void 0,r=s.__importDefault(r),a=s.__importDefault(a),i=s.__importStar(i),l=s.__importStar(l),c=s.__importStar(c),d=s.__importStar(d);const u=c.text,p=l.input,m=l.option,h=(0,a.default)(p)`
  .select-input-input {
    padding: 0 6px !important;
  }
`,f=a.default.div`
  .phone-text {
    padding-bottom: 13px;
  }
`,_=(0,a.default)(m)`
  &&&& {
    vertical-align: baseline;
  }
`;class g extends r.default.Component{constructor(e){super(e),this.getFullNumber=()=>d.full_number(this.state.selectedCountryCode,this.state.phoneNumber),this.getCountryIso=()=>d.iso_to_dialing(this.state.selectedCountryCode),this.getExampleNumber=()=>d.get_example_mobile_number(this.getCountryIso()),this.onCountrySelected=(e,t)=>{this.setState({selectedCountryCode:t})},this.bindToInput=e=>t=>{this.setState(Object.assign(Object.assign({},this.state),{[e]:t.currentTarget.value}))},this.state={selectedCountryCode:i.LOCALE||"US",phoneNumber:""}}componentDidUpdate(e,t){this.state.selectedCountryCode===t.selectedCountryCode&&this.state.phoneNumber===t.phoneNumber||this.notifyListenerOfPhoneInput()}notifyListenerOfPhoneInput(){this.getFullNumber()?d.is_valid(this.getFullNumber())?this.props.onPhoneNumberInput({type:"success",phoneNumber:this.getFullNumber()}):this.props.onPhoneNumberInput({type:"error"}):this.props.onPhoneNumberInput({type:"empty"})}renderCountryList(){return r.default.createElement(h,{onChange:this.onCountrySelected,value:this.state.selectedCountryCode,className:"phone-country",variant:"small"},this.props.countryList.map(e=>r.default.createElement(_,{key:e.countryCode,value:e.countryCode},e.countryName," ",e.phoneCode)))}renderLoading(){return r.default.createElement("img",{src:(0,o.static_url)("/static/metaserver/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"),alt:n.intl.formatMessage({id:"jybGUg",defaultMessage:"Loading"})})}render(){if(this.props.isLoading)return this.renderLoading();const e=d.format(this.getCountryIso(),this.state.phoneNumber),t=!this.state.phoneNumber||d.is_valid(this.getFullNumber());return r.default.createElement(f,{className:"phone-number-input phone-number-input-inline"},r.default.createElement("div",{className:"phone-number-error-wrapper"},r.default.createElement("div",{className:"phone-number-error error-message"}," ")),this.renderCountryList(),r.default.createElement(u,{placeholder:this.getExampleNumber(),className:"phone-text",inline:!0,variant:"small",onChange:this.bindToInput("phoneNumber"),value:e,error:t?void 0:{message_text:n.intl.formatMessage({id:"Q8gucb",defaultMessage:"Invalid phone number"})}}))}}t.PhoneInput=g,g.displayName="PhoneInput"})),define("metaserver/static/js/account_page/widgets/two_step_verification/modals/twofactor_api",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/auth/authenticator"],(function(e,t,s,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.revokeAllTrustedDevices=t.finishSecurityKeyRegistration=t.startSecurityKeyRegistration=t.getRecoveryCodes=t.disableTwofactor=t.enableTwofactorFinish=t.addBackupPhone=t.confirmCode=t.submitPhoneNumber=t.fetchOfflineKey=t.confirmPassword=void 0,a=s.__importStar(a);const i={type:"unknown_error"};t.confirmPassword=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{let s;s="enable"===a?"/account/twofactor/confirm_password":"disable"===a?"/account/twofactor/disable_confirm_password":"/account/twofactor/edit_confirm_password";const i=yield(0,r.WebRequest)({url:s,data:{password:t},subject_user:e});if(i.startsWith("OK:"))return{type:"success",checkpointToken:i.substring(3)};switch(i){case"EXPIRED_PASSWORD":case"INVALID":case"RATELIMIT":case"ALREADY_ENABLED":case"ALREADY_DISABLED":return{type:"error",error:i}}}catch(e){}return i}))},t.fetchOfflineKey=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/add_phone",data:{checkpoint_token:t,offline:!0},subject_user:e});if(s.startsWith("OK:"))return{type:"success",b32EncodedKey:s.substring(3)};if("EXPIRED"===s)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.submitPhoneNumber=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/add_phone",data:{checkpoint_token:t,phone_number:a},subject_user:e});if(s.startsWith("OK:")){return{type:"success",phoneSig:s.substring(3)}}switch(s){case"EXPIRED":case"UNREACHABLE":case"BADCARRIER":case"INVALIDNUMBER":case"NOTAMOBILE":case"RATELIMIT":return{type:"error",error:s}}}catch(e){}return i}))},t.confirmCode=function(e,t,a,n){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/confirm_phone",data:{checkpoint_token:t,twofactor_code:a,phone_sig:n},subject_user:e}),i=JSON.parse(s);if("OK"===i.result)return{type:"success",backupCodes:i.codes};switch(i.result){case"INVALID":case"EXPIRED":case"RATELIMIT":return{type:"error",error:i.result}}}catch(e){}return i}))},t.addBackupPhone=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/set_backup_phone",data:{checkpoint_token:t,backup_phone_number:a||""},subject_user:e});if("OK"===s)return{type:"success"};if("EXPIRED"===s)return{type:"error",error:s}}catch(e){}return i}))},t.enableTwofactorFinish=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{const s={checkpoint_token:t};null!==a&&(s.backup_phone_number=a);const i=yield(0,r.WebRequest)({url:"/account/twofactor/enable_finish",data:s,subject_user:e});if("OK"===i)return{type:"success"};if("EXPIRED"===i)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.disableTwofactor=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/disable",data:{checkpoint_token:t},subject_user:e});if("OK"===s)return{type:"success"};if("EXPIRED"===s)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.getRecoveryCodes=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=a?"/account/twofactor/new_rescue_code":"/account/twofactor/get_rescue_code",i=yield(0,r.WebRequest)({url:s,data:{checkpoint_token:t,user_json:!0},dataType:"json",subject_user:e});if("OK"===i.result)return{type:"success",backupCodes:i.codes};if("EXPIRED"===i.result)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))},t.startSecurityKeyRegistration=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/u2f_start_registration",data:{checkpoint_token:t},subject_user:e}),n=JSON.parse(s),o={challenge_id:n.challenge_id};for(const e of Object.keys(a.PROTOCOLS))o[e]=n[e]&&JSON.parse(n[e]);return Object.keys(o).length>0?{type:"success",request:o}:i}catch(e){return i}}))},t.finishSecurityKeyRegistration=function(e,t,a){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield(0,r.WebRequest)({url:"/account/twofactor/u2f_finish_registration",data:{checkpoint_token:t,device_response:JSON.stringify(a)},subject_user:e});return s.startsWith("err:")?{type:"error",localizedError:JSON.parse(s.substring("err:".length)).security_key_register.message_text}:{type:"success",data:JSON.parse(s)}}catch(e){return i}}))},t.revokeAllTrustedDevices=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s="/account/twofactor/revoke_all_trusted_devices",a=yield(0,r.WebRequest)({url:s,data:{checkpoint_token:t},subject_user:e});if("OK"===a)return{type:"success"};if("EXPIRED"===a)return{type:"error",error:"EXPIRED"}}catch(e){}return i}))}})),define("metaserver/static/js/admin/ui/teams/onboarding/web/components/send_mobile_link",["require","exports","tslib","react","react-intl","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/progress_indicators","dig-components/tabs","dig-components/text_fields","dig-components/typography","metaserver/static/js/clean/static_urls","metaserver/static/js/account_page/widgets/two_step_verification/modals/flow_steps","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery","metaserver/static/js/clean/analytics","metaserver/static/js/growth/smb_funnel/smb_funnel_logger","metaserver/static/js/growth/ui/send_app_link_form","metaserver/static/js/growth/ui/send_app_link_form_disclaimer","metaserver/static/js/admin/ui/teams/onboarding/web/constants","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/components/ui/css","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/growth/ui/open_in_util"],(function(e,t,s,r,a,i,n,o,l,c,d,u,p,m,h,f,_,g,b,y,v,E,S,w,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMobileLink=t.usePhoneNumberConstants=void 0,r=s.__importStar(r);const k=(0,a.defineMessage)({id:"GU8La8",defaultMessage:"Link sent to {email}"}),N=(0,a.defineMessage)({id:"93LvA5",defaultMessage:"There was an error sending the link"}),A={EMAIL:{id:"email",label:v.intl.formatMessage({id:"Jf36zT",defaultMessage:"By email"}),content:v.intl.formatMessage({id:"5ZXdxv",defaultMessage:"We'll send a link to:"}),buttonText:v.intl.formatMessage({id:"JuuMAX",defaultMessage:"Email me the link"})},PHONE:{id:"phone",label:v.intl.formatMessage({id:"DVUAxh",defaultMessage:"By text"}),content:v.intl.formatMessage({id:"OeOpuZ",defaultMessage:"We'll send a link to:"}),buttonText:v.intl.formatMessage({id:"6sVXnz",defaultMessage:"Text me the link"})},QR:{id:"qr",label:v.intl.formatMessage({id:"Y+Foy6",defaultMessage:"QR code"}),content:v.intl.formatMessage({id:"heeSqP",defaultMessage:"Point your camera at the QR code to download Dropbox."}),buttonText:""}},I=(0,p.static_url)("/static/metaserver/static/images/growth/personalization/download_app_qr_code_no_margin-vflidVVmZ.png");t.usePhoneNumberConstants=()=>{const[e,t]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(0,m.fetchPhoneNumberConstants)().then(t)},[]),e};const C=({email:e,dontNotify:a=!1,loggingExtras:p={},sendEmailButtonRef:m,sendTextButtonRef:S,showPrimaryButton:C})=>{const R=A.QR,T=A.EMAIL,[F,x]=(0,r.useState)(R.id),[L,O]=(0,r.useState)(I);(0,r.useEffect)(()=>{C&&C(F!==A.QR.id),(function(){return s.__awaiter(this,void 0,void 0,(function*(){const e=(0,M.getCurrentUser)(),t=new w.DefaultUserApiV2Client(e),{image_src:s}=yield t.ns("growth").rpc("get_mobile_app_link_qr_image",void 0,{});return s}))})().then(e=>{O(e)})},[]);const P=(0,t.usePhoneNumberConstants)();return r.default.createElement("div",{className:"send-mobile-link"},r.default.createElement(c.Tabs,{selectedTab:F,onSelection:e=>{x(e),C&&C(e!==A.QR.id)}},r.default.createElement(c.Tabs.Group,null,r.default.createElement(c.Tabs.Tab,{id:R.id},R.label),r.default.createElement(c.Tabs.Tab,{id:T.id},T.label)),r.default.createElement(c.Tabs.Panel,{tabId:A.EMAIL.id},r.default.createElement("div",{className:"input-container"},r.default.createElement(u.Text,{tagName:"label",htmlFor:"email-input",size:"small",isBold:!0},A.EMAIL.content),r.default.createElement(d.TextInput,{id:"email-input",size:"large",value:e,withRightAccessory:r.default.createElement(n.UIIcon,{src:o.LockLine}),disabled:!0})),r.default.createElement(i.Button,{className:"setup-button",variant:"primary",size:"large",onClick:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const t={ctaName:"email_link"};try{f.TeamsWebActionsLogger.log("send_mobile_app_link",Object.assign(Object.assign({},p),{cta_shown:"email_link",sent_address:e})),yield(0,h.WebRequest)({url:"/email_mobile_app",data:{recipient_email:e}}),t.success="true",a||E.Notify.success(v.intl.formatMessage(k,{email:e}))}catch(e){t.success="false",a||E.Notify.error(v.intl.formatMessage(N))}finally{_.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,t)}})),ref:m,style:{display:m?"none":void 0}},A.EMAIL.buttonText),!!m&&r.default.createElement("div",{style:{height:2}}),r.default.createElement("div",{className:"notification-message"},r.default.createElement(u.Text,{tagName:"span",color:"faint"},v.intl.formatMessage({id:"hHhhyq",defaultMessage:"Double check your spam folder."})))),r.default.createElement(c.Tabs.Panel,{tabId:A.PHONE.id},r.default.createElement("div",{className:"input-container"},P?r.default.createElement(r.default.Fragment,null,r.default.createElement(u.Text,{tagName:"label",size:"small",isBold:!0},A.PHONE.content),r.default.createElement(g.SendAppLinkForm,{phoneInputData:P,onStatusChange:e=>{const{phoneNumber:t,sendStatus:s}=e;s===g.SendStatus.SENDING?f.TeamsWebActionsLogger.log("send_mobile_app_link",Object.assign(Object.assign({},p),{cta_shown:"text_link",sent_address:t})):s===g.SendStatus.SUCCESS?_.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,{ctaName:"text_link",success:"true"}):s===g.SendStatus.FAILURE&&_.SMBFunnelLogger.log(y.AMPMetrics.ACTIVATION_MOBILE_LINK_SEND,{ctaName:"text_link",success:"false"}),a||(0,g.showStatusUsingNotify)(e)},size:"large",SubmitButton:()=>r.default.createElement(i.Button,{className:"setup-button",variant:"primary",size:"large",type:"submit",ref:S,style:{display:S?"none":void 0}},A.PHONE.buttonText),formTypes:[g.SendAppLinkFormType.SMS],buttonPosition:g.SendAppLinkButtonPosition.BOTTOM,isFullWidth:!0})):r.default.createElement("div",{style:{textAlign:"center"}},r.default.createElement(l.Spinner,{"aria-valuetext":"Loading"}))),!!P&&r.default.createElement(b.SendAppLinkFormDisclaimer,{size:"large",color:"faint"})),r.default.createElement(c.Tabs.Panel,{tabId:A.QR.id},r.default.createElement("div",{className:"input-container"},r.default.createElement("div",{className:"qr-code-container"},r.default.createElement("img",{className:"qr-code-img",alt:v.intl.formatMessage({id:"downloadAppQRCodeImageAlt",defaultMessage:"Download Dropbox using this QR code"}),src:L}),r.default.createElement("div",{className:"qr-code-text-container"},r.default.createElement(u.Text,{tagName:"p",size:"standard"},A.QR.content)))))))};C.displayName="SendMobileLinkWithoutCss",t.SendMobileLink=(0,S.requireCssWithComponent)(C,["/static/metaserver/static/css/admin/teams/essential_setup/send_mobile_link-vflGQi7zO.css"])})),define("metaserver/static/js/growth/ui/open_in_util",["require","exports","metaserver/static/js/clean/active_user","metaserver/static/js/clean/viewer"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentUser=t.loggingExtras=void 0,t.loggingExtras={module_name:"clink_first_task",framework:"team_setup_essential"},t.getCurrentUser=function(){const e=(0,s.getActiveUser)();if(e)return e;const t=r.Viewer.get_viewer().get_users();return t.length>0?t[t.length-1]:void 0}})),define("metaserver/static/js/growth/ui/send_app_link_form",["require","exports","tslib","react","react-dom","metaserver/static/js/components/ui/css","phone_helpers","metaserver/static/js/modules/constants/viewer","classnames","metaserver/static/js/core/notify","metaserver/static/js/core/i18n","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/clean/mobile_tracker","metaserver/static/js/growth/ui/send_app_link_form_disclaimer","metaserver/static/js/validators/email_validator","metaserver/static/js/core/dom","dig-components/form_row","dig-components/text_fields","dig-components/icons","dig-components/icons/src","dig-components/typography","dig-components/buttons"],(function(e,t,s,r,a,i,n,o,l,c,d,u,p,m,h,f,_,g,b,y,v,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendAppLinkForm=t.SendAppLinkFormComponent=t.showStatusUsingNotify=t.SendAppLinkFormLayout=t.SendAppLinkButtonPosition=t.SendAppLinkFormType=t.SendStatus=void 0,r=s.__importDefault(r),a=s.__importStar(a),n=s.__importStar(n),o=s.__importStar(o),l=s.__importDefault(l),u=s.__importStar(u),h=s.__importDefault(h),f=s.__importStar(f);const S=["AQ","BV","PN"];var w,M,k;(function(e){e.SENDING="sending",e.SUCCESS="success",e.INVALID="invalid",e.FAILURE="failure"})(w=t.SendStatus||(t.SendStatus={})),(function(e){e.SMS="sms",e.EMAIL="email"})(M=t.SendAppLinkFormType||(t.SendAppLinkFormType={})),(function(e){e.RIGHT="button-right",e.BOTTOM="button-bottom"})(t.SendAppLinkButtonPosition||(t.SendAppLinkButtonPosition={})),(function(e){e.DEFAULT="default",e.SUBMIT_ON_BOTTOM="submit-on-bottom"})(k=t.SendAppLinkFormLayout||(t.SendAppLinkFormLayout={}));t.showStatusUsingNotify=({currentFormType:e,sendStatus:t,phoneNumber:s,email:r})=>{switch(c.Notify.clear(),t){case w.SENDING:c.Notify.info(d.intl.formatMessage({id:"zq/eht",defaultMessage:"Sending"}),60);break;case w.SUCCESS:let t;switch(e){case M.SMS:t=d.intl.formatMessage({id:"GHBzHK",defaultMessage:"Link sent to {phone_number}"},{phone_number:s});break;case M.EMAIL:t=d.intl.formatMessage({id:"RQAh9Y",defaultMessage:"Link sent to {email}"},{email:r})}t&&c.Notify.success(t,3);break;case w.INVALID:let a;switch(e){case M.SMS:a=d.intl.formatMessage({id:"SYbWri",defaultMessage:"Please enter a valid phone number"});break;case M.EMAIL:a=d.intl.formatMessage({id:"CAJjXO",defaultMessage:"Please enter a valid email address"})}a&&c.Notify.error(a,3);break;case w.FAILURE:c.Notify.error(d.intl.formatMessage({id:"2/fjiQ",defaultMessage:"There was an error sending the link"}),3)}};class N extends r.default.Component{constructor(e){if(super(e),this.getUnformattedNumber=e=>(e=e||this.state.phoneNumber).replace(/[^\d]/g,""),this.isPhoneNumberValid=e=>{e=e||this.state.phoneNumber;const t=this.getPhoneNumberPlaceholder();return this.getUnformattedNumber(e).length===this.getUnformattedNumber(t).length},this.isEmailValid=e=>(e=e||this.state.email,h.default.validate(e).every(e=>e.valid)),this.handleSubmit=e=>{e.preventDefault();const t=(0,p.getMobileTrackerCampaignParams)();switch(this.state.currentFormType){case M.SMS:this.state.sendStatus!==w.SENDING&&(this.isPhoneNumberValid()?(this.setState({sendStatus:w.SENDING}),u.SilentBackgroundRequest({url:"/text_mobile_app",data:Object.assign({country_code:this.getCountryCode(),phone_number:this.getUnformattedNumber()},t),success:e=>{"True"===e?this.setState({sendStatus:w.SUCCESS}):this.setState({sendStatus:w.FAILURE})},error:()=>{this.setState({sendStatus:w.FAILURE})}})):this.setState({sendStatus:w.INVALID}));break;case M.EMAIL:this.state.sendStatus!==w.SENDING&&(this.isEmailValid()?(this.setState({sendStatus:w.SENDING}),u.SilentBackgroundRequest({url:"/email_mobile_app",data:Object.assign({recipient_email:this.state.email},t),success:e=>{"True"===e?this.setState({sendStatus:w.SUCCESS}):this.setState({sendStatus:w.FAILURE})},error:()=>{this.setState({sendStatus:w.FAILURE})}})):this.setState({sendStatus:w.INVALID}))}this.props.onSubmit&&this.props.onSubmit(e)},this.handlePhoneNumberInput=()=>{this.phoneNumberInput&&this.setState({phoneNumber:this.phoneNumberInput.value})},this.handleCountryCodeInput=e=>{this.setState({countryAbbreviation:e.target.value})},this.getStateIconElement=()=>{const e="send-app-link-form__phone-email-input-icon";switch(this.state.sendStatus){case w.SUCCESS:return r.default.createElement(v.Text,{className:e},r.default.createElement(b.UIIcon,{src:y.CheckmarkLine}));case w.INVALID:return r.default.createElement(v.Text,{className:e,color:"error"},r.default.createElement(b.UIIcon,{src:y.WarningLine}))}return null},this.getCountryIso=()=>n.iso_to_dialing(this.state.countryAbbreviation),this.getPhoneNumberPlaceholder=()=>n.get_example_mobile_number(this.getCountryIso()),this.getCountryCode=e=>(e=e||this.state.countryAbbreviation,this.props.phoneInputData?this.props.phoneInputData.phone_code_map[e]:null),this.setPhoneNumberInputRef=e=>this.phoneNumberInput=e,this.handleFocusCountryCode=()=>{this.setState({isCountryCodeFocused:!0})},this.handleBlurCountryCode=()=>{this.setState({isCountryCodeFocused:!1})},this.renderHelperText=()=>{const{inputHelperText:e}=this.props,{sendStatus:t}=this.state;return e?r.default.createElement(_.FormHelperText,{isInvalid:t===w.INVALID||t===w.FAILURE},e):null},this.getPhoneInput=()=>{const{phoneInputData:e,buttonPosition:t,isFullWidth:s,smsInputPlaceholder:a,size:i="standard"}=this.props,{countryAbbreviation:o,sendStatus:c,phoneNumber:u,isCountryCodeFocused:p,mouseInSelect:m}=this.state,h=n.format(this.getCountryIso(),u),f=this.getPhoneNumberPlaceholder();return e?r.default.createElement("div",{className:`\n        send-app-link-form__phone-input\n        send-app-link-form__phone-input--${t}\n        send-app-link-form__phone-input--${s?"full-width":"auto-width"}\n        send-app-link-form__phone-input--${c}\n      `},r.default.createElement("div",{className:"send-app-link-form__phone-input__input-group"},r.default.createElement("div",{className:"send-app-link-form__country-select"},r.default.createElement("label",{htmlFor:"send-app-link-form__country-select__input"},d.intl.formatMessage({id:"1SPrvR",defaultMessage:"Country"})),r.default.createElement("select",{id:"send-app-link-form__country-select__input",name:"country",className:"send-app-link-form__country-select__input",onChange:this.handleCountryCodeInput,onFocus:this.handleFocusCountryCode,onBlur:this.handleBlurCountryCode,value:o,onMouseEnter:this.onMouseEnterSelect,onMouseLeave:this.onMouseLeaveSelect},r.default.createElement("option",{disabled:!0,"aria-selected":!1},d.intl.formatMessage({id:"LrbExT",defaultMessage:"Country code"})),e.country_list.map(e=>{const[t,s]=e,a=this.getCountryCode(t);return a&&-1===S.indexOf(t)?r.default.createElement("option",{value:t,key:t,"aria-selected":o===t},`${s} ${a}`):null})),r.default.createElement("div",{className:(0,l.default)({"send-app-link-form__country-select__display":!0,"send-app-link-form__country-select__display--invalid":c===w.INVALID||c===w.FAILURE,"send-app-link-form__country-select__display--focused":p,"send-app-link-form__country-select__display--hovered":m}),"aria-hidden":!0},this.getCountryCode(),r.default.createElement(v.Text,{className:"send-app-link-form__country-select__display__icon"},r.default.createElement(b.UIIcon,{src:y.ChevronDownLine})))),r.default.createElement("div",{className:"send-app-link-form__phone-number"},r.default.createElement("label",{htmlFor:"send-app-link-form__phone-number__input"},d.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"})),r.default.createElement(g.TextInput,{id:"send-app-link-form__phone-number__input",type:"tel",name:"phone_number",className:"\n                send-app-link-form__phone-number__input\n              ",isInvalid:c===w.INVALID||c===w.FAILURE,placeholder:a||d.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"}),value:h,onChange:this.handlePhoneNumberInput,ref:this.setPhoneNumberInputRef,maxLength:f.length,size:i}),this.getStateIconElement())),this.renderHelperText()):null},this.setEmailInputRef=e=>this.emailInput=e,this.handleEmailInput=()=>{this.emailInput&&this.setState({email:this.emailInput.value})},this.getEmailInput=()=>{const{sendStatus:e,email:t}=this.state,{buttonPosition:s,isFullWidth:a,emailInputPlaceholder:i,size:n="standard"}=this.props;return r.default.createElement("div",{className:`\n        send-app-link-form__email-input\n        send-app-link-form__email-input--${s}\n        send-app-link-form__email-input--${a?"full-width":"auto-width"}\n        send-app-link-form__email-input--${e}\n      `},r.default.createElement("div",{className:"send-app-link-form__email-input__input-group"},r.default.createElement("label",{htmlFor:"send-app-link-form__email__input"},d.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"})),r.default.createElement(g.TextInput,{id:"send-app-link-form__email__input",type:"email",name:"email",placeholder:i||d.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"}),value:t,onChange:this.handleEmailInput,ref:this.setEmailInputRef,isInvalid:e===w.INVALID||e===w.FAILURE,size:n}),this.getStateIconElement()),this.renderHelperText())},this.onMouseEnterSelect=()=>{this.setState({mouseInSelect:!0})},this.onMouseLeaveSelect=()=>{this.setState({mouseInSelect:!1})},this.getInactiveFormType=()=>{const e=this.props.formTypes.filter(e=>e!==this.state.currentFormType);return e.length?e[0]:null},this.getFormInputElement=()=>{switch(this.state.currentFormType){case M.SMS:return this.getPhoneInput();case M.EMAIL:return this.getEmailInput();default:return null}},this.getFormSwitchPhrase=()=>{switch(this.getInactiveFormType()){case M.SMS:return d.intl.formatMessage({id:"NIcDB+",defaultMessage:"Or text me the link"});case M.EMAIL:return d.intl.formatMessage({id:"2WiFdV",defaultMessage:"Or email me the link"});default:return null}},this.handleClickFormSwitch=e=>{e.preventDefault();const t=this.getInactiveFormType();t&&this.setState({currentFormType:t})},this.setFormRef=e=>{this.formRef=e},this.getSubmitButton=()=>{const{SubmitButton:e,isFullWidth:t}=this.props,{sendStatus:s,currentFormType:a}=this.state;return r.default.createElement("div",{className:`\n          send-app-link-form__submit-wrapper\n          send-app-link-form__submit-wrapper--${t?"full-width":"auto-width"}\n        `},r.default.createElement(e,{sendStatus:s,currentFormType:a}))},this.getFormSwitchButton=e=>{const{isFullWidth:t,size:s}=this.props;return r.default.createElement("div",{className:(0,l.default)({"send-app-link-form__form-switch__wrapper":!0,"send-app-link-form__form-switch__wrapper--full-width":t,"send-app-link-form__form-switch__wrapper--auto-width":!t})},r.default.createElement(E.Button,{size:"large"===s?"standard":"small",variant:"transparent",onClick:this.handleClickFormSwitch,type:"button"},e))},this.getDisclaimer=()=>{const{currentFormType:e}=this.state,{size:t,disclaimerColor:s}=this.props;return r.default.createElement("div",{className:`\n              send-app-link-form__disclaimer\n              send-app-link-form__disclaimer--${e===M.SMS?"visible":"hidden"}\n            `,"aria-hidden":e!==M.SMS},r.default.createElement(m.SendAppLinkFormDisclaimer,{tabIndex:e===M.SMS?0:-1,onShowTooltip:this.props.onShowDisclaimerTooltip,size:t,color:s}))},e.formTypes.includes(M.SMS)&&!e.phoneInputData)throw new Error("SMS form type required phoneInputData prop");this.state={currentFormType:e.formTypes[0],phoneNumber:"",countryAbbreviation:o.LOCALE||"US",isCountryCodeFocused:!1,email:e.defaultUserEmail?e.defaultUserEmail:"",sendStatus:null,mouseInSelect:!1}}componentDidUpdate(e,t){const{onStatusChange:s,onSwitchFormType:r,onChangeCountryCode:i}=this.props,{sendStatus:n,phoneNumber:l,countryAbbreviation:c,currentFormType:d,email:u}=this.state;if(s&&t.sendStatus!==n&&s({currentFormType:d,sendStatus:n,phoneNumber:l,email:u}),t.phoneNumber===l&&t.countryAbbreviation===c&&t.email===u&&t.currentFormType===d||(this.setState({sendStatus:null}),i&&c!==t.countryAbbreviation&&i(c),this.props.onChangeInput&&(t.email!==u?this.props.onChangeInput(u):t.phoneNumber!==l&&this.props.onChangeInput(l))),t.currentFormType!==d){if(this.setState({phoneNumber:"",countryAbbreviation:o.LOCALE||"US",email:this.props.defaultUserEmail?this.props.defaultUserEmail:""}),this.formRef){const e=a.findDOMNode(this.formRef),t=f.getTabbableElementsIn(e);t.length&&t[0].focus()}r&&r(d)}}render(){const{formTypes:e,buttonPosition:t,showDisclaimer:s,formLayout:a}=this.props,i=this.getFormSwitchPhrase(),n=this.getFormInputElement(),o=this.getSubmitButton(),l=e.length>1&&i&&this.getFormSwitchButton(i),c=s&&this.getDisclaimer();let d=r.default.createElement(r.default.Fragment,null,n,o,l,c);switch(a){case k.SUBMIT_ON_BOTTOM:d=r.default.createElement(r.default.Fragment,null,n,c,l,o)}return r.default.createElement("form",{noValidate:!0,onSubmit:this.handleSubmit,className:`\n          send-app-link-form\n          send-app-link-form--${t}\n        `,ref:this.setFormRef},d)}}t.SendAppLinkFormComponent=N,N.displayName="SendAppLinkFormComponent",t.SendAppLinkForm=(0,i.requireCssWithComponent)(N,["/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css","/static/metaserver/static/css/growth/send_app_link_form-vflbcEk-x.css"])})),define("metaserver/static/js/growth/ui/send_app_link_form_disclaimer",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/core/i18n","dig-components/tooltips","dig-components/typography"],(function(e,t,s,r,a,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendAppLinkFormDisclaimer=t.SendAppLinkFormDisclaimerComponent=void 0,r=s.__importStar(r);const l=e=>{const{onShowTooltip:t}=e;return(0,r.useEffect)(()=>{t&&t()},[t]),r.default.createElement("span",null,i.intl.formatMessage({id:"tZ+OmK",defaultMessage:"I agree that Dropbox may send me messages using an automatic telephone dialing system at the provided phone number. I understand that I am not required to agree in order to sign up for Dropbox. I understand that standard data and message rates may apply."}))};l.displayName="MyCustomTooltipContent";t.SendAppLinkFormDisclaimerComponent=e=>{const{tabIndex:t=0,size:s,color:a,onShowTooltip:c}=e,d="send-app-link-form-disclaimer__tooltip",u="large"===s?"standard":"xsmall";return r.default.createElement("span",null,r.default.createElement(o.Text,{className:"send-app-link-form-disclaimer",size:u,color:a},i.intl.formatMessage({id:"99UyMq",defaultMessage:"Standard rates apply."})," "),r.default.createElement(n.Tooltip,{placement:"top",title:r.default.createElement(l,{onShowTooltip:c}),id:d},r.default.createElement(o.Text,{size:u,color:a,isBold:!0,tabIndex:t,className:"send-app-link-form-disclaimer__trigger","aria-describedby":d},i.intl.formatMessage({id:"0GIkLa",defaultMessage:"See more"}))))},t.SendAppLinkFormDisclaimerComponent.displayName="SendAppLinkFormDisclaimerComponent",t.SendAppLinkFormDisclaimer=(0,a.requireCssWithComponent)(t.SendAppLinkFormDisclaimerComponent,["/static/metaserver/static/css/growth/send_app_link_form_disclaimer-vflzqd4HK.css"])}));
//# sourceMappingURL=pkg-browse-file-actions.min.js-vflRjAjJd.map