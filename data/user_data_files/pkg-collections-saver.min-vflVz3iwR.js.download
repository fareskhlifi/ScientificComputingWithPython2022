define("metaserver/static/js/collections/api",["require","exports","tslib","metaserver/static/js/edison/edison","js/proto_utils/unpack","typescript/dropbox/proto/collections_messages/collections_messages_pb","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/clean/active_user","metaserver/static/js/collections/types/types","metaserver/static/js/collections/api_utils","metaserver/static/js/video_synthesis/logger"],(function(e,t,s,n,i,o,a,r,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeCollectionMembersAccess=t.downloadCollectionItems=t.downloadSharedCollectionItems=t.getSharedLinksWithSettings=t.modifySharedCollectionLinkSettings=t.revokeCollectionSharedLink=t.createCollectionSharedLink=t.createShortcut=t.moveItem=t.getCollectionsFeatureFlags=t.deleteCollections=t.deleteBatch=t.addCollectionMember=t.createAndAddToCollection=t.addFilesToCollection=t.renameCollection=t.createCollection=t.saveSeedCollection=t.getCollectionItems=t.getCollections=void 0;const m=e=>new Promise(t=>setTimeout(t,e));function _(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const n=(0,l.mustGetActiveUser)(),i=new a.DefaultUserApiV2Client(n).ns("collections"),o=e.result;if("add_bulk_async_job_id"===o[".tag"]){const e=o.add_bulk_async_job_id,n=()=>s.__awaiter(this,void 0,void 0,(function*(){return yield i.rpc("add_bulk_items_check",{async_job_id:e},{})}));let a=yield n();for(;"pending"===a.job_status[".tag"];)yield m(1e3),a=yield n();const{succeeded_items:r,failed_file_identifiers:l}=a.add_bulk_items_result;if("failed"===a.job_status[".tag"]||"other"===a.job_status[".tag"]||0===r.length)throw new Error(t);return{succeededItems:r.map(d.convertCollectionFileFromApiV2ToCollectionItem),failedFileIdentifiers:l.map(d.convertFileIdentifierApiToFileIdentifier)}}if("add_bulk_items_result"===o[".tag"]){const{succeeded_items:e,failed_file_identifiers:t}=o;return{succeededItems:e.map(d.convertCollectionFileFromApiV2ToCollectionItem),failedFileIdentifiers:t.map(d.convertFileIdentifierApiToFileIdentifier)}}throw new Error(t)}))}t.getCollections=function(){return s.__awaiter(this,void 0,void 0,(function*(){let e=void 0;if(window.RUNNING_IN_EDISON){const t=(0,d.getProtoCollectionTypeFilter)();return e=(0,i.unmarshalProto)(yield n.Edison.serviceMethodPrefetch("collections.CollectionsWebInternal","GetAllCollectionsPrefetch",new o.GetAllCollectionsArgs({collectionTypeFilter:t})),o.GetAllCollectionsResponse).collectionInfos,e.map(d.convertCollectionInfoFromProtoToCollectionData)}{const e=(0,l.mustGetActiveUser)(),t=new a.DefaultUserApiV2Client(e).ns("collections"),s=(0,d.getApiV2CollectionTypeFilter)();return(yield t.rpc("get_all_collections",{collection_type_filter:s},{})).collection_infos.map(d.convertCollectionInfoFromApiV2ToCollectionData)}}))},t.getCollectionItems=function(e){return s.__awaiter(this,void 0,void 0,(function*(){return(0,i.unmarshalProto)(yield n.Edison.serviceMethodPrefetch("collections.CollectionsWebInternal","GetCollectionItemsPrefetch",new o.GetCollectionItemsPrefetchArgs({collectionId:decodeURIComponent(e),itemInfoFilter:o.ItemInfoFilter.GET_ALL_INFO})),o.GetCollectionItemsResponse).collectionItems.map(d.convertCollectionFileFromProtoToCollectionItem)}))},t.saveSeedCollection=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(0,l.mustGetActiveUser)(),s=new a.DefaultUserApiV2Client(t).ns("collections"),n={collection_id:e};yield s.rpc("save_seed",n,{})}))},t.createCollection=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(0,l.mustGetActiveUser)(),s=new a.DefaultUserApiV2Client(t).ns("collections"),n={name:e},i=yield s.rpc("create",n,{}),{id:o,name:r}=i.collection_info;return{id:o,name:r,thumbnails:[],numOfItems:0,type:"manual",sharingInfo:{}}}))},t.renameCollection=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={collection_id:e,new_name:t};return yield n.rpc("rename_collection",i,{})}))},t.addFilesToCollection=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={collection_id:e,file_identifiers:null==t?void 0:t.map(d.convertFileIdentifierToFileIdentifierApi)};return _(yield n.rpc("add_bulk_items",i,{}),"collections/add_bulk_items")}))},t.createAndAddToCollection=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={name:e,file_ids:t},o=yield n.rpc("create_and_add_to_collection",i,{}),r=o.create_response.collection_info,c=(0,d.convertCollectionInfoFromApiV2ToCollectionData)(r),u=o.add_response;return{collectionData:c,addResult:yield _(u,"collections/create_and_add")}}))},t.addCollectionMember=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(0,l.mustGetActiveUser)(),s=new a.DefaultUserApiV2Client(t).ns("collections"),n={shared_collection_id:e};return(yield s.rpc("add_collection_member",n,{})).user_collection_id}))},t.deleteBatch=function(e){var t;return s.__awaiter(this,void 0,void 0,(function*(){const n=(0,l.mustGetActiveUser)(),i=new a.DefaultUserApiV2Client(n).ns("collections"),o={item_ids:e},r=yield i.rpc("delete_batch",o,{});if("async_delete_job_id"===(null===(t=r.delete_response)||void 0===t?void 0:t[".tag"])){const e=r.delete_response.async_delete_job_id,t=()=>s.__awaiter(this,void 0,void 0,(function*(){return yield i.rpc("delete_batch_check",{async_job_id:e},{})}));let n=yield t();for(;"pending"===n.status[".tag"];)yield m(1e3),n=yield t();if("failed"===n.status[".tag"]||"other"===n.status[".tag"])throw new Error("collections/delete_batch")}}))},t.deleteCollections=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(0,l.mustGetActiveUser)(),s=new a.DefaultUserApiV2Client(t).ns("collections"),n={collection_ids:e},i=yield s.rpc("delete_collections",n,{});if(i.succesful_deletion_ids)return i.succesful_deletion_ids;throw new Error("collections/delete_collections")}))},t.getCollectionsFeatureFlags=function(){return s.__awaiter(this,void 0,void 0,(function*(){const e=(0,i.unmarshalProto)(yield n.Edison.serviceMethodPrefetch("collections.CollectionsWebInternal","GetCollectionsFeatureFlags"),o.FeatureFlags);return(0,u.setPopulationId)(e.videoSynthesisPopulationId),e}))},t.moveItem=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={item_ids:[e],place_before_item_id:t};yield n.rpc("move_items",i,{})}))},t.createShortcut=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={collection_id:e,url:t},o=yield n.rpc("add_link",i,{});return(0,d.convertCollectionFileFromApiV2ToCollectionItem)(o.item)}))},t.createCollectionSharedLink=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={collection_id:e,link_type:{".tag":t===c.SharedLinkType.View?"view":"edit"}},{url:o,link_settings:r}=yield n.rpc("create_shared_link",i,{});return{url:o,linkSettings:{allowDownload:!!r.allow_download,linkAudience:(0,d.convertSharedLinkAudienceApiToLinkAudience)(r.audience)}}}))},t.revokeCollectionSharedLink=function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(0,l.mustGetActiveUser)(),s=new a.DefaultUserApiV2Client(t).ns("collections"),n={url:e};yield s.rpc("revoke_shared_link",n,{})}))},t.modifySharedCollectionLinkSettings=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={url:e,new_sharing_settings:{allow_download:t.allowDownload}};return{allowDownload:(yield n.rpc("modify_shared_collection_link_settings",i,{})).link_settings.allow_download,linkAudience:t.linkAudience}}))},t.getSharedLinksWithSettings=function(e){var t,n,i,o,r,c,u,m,_,p,f,h,S,I;return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),g=new a.DefaultUserApiV2Client(s).ns("collections"),E={collection_id:e},T=yield g.rpc("get_shared_links_with_settings",E,{});return{viewLink:T.view_link?{url:null===(t=T.view_link)||void 0===t?void 0:t.url,linkSettings:{allowDownload:null===(i=null===(n=T.view_link)||void 0===n?void 0:n.collection_sharing_settings)||void 0===i?void 0:i.allow_download,linkAudience:(0,d.convertSharedLinkAudienceApiToLinkAudience)(null===(r=null===(o=T.view_link)||void 0===o?void 0:o.collection_sharing_settings)||void 0===r?void 0:r.audience)},userLinkPermissions:{canDisallowDownload:null===(u=null===(c=T.view_link)||void 0===c?void 0:c.user_link_permissions)||void 0===u?void 0:u.can_disallow_download}}:void 0,editLink:T.edit_link?{url:null===(m=T.edit_link)||void 0===m?void 0:m.url,linkSettings:{allowDownload:null===(p=null===(_=T.edit_link)||void 0===_?void 0:_.collection_sharing_settings)||void 0===p?void 0:p.allow_download,linkAudience:(0,d.convertSharedLinkAudienceApiToLinkAudience)(null===(h=null===(f=T.edit_link)||void 0===f?void 0:f.collection_sharing_settings)||void 0===h?void 0:h.audience)},userLinkPermissions:{canDisallowDownload:null===(I=null===(S=T.edit_link)||void 0===S?void 0:S.user_link_permissions)||void 0===I?void 0:I.can_disallow_download}}:void 0}}))},t.downloadSharedCollectionItems=function(e,t,n){return s.__awaiter(this,void 0,void 0,(function*(){if(void 0===t&&void 0===n)throw new Error("This endpoint must receive either collection id or a list of item ids of collection items.");const s=(0,l.getActiveUser)(),i=(s?new a.DefaultUserApiV2Client(s):new r.NoAuthApiV2Client).ns("collections"),o={url:e};return void 0!==t?o.shared_items_to_download={".tag":"collection_id",collection_id:t}:void 0!==n&&(o.shared_items_to_download={".tag":"collection_items",item_ids:n}),(yield i.rpc("download_shared_collection_items",o,{})).download_url}))},t.downloadCollectionItems=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(void 0===e&&void 0===t)throw new Error("This endpoint must receive either collection id or a list of item ids of collection items.");const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={};return void 0!==t?i.collection_items_to_download={".tag":"collection_items",item_ids:t}:void 0!==e&&(i.collection_items_to_download={".tag":"collection_id",collection_id:e}),(yield n.rpc("download_collection_items",i,{})).download_url}))},t.removeCollectionMembersAccess=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=(0,l.mustGetActiveUser)(),n=new a.DefaultUserApiV2Client(s).ns("collections"),i={collection_id:e,user_ids:t};yield n.rpc("remove_collection_members_access",i,{})}))}})),define("metaserver/static/js/collections/components/saver_modal/index",["require","exports","tslib","react","metaserver/static/js/core/i18n","dig-components/modal","metaserver/static/js/components/ui/modal_controller","metaserver/static/js/collections/api","metaserver/static/js/collections/logger","metaserver/static/js/collections/components/saver_modal/screens/choose_collection_screen/choose_collection_screen","metaserver/static/js/collections/components/saver_modal/screens/create_and_add_screen"],(function(e,t,s,n,i,o,a,r,l,c,d){"use strict";var u;Object.defineProperty(t,"__esModule",{value:!0}),t.showCollectionSaverModal=void 0,n=s.__importDefault(n),a=s.__importStar(a),r=s.__importStar(r),(function(e){e[e.ChooseCollection=0]="ChooseCollection",e[e.CreateAndAdd=1]="CreateAndAdd"})(u||(u={}));const m=({fileIds:e,surface:t})=>{const[m,_]=n.default.useState(!0),[p,f]=n.default.useState(u.ChooseCollection),[h,S]=n.default.useState(void 0);n.default.useEffect(()=>{(function(){s.__awaiter(this,void 0,void 0,(function*(){const e=yield r.getCollections();S(e)}))})()},[]),n.default.useEffect(()=>{o.Modal.setAppElement(document.getElementById("embedded-app")||document.body)},[]);const I=()=>_(!1);return n.default.createElement(o.Modal,{open:m,onAfterOpen:()=>(0,l.logEntryPointLoaded)(t),onAfterClose:()=>{(0,l.logEntryPointClosed)(t),a.unmountModal()},isCentered:!0,withCloseButton:i.intl.formatMessage({id:"AbzPSt",defaultMessage:"Cancel"}),onRequestClose:I},p===u.ChooseCollection&&n.default.createElement(c.ChooseCollectionScreen,{fileIds:e,surface:t,collections:h,onCreateNewCollectionClick:()=>f(u.CreateAndAdd),closeModal:I}),p===u.CreateAndAdd&&n.default.createElement(d.CreateAndAddScreen,{fileIds:e,surface:t,onBackClick:()=>f(u.ChooseCollection),closeModal:I}))};m.displayName="CollectionSaverModal",t.showCollectionSaverModal=function(e){a.mountModal(n.default.createElement(m,Object.assign({},e)))}})),define("metaserver/static/js/collections/components/saver_modal/screens/choose_collection_screen/choose_collection_screen",["require","exports","tslib","react","metaserver/static/js/core/i18n","dig-components/buttons","dig-components/modal","dig-components/typography","metaserver/static/js/collections/constants","metaserver/static/js/collections/components/saver_modal/screens/choose_collection_screen/choose_collection_screen.module.css","metaserver/static/js/collections/components/saver_modal/screens/choose_collection_screen/list_items","metaserver/static/js/collections/components/saver_modal/api_helper","metaserver/static/js/collections/constants","metaserver/static/js/core/browser"],(function(e,t,s,n,i,o,a,r,l,c,d,u,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChooseCollectionScreen=void 0,n=s.__importDefault(n),c=s.__importDefault(c);const p=i.intl.formatMessage({id:"/2+Mr3",defaultMessage:"Sort later"});t.ChooseCollectionScreen=({fileIds:e,surface:t,onCreateNewCollectionClick:f,closeModal:h,collections:S})=>{const[I,g]=n.default.useState(void 0);let E=null;return E=S?0===S.length?n.default.createElement(n.default.Fragment,null,n.default.createElement(d.CreateNewCollectionListItem,{onCreateNewCollectionClick:f,disabled:!1}),n.default.createElement(d.CreateEmptyStateCollectionListItem,{name:p,selected:(null==I?void 0:I.name)===p,onItemClick:g})):n.default.createElement(n.default.Fragment,null,n.default.createElement(d.CreateNewCollectionListItem,{onCreateNewCollectionClick:f,disabled:S.length>=l.MAX_COLLECTIONS}),S.map(t=>n.default.createElement(d.CollectionListItem,{collection:t,selected:(null==I?void 0:I.id)===t.id,onItemClick:g,key:t.id,disabled:t.numOfItems+e.length>l.MAX_ITEMS_IN_COLLECTION}))):n.default.createElement(n.default.Fragment,null,n.default.createElement(d.CreateNewCollectionListItemPlaceholder,null),n.default.createElement(d.CollectionListItemPlaceholder,null),n.default.createElement(d.CollectionListItemPlaceholder,null),n.default.createElement(d.CollectionListItemPlaceholder,null)),n.default.createElement(n.default.Fragment,null,n.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},n.default.createElement(a.Modal.Title,null,n.default.createElement(r.Title,{size:"small"},i.intl.formatMessage({id:"qIkp0P",defaultMessage:"Add {count} {count, plural, one{item} other{items}} toâ€¦"},{count:e.length})),n.default.createElement("div",{className:c.default.headerSubtitle},n.default.createElement(r.Text,{size:"small"},i.intl.formatMessage({id:"JFM6A7",defaultMessage:"Links to the following items will be added to this collection."})),n.default.createElement(o.Button,{variant:"transparent",size:"small",onClick:()=>{(0,_.open_tab)(m.COLLECTIONS_PAGE_BASENAME)}},i.intl.formatMessage({id:"474n/6",defaultMessage:"Learn more"}))))),n.default.createElement(a.Modal.Body,null,n.default.createElement("div",{className:c.default.collectionsList},E)),n.default.createElement(a.Modal.Footer,null,n.default.createElement(o.Button,{variant:"opacity",onClick:h},i.intl.formatMessage({id:"AqQDNW",defaultMessage:"Cancel"})),n.default.createElement(o.Button,{variant:"primary",onClick:()=>s.__awaiter(void 0,void 0,void 0,(function*(){if(I)return I.id?(0,u.addToCollection)({collectionId:I.id,collectionName:I.name,fileIds:e,surface:t,onBeforeAdd:h}):(0,u.addToCollection)({collectionName:p,fileIds:e,surface:t,onBeforeAdd:h})})),disabled:!I,autoFocus:!0},i.intl.formatMessage({id:"R0RyY9",defaultMessage:"Add"}))))},t.ChooseCollectionScreen.displayName="ChooseCollectionScreen"})),define("metaserver/static/js/collections/components/saver_modal/screens/create_and_add_screen",["require","exports","tslib","react","ts-key-enum","metaserver/static/js/core/i18n","dig-components/buttons","dig-components/modal","dig-components/tooltips","dig-components/text_fields","dig-components/typography","metaserver/static/js/collections/components/saver_modal/screens/create_and_add_screen.module.css","metaserver/static/js/collections/components/saver_modal/api_helper","metaserver/static/js/collections/constants"],(function(e,t,s,n,i,o,a,r,l,c,d,u,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateAndAddScreen=void 0,n=s.__importDefault(n),u=s.__importDefault(u);t.CreateAndAddScreen=({fileIds:e,closeModal:t,onBackClick:p,surface:f})=>{const[h,S]=n.default.useState(""),I=n.default.useRef(null);n.default.useEffect(()=>{var e;null===(e=null==I?void 0:I.current)||void 0===e||e.focus()},[]);const g=()=>s.__awaiter(void 0,void 0,void 0,(function*(){return(0,m.addToCollection)({collectionName:h,fileIds:e,surface:f,onBeforeAdd:t})})),E=o.intl.formatMessage({id:"4aoqDj",defaultMessage:"Create"});return n.default.createElement(n.default.Fragment,null,n.default.createElement(r.Modal.Header,{hasBottomSpacing:"title-standard"},n.default.createElement(r.Modal.Title,null,o.intl.formatMessage({id:"OKqIjj",defaultMessage:"Create a collection"}))),n.default.createElement(r.Modal.Body,null,n.default.createElement("div",{className:u.default.body},n.default.createElement(d.Text,{isBold:!0,variant:"label",size:"small",className:u.default.inputLabel},o.intl.formatMessage({id:"YIRjng",defaultMessage:"Name"})),n.default.createElement(c.TextInput,{ref:I,id:"trigger",onChange:({currentTarget:{value:e}})=>{S(e)},value:h,"aria-label":o.intl.formatMessage({id:"waHocS",defaultMessage:"Enter a name"}),placeholder:o.intl.formatMessage({id:"HA9vtu",defaultMessage:"Enter a name"}),autoComplete:"off",onKeyDown:e=>{e.key===i.Key.Enter&&""!==h&&g()}}))),n.default.createElement(r.Modal.Footer,null,n.default.createElement(a.Button,{variant:"opacity",onClick:p,autoFocus:!0},o.intl.formatMessage({id:"8dbMCL",defaultMessage:"Back"})),e.length>_.MAX_ITEMS_IN_COLLECTION?n.default.createElement(l.Tooltip,{title:o.intl.formatMessage({id:"nDXLeP",defaultMessage:"Your collection has reached the maximum amount of {max_items, number} items. Future updates to allow over {max_items, number} items will be coming soon."},{max_items:_.MAX_ITEMS_IN_COLLECTION}),placement:"top"},n.default.createElement("span",{style:{display:"inline-block"},tabIndex:0},n.default.createElement(a.Button,{variant:"primary",onClick:g,disabled:!0,autoFocus:!0},E))):n.default.createElement(a.Button,{variant:"primary",onClick:g,disabled:""===h,autoFocus:!0},E)))},t.CreateAndAddScreen.displayName="CreateAndAddScreen"})),define("metaserver/static/js/collections/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_EXCLOG_TAGS=t.defaultFeatureFlags=t.MAX_ITEMS_IN_COLLECTION=t.MAX_COLLECTIONS=t.COLLECTIONS_PAGE_BASENAME=void 0,t.COLLECTIONS_PAGE_BASENAME="/collections",t.MAX_COLLECTIONS=100,t.MAX_ITEMS_IN_COLLECTION=100,t.defaultFeatureFlags={isCollectionSharingEnabled:!1,isVideoSynthesisEnabled:!1,isCollectionCollaborativeSharingEnabled:!1,isListViewEnabled:!1,suggestedCollectionsVariant:"OFF",collectionsFeaturePopulationId:"",isSharingSdkEnabled:!1},t.DEFAULT_EXCLOG_TAGS=["collections_client"]})),define("typescript/dropbox/proto/collections_messages/collections_messages_pb",["require","exports","@bufbuild/protobuf","../file_info/file_info_pb","../file_viewer_preview_metadata/shared_file_pb","../file_viewer_preview_metadata/preview_metadata_pb"],(function(e,t,s,n,i,o){"use strict";var a,r,l,c,d;Object.defineProperty(t,"__esModule",{value:!0}),t.SharedCollectionPropsResponse=t.SharedCollectionPropsRequest=t.SharedCollectionInfo=t.SharedLinkInfo=t.SharedLinkSettings=t.SharedItem=t.FeatureFlags=t.GetAllCollectionsResponse=t.GetAllCollectionsArgs=t.GetCollectionItemsPrefetchArgs=t.CollectionPagePrefetchArgs=t.CollectionInfo=t.CollectionSharingInfo=t.Collaborator=t.GetCollectionItemsResponse=t.CollectionItem=t.OriginalIdAndName=t.Item=t.Dimensions=t.SharedCollectionPropsError=t.CollectionType=t.SharedLinkAudience=t.SharedLinkType=t.ItemInfoFilter=void 0,(function(e){e[e.GET_ALL_INFO=0]="GET_ALL_INFO",e[e.NO_ITEM=2]="NO_ITEM",e[e.ITEM_ID_ONLY=3]="ITEM_ID_ONLY"})(a=t.ItemInfoFilter||(t.ItemInfoFilter={})),s.proto3.util.setEnumType(a,"collections_messages.ItemInfoFilter",[{no:0,name:"GET_ALL_INFO"},{no:2,name:"NO_ITEM"},{no:3,name:"ITEM_ID_ONLY"}]),(function(e){e[e.VIEW=0]="VIEW",e[e.EDIT=1]="EDIT"})(r=t.SharedLinkType||(t.SharedLinkType={})),s.proto3.util.setEnumType(r,"collections_messages.SharedLinkType",[{no:0,name:"VIEW"},{no:1,name:"EDIT"}]),(function(e){e[e.INVALID_LINK_AUDIENCE=0]="INVALID_LINK_AUDIENCE",e[e.PUBLIC=1]="PUBLIC",e[e.TEAM_ONLY=2]="TEAM_ONLY",e[e.ACL_ONLY=3]="ACL_ONLY"})(l=t.SharedLinkAudience||(t.SharedLinkAudience={})),s.proto3.util.setEnumType(l,"collections_messages.SharedLinkAudience",[{no:0,name:"INVALID_LINK_AUDIENCE"},{no:1,name:"PUBLIC"},{no:2,name:"TEAM_ONLY"},{no:3,name:"ACL_ONLY"}]),(function(e){e[e.MANUAL=0]="MANUAL",e[e.SEED=1]="SEED",e[e.SAVED_FROM_WEB=2]="SAVED_FROM_WEB",e[e.SUGGESTED=3]="SUGGESTED",e[e.CAPTURES=4]="CAPTURES"})(c=t.CollectionType||(t.CollectionType={})),s.proto3.util.setEnumType(c,"collections_messages.CollectionType",[{no:0,name:"MANUAL"},{no:1,name:"SEED"},{no:2,name:"SAVED_FROM_WEB"},{no:3,name:"SUGGESTED"},{no:4,name:"CAPTURES"}]),(function(e){e[e.INVALID_LINK=0]="INVALID_LINK",e[e.COLLECTION_NOT_ACCESSIBLE=1]="COLLECTION_NOT_ACCESSIBLE"})(d=t.SharedCollectionPropsError||(t.SharedCollectionPropsError={})),s.proto3.util.setEnumType(d,"collections_messages.SharedCollectionPropsError",[{no:0,name:"INVALID_LINK"},{no:1,name:"COLLECTION_NOT_ACCESSIBLE"}]);class u extends s.Message{constructor(e){super(),this.height=s.protoInt64.zero,this.width=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new u).fromBinary(e,t)}static fromJson(e,t){return(new u).fromJson(e,t)}static fromJsonString(e,t){return(new u).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(u,e,t)}}t.Dimensions=u,u.runtime=s.proto3,u.typeName="collections_messages.Dimensions",u.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"height",kind:"scalar",T:4},{no:2,name:"width",kind:"scalar",T:4}]);class m extends s.Message{constructor(e){super(),this.item={case:void 0},this.hasTargetDirectAccess=!1,this.isTargetMountedFile=!1,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new m).fromBinary(e,t)}static fromJson(e,t){return(new m).fromJson(e,t)}static fromJsonString(e,t){return(new m).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(m,e,t)}}t.Item=m,m.runtime=s.proto3,m.typeName="collections_messages.Item",m.fields=s.proto3.util.newFieldList(()=>[{no:6,name:"dimensions",kind:"message",T:u},{no:1,name:"note_content",kind:"scalar",T:9,oneof:"item"},{no:2,name:"link_url",kind:"scalar",T:9,oneof:"item"},{no:5,name:"file",kind:"message",T:n.FileInfo,oneof:"item"},{no:8,name:"shared_file_info",kind:"message",T:i.SharedFile,oneof:"item"},{no:7,name:"preview_metadata",kind:"message",T:o.PreviewMetadata},{no:9,name:"has_target_direct_access",kind:"scalar",T:8},{no:10,name:"is_target_mounted_file",kind:"scalar",T:8}]);class _ extends s.Message{constructor(e){super(),this.id="",this.name="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new _).fromBinary(e,t)}static fromJson(e,t){return(new _).fromJson(e,t)}static fromJsonString(e,t){return(new _).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(_,e,t)}}t.OriginalIdAndName=_,_.runtime=s.proto3,_.typeName="collections_messages.OriginalIdAndName",_.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]);class p extends s.Message{constructor(e){super(),this.id="",this.info={case:void 0},this.name="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new p).fromBinary(e,t)}static fromJson(e,t){return(new p).fromJson(e,t)}static fromJsonString(e,t){return(new p).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(p,e,t)}}t.CollectionItem=p,p.runtime=s.proto3,p.typeName="collections_messages.CollectionItem",p.fields=s.proto3.util.newFieldList(()=>[{no:9,name:"id",kind:"scalar",T:9},{no:12,name:"item_info",kind:"message",T:m,oneof:"info"},{no:11,name:"original_id_and_name",kind:"message",T:_,oneof:"info"},{no:13,name:"name",kind:"scalar",T:9}]);class f extends s.Message{constructor(e){super(),this.collectionItems=[],this.collectionName="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new f).fromBinary(e,t)}static fromJson(e,t){return(new f).fromJson(e,t)}static fromJsonString(e,t){return(new f).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(f,e,t)}}t.GetCollectionItemsResponse=f,f.runtime=s.proto3,f.typeName="collections_messages.GetCollectionItemsResponse",f.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"collection_items",kind:"message",T:p,repeated:!0},{no:2,name:"collection_name",kind:"scalar",T:9}]);class h extends s.Message{constructor(e){super(),this.email="",this.photoUrl="",this.userId="",this.displayName="",this.isOwner=!1,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new h).fromBinary(e,t)}static fromJson(e,t){return(new h).fromJson(e,t)}static fromJsonString(e,t){return(new h).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(h,e,t)}}t.Collaborator=h,h.runtime=s.proto3,h.typeName="collections_messages.Collaborator",h.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"email",kind:"scalar",T:9},{no:2,name:"photo_url",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:4,name:"display_name",kind:"scalar",T:9},{no:5,name:"is_owner",kind:"scalar",T:8}]);class S extends s.Message{constructor(e){super(),this.url="",this.viewLink="",this.editLink="",this.collaborators=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new S).fromBinary(e,t)}static fromJson(e,t){return(new S).fromJson(e,t)}static fromJsonString(e,t){return(new S).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(S,e,t)}}t.CollectionSharingInfo=S,S.runtime=s.proto3,S.typeName="collections_messages.CollectionSharingInfo",S.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"url",kind:"scalar",T:9},{no:2,name:"view_link",kind:"scalar",T:9},{no:3,name:"edit_link",kind:"scalar",T:9},{no:4,name:"collaborators",kind:"message",T:h,repeated:!0},{no:5,name:"view_link_settings",kind:"message",T:P},{no:6,name:"edit_link_settings",kind:"message",T:P}]);class I extends s.Message{constructor(e){super(),this.id="",this.name="",this.numOfItems=0,this.sampleFiles=[],this.collectionType=c.MANUAL,this.nsId=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new I).fromBinary(e,t)}static fromJson(e,t){return(new I).fromJson(e,t)}static fromJsonString(e,t){return(new I).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(I,e,t)}}t.CollectionInfo=I,I.runtime=s.proto3,I.typeName="collections_messages.CollectionInfo",I.fields=s.proto3.util.newFieldList(()=>[{no:6,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:4,name:"num_of_items",kind:"scalar",T:13},{no:5,name:"sample_files",kind:"message",T:m,repeated:!0},{no:7,name:"collection_type",kind:"enum",T:s.proto3.getEnumType(c)},{no:8,name:"sharing_info",kind:"message",T:S},{no:9,name:"ns_id",kind:"scalar",T:4}]);class g extends s.Message{constructor(e){super(),s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new g).fromBinary(e,t)}static fromJson(e,t){return(new g).fromJson(e,t)}static fromJsonString(e,t){return(new g).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(g,e,t)}}t.CollectionPagePrefetchArgs=g,g.runtime=s.proto3,g.typeName="collections_messages.CollectionPagePrefetchArgs",g.fields=s.proto3.util.newFieldList(()=>[]);class E extends s.Message{constructor(e){super(),this.collectionId="",this.itemInfoFilter=a.GET_ALL_INFO,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new E).fromBinary(e,t)}static fromJson(e,t){return(new E).fromJson(e,t)}static fromJsonString(e,t){return(new E).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(E,e,t)}}t.GetCollectionItemsPrefetchArgs=E,E.runtime=s.proto3,E.typeName="collections_messages.GetCollectionItemsPrefetchArgs",E.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"collection_id",kind:"scalar",T:9},{no:2,name:"item_info_filter",kind:"enum",T:s.proto3.getEnumType(a)}]);class T extends s.Message{constructor(e){super(),this.collectionTypeFilter=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new T).fromBinary(e,t)}static fromJson(e,t){return(new T).fromJson(e,t)}static fromJsonString(e,t){return(new T).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(T,e,t)}}t.GetAllCollectionsArgs=T,T.runtime=s.proto3,T.typeName="collections_messages.GetAllCollectionsArgs",T.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"collection_type_filter",kind:"enum",T:s.proto3.getEnumType(c),repeated:!0}]);class v extends s.Message{constructor(e){super(),this.collectionInfos=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new v).fromBinary(e,t)}static fromJson(e,t){return(new v).fromJson(e,t)}static fromJsonString(e,t){return(new v).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(v,e,t)}}t.GetAllCollectionsResponse=v,v.runtime=s.proto3,v.typeName="collections_messages.GetAllCollectionsResponse",v.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"collection_infos",kind:"message",T:I,repeated:!0}]);class A extends s.Message{constructor(e){super(),this.isManualOrderingEnabled=!1,this.isCollectionDynamicFacetsEnabled=!1,this.isCollectionSharingEnabled=!1,this.isCollectionSuggestionItemsEnabled=!1,this.isCollectionSmartThumbnailsEnabled=!1,this.collectionDynamicFacetsVariant="",this.isVideoSynthesisEnabled=!1,this.isCollectionCollaborativeSharingEnabled=!1,this.isListViewEnabled=!1,this.collectionsFeaturePopulationId="",this.videoSynthesisPopulationId="",this.suggestedCollectionsVariant="",this.isSharingSdkEnabled=!1,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new A).fromBinary(e,t)}static fromJson(e,t){return(new A).fromJson(e,t)}static fromJsonString(e,t){return(new A).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(A,e,t)}}t.FeatureFlags=A,A.runtime=s.proto3,A.typeName="collections_messages.FeatureFlags",A.fields=s.proto3.util.newFieldList(()=>[{no:2,name:"is_manual_ordering_enabled",kind:"scalar",T:8},{no:4,name:"is_collection_dynamic_facets_enabled",kind:"scalar",T:8},{no:6,name:"is_collection_sharing_enabled",kind:"scalar",T:8},{no:8,name:"is_collection_suggestion_items_enabled",kind:"scalar",T:8},{no:9,name:"is_collection_smart_thumbnails_enabled",kind:"scalar",T:8},{no:11,name:"collection_dynamic_facets_variant",kind:"scalar",T:9},{no:12,name:"is_video_synthesis_enabled",kind:"scalar",T:8},{no:13,name:"is_collection_collaborative_sharing_enabled",kind:"scalar",T:8},{no:14,name:"is_list_view_enabled",kind:"scalar",T:8},{no:15,name:"collections_feature_population_id",kind:"scalar",T:9},{no:16,name:"video_synthesis_population_id",kind:"scalar",T:9},{no:17,name:"suggested_collections_variant",kind:"scalar",T:9},{no:18,name:"is_sharing_sdk_enabled",kind:"scalar",T:8}]);class C extends s.Message{constructor(e){super(),this.id="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new C).fromBinary(e,t)}static fromJson(e,t){return(new C).fromJson(e,t)}static fromJsonString(e,t){return(new C).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(C,e,t)}}t.SharedItem=C,C.runtime=s.proto3,C.typeName="collections_messages.SharedItem",C.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"shared_file_info",kind:"message",T:i.SharedFile}]);class P extends s.Message{constructor(e){super(),this.allowDownload=!1,this.audience=l.INVALID_LINK_AUDIENCE,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new P).fromBinary(e,t)}static fromJson(e,t){return(new P).fromJson(e,t)}static fromJsonString(e,t){return(new P).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(P,e,t)}}t.SharedLinkSettings=P,P.runtime=s.proto3,P.typeName="collections_messages.SharedLinkSettings",P.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"allow_download",kind:"scalar",T:8},{no:3,name:"audience",kind:"enum",T:s.proto3.getEnumType(l)}]);class w extends s.Message{constructor(e){super(),this.linkType=r.VIEW,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new w).fromBinary(e,t)}static fromJson(e,t){return(new w).fromJson(e,t)}static fromJsonString(e,t){return(new w).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(w,e,t)}}t.SharedLinkInfo=w,w.runtime=s.proto3,w.typeName="collections_messages.SharedLinkInfo",w.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"link_settings",kind:"message",T:P},{no:2,name:"link_type",kind:"enum",T:s.proto3.getEnumType(r)}]);class y extends s.Message{constructor(e){super(),this.collectionName="",this.collectionId="",this.sharedItems=[],this.collectionSharerName="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new y).fromBinary(e,t)}static fromJson(e,t){return(new y).fromJson(e,t)}static fromJsonString(e,t){return(new y).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(y,e,t)}}t.SharedCollectionInfo=y,y.runtime=s.proto3,y.typeName="collections_messages.SharedCollectionInfo",y.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"collection_name",kind:"scalar",T:9},{no:2,name:"collection_id",kind:"scalar",T:9},{no:3,name:"shared_items",kind:"message",T:C,repeated:!0},{no:4,name:"collection_sharer_name",kind:"scalar",T:9},{no:5,name:"link_settings",kind:"message",T:P},{no:6,name:"link_info",kind:"message",T:w}]);class k extends s.Message{constructor(e){super(),this.url="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new k).fromBinary(e,t)}static fromJson(e,t){return(new k).fromJson(e,t)}static fromJsonString(e,t){return(new k).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(k,e,t)}}t.SharedCollectionPropsRequest=k,k.runtime=s.proto3,k.typeName="collections_messages.SharedCollectionPropsRequest",k.fields=s.proto3.util.newFieldList(()=>[{no:3,name:"url",kind:"scalar",T:9}]);class F extends s.Message{constructor(e){super(),this.response={case:void 0},s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new F).fromBinary(e,t)}static fromJson(e,t){return(new F).fromJson(e,t)}static fromJsonString(e,t){return(new F).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(F,e,t)}}t.SharedCollectionPropsResponse=F,F.runtime=s.proto3,F.typeName="collections_messages.SharedCollectionPropsResponse",F.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"shared_collection_info",kind:"message",T:y,oneof:"response"},{no:2,name:"shared_collection_error",kind:"enum",T:s.proto3.getEnumType(d),oneof:"response"}])})),define("typescript/dropbox/proto/file_info/file_info_pb",["require","exports","@bufbuild/protobuf","../per_node_metadata/api_v2_meta_pb","../file_viewer_preview_metadata/preview_metadata_pb"],(function(e,t,s,n,i){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FileInfo=t.FileLockInfo=t.FileType=void 0,(function(e){e[e.INVALID=0]="INVALID",e[e.FILE=1]="FILE",e[e.FOLDER=2]="FOLDER",e[e.PACKAGE=3]="PACKAGE",e[e.SHARED_FOLDER=4]="SHARED_FOLDER",e[e.SANDBOX=5]="SANDBOX",e[e.TEAM_SHARED_FOLDER=6]="TEAM_SHARED_FOLDER",e[e.TEAM_MEMBER_FOLDER=7]="TEAM_MEMBER_FOLDER",e[e.VAULT_FOLDER=8]="VAULT_FOLDER",e[e.FAMILY_SHARED_FOLDER=9]="FAMILY_SHARED_FOLDER",e[e.BACKUP_FOLDER=10]="BACKUP_FOLDER"})(o=t.FileType||(t.FileType={})),s.proto3.util.setEnumType(o,"file_info.FileType",[{no:0,name:"INVALID"},{no:1,name:"FILE"},{no:2,name:"FOLDER"},{no:3,name:"PACKAGE"},{no:4,name:"SHARED_FOLDER"},{no:5,name:"SANDBOX"},{no:6,name:"TEAM_SHARED_FOLDER"},{no:7,name:"TEAM_MEMBER_FOLDER"},{no:8,name:"VAULT_FOLDER"},{no:9,name:"FAMILY_SHARED_FOLDER"},{no:10,name:"BACKUP_FOLDER"}]);class a extends s.Message{constructor(e){super(),this.isLockholder=!1,this.lockholderName="",this.tsLocked=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(a,e,t)}}t.FileLockInfo=a,a.runtime=s.proto3,a.typeName="file_info.FileLockInfo",a.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"is_lockholder",kind:"scalar",T:8},{no:2,name:"lockholder_name",kind:"scalar",T:9},{no:3,name:"ts_locked",kind:"scalar",T:3}]);class r extends s.Message{constructor(e){super(),this.directBlockserverLink="",this.ext="",this.fileId="",this.fqPath="",this.href="",this.icon="",this.isCloudDoc=!1,this.isDir=!1,this.isInTeamFolderTree=!1,this.isSymlink=!1,this.isUnmounted=!1,this.lastModifiedName="",this.mountAccessPerms=[],this.nsId=s.protoInt64.zero,this.nsPath="",this.readOnly=!1,this.revisionId="",this.sizeBytes=s.protoInt64.zero,this.sjid=s.protoInt64.zero,this.deprecatedSortKey=[],this.targetNs=s.protoInt64.zero,this.thumbnailUrlTmpl="",this.ts=s.protoInt64.zero,this.type=o.INVALID,this.sortKey="",this.hasMountAccessPerms=!1,this.openToUrl="",this.isLocked=!1,this.isInVaultFolder=!1,this.hasAutomatedRule=!1,this.isBackupFolder=!1,this.modifiedAgo="",this.agoFromLastActionByUserTs="",this.isInBackupFolder=!1,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new r).fromBinary(e,t)}static fromJson(e,t){return(new r).fromJson(e,t)}static fromJsonString(e,t){return(new r).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(r,e,t)}}t.FileInfo=r,r.runtime=s.proto3,r.typeName="file_info.FileInfo",r.fields=s.proto3.util.newFieldList(()=>[{no:2,name:"direct_blockserver_link",kind:"scalar",T:9},{no:3,name:"ext",kind:"scalar",T:9},{no:4,name:"file_id",kind:"scalar",T:9},{no:5,name:"fq_path",kind:"scalar",T:9},{no:6,name:"href",kind:"scalar",T:9},{no:7,name:"icon",kind:"scalar",T:9},{no:8,name:"is_cloud_doc",kind:"scalar",T:8},{no:9,name:"is_dir",kind:"scalar",T:8},{no:10,name:"is_in_team_folder_tree",kind:"scalar",T:8},{no:11,name:"is_symlink",kind:"scalar",T:8},{no:12,name:"is_unmounted",kind:"scalar",T:8},{no:13,name:"last_modified_name",kind:"scalar",T:9},{no:14,name:"mount_access_perms",kind:"scalar",T:9,repeated:!0},{no:15,name:"ns_id",kind:"scalar",T:4},{no:16,name:"ns_path",kind:"scalar",T:9},{no:17,name:"read_only",kind:"scalar",T:8},{no:18,name:"revision_id",kind:"scalar",T:9},{no:19,name:"size_bytes",kind:"scalar",T:3},{no:20,name:"sjid",kind:"scalar",T:4},{no:21,name:"deprecated_sort_key",kind:"scalar",T:9,repeated:!0},{no:22,name:"target_ns",kind:"scalar",T:4},{no:23,name:"thumbnail_url_tmpl",kind:"scalar",T:9},{no:24,name:"ts",kind:"scalar",T:3},{no:25,name:"type",kind:"enum",T:s.proto3.getEnumType(o)},{no:26,name:"sort_key",kind:"scalar",T:9},{no:27,name:"has_mount_access_perms",kind:"scalar",T:8},{no:28,name:"open_to_url",kind:"scalar",T:9},{no:29,name:"is_locked",kind:"scalar",T:8},{no:30,name:"lock_info",kind:"message",T:a},{no:31,name:"per_node_metadata",kind:"message",T:n.PerNodeMetadataEntity},{no:32,name:"is_in_vault_folder",kind:"scalar",T:8},{no:33,name:"has_automated_rule",kind:"scalar",T:8},{no:34,name:"is_backup_folder",kind:"scalar",T:8},{no:35,name:"modified_ago",kind:"scalar",T:9},{no:36,name:"ago_from_last_action_by_user_ts",kind:"scalar",T:9},{no:37,name:"preview",kind:"message",T:i.PreviewMetadata},{no:38,name:"is_in_backup_folder",kind:"scalar",T:8}])})),define("typescript/dropbox/proto/per_node_metadata/api_v2_meta_pb",["require","exports","@bufbuild/protobuf","./link_node_pb"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerNodeMetadataEntity=t.DeviceInfoEntity=t.BypassBehaviors=void 0;class i extends s.Message{constructor(e){super(),s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new i).fromBinary(e,t)}static fromJson(e,t){return(new i).fromJson(e,t)}static fromJsonString(e,t){return(new i).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(i,e,t)}}t.BypassBehaviors=i,i.runtime=s.proto3,i.typeName="per_node_metadata.BypassBehaviors",i.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"is_vault",kind:"message",T:s.BoolValue},{no:2,name:"is_device_folder",kind:"message",T:s.BoolValue}]);class o extends s.Message{constructor(e){super(),this.deviceId="",this.userId=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new o).fromBinary(e,t)}static fromJson(e,t){return(new o).fromJson(e,t)}static fromJsonString(e,t){return(new o).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(o,e,t)}}t.DeviceInfoEntity=o,o.runtime=s.proto3,o.typeName="per_node_metadata.DeviceInfoEntity",o.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"device_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:3}]);class a extends s.Message{constructor(e){super(),s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(a,e,t)}}t.PerNodeMetadataEntity=a,a.runtime=s.proto3,a.typeName="per_node_metadata.PerNodeMetadataEntity",a.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"bypass_behaviors",kind:"message",T:i},{no:2,name:"suppress_delete",kind:"message",T:s.BoolValue},{no:3,name:"suppress_move",kind:"message",T:s.BoolValue},{no:7,name:"suppress_ns_partition",kind:"message",T:s.BoolValue},{no:8,name:"suppress_shared_link",kind:"message",T:s.BoolValue},{no:6,name:"link_node",kind:"message",T:n.LinkNodeEntity},{no:10,name:"hide_extension",kind:"message",T:s.BoolValue},{no:11,name:"suppress_remote_actions",kind:"message",T:s.BoolValue},{no:12,name:"device_info",kind:"message",T:o},{no:5,name:"suppress_share",kind:"message",T:s.BoolValue}])})),define("typescript/dropbox/proto/per_node_metadata/link_node_pb",["require","exports","@bufbuild/protobuf"],(function(e,t,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LinkNodeEntity=t.LinkNodeAction=void 0,(function(e){e[e.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",e[e.DEVICE_FOLDER_PRE_SETUP=1]="DEVICE_FOLDER_PRE_SETUP",e[e.LIFE_VAULT_PRE_SETUP=2]="LIFE_VAULT_PRE_SETUP",e[e.LIFE_VAULT_POST_SETUP=3]="LIFE_VAULT_POST_SETUP",e[e.PASSWORDS_PRE_SETUP=4]="PASSWORDS_PRE_SETUP",e[e.PASSWORDS_POST_SETUP=5]="PASSWORDS_POST_SETUP"})(n=t.LinkNodeAction||(t.LinkNodeAction={})),s.proto3.util.setEnumType(n,"per_node_metadata.LinkNodeAction",[{no:0,name:"UNKNOWN_ACTION"},{no:1,name:"DEVICE_FOLDER_PRE_SETUP"},{no:2,name:"LIFE_VAULT_PRE_SETUP"},{no:3,name:"LIFE_VAULT_POST_SETUP"},{no:4,name:"PASSWORDS_PRE_SETUP"},{no:5,name:"PASSWORDS_POST_SETUP"}]);class i extends s.Message{constructor(e){super(),this.action=n.UNKNOWN_ACTION,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new i).fromBinary(e,t)}static fromJson(e,t){return(new i).fromJson(e,t)}static fromJsonString(e,t){return(new i).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(i,e,t)}}t.LinkNodeEntity=i,i.runtime=s.proto3,i.typeName="per_node_metadata.LinkNodeEntity",i.fields=s.proto3.util.newFieldList(()=>[{no:1,name:"action",kind:"enum",T:s.proto3.getEnumType(n)}])})),define("metaserver/static/js/file_viewer/container_with_skeleton",["require","exports","tslib","react","typescript/libraries/file-viewer/src/skeleton/preview_skeleton","metaserver/static/js/file_viewer/sdk_file_viewer/preferences_util","metaserver/static/js/core/browser_detection","metaserver/static/js/file_store/utils","typescript/libraries/file-viewer/src/logging/performance","metaserver/static/js/metrics/index","metaserver/static/js/clean/active_user","typescript/libraries/file-viewer/src/core/riviera/api","metaserver/static/js/file_viewer/sdk_file_viewer/experiments","typescript/libraries/file-viewer/src/core/utils/functions","metaserver/static/js/pass/pass_helpers","typescript/libraries/file-viewer/src/core/utils/uuid","metaserver/static/js/pass/store"],(function(e,t,s,n,i,o,a,r,l,c,d,u,m,_,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerWithSkeleton=void 0;const h=(n=s.__importDefault(n)).default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FileViewerContainer:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/file_viewer/container"],t,s)}).then(s.__importStar);return{default:t}})));t.ContainerWithSkeleton=e=>{var t;const{isEmbedded:s}=e,S=(0,d.getActiveUser)(),I=null==S?void 0:S.id,g=!I||(0,o.getRightRailIsCollapsed)(I),E=!I||(0,o.getDocSidebarIsCollapsed)(I),T=(0,r.getFilename)(e.file);var v;(0,l.usePreviewTimingSession)(),v=e.file.preview,n.default.useMemo(()=>{var e;const t=new u.RivieraClientBase;switch(null===(e=null==v?void 0:v.content)||void 0===e?void 0:e[".tag"]){case"ssr_doc":const[e,s]=(0,_.calculatePageRange)(0,m.fileViewerFeatureExperiments.partialPrewarmAllowed);t.fetchDocMetadata(v.content.text_url_tmpl,!0,e,s)}},[]);const A=((e,t,s)=>{const i=n.default.useMemo(f.v4,[]);return n.default.useEffect(()=>{p.PassHelpers.setup({user:null!=e?e:null,passSessionId:i,fileData:{file:t,url:s},skipSharingEndpoints:!1,prevFileData:null})},[e,i,t,s]),i})(S,e.file,null===(t=e.sharedLinkInfo)||void 0===t?void 0:t.url);return n.default.createElement(n.default.Fragment,null,!s&&!(0,a.is_mobile_or_tablet)()&&n.default.createElement(i.Skeleton,{isRightRailCollapsed:g,docSidebarCollapsed:E,preview:e.file.preview,fileName:T,logPerformanceMark:!0,metricsReporter:(0,c.getMetricsReporter)(),partialPrewarmAllowed:m.fileViewerFeatureExperiments.partialPrewarmAllowed,imgSizeOptimizationEnabled:m.fileViewerFeatureExperiments.imgSizeOptimization}),n.default.createElement(n.default.Suspense,{fallback:n.default.createElement("div",null)},n.default.createElement(h,Object.assign({},e,{passSessionId:A}))))},t.ContainerWithSkeleton.displayName="ContainerWithSkeleton"})),define("metaserver/static/js/file_viewer/utils",["require","exports","tslib","react","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/previews/ui/constants","metaserver/static/js/open_in_app/types","metaserver/static/js/core/browser_detection","metaserver/static/js/file_viewer/constants","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/clean/web_user_action_events"],(function(e,t,s,n,i,o,a,r,l,c,d,u,m){"use strict";function _(e){if(e)switch(e){case c.FileViewOriginType.BROWSE:return a.PreviewSourceContext.Browse;case c.FileViewOriginType.COLLECTIONS:return a.PreviewSourceContext.Collections;case c.FileViewOriginType.COMMERCE:return a.PreviewSourceContext.Commerce;case c.FileViewOriginType.HELLOSIGN:return a.PreviewSourceContext.HelloSign;case c.FileViewOriginType.HOME:return a.PreviewSourceContext.Home;case c.FileViewOriginType.PHOTOS:return a.PreviewSourceContext.Photos;case c.FileViewOriginType.RECENTS:return a.PreviewSourceContext.Recents;case c.FileViewOriginType.SEARCH:return a.PreviewSourceContext.Search;case c.FileViewOriginType.STARRED:return a.PreviewSourceContext.Starred;case c.FileViewOriginType.TRANSFER:return a.PreviewSourceContext.Transfer;case c.FileViewOriginType.SHARED_COLLECTION:return a.PreviewSourceContext.SharedCollection;case c.FileViewOriginType.CLIENT_PORTAL:return a.PreviewSourceContext.ClientPortal}const t=i.get_uri().path;return/^\/h$/.test(t)?a.PreviewSourceContext.Home:/^\/starred$/.test(t)?a.PreviewSourceContext.Starred:/^\/recents$/.test(t)?a.PreviewSourceContext.Recents:/^\/search$/.test(t)?a.PreviewSourceContext.Search:/^\/(s|scl\/fi)\//.test(t)?a.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(t)?a.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(t)?a.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(t)?a.PreviewSourceContext.VersionHistory:/^\/(home|work|personal)/.test(t)?a.PreviewSourceContext.Browse:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.getOpenInAppUrls=t.showDocSendSnackbar=t.getSourceAction=t.getSourceContext=void 0,n=s.__importDefault(n),i=s.__importStar(i),l=s.__importStar(l),t.getSourceContext=_,t.getSourceAction=function(){switch(_()){case a.PreviewSourceContext.SharedLinkFile:case a.PreviewSourceContext.SharedLinkFolder:return a.PreviewSourceAction.Visit;default:return a.PreviewSourceAction.Click}},t.showDocSendSnackbar=function(e){setTimeout(()=>{d.Snackbar.show(n.default.createElement(d.Snackbar,{title:o.intl.formatMessage({id:"d93ce2",defaultMessage:"Always save signed documents in Dropbox? You can change this anytime in DocSend settings."}),closeButtonText:o.intl.formatMessage({id:"6NGNJV",defaultMessage:"Not now"}),actionButtonText:o.intl.formatMessage({id:"gM7OF1",defaultMessage:"Yes"}),id:"sync-from-docsend",onActionClick:()=>{e&&u.WebUserActionLog.log(e.id,m.WebUserActionLogEvent.CLICK_DOCSEND_SNACKBAR_YES,{}),window.open("https://docsend.com/settings/company/users/redirect?anchor=apps-settings","_blank")},onCloseClick:()=>{e&&u.WebUserActionLog.log(e.id,m.WebUserActionLogEvent.CLICK_DOCSEND_SNACKBAR_NOT_NOW,{})}}))},0)},t.getOpenInAppUrls=function(e,t,s,n){if(e&&t&&s)return e.open_in_app_data;if(l.iOS&&n){const t=encodeURIComponent(e.fq_path),s=encodeURIComponent(n.id);return{platform:r.OpenInMobileAppPlatform.IPHONE,iOSAppUrl:`dbapi-5://1/viewPath?path=${t}&userId=${s}`,iOSAppStoreUrl:"https://itunes.apple.com/us/app/dropbox/id327630330?mt=8e"}}if(l.is_android()){const e="/dl/home/mobile?mobile_app_fallback";return{platform:r.OpenInMobileAppPlatform.ANDROID_MARKET,androidAppUrl:e}}}})),define("metaserver/static/js/pass/actions",["require","exports","metaserver/static/js/flux/dispatcher","metaserver/static/js/pass/constants"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassActions=void 0;t.PassActions=class{static passPermissionRequest(e){s.Dispatcher.dispatch({type:n.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e}})}static updatePermissions(e,t){s.Dispatcher.dispatch({type:n.ActionTypes.UPDATE_PERMISSIONS,data:{fileId:e,partialPermission:t}})}static fetchPassError(e){s.Dispatcher.dispatch({type:n.ActionTypes.FETCH_PASS_ERROR,data:{fileId:e}})}static fetchPassConcluded(e){s.Dispatcher.dispatch({type:n.ActionTypes.FETCH_PASS_CONCLUDED,data:{fileId:e}})}static receivePresenceDelta(e,t,i,o){s.Dispatcher.dispatch({type:n.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,fileId:t,onlineUniqueUsers:i,offlineUniqueUsers:o}})}static receivePresenceSnapshot(e,t,i){s.Dispatcher.dispatch({type:n.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,fileId:t,onlineUniqueUsers:i}})}static resetPassInfo(e){s.Dispatcher.dispatch({type:n.ActionTypes.RESET_PASS_INFO,data:{fileId:e}})}static updateSeenStateInfo(e,t,i){s.Dispatcher.dispatch({type:n.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{fileId:e,seenStateInfo:t,seenStateCursor:i}})}static updateUserTeamInteractionInfo(e,t){s.Dispatcher.dispatch({type:n.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO,data:{fileId:e,userTeamInteractionInfo:t}})}static updateSeenStateInfoContinue(e,t,i){s.Dispatcher.dispatch({type:n.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{fileId:e,seenStateInfo:t,seenStateCursor:i}})}static discontinueSeenStateInfo(e){s.Dispatcher.dispatch({type:n.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{fileId:e}})}static updateSeenStateUnavailable(e,t){s.Dispatcher.dispatch({type:n.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,fileId:t}})}}})),define("metaserver/static/js/pass/beacon_presence_helpers",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/clean/beacon_nodeps","metaserver/static/js/pass/seen_state_helpers","metaserver/static/js/pass/actions","metaserver/static/js/uuid/uuid","metaserver/static/js/clean/viewer","metaserver/static/js/core/exception","metaserver/static/js/pass/action_timestamps","metaserver/static/js/pass/constants"],(function(e,t,s,n,i,o,a,r,l,c,d,u,m){"use strict";function _(e){r.PassActions.resetPassInfo(e),r.PassActions.fetchPassError(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.BeaconPresenceHelpers=t.BEACON_ONLINE_STATUS=t.BEACON_OFFLINE_STATUS=void 0,o=s.__importStar(o),t.BEACON_OFFLINE_STATUS="",t.BEACON_ONLINE_STATUS="online";class p{static resetClassState(){delete this.receiverData,delete this.transmitterData,delete this.lastFileIdForReceiverTokenRequest,delete this.lastFileIdForTransmitterTokenRequest}static shutdown({beaconFileData:e,user:t,async:s,shouldWritePresence:n=!0}){if(delete this.lastFileIdForReceiverTokenRequest,delete this.lastFileIdForTransmitterTokenRequest,this.transmitterData){const{beaconUserId:i,context:o,identifier:r}=this.transmitterData;this.transmitterData.transmitter.stop(),delete this.transmitterData,!c.Viewer.get_viewer().is_assume_user_session&&n&&a.SeenStateHelpers.updateSeenStateOnResign(t,e,s,i,r,o)}this.receiverData&&this.receiverData.receiver&&(this.receiverData.receiver.stop(),delete this.receiverData)}static receiveBeaconData({beaconFileData:e,user:t,passSessionId:n,onUpdate:i}){return s.__awaiter(this,void 0,void 0,(function*(){const{fileId:s}=e;n&&u.ActionTimestampsTracker.record(m.LoggingActions.RECEIVER_TOKEN_BEGIN,n),this.lastFileIdForReceiverTokenRequest=s;const a=yield this.fetchReceiverToken(t,e);if(this.lastFileIdForReceiverTokenRequest!==s)return;if(a.beacon_presence_error)return r.PassActions.updatePermissions(s,{canReadPresence:!1}),void("no_permission"===a.beacon_presence_error[".tag"]||_(s));r.PassActions.updatePermissions(s,{canReadPresence:!0}),n&&u.ActionTimestampsTracker.record(m.LoggingActions.RECEIVER_TOKEN_RECEIVE,n);const l=[new o.PresenceParams(o.PresenceType.Context,t.account_id,this.APP,a.beacon_presence_info.context,a.beacon_presence_info.token)];this.receiverData&&this.receiverData.receiver&&this.receiverData.receiver.stop(),this.receiverData={authKey:a.beacon_presence_info.auth_key,receiver:new o.Receiver(l,s=>{n&&u.ActionTimestampsTracker.record(m.LoggingActions.PRESENCE_RECEIVE,n);const o=this.parseBeaconUpdates(s[0]);i(o,t.id,e)},()=>this.receiveBeaconData({user:t,beaconFileData:e,passSessionId:n,onUpdate:i})),context:a.beacon_presence_info.context},this.receiverData.receiver.start()}))}static fetchReceiverToken(e,t){const{fileId:s,url:i}=t,o={file_info:f(s,i)};return(new n.UserApiV2Client).ns("file_presence").rpc("get_pass_receiver_token",o,{subjectUserId:e.id})}static isOnline(e){return e&&this.HARMONY_ONLINE_STATUSES.includes(e)||e===t.BEACON_ONLINE_STATUS}static parseBeaconUpdates(e){const t={},s={},n="delta"in e?"delta":"snapshot",i="delta"in e&&e.delta?e.delta:"snapshot"in e&&e.snapshot?e.snapshot:[];for(const e of i){const n=e.agent,i=n.user_id,o=n.source.identifier;this.isOnline(e.status)?(i in t||(t[i]={}),t[i][o]=!0):(i in s||(s[i]={}),s[i][o]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:s,type:n}}static transmitBeaconData({user:e,passSessionId:n,beaconFileData:i,prevBeaconFileData:a}){return s.__awaiter(this,void 0,void 0,(function*(){const{fileId:s}=i;this.transmitterData&&a&&(this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,this.transmitterData.context,t.BEACON_OFFLINE_STATUS)]),setTimeout(()=>{this.transmitterData.transmitter.stop()},1)),n&&u.ActionTimestampsTracker.record(m.LoggingActions.TRANSMITTER_TOKEN_BEGIN,n),this.lastFileIdForTransmitterTokenRequest=s;const c=yield this.fetchTransmitterToken(e,i);if(this.lastFileIdForTransmitterTokenRequest===s){if(c.beacon_presence_error)return r.PassActions.updatePermissions(s,{canWritePresence:!1}),void("no_permission"===c.beacon_presence_error[".tag"]||_(s));r.PassActions.updatePermissions(s,{canWritePresence:!0}),n&&u.ActionTimestampsTracker.record(m.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,n),this.transmitterData={identifier:l.UUID.v4({allowInsecure:!0}),beaconUserId:c.beacon_presence_info.beacon_user_id,authKey:c.beacon_presence_info.auth_key,transmitter:new o.Transmitter(c.beacon_presence_info.token,()=>this.transmitBeaconData({user:e,passSessionId:n,beaconFileData:i,prevBeaconFileData:null})),context:c.beacon_presence_info.context},this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,this.transmitterData.context,t.BEACON_ONLINE_STATUS)]),this.transmitterData.transmitter.start()}}))}static getAgentStatusForFile(e,t,s,n,i){const a=new o.Source(this.PLATFORM,this.SURFACE,t),r=new o.Agent(e,this.APP,n,a);return new o.AgentStatus(r,i,s)}static fetchTransmitterToken(e,t){const{fileId:s,url:o}=t,a={file_info:f(s,o)};return e||o||(0,d.reportStack)("For logged out user URL is needed for get_pass_transmitter_token",{tags:["file_presence","file_presence_js"],severity:"non-critical"}),e?(new n.UserApiV2Client).ns("file_presence").rpc("get_pass_transmitter_token",a,{subjectUserId:e.id}):(new i.NoAuthApiV2Client).ns("file_presence").rpc("logged_out/get_pass_transmitter_token",a,{})}}function f(e,t){return t?{".tag":"shared_link_details",url:t}:{".tag":"file_identifier",file_identifier:e}}t.BeaconPresenceHelpers=p,p.APP="harmony",p.PLATFORM=o.Platforms.WEB,p.SURFACE="file_viewer",p.HARMONY_ONLINE_STATUSES=["modifier","viewer"]})),define("metaserver/static/js/pass/pass_helpers",["require","exports","metaserver/static/js/file_viewer/utils","metaserver/static/js/previews/ui/constants","metaserver/static/js/pass/actions","metaserver/static/js/pass/beacon_presence_helpers","metaserver/static/js/pass/seen_state_helpers","metaserver/static/js/pass/types","metaserver/static/js/pass/constants","metaserver/static/js/sharing/actions/sharing_actions","metaserver/static/js/clean/viewer"],(function(e,t,s,n,i,o,a,r,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassHelpers=void 0;const u=l.MAX_FACES_NORMAL+l.MAX_OVERFLOW_BUTTON_INDICATOR+1;class m{static setup({user:e,fileData:t,prevFileData:s,passSessionId:n,shouldWritePresence:o=!0,skipSharingEndpoints:a=!1,limit:r=150}){const l=t.file.file_id;this.shouldInitializePass(e,l,o)&&setTimeout(()=>{i.PassActions.passPermissionRequest(l),m.makeAllRequests({user:e,fileData:t,prevFileData:s,passSessionId:n,shouldWritePresence:o,skipSharingEndpoints:a,limit:r})},0)}static teardown({user:e,fileData:t,async:s,shouldWritePresence:n=!0}){const{file:i,url:a}=t,l=i.file_id;if(this.shouldInitializePass(e,l,n)){m.removeUnloadHandler();const t=new r.BeaconFileData(l,a);o.BeaconPresenceHelpers.shutdown({beaconFileData:t,user:e,async:s,shouldWritePresence:n})}}static shouldInitializePass(e,t,i){return(0,s.getSourceContext)()!==n.PreviewSourceContext.SharedLinkCollection&&(null!==e||i)&&t}static onBeaconUpdate(e,t,s){const n=s.fileId;"delta"===e.type?i.PassActions.receivePresenceDelta(t,n,e.onlineUniqueUsers,e.offlineUniqueUsers):"snapshot"===e.type&&i.PassActions.receivePresenceSnapshot(t,n,e.onlineUniqueUsers)}static makeAllRequests({user:e,fileData:t,prevFileData:s,passSessionId:n,limit:l=150,shouldWritePresence:_=!0,skipSharingEndpoints:p=!1}){const{file:f,url:h}=t,{file_id:S,fq_path:I}=f,g=S||I,E=new r.BeaconFileData(f.file_id,h);e?(g&&!p&&(c.SharingActions.fetchFileMemberCount({user:e,contentId:g,limit:u,countGroupsAsMembers:!1,url:h,passSessionId:n,runViewerInfoChecks:!0}),c.SharingActions.listMembers({user:e,contentId:g,isFolder:!1,limit:6,url:h,passSessionId:n,includeSeenState:!1})),a.SeenStateHelpers.fetchSeenStateInfo(e,S,l,h,n),o.BeaconPresenceHelpers.receiveBeaconData({beaconFileData:E,user:e,passSessionId:n,onUpdate:this.onBeaconUpdate})):i.PassActions.updatePermissions(S,{canReadPresence:!1,canReadSeenState:!1});const T=d.Viewer.get_viewer().is_assume_user_session;if(!_||T)i.PassActions.updatePermissions(S,{canWritePresence:!1});else{const i=s&&new r.BeaconFileData(s.file,s.url);o.BeaconPresenceHelpers.transmitBeaconData({user:e,passSessionId:n,beaconFileData:E,prevBeaconFileData:i}),m.removeUnloadHandler(),m.onUnload=s=>(this.teardown({user:e,fileData:t,async:!1,shouldWritePresence:!0}),s.returnValue=void 0,null),document.addEventListener("beforeunload",m.onUnload)}}}t.PassHelpers=m,m.removeUnloadHandler=()=>{m.onUnload&&document.removeEventListener("beforeunload",m.onUnload),m.onUnload=void 0}})),define("metaserver/static/js/pass/seen_state_helpers",["require","exports","tslib","metaserver/static/js/api_v2/transport/fetch","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/api_v2/error","metaserver/static/js/api_v2/types","metaserver/static/js/pass/actions","metaserver/static/js/pass/constants","metaserver/static/js/pass/action_timestamps"],(function(e,t,s,n,i,o,a,r,l,c,d){"use strict";function u(e){l.PassActions.resetPassInfo(e),l.PassActions.fetchPassError(e)}function m(e,t){return{file_identifier:e,shared_link_details:t?{url:t}:void 0}}var _;Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStateHelpers=t.APITransport=void 0,(function(e){e.create=function(e){return e?new n.FetchAsyncTransport:new n.FetchSyncTransport}})(_=t.APITransport||(t.APITransport={}));t.SeenStateHelpers=class{static constructFakeSeenStateInfo(e,t,s){const n=s.seen_states,i=[];for(const e of n)i.push(e.seen_state_user.user_id);for(const s of e)if(!i.includes(s.user_id)){s.sharing_access_type&&(s.sharing_access_type=this.convertToUnion(s.sharing_access_type));const e={seen_state_user:s,when_last_seen:t,seen_events:[]};n.unshift(e)}return s.seen_states=n,s}static convertToUnion(e){return e?r.Union.parse(e):null}static parseSeenStatePassPlatform(e){if(e){switch(r.Union.parse(e).type){case"web":return c.PassPlatform.WEB;case"mobile":return c.PassPlatform.MOBILE;case"desktop":return c.PassPlatform.DESKTOP}}return c.PassPlatform.UNKNOWN}static fetchSeenStateUsers(e,t,n,o,r,_){return s.__awaiter(this,void 0,void 0,(function*(){const s=Date.now()/1e3;_&&d.ActionTimestampsTracker.record(c.LoggingActions.SEEN_STATE_USERS_BEGIN,_);const p=yield(new i.UserApiV2Client).ns("seen_state").rpc("get_seen_state_users",{user_ids:n,file_info:m(o,r)},{subjectUserId:e}).catch((0,a.catchApiError)(()=>(u(o),Promise.reject(void 0))));_&&d.ActionTimestampsTracker.record(c.LoggingActions.SEEN_STATE_USERS_RECEIVE,_);const f=this.constructFakeSeenStateInfo(p,s,t);l.PassActions.updateSeenStateInfo(o,f)}))}static processAndUpdateSeenStateInfo(e,t,s,n){const{seen_state_info:i,seen_state_error:o,seen_state_cursor:a}=s[0];if(o)if(n)l.PassActions.discontinueSeenStateInfo(t);else{if("no_permission"===r.Union.parse(o).type)return;u(t)}else{for(const e of i.seen_states)e.seen_state_user.sharing_access_type=this.convertToUnion(e.seen_state_user.sharing_access_type),e.platform_type=this.parseSeenStatePassPlatform(e.platform_type);n?l.PassActions.updateSeenStateInfoContinue(t,i,a):l.PassActions.updateSeenStateInfo(t,i,a)}}static fetchSeenStateInfo(e,t,n,o,r){return s.__awaiter(this,void 0,void 0,(function*(){r&&d.ActionTimestampsTracker.record(c.LoggingActions.SEEN_STATE_BEGIN,r);const s=yield(new i.UserApiV2Client).ns("seen_state").rpc("get_seen_state_info",{file_infos:[m(t,o)],limit:n},{subjectUserId:e.id}).catch((0,a.catchApiError)(()=>(u(t),Promise.reject(void 0))));let _=!0;const{seen_state_info:p,seen_state_error:f}=s[0];_=!(!p||f),l.PassActions.updatePermissions(t,{canReadSeenState:_}),_||l.PassActions.updateSeenStateUnavailable(e.id,t),_&&r&&d.ActionTimestampsTracker.record(c.LoggingActions.SEEN_STATE_RECEIVE,r),this.processAndUpdateSeenStateInfo(e,t,s,!1),_&&this.fetchRemainingSeenStateInfo(e,t,s,o)}))}static fetchRemainingSeenStateInfo(e,t,s,n){const i=s[0].seen_state_cursor;if(i&&i.has_next){const s=i.cursor_state;s&&this.fetchSeenStateInfoContinue(e,t,s,1e5,n)}}static fetchSeenStateInfoContinue(e,t,n,o,r){return s.__awaiter(this,void 0,void 0,(function*(){const s=yield(new i.UserApiV2Client).ns("seen_state").rpc("get_seen_state_info/continue",{file_infos:[m(t,r)],cursor:n,limit:o},{subjectUserId:e.id}).catch((0,a.catchApiError)(()=>(l.PassActions.discontinueSeenStateInfo(t),Promise.reject(void 0))));this.processAndUpdateSeenStateInfo(e,t,s,!0)}))}static updateSeenStateOnResign(e,t,s,n,a,r){const l=_.create(s);return(function(e,t,s,n,a){return e?t(new i.UserApiV2Client(a).ns("seen_state"),n,{subjectUserId:e.id}):s(new o.NoAuthApiV2Client(a).ns("seen_state"),n,{})})(e,(e,t,s)=>e.rpc("update_timestamps_and_mark_offline",t,s),(e,t,s)=>e.rpc("logged_out/mark_offline",t,s),{beacon_infos:[{beacon_user_id:n,context:r,shared_link_url:t.url,identifier:a}]},l)}}})),define("metaserver/static/js/pass/store",["require","exports","tslib","lodash","metaserver/static/js/flux/base_store","metaserver/static/js/pass/constants","metaserver/static/js/pass/utils","metaserver/static/js/core/assert","metaserver/static/js/core/exception"],(function(e,t,s,n,i,o,a,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passStore=t.PassStore=void 0,n=s.__importStar(n),l=s.__importStar(l);class c{constructor(){this.userIdToUniqueIds={}}addUniqueUser(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0}removeUniqueUser(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])}getOnlineUserIds(){return Object.keys(this.userIdToUniqueIds)}}class d extends i.Store{constructor(e){super(e),this.seenStateInfos={},this.seenStateCursors={},this.presenceInfos={},this.passFetchingStatusMap={},this.userIdsWithoutSeenStateInfoMap={},this.userIdsWithoutTeamInteractionInfoMap={},this.userTeamInteractionInfoMap={},this.passPermissions={}}presence(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null}seenStateInfo(e){return this.seenStateInfos[e]||null}identifiedSeenStateInfo(e){if(e in this.seenStateInfos){return{seen_states:n.reject(this.seenStateInfos[e].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null}seenStateCursorHasNext(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null}seenStateCursorState(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null}passFetchingStatus(e){return this.passFetchingStatusMap[e]||o.PassFetchingStatus.NOT_YET_KNOWN}getLinkAndGroupSeenStateInfo(e){let t=null,s=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:s};t=[],s={};for(const n of this.seenStateInfos[e].seen_states)if(!a.AnonymousViewerUtils.isAnonymousSeenState(n)){const{seen_state_user:{sharing_access_type:e}}=n;if(e)switch(e.type){case"link_only":case"view_link_access":case"edit_link_access":t.push(n);break;case"view_member_access":case"edit_member_access":const i=e.value.group_ids;for(const e of i)e in s||(s[e]=[]),s[e].push(n)}}return{linkSeenStateInfo:t,groupSeenStateInfo:s}}anonymousPresence(e){return e in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null}userIdsWithoutSeenStateInfo(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]}userIdsWithoutTeamInteractionInfo(e){return this.userIdsWithoutTeamInteractionInfoMap[e]||[]}userTeamInteractionInfo(e){return this.userTeamInteractionInfoMap[e]||{}}isPassPermissionsPending(e){const t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))}getPassPermissions(e){if(!e)return null;const t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t}resetPassInfo(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()}setPassPermissionRequest(e){this.passPermissions[e]||(this.passPermissions[e]={}),this.setPassFetchingStatus(e,o.PassFetchingStatus.FETCHING)}updatePermissions(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=Object.assign(Object.assign({},this.passPermissions[e]),t),this.emit_change())}markPassConcludedIfNecessary(e){const t=this.passPermissions[e];!(t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState"))||t.canReadPresence||t.canReadSeenState||(this.resetPassInfo(e),this.setPassFetchingStatus(e,o.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))}receivePresenceDelta(e,t,s,n){(0,r.assert)(-1===[o.PassFetchingStatus.FETCHING,o.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");const i=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,s,n),this.updateUserIdsWithoutSeenStateInfo(e,t,i),this.emit_change()}receivePresenceSnapshot(e,t,s){(0,r.assert)(-1===[o.PassFetchingStatus.FETCHING,o.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence snapshot, you must call assurePresenceSuccessRegistered");const n=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new c,this.updatePresenceInfos(t,s,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,n),this.emit_change()}getOnlineUsersForFileId(e){return e in this.presenceInfos||(this.presenceInfos[e]=new c),this.presenceInfos[e].getOnlineUserIds()}updatePresenceInfos(e,t,s){for(const t of Object.keys(s))for(const n of Object.keys(s[t]))this.presenceInfos[e].removeUniqueUser(t,n);for(const s of Object.keys(t))for(const n of Object.keys(t[s]))this.presenceInfos[e].addUniqueUser(s,n)}updateUserIdsWithoutSeenStateInfo(e,t,s){let i;const r=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),l=a.AnonymousViewerUtils.filterAnonymousUserIds(s),c=n.difference(l,r),d=n.difference(r,l);if(t in this.seenStateInfos){let e;const s=this.passFetchingStatus(t);if(-1!==[o.PassFetchingStatus.SEEN_STATE_DISALLOWED,o.PassFetchingStatus.PASS_MIXED_SUCCESS].indexOf(s))({userIdsWithoutSeenStateInfo:i,baseSeenStateInfo:e}=this.createMinimalBaseSeenStateInfo(t,r)),this.updateSeenStateInfo(t,e);else{const s=this.makeSeenStateAgreeWithUpdatedPresence(t,r,c,d);({userIdsWithoutSeenStateInfo:i,baseSeenStateInfo:e}=s)}}else i=[];this.userIdsWithoutSeenStateInfoMap[t]=i}makeSeenStateAgreeWithUpdatedPresence(e,t,s,n){const i=[],o=this.seenStateInfos[e],a=o.seen_states,r=[],l=[],c=[],d=Date.now()/1e3;for(const e of a){const t=e.seen_state_user.user_id;t&&(i.push(t),n.includes(t)?(e.when_last_seen=d,e.seen_events=e.seen_events||[],l.push(e)):s.includes(t)?(e.when_last_seen=d,e.seen_events=e.seen_events||[],e.seen_events.push({ts:d}),c.push(e)):r.push(e))}return o.seen_states=[...l,...c,...r],{userIdsWithoutSeenStateInfo:t.filter(e=>!i.includes(e)),baseSeenStateInfo:o}}createMinimalBaseSeenStateInfo(e,t){const s=[],i=[];for(const n of this.seenStateInfos[e].seen_states){const e=n.seen_state_user.user_id;e&&t.includes(e)&&(s.push(n),i.push(e))}return{userIdsWithoutSeenStateInfo:n.difference(t,i),baseSeenStateInfo:{seen_states:s}}}updateSeenStateInfo(e,t,s=!1){(0,r.assert)(-1===[null,o.PassFetchingStatus.FETCHING].indexOf(this.passFetchingStatus(e)),"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),s&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutTeamInteractionInfoMap[e]=this.userIdsWithoutSeenStateInfoMap[e],this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()}updateSeenStateInfoWithEmptyData(e){this.updateSeenStateInfo(e,{seen_states:[]})}setPassFetchingStatus(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()}updateSeenStateCursor(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())}assureSeenStateSuccessRegistered(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.SEEN_STATE_SUCCESS);break;case o.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_SUCCESS);break;case o.PassFetchingStatus.SEEN_STATE_DISALLOWED:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:l.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case o.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}onFetchSeenStateDisabled(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.SEEN_STATE_DISALLOWED);break;case o.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}assurePresenceSuccessRegistered(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_SUCCESS);break;case o.PassFetchingStatus.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.PRESENCE_SUCCESS);break;case o.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}updateUserTeamInteractionInfo(e,t){if(e in t)for(const s of Object.keys(t))this.userTeamInteractionInfoMap[e][s]=t[s];else this.userTeamInteractionInfoMap[e]=t;this.userIdsWithoutTeamInteractionInfoMap[e]=[],this.emit_change()}_new_payload(e){const{type:t,data:s}=e.action;if(!s)return;let{userId:n,fileId:i,teamId:a,seenStateInfo:r,seenStateCursor:l,onlineUniqueUsers:c,offlineUniqueUsers:d,partialPermission:u,userTeamInteractionInfo:m,userTeamInteractionUserIds:_}=s;switch(n=n,i=i,a=a,r=r,l=l,c=c,d=d,u=u,m=m,_=_,t){case o.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(i,o.PassFetchingStatus.ERROR);break;case o.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(i,o.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(i);break;case o.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(i);break;case o.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(i),this.receivePresenceDelta(n,i,c,d);break;case o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(i),this.receivePresenceSnapshot(n,i,c);break;case o.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(i);break;case o.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(i,u),this.markPassConcludedIfNecessary(i);break;case o.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:l={cursor_state:"",has_next:!1},this.updateSeenStateCursor(i,l);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(i),this.updateSeenStateInfo(i,r),this.updateSeenStateCursor(i,l);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(i),this.updateSeenStateInfo(i,r,!0),this.updateSeenStateCursor(i,l);break;case o.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(i),this.updateSeenStateInfoWithEmptyData(i),this.updateUserIdsWithoutSeenStateInfo(n,i,[]);break;case o.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO:this.updateUserTeamInteractionInfo(i,m)}}}t.PassStore=d,t.passStore=new d})),define("metaserver/static/js/pass/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BeaconFileData=t.FacepileInfo=t.UserInfo=void 0;t.UserInfo=class{constructor(e,t,s,n,i,o,a,r,l,c,d,u,m){this.key=e,this.displayName=t,this.isActive=s,this.isViewer=n,this.incrementOverflowBasis=i,this.email=o,this.accessLevel=a,this.whenLastSeen=r,this.photoUrl=l,this.userId=c,this.platformType=d,this.same_team=u,this.is_guest=m}};class s{constructor(e,t){this.isLoaded=e,this.data=t}static create(e){return new s(!0,e)}static createNotLoaded(){return new s(!1,null)}}t.FacepileInfo=s;t.BeaconFileData=class{constructor(e,t){this.fileId=e,this.url=t}}}));
//# sourceMappingURL=pkg-collections-saver.min.js-vfliS4mPR.map